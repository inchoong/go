
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>test --- Python 回归测试包 &#8212; Python 3.11.0 文档</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?2022.1" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 3.11.0 文档 中搜索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="关于这些文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="copyright" title="版权所有" href="../copyright.html" />
    <link rel="next" title="调试和分析" href="debug.html" />
    <link rel="prev" title="2to3 --- Automated Python 2 to 3 code translation" href="2to3.html" />
    <link rel="canonical" href="https://docs.python.org/3/library/test.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://www.python.org/" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="快速搜索"/>
            <input type="submit" value="转向"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code> ---  Python 回归测试包</a><ul>
<li><a class="reference internal" href="#writing-unit-tests-for-the-test-package">为 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code> 包编写单元测试</a></li>
<li><a class="reference internal" href="#running-tests-using-the-command-line-interface">使用命令行界面运行测试</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-test.support"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code> --- 针对 Python 测试套件的工具</a></li>
<li><a class="reference internal" href="#module-test.support.socket_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.socket_helper</span></code> --- 用于套接字测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.script_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.script_helper</span></code> --- 用于 Python 执行测试工具</a></li>
<li><a class="reference internal" href="#module-test.support.bytecode_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.bytecode_helper</span></code> --- 用于测试正确字节码生成的支持工具</a></li>
<li><a class="reference internal" href="#module-test.support.threading_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.threading_helper</span></code> --- 用于线程测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.os_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.os_helper</span></code> --- 用于操作系统测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.import_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.import_helper</span></code> --- 用于导入测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.warnings_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.warnings_helper</span></code> --- 用于警告测试的工具</a></li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="2to3.html"
                          title="上一章">2to3 --- Automated Python 2 to 3 code translation</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="debug.html"
                          title="下一章">调试和分析</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/test.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="debug.html" title="调试和分析"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="2to3.html" title="2to3 --- Automated Python 2 to 3 code translation"
             accesskey="P">上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 标准库</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="development.html" accesskey="U">开发工具</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code> ---  Python 回归测试包</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-test">
<span id="test-regression-tests-package-for-python"></span><h1><a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> ---  Python 回归测试包<a class="headerlink" href="#module-test" title="永久链接至标题">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> 包只供 Python 内部使用。它的记录是为了让 Python 的核心开发者受益。我们不鼓励在 Python 标准库之外使用这个包，因为这里提到的代码在 Python 的不同版本之间可能会改变或被删除而不另行通知。</p>
</div>
<hr class="docutils" />
<p><a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> 包包含了 Python 的所有回归测试，以及 <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 和 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test.regrtest</span></code> 模块。  <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 用于增强你的测试，而 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test.regrtest</span></code> 驱动测试套件。</p>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">test`包中每个名字以</span> <span class="pre">``test_`</span></code> 开头的模块都是一个特定模块或功能的测试套件。所有新的测试应该使用 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> 或 <a class="reference internal" href="doctest.html#module-doctest" title="doctest: Test pieces of code within docstrings."><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> 模块编写。一些旧的测试是使用“传统”的测试风格编写的，即比较打印出来的输出到``sys.stdout``；这种测试风格被认为是过时的。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt>模块 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a></dt><dd><p>编写 PyUnit 回归测试.</p>
</dd>
<dt><a class="reference internal" href="doctest.html#module-doctest" title="doctest: Test pieces of code within docstrings."><code class="xref py py-mod docutils literal notranslate"><span class="pre">doctest</span></code></a> --- 文档测试模块</dt><dd><p>嵌入到文档字符串的测试。</p>
</dd>
</dl>
</div>
<section id="writing-unit-tests-for-the-test-package">
<span id="writing-tests"></span><h2>为 <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> 包编写单元测试<a class="headerlink" href="#writing-unit-tests-for-the-test-package" title="永久链接至标题">¶</a></h2>
<p>使用 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> 模块的测试最好是遵循一些准则。 其中一条是测试模块的名称要以 <code class="docutils literal notranslate"><span class="pre">test_</span></code> 打头并以被测试模块的名称结尾。 测试模块中的测试方法应当以 <code class="docutils literal notranslate"><span class="pre">test_</span></code> 打头并以该方法所测试的内容的说明结尾。 这很有必要因为这样测试驱动程序就会将这些方法识别为测试方法。 此外，该方法不应当包括任何文档字符串。 应当使用注释 (例如 <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Tests</span> <span class="pre">function</span> <span class="pre">returns</span> <span class="pre">only</span> <span class="pre">True</span> <span class="pre">or</span> <span class="pre">False</span></code>) 来为测试方法提供文档说明。 这样做是因为文档字符串如果存在则会被打印出来因此无法指明正在运行哪个测试。</p>
<p>有一个基本模板经常会被使用:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>

<span class="k">class</span> <span class="nc">MyTestCase1</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="c1"># Only use setUp() and tearDown() if necessary</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span> <span class="n">code</span> <span class="n">to</span> <span class="n">execute</span> <span class="ow">in</span> <span class="n">preparation</span> <span class="k">for</span> <span class="n">tests</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span> <span class="n">code</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">to</span> <span class="n">clean</span> <span class="n">up</span> <span class="n">after</span> <span class="n">tests</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">test_feature_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Test feature one.</span>
        <span class="o">...</span> <span class="n">testing</span> <span class="n">code</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">test_feature_two</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Test feature two.</span>
        <span class="o">...</span> <span class="n">testing</span> <span class="n">code</span> <span class="o">...</span>

    <span class="o">...</span> <span class="n">more</span> <span class="n">test</span> <span class="n">methods</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">MyTestCase2</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span> <span class="n">same</span> <span class="n">structure</span> <span class="k">as</span> <span class="n">MyTestCase1</span> <span class="o">...</span>

<span class="o">...</span> <span class="n">more</span> <span class="n">test</span> <span class="n">classes</span> <span class="o">...</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>这种代码模式允许测试套件由 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test.regrtest</span></code> 运行，作为支持 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> CLI 的脚本单独运行，或者通过 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">unittest</span></code> CLI 来运行。</p>
<p>回归测试的目标是尝试破坏代码。 这引出了一些需要遵循的准则:</p>
<ul>
<li><p>测试套件应当测试所有的类、函数和常量。 这不仅包括要向外界展示的外部 API 也包括“私有”的代码。</p></li>
<li><p>白盒测试（在编写测试时检查被测试的代码）是最推荐的。 黑盒测试（只测试已发布的用户接口）因不够完整而不能确保所有边界和边缘情况都被测试到。</p></li>
<li><p>确保所有可能的值包括无效的值都被测试到。 这能确保不仅全部的有效值都可被接受而且不适当的值也能被正确地处理。</p></li>
<li><p>消耗尽可能多的代码路径。 测试发生分支的地方从而调整输入以确保通过代码采取尽可能多的不同路径。</p></li>
<li><p>为受测试的代码所发现的任何代码缺陷添加明确的测试。 这将确保如果代码在将来被改变错误也不会再次出现。</p></li>
<li><p>确保在你的测试完成后执行清理（例如关闭并删除所有临时文件）。</p></li>
<li><p>如果某个测试依赖于操作系统上的特定条件那么要在尝试测试之前先验证该条件是否已存在。</p></li>
<li><p>尽可能少地导入模块并尽可能快地完成操作。 这可以最大限度地减少测试的外部依赖性并且还可以最大限度地减少导入模块带来的附带影响所导致的异常行为。</p></li>
<li><p>尝试最大限度地重用代码。 在某些情况下，测试结果会因使用不同类型的输入这样的小细节而变化。 可通过一个指定输入的类来子类化一个基本测试类来最大限度地减少重复代码:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestFuncAcceptsSequencesMixin</span><span class="p">:</span>

    <span class="n">func</span> <span class="o">=</span> <span class="n">mySuperWhammyFunction</span>

    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AcceptLists</span><span class="p">(</span><span class="n">TestFuncAcceptsSequencesMixin</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">AcceptStrings</span><span class="p">(</span><span class="n">TestFuncAcceptsSequencesMixin</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span>

<span class="k">class</span> <span class="nc">AcceptTuples</span><span class="p">(</span><span class="n">TestFuncAcceptsSequencesMixin</span><span class="p">,</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>当使用这种模式时，请记住所有继承自 <a class="reference internal" href="unittest.html#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a> 的类都会作为测试来运行。 上面例子中的 <code class="xref py py-class docutils literal notranslate"><span class="pre">Mixin</span></code> 类没有任何数据所以其本身是无法运行的，因此它不是继承自 <a class="reference internal" href="unittest.html#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a>。</p>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt>测试驱动的开发</dt><dd><p>Kent Beck 所著的阐述在实现代码之前编写驱动的书。</p>
</dd>
</dl>
</div>
</section>
<section id="running-tests-using-the-command-line-interface">
<span id="regrtest"></span><h2>使用命令行界面运行测试<a class="headerlink" href="#running-tests-using-the-command-line-interface" title="永久链接至标题">¶</a></h2>
<p>通过使用 <a class="reference internal" href="../using/cmdline.html#cmdoption-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> 选项 <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> 包可以作为脚本运行以驱动 Python 的回归测试套件: <strong class="program">python -m test</strong>。 在内部，它使用 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test.regrtest</span></code>；之前 Python 版本所使用的 <strong class="program">python -m test.regrtest</strong> 调用仍然有效。 运行该脚本自身会自动开始运行 <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> 包中的所有回归测试。 它通过在包中查找所有名称以 <code class="docutils literal notranslate"><span class="pre">test_</span></code> 打头的模块，导入它们，并在有 <code class="xref py py-func docutils literal notranslate"><span class="pre">test_main()</span></code> 函数时执行它或是在没有 <code class="docutils literal notranslate"><span class="pre">test_main</span></code> 时通过 unittest.TestLoader.loadTestsFromModule 载入测试。 要执行的测试的名称也可以被传递给脚本。 指定一个单独的回归测试 (<strong class="program">python -m test test_spam</strong>) 将使输出最小化并且只打印测试通过或失败的消息。</p>
<p>直接运行 <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> 将允许设置哪些资源可供测试使用。 你可以通过使用 <code class="docutils literal notranslate"><span class="pre">-u</span></code> 命令行选项来做到这一点。 指定 <code class="docutils literal notranslate"><span class="pre">all</span></code> 作为 <code class="docutils literal notranslate"><span class="pre">-u</span></code> 选项的值将启用所有可能的资源: <strong class="program">python -m test -uall</strong>。 如果只需要一项资源（这是更为常见的情况），可以在 <code class="docutils literal notranslate"><span class="pre">all</span></code> 之后加一个以逗号分隔的列表来指明不需要的资源。 命令 <strong class="program">python -m test -uall,-audio,-largefile</strong> 将运行 <a class="reference internal" href="#module-test" title="test: Regression tests package containing the testing suite for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code></a> 并使用除 <code class="docutils literal notranslate"><span class="pre">audio</span></code> 和 <code class="docutils literal notranslate"><span class="pre">largefile</span></code> 资源之外的所有资源。 要查看所有资源的列表和更多的命令行选项，请运行 <strong class="program">python -m test -h</strong>。</p>
<p>另外一些执行回归测试的方式依赖于执行测试所在的系统平台。 在 Unix 上，你可以在构建 Python 的最高层级目录中运行 <strong class="program">make test</strong>。 在 Windows 上，在你的 <code class="file docutils literal notranslate"><span class="pre">PCbuild</span></code> 目录中执行 <strong class="program">rt.bat</strong> 将运行所有的回归测试。</p>
</section>
</section>
<section id="module-test.support">
<span id="test-support-utilities-for-the-python-test-suite"></span><h1><a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> --- 针对 Python 测试套件的工具<a class="headerlink" href="#module-test.support" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 模块提供了对 Python 的回归测试套件的支持。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 不是一个公用模块。 这篇文档是为了帮助 Python 开发者编写测试。 此模块的 API 可能被改变而不顾及发行版本之间的向下兼容性问题。</p>
</div>
<p>此模块定义了以下异常:</p>
<dl class="py exception">
<dt class="sig sig-object py" id="test.support.TestFailed">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">TestFailed</span></span><a class="headerlink" href="#test.support.TestFailed" title="永久链接至目标">¶</a></dt>
<dd><p>当一个测试失败时将被引发的异常。 此异常已被弃用而应改用基于 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> 的测试以及 <a class="reference internal" href="unittest.html#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a> 的断言方法。</p>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="test.support.ResourceDenied">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">ResourceDenied</span></span><a class="headerlink" href="#test.support.ResourceDenied" title="永久链接至目标">¶</a></dt>
<dd><p><a class="reference internal" href="unittest.html#unittest.SkipTest" title="unittest.SkipTest"><code class="xref py py-exc docutils literal notranslate"><span class="pre">unittest.SkipTest</span></code></a> 的子类。 当一个资源（例如网络连接）不可用时将被引发。 由 <a class="reference internal" href="#test.support.requires" title="test.support.requires"><code class="xref py py-func docutils literal notranslate"><span class="pre">requires()</span></code></a> 函数所引发。</p>
</dd></dl>

<p><a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 模块定义了以下常量:</p>
<dl class="py data">
<dt class="sig sig-object py" id="test.support.verbose">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">verbose</span></span><a class="headerlink" href="#test.support.verbose" title="永久链接至目标">¶</a></dt>
<dd><p>当启用详细输出时为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。 当需要有关运行中的测试的更详细信息时应当被选择。 <em>verbose</em> 是由 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test.regrtest</span></code> 来设置的。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.is_jython">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">is_jython</span></span><a class="headerlink" href="#test.support.is_jython" title="永久链接至目标">¶</a></dt>
<dd><p>如果所运行的解释器是 Jython 时为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.is_android">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">is_android</span></span><a class="headerlink" href="#test.support.is_android" title="永久链接至目标">¶</a></dt>
<dd><p>如果系统是 Android 时为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.unix_shell">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">unix_shell</span></span><a class="headerlink" href="#test.support.unix_shell" title="永久链接至目标">¶</a></dt>
<dd><p>如果系统不是 Windows 时则为 shell 的路径；否则为 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.LOOPBACK_TIMEOUT">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">LOOPBACK_TIMEOUT</span></span><a class="headerlink" href="#test.support.LOOPBACK_TIMEOUT" title="永久链接至目标">¶</a></dt>
<dd><p>使用网络服务器监听网络本地环回接口如 <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> 的测试的以秒为单位的超时值。</p>
<p>该超时长到足以防止测试失败：它要考虑客户端和服务器可能会在不同线程甚至不同进程中运行。</p>
<p>该超时应当对于 <a class="reference internal" href="socket.html#socket.socket" title="socket.socket"><code class="xref py py-class docutils literal notranslate"><span class="pre">socket.socket</span></code></a> 的 <a class="reference internal" href="socket.html#socket.socket.connect" title="socket.socket.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connect()</span></code></a>, <a class="reference internal" href="socket.html#socket.socket.recv" title="socket.socket.recv"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recv()</span></code></a> 和 <a class="reference internal" href="socket.html#socket.socket.send" title="socket.socket.send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a> 方法都足够长。</p>
<p>其默认值为5秒。</p>
<p>参见 <a class="reference internal" href="#test.support.INTERNET_TIMEOUT" title="test.support.INTERNET_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">INTERNET_TIMEOUT</span></code></a>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.INTERNET_TIMEOUT">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">INTERNET_TIMEOUT</span></span><a class="headerlink" href="#test.support.INTERNET_TIMEOUT" title="永久链接至目标">¶</a></dt>
<dd><p>发往互联网的网络请求的以秒为单位的超时值。</p>
<p>该超时短到足以避免测试在互联网请求因任何原因被阻止时等待太久。</p>
<p>通常使用 <a class="reference internal" href="#test.support.INTERNET_TIMEOUT" title="test.support.INTERNET_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">INTERNET_TIMEOUT</span></code></a> 的超时不应该将测试标记为失败，而是跳过测试：参见 <a class="reference internal" href="#test.support.socket_helper.transient_internet" title="test.support.socket_helper.transient_internet"><code class="xref py py-func docutils literal notranslate"><span class="pre">transient_internet()</span></code></a>。</p>
<p>其默认值是1分钟。</p>
<p>参见 <a class="reference internal" href="#test.support.LOOPBACK_TIMEOUT" title="test.support.LOOPBACK_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">LOOPBACK_TIMEOUT</span></code></a>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.SHORT_TIMEOUT">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">SHORT_TIMEOUT</span></span><a class="headerlink" href="#test.support.SHORT_TIMEOUT" title="永久链接至目标">¶</a></dt>
<dd><p>如果测试耗时“太长”而要将测试标记为失败的以秒为单位的超时值。</p>
<p>该超时值取决于 regrtest <code class="docutils literal notranslate"><span class="pre">--timeout</span></code> 命令行选项。</p>
<p>如果一个使用 <a class="reference internal" href="#test.support.SHORT_TIMEOUT" title="test.support.SHORT_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">SHORT_TIMEOUT</span></code></a> 的测试在慢速 buildbots 上开始随机失败，请使用 <a class="reference internal" href="#test.support.LONG_TIMEOUT" title="test.support.LONG_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">LONG_TIMEOUT</span></code></a> 来代替。</p>
<p>其默认值为30秒。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.LONG_TIMEOUT">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">LONG_TIMEOUT</span></span><a class="headerlink" href="#test.support.LONG_TIMEOUT" title="永久链接至目标">¶</a></dt>
<dd><p>用于检测测试何时挂起的以秒为单位的超时值。</p>
<p>它的长度足够在最慢的 Python buildbot 上降低测试失败的风险。 如果测试耗时“过长”也不应当用它将该测试标记为失败。 此超时值依赖于 regrtest <code class="docutils literal notranslate"><span class="pre">--timeout</span></code> 命令行选项。</p>
<p>其默认值为5分钟。</p>
<p>另请参见 <a class="reference internal" href="#test.support.LOOPBACK_TIMEOUT" title="test.support.LOOPBACK_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">LOOPBACK_TIMEOUT</span></code></a>, <a class="reference internal" href="#test.support.INTERNET_TIMEOUT" title="test.support.INTERNET_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">INTERNET_TIMEOUT</span></code></a> 和 <a class="reference internal" href="#test.support.SHORT_TIMEOUT" title="test.support.SHORT_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">SHORT_TIMEOUT</span></code></a>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.PGO">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">PGO</span></span><a class="headerlink" href="#test.support.PGO" title="永久链接至目标">¶</a></dt>
<dd><p>当测试对 PGO 没有用处时设置是否要跳过测试。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.PIPE_MAX_SIZE">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">PIPE_MAX_SIZE</span></span><a class="headerlink" href="#test.support.PIPE_MAX_SIZE" title="永久链接至目标">¶</a></dt>
<dd><p>一个通常大于下层 OS 管道缓冲区大小的常量，以产生写入阻塞。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.SOCK_MAX_SIZE">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">SOCK_MAX_SIZE</span></span><a class="headerlink" href="#test.support.SOCK_MAX_SIZE" title="永久链接至目标">¶</a></dt>
<dd><p>一个通常大于下层 OS 套接字缓冲区大小的常量，以产生写入阻塞。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.TEST_SUPPORT_DIR">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">TEST_SUPPORT_DIR</span></span><a class="headerlink" href="#test.support.TEST_SUPPORT_DIR" title="永久链接至目标">¶</a></dt>
<dd><p>设为包含 <a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 的最高层级目录。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.TEST_HOME_DIR">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">TEST_HOME_DIR</span></span><a class="headerlink" href="#test.support.TEST_HOME_DIR" title="永久链接至目标">¶</a></dt>
<dd><p>设为 test 包的最高层级目录。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.TEST_DATA_DIR">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">TEST_DATA_DIR</span></span><a class="headerlink" href="#test.support.TEST_DATA_DIR" title="永久链接至目标">¶</a></dt>
<dd><p>设为 test 包中的 <code class="docutils literal notranslate"><span class="pre">data</span></code> 目录。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.MAX_Py_ssize_t">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">MAX_Py_ssize_t</span></span><a class="headerlink" href="#test.support.MAX_Py_ssize_t" title="永久链接至目标">¶</a></dt>
<dd><p>设为大内存测试的 <a class="reference internal" href="sys.html#sys.maxsize" title="sys.maxsize"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.maxsize</span></code></a>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.max_memuse">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">max_memuse</span></span><a class="headerlink" href="#test.support.max_memuse" title="永久链接至目标">¶</a></dt>
<dd><p>通过 <a class="reference internal" href="#test.support.set_memlimit" title="test.support.set_memlimit"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_memlimit()</span></code></a> 设为针对大内存测试的内存限制。 受 <a class="reference internal" href="#test.support.MAX_Py_ssize_t" title="test.support.MAX_Py_ssize_t"><code class="xref py py-data docutils literal notranslate"><span class="pre">MAX_Py_ssize_t</span></code></a> 的限制。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.real_max_memuse">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">real_max_memuse</span></span><a class="headerlink" href="#test.support.real_max_memuse" title="永久链接至目标">¶</a></dt>
<dd><p>通过 <a class="reference internal" href="#test.support.set_memlimit" title="test.support.set_memlimit"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_memlimit()</span></code></a> 设为针对大内存测试的内存限制。 不受 <a class="reference internal" href="#test.support.MAX_Py_ssize_t" title="test.support.MAX_Py_ssize_t"><code class="xref py py-data docutils literal notranslate"><span class="pre">MAX_Py_ssize_t</span></code></a> 的限制。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.MISSING_C_DOCSTRINGS">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">MISSING_C_DOCSTRINGS</span></span><a class="headerlink" href="#test.support.MISSING_C_DOCSTRINGS" title="永久链接至目标">¶</a></dt>
<dd><p>如果 Python 编译时不带文档字符串（即未定义 <code class="xref c c-macro docutils literal notranslate"><span class="pre">WITH_DOC_STRINGS</span></code> 宏）则设为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。 参见 <a class="reference internal" href="../using/configure.html#cmdoption-without-doc-strings"><code class="xref std std-option docutils literal notranslate"><span class="pre">configure</span> <span class="pre">--without-doc-strings</span></code></a> 选项。</p>
<p>另请参阅 <a class="reference internal" href="#test.support.HAVE_DOCSTRINGS" title="test.support.HAVE_DOCSTRINGS"><code class="xref py py-data docutils literal notranslate"><span class="pre">HAVE_DOCSTRINGS</span></code></a> 变量。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.HAVE_DOCSTRINGS">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">HAVE_DOCSTRINGS</span></span><a class="headerlink" href="#test.support.HAVE_DOCSTRINGS" title="永久链接至目标">¶</a></dt>
<dd><p>如果函数带有文档字符串则设为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。 参见 <a class="reference internal" href="../using/cmdline.html#cmdoption-O"><code class="xref std std-option docutils literal notranslate"><span class="pre">python</span> <span class="pre">-OO</span></code></a> 选项，该选项会去除在 Python 中实现的函数的文档字符串。</p>
<p>另请参阅 <a class="reference internal" href="#test.support.MISSING_C_DOCSTRINGS" title="test.support.MISSING_C_DOCSTRINGS"><code class="xref py py-data docutils literal notranslate"><span class="pre">MISSING_C_DOCSTRINGS</span></code></a> 变量。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.TEST_HTTP_URL">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">TEST_HTTP_URL</span></span><a class="headerlink" href="#test.support.TEST_HTTP_URL" title="永久链接至目标">¶</a></dt>
<dd><p>定义用于网络测试的韧性 HTTP 服务器的 URL。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.ALWAYS_EQ">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">ALWAYS_EQ</span></span><a class="headerlink" href="#test.support.ALWAYS_EQ" title="永久链接至目标">¶</a></dt>
<dd><p>等于任何对象的对象。 用于测试混合类型比较。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.NEVER_EQ">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">NEVER_EQ</span></span><a class="headerlink" href="#test.support.NEVER_EQ" title="永久链接至目标">¶</a></dt>
<dd><p>不等于任何对象的对象 (即使是 <a class="reference internal" href="#test.support.ALWAYS_EQ" title="test.support.ALWAYS_EQ"><code class="xref py py-data docutils literal notranslate"><span class="pre">ALWAYS_EQ</span></code></a>)。 用于测试混合类型比较。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.LARGEST">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">LARGEST</span></span><a class="headerlink" href="#test.support.LARGEST" title="永久链接至目标">¶</a></dt>
<dd><p>大于任何对象的对象（除了其自身）。 用于测试混合类型比较。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.SMALLEST">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">SMALLEST</span></span><a class="headerlink" href="#test.support.SMALLEST" title="永久链接至目标">¶</a></dt>
<dd><p>小于任何对象的对象（除了其自身）。 用于测试混合类型比较。Used to test mixed type comparison.</p>
</dd></dl>

<p><a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 模块定义了以下函数:</p>
<dl class="py function">
<dt class="sig sig-object py" id="test.support.is_resource_enabled">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">is_resource_enabled</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.is_resource_enabled" title="永久链接至目标">¶</a></dt>
<dd><p>如果 <em>resource</em> 已启用并可用则返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>。 可用资源列表只有当 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test.regrtest</span></code> 正在执行测试时才会被设置。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.python_is_optimized">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">python_is_optimized</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.python_is_optimized" title="永久链接至目标">¶</a></dt>
<dd><p>如果 Python 编译未使用 <code class="docutils literal notranslate"><span class="pre">-O0</span></code> 或 <code class="docutils literal notranslate"><span class="pre">-Og</span></code> 则返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.with_pymalloc">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">with_pymalloc</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.with_pymalloc" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <code class="xref py py-data docutils literal notranslate"><span class="pre">_testcapi.WITH_PYMALLOC</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.requires" title="永久链接至目标">¶</a></dt>
<dd><p>如果 <em>resource</em> 不可用则引发 <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceDenied</span></code></a>。 如果该异常被引发则 <em>msg</em> 为传给 <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceDenied</span></code></a> 的参数。 如果被 <code class="docutils literal notranslate"><span class="pre">__name__</span></code> 为 <code class="docutils literal notranslate"><span class="pre">'__main__'</span></code> 的函数调用则总是返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>。 在测试由 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test.regrtest</span></code> 执行时使用。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.sortdict">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">sortdict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.sortdict" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <em>dict</em> 按键排序的 repr。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.findfile">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">findfile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.findfile" title="永久链接至目标">¶</a></dt>
<dd><p>返回名为 <em>filename</em> 的文件的路径。 如果未找到匹配结果则返回 <em>filename</em>。 这并不等于失败因为它也算是该文件的路径。</p>
<p>设置 <em>subdir</em> 指明要用来查找文件的相对路径而不是直接在路径目录中查找。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.match_test">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">match_test</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.match_test" title="永久链接至目标">¶</a></dt>
<dd><p>确定 <em>test</em> 是否匹配在 <a class="reference internal" href="#test.support.set_match_tests" title="test.support.set_match_tests"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_match_tests()</span></code></a> 中设置的模式。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.set_match_tests">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">set_match_tests</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">accept_patterns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_patterns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.set_match_tests" title="永久链接至目标">¶</a></dt>
<dd><p>定义测试文件名和测试方法名的匹配模式用于筛选测试。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.run_unittest">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">run_unittest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">classes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.run_unittest" title="永久链接至目标">¶</a></dt>
<dd><p>执行传给函数的 <a class="reference internal" href="unittest.html#unittest.TestCase" title="unittest.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">unittest.TestCase</span></code></a> 子类。 此函数会扫描类中带有 <code class="docutils literal notranslate"><span class="pre">test_</span></code> 前缀的方法并单独执行这些测试。</p>
<p>将字符串作为形参传递也是合法的；这些形参应为 <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code> 中的键。 每个被关联的模块将由 <code class="docutils literal notranslate"><span class="pre">unittest.TestLoader.loadTestsFromModule()</span></code> 执行扫描。 这通常出现在以下 <code class="xref py py-func docutils literal notranslate"><span class="pre">test_main()</span></code> 函数中:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_main</span><span class="p">():</span>
    <span class="n">support</span><span class="o">.</span><span class="n">run_unittest</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>这将运行在指定模块中定义的所有测试。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.run_doctest">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">run_doctest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbosity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optionflags</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.run_doctest" title="永久链接至目标">¶</a></dt>
<dd><p>在给定的 <em>module</em> 上运行 <a class="reference internal" href="doctest.html#doctest.testmod" title="doctest.testmod"><code class="xref py py-func docutils literal notranslate"><span class="pre">doctest.testmod()</span></code></a>。 返回 <code class="docutils literal notranslate"><span class="pre">(failure_count,</span> <span class="pre">test_count)</span></code>。</p>
<p>如果 <em>verbosity</em> 为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，<a class="reference internal" href="doctest.html#doctest.testmod" title="doctest.testmod"><code class="xref py py-func docutils literal notranslate"><span class="pre">doctest.testmod()</span></code></a> 运行时的消息详细程度将设为 <a class="reference internal" href="#test.support.verbose" title="test.support.verbose"><code class="xref py py-data docutils literal notranslate"><span class="pre">verbose</span></code></a>。 否则，运行时的消息详细程度将设为 <code class="docutils literal notranslate"><span class="pre">None</span></code>。 <em>optionflags</em> 将作为 <code class="docutils literal notranslate"><span class="pre">optionflags</span></code> 传给 <a class="reference internal" href="doctest.html#doctest.testmod" title="doctest.testmod"><code class="xref py py-func docutils literal notranslate"><span class="pre">doctest.testmod()</span></code></a>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.setswitchinterval">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">setswitchinterval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interval</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.setswitchinterval" title="永久链接至目标">¶</a></dt>
<dd><p>将 <a class="reference internal" href="sys.html#sys.setswitchinterval" title="sys.setswitchinterval"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setswitchinterval()</span></code></a> 设为给定的 <em>interval</em>。 请为 Android 系统定义一个最小间隔以防止系统挂起。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.check_impl_detail">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">check_impl_detail</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">guards</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.check_impl_detail" title="永久链接至目标">¶</a></dt>
<dd><p>使用此检测来保护 CPython 实现专属的测试或者仅在有这些参数保护的实现上运行它们。 此函数将根据主机系统平台的不同返回 <code class="docutils literal notranslate"><span class="pre">True</span></code> 或 <code class="docutils literal notranslate"><span class="pre">False</span></code>。 用法示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_impl_detail</span><span class="p">()</span>               <span class="c1"># Only on CPython (default).</span>
<span class="n">check_impl_detail</span><span class="p">(</span><span class="n">jython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    <span class="c1"># Only on Jython.</span>
<span class="n">check_impl_detail</span><span class="p">(</span><span class="n">cpython</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Everywhere except CPython.</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.set_memlimit">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">set_memlimit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">limit</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.set_memlimit" title="永久链接至目标">¶</a></dt>
<dd><p>针对大内存测试设置 <a class="reference internal" href="#test.support.max_memuse" title="test.support.max_memuse"><code class="xref py py-data docutils literal notranslate"><span class="pre">max_memuse</span></code></a> 和 <a class="reference internal" href="#test.support.real_max_memuse" title="test.support.real_max_memuse"><code class="xref py py-data docutils literal notranslate"><span class="pre">real_max_memuse</span></code></a> 的值。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.record_original_stdout">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">record_original_stdout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stdout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.record_original_stdout" title="永久链接至目标">¶</a></dt>
<dd><p>存放来自 <em>stdout</em> 的值。 它会在回归测试开始时处理 stdout。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.get_original_stdout">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">get_original_stdout</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.get_original_stdout" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <a class="reference internal" href="#test.support.record_original_stdout" title="test.support.record_original_stdout"><code class="xref py py-func docutils literal notranslate"><span class="pre">record_original_stdout()</span></code></a> 所设置的原始 stdout 或者如果未设置则为 <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.args_from_interpreter_flags">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">args_from_interpreter_flags</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.args_from_interpreter_flags" title="永久链接至目标">¶</a></dt>
<dd><p>返回在 <code class="docutils literal notranslate"><span class="pre">sys.flags</span></code> 和 <code class="docutils literal notranslate"><span class="pre">sys.warnoptions</span></code> 中重新产生当前设置的命令行参数列表。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.optim_args_from_interpreter_flags">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">optim_args_from_interpreter_flags</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.optim_args_from_interpreter_flags" title="永久链接至目标">¶</a></dt>
<dd><p>返回在 <code class="docutils literal notranslate"><span class="pre">sys.flags</span></code> 中重新产生当前优化设置的命令行参数列表。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.captured_stdin">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">captured_stdin</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.captured_stdin" title="永久链接至目标">¶</a></dt>
<dt class="sig sig-object py" id="test.support.captured_stdout">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">captured_stdout</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.captured_stdout" title="永久链接至目标">¶</a></dt>
<dt class="sig sig-object py" id="test.support.captured_stderr">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">captured_stderr</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.captured_stderr" title="永久链接至目标">¶</a></dt>
<dd><p>使用 <a class="reference internal" href="io.html#io.StringIO" title="io.StringIO"><code class="xref py py-class docutils literal notranslate"><span class="pre">io.StringIO</span></code></a> 对象临时替换指定流的上下文管理器。</p>
<p>使用输出流的示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">captured_stdout</span><span class="p">()</span> <span class="k">as</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">captured_stderr</span><span class="p">()</span> <span class="k">as</span> <span class="n">stderr</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">stdout</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;hello</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="k">assert</span> <span class="n">stderr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;error</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>使用输入流的示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">captured_stdin</span><span class="p">()</span> <span class="k">as</span> <span class="n">stdin</span><span class="p">:</span>
    <span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;hello</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">stdin</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># call test code that consumes from sys.stdin</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">captured</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.disable_faulthandler">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">disable_faulthandler</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.disable_faulthandler" title="永久链接至目标">¶</a></dt>
<dd><p>临时禁用 <a class="reference internal" href="faulthandler.html#module-faulthandler" title="faulthandler: Dump the Python traceback."><code class="xref py py-mod docutils literal notranslate"><span class="pre">faulthandler</span></code></a> 的上下文管理器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.gc_collect">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">gc_collect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.gc_collect" title="永久链接至目标">¶</a></dt>
<dd><p>强制收集尽可能多的对象。 这是有必要的因为垃圾回收器并不能保证及时回收资源。 这意味着 <code class="docutils literal notranslate"><span class="pre">__del__</span></code> 方法的调用可能会晚于预期而弱引用的存活长于预期。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.disable_gc">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">disable_gc</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.disable_gc" title="永久链接至目标">¶</a></dt>
<dd><p>在进入时禁用垃圾回收器的上下文管理器。 在退出时，垃圾回收器将恢复到先前状态。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.swap_attr">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">swap_attr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_val</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.swap_attr" title="永久链接至目标">¶</a></dt>
<dd><p>上下文管理器用一个新对象来交换一个属性。</p>
<p>用法：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">swap_attr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;attr&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>这将把 <code class="docutils literal notranslate"><span class="pre">obj.attr</span></code> 设为 5 并在 <code class="docutils literal notranslate"><span class="pre">with</span></code> 语句块内保持，在语句块结束时恢复旧值。 如果 <code class="docutils literal notranslate"><span class="pre">attr</span></code> 不存在于 <code class="docutils literal notranslate"><span class="pre">obj</span></code> 中，它将被创建并在语句块结束时被删除。</p>
<p>旧值 (或者如果不存在旧值则为 <code class="docutils literal notranslate"><span class="pre">None</span></code>) 将被赋给 &quot;as&quot; 子句的目标，如果存在子句的话。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.swap_item">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">swap_item</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_val</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.swap_item" title="永久链接至目标">¶</a></dt>
<dd><p>上下文件管理器用一个新对象来交换一个条目。</p>
<p>用法：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">swap_item</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>这将把 <code class="docutils literal notranslate"><span class="pre">obj[&quot;item&quot;]</span></code> 设为 5 并在 <code class="docutils literal notranslate"><span class="pre">with</span></code> 语句块内保持，在语句块结束时恢复旧值。 如果 <code class="docutils literal notranslate"><span class="pre">item</span></code> 不存在于 <code class="docutils literal notranslate"><span class="pre">obj</span></code> 中，它将被创建并在语句块结束时被删除。</p>
<p>旧值 (或者如果不存在旧值则为 <code class="docutils literal notranslate"><span class="pre">None</span></code>) 将被赋给 &quot;as&quot; 子句的目标，如果存在子句的话。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.flush_std_streams">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">flush_std_streams</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.flush_std_streams" title="永久链接至目标">¶</a></dt>
<dd><p>Call the <code class="docutils literal notranslate"><span class="pre">flush()</span></code> method on <a class="reference internal" href="sys.html#sys.stdout" title="sys.stdout"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdout</span></code></a> and then on
<a class="reference internal" href="sys.html#sys.stderr" title="sys.stderr"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a>. It can be used to make sure that the logs order is
consistent before writing into stderr.</p>
<div class="versionadded">
<p><span class="versionmodified added">3.11 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.print_warning">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">print_warning</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.print_warning" title="永久链接至目标">¶</a></dt>
<dd><p>打印一个警告到 <a class="reference internal" href="sys.html#sys.__stderr__" title="sys.__stderr__"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.__stderr__</span></code></a>。 将消息格式化为: <code class="docutils literal notranslate"><span class="pre">f&quot;Warning</span> <span class="pre">--</span> <span class="pre">{msg}&quot;</span></code>。 如果 <em>msg</em> 包含多行，则为每行添加 <code class="docutils literal notranslate"><span class="pre">&quot;Warning</span> <span class="pre">--</span> <span class="pre">&quot;</span></code> 前缀。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.9 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.wait_process">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">wait_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pid</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exitcode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.wait_process" title="永久链接至目标">¶</a></dt>
<dd><p>等待直到进程 <em>pid</em> 结束并检查进程退出代码是否为 <em>exitcode</em>。</p>
<p>如果进程退出代码不等于 <em>exitcode</em> 则引发 <a class="reference internal" href="exceptions.html#AssertionError" title="AssertionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code></a>。</p>
<p>如果进程运行时长超过 <em>timeout</em> 秒 (默认为 <a class="reference internal" href="#test.support.SHORT_TIMEOUT" title="test.support.SHORT_TIMEOUT"><code class="xref py py-data docutils literal notranslate"><span class="pre">SHORT_TIMEOUT</span></code></a>)，则杀死进程并引发 <a class="reference internal" href="exceptions.html#AssertionError" title="AssertionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code></a>。 超时特性在 Windows 上不可用。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.9 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.calcobjsize">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">calcobjsize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fmt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.calcobjsize" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <a class="reference internal" href="../c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a> 的大小，其结构成员由 <em>fmt</em> 定义。 返回的值包括 Python 对象头的大小和对齐方式。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.calcvobjsize">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">calcvobjsize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fmt</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.calcvobjsize" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <a class="reference internal" href="../c-api/structures.html#c.PyVarObject" title="PyVarObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyVarObject</span></code></a> 的大小，其结构成员由 <em>fmt</em> 定义。 返回的值包括 Python 对象头的大小和对齐方式。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.checksizeof">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">checksizeof</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">o</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.checksizeof" title="永久链接至目标">¶</a></dt>
<dd><p>对于测试用例 <em>test</em>，断言 <em>o</em> 的 <code class="docutils literal notranslate"><span class="pre">sys.getsizeof</span></code> 加 GC 头的大小等于 <em>size</em>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.anticipate_failure">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">anticipate_failure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">condition</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.anticipate_failure" title="永久链接至目标">¶</a></dt>
<dd><p>一个有条件地用 <a class="reference internal" href="unittest.html#unittest.expectedFailure" title="unittest.expectedFailure"><code class="xref py py-func docutils literal notranslate"><span class="pre">unittest.expectedFailure()</span></code></a> 来标记测试的装饰器。 任何对此装饰器的使用都应当具有标识相应追踪事项的有关联注释。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.system_must_validate_cert">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">system_must_validate_cert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">f</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.system_must_validate_cert" title="永久链接至目标">¶</a></dt>
<dd><p>一个在 TLS 证书验证失败时跳过被装饰测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.run_with_locale">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">run_with_locale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">catstr</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">locales</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.run_with_locale" title="永久链接至目标">¶</a></dt>
<dd><p>一个在不同语言区域下运行函数的装饰器，并在其结束后正确地重置语言区域。 <em>catstr</em> 是字符串形式的语言区域类别 (例如 <code class="docutils literal notranslate"><span class="pre">&quot;LC_ALL&quot;</span></code>)。 传入的 <em>locales</em> 将依次被尝试，并将使用第一个有效的语言区域。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.run_with_tz">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">run_with_tz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tz</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.run_with_tz" title="永久链接至目标">¶</a></dt>
<dd><p>一个在指定时区下运行函数的装饰器，并在其结束后正确地重置时区。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_freebsd_version">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_freebsd_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">min_version</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.requires_freebsd_version" title="永久链接至目标">¶</a></dt>
<dd><p>当在 FreeBSD 上运行测试时指定最低版本的装饰器。 如果 FreeBSD 版本号低于指定值，测试将被跳过。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_linux_version">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_linux_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">min_version</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.requires_linux_version" title="永久链接至目标">¶</a></dt>
<dd><p>当在 Linux 上运行测试时指定最低版本的装饰器。 如果 Linux 版本号低于指定值，测试将被跳过。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_mac_version">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_mac_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">min_version</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.requires_mac_version" title="永久链接至目标">¶</a></dt>
<dd><p>当在 macOS 上运行测试时指定最低版本的装饰器。 如果 macOS 版本号低于指定值，测试将被跳过。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_IEEE_754">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_IEEE_754</span></span><a class="headerlink" href="#test.support.requires_IEEE_754" title="永久链接至目标">¶</a></dt>
<dd><p>用于在非 non-IEEE 754 平台上跳过测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_zlib">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_zlib</span></span><a class="headerlink" href="#test.support.requires_zlib" title="永久链接至目标">¶</a></dt>
<dd><p>用于当 <a class="reference internal" href="zlib.html#module-zlib" title="zlib: Low-level interface to compression and decompression routines compatible with gzip."><code class="xref py py-mod docutils literal notranslate"><span class="pre">zlib</span></code></a> 不存在时跳过测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_gzip">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_gzip</span></span><a class="headerlink" href="#test.support.requires_gzip" title="永久链接至目标">¶</a></dt>
<dd><p>用于当 <a class="reference internal" href="gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a> 不存在时跳过测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_bz2">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_bz2</span></span><a class="headerlink" href="#test.support.requires_bz2" title="永久链接至目标">¶</a></dt>
<dd><p>用于当 <a class="reference internal" href="bz2.html#module-bz2" title="bz2: Interfaces for bzip2 compression and decompression."><code class="xref py py-mod docutils literal notranslate"><span class="pre">bz2</span></code></a> 不存在时跳过测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_lzma">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_lzma</span></span><a class="headerlink" href="#test.support.requires_lzma" title="永久链接至目标">¶</a></dt>
<dd><p>用于当 <a class="reference internal" href="lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> 不存在时跳过测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_resource">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_resource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.requires_resource" title="永久链接至目标">¶</a></dt>
<dd><p>用于当 <em>resource</em> 不可用时跳过测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.requires_docstrings">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">requires_docstrings</span></span><a class="headerlink" href="#test.support.requires_docstrings" title="永久链接至目标">¶</a></dt>
<dd><p>用于仅当 <a class="reference internal" href="#test.support.HAVE_DOCSTRINGS" title="test.support.HAVE_DOCSTRINGS"><code class="xref py py-data docutils literal notranslate"><span class="pre">HAVE_DOCSTRINGS</span></code></a> 时才运行测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.cpython_only">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">cpython_only</span></span><a class="headerlink" href="#test.support.cpython_only" title="永久链接至目标">¶</a></dt>
<dd><p>表示仅适用于 CPython 的测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.impl_detail">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">impl_detail</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">guards</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.impl_detail" title="永久链接至目标">¶</a></dt>
<dd><p>用于在 <em>guards</em> 上发起调用 <a class="reference internal" href="#test.support.check_impl_detail" title="test.support.check_impl_detail"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_impl_detail()</span></code></a> 的装饰器。 如果调用返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则使用 <em>msg</em> 作为跳过测试的原因。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.no_tracing">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">no_tracing</span></span><a class="headerlink" href="#test.support.no_tracing" title="永久链接至目标">¶</a></dt>
<dd><p>用于在测试期间临时关闭追踪的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.refcount_test">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">refcount_test</span></span><a class="headerlink" href="#test.support.refcount_test" title="永久链接至目标">¶</a></dt>
<dd><p>用于涉及引用计数的测试的装饰器。 如果测试不是由 CPython 运行则该装饰器不会运行测试。 在测试期间会取消设置任何追踪函数以由追踪函数导致的意外引用计数。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.bigmemtest">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">bigmemtest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">memuse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_run</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.bigmemtest" title="永久链接至目标">¶</a></dt>
<dd><p>用于大内存测试的装饰器。</p>
<p><em>size</em> 是测试所请求的大小（以任意的，由测试解读的单位。）  <em>memuse</em> 是测试的每单元字节数，或是对它的良好估计。 例如，一个需要两个字节缓冲区，每个缓冲区 4 GiB，则可以用 <code class="docutils literal notranslate"><span class="pre">&#64;bigmemtest(size=_4G,</span> <span class="pre">memuse=2)</span></code> 来装饰。</p>
<p><em>size</em> 参数通常作为额外参数传递给被测试的方法。 如果 <em>dry_run</em> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，则传给测试方法的值可能少于所请求的值。 如果 <em>dry_run</em> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则意味着当当未指定 <code class="docutils literal notranslate"><span class="pre">-M</span></code> 时测试将不支持虚拟运行。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.bigaddrspacetest">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">bigaddrspacetest</span></span><a class="headerlink" href="#test.support.bigaddrspacetest" title="永久链接至目标">¶</a></dt>
<dd><p>用于填充地址空间的测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.check_syntax_error">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">check_syntax_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">testcase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statement</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errtext</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lineno</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.check_syntax_error" title="永久链接至目标">¶</a></dt>
<dd><p>用于通过尝试编译 <em>statement</em> 来测试 <em>statement</em> 中的语法错误。 <em>testcase</em> 是测试的 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> 实例。 <em>errtext</em> 是应当匹配所引发的 <a class="reference internal" href="exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 的字符串表示形式的正则表达式。 如果 <em>lineno</em> 不为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则与异常所在的行进行比较。 如果 <em>offset</em> 不为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则与异常的偏移量进行比较。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.open_urlresource">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">open_urlresource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.open_urlresource" title="永久链接至目标">¶</a></dt>
<dd><p>打开 <em>url</em>。 如果打开失败，则引发 <a class="reference internal" href="#test.support.TestFailed" title="test.support.TestFailed"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TestFailed</span></code></a>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.reap_children">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">reap_children</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.reap_children" title="永久链接至目标">¶</a></dt>
<dd><p>只要有子进程启动就在 <code class="docutils literal notranslate"><span class="pre">test_main</span></code> 的末尾使用此函数。 这将有助于确保没有多余的子进程（僵尸）存在占用资源并在查找引用泄漏时造成问题。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.get_attribute">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">get_attribute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.get_attribute" title="永久链接至目标">¶</a></dt>
<dd><p>获取一个属性，如果引发了 <a class="reference internal" href="exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> 则会引发 <a class="reference internal" href="unittest.html#unittest.SkipTest" title="unittest.SkipTest"><code class="xref py py-exc docutils literal notranslate"><span class="pre">unittest.SkipTest</span></code></a>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.catch_unraisable_exception">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">catch_unraisable_exception</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.catch_unraisable_exception" title="永久链接至目标">¶</a></dt>
<dd><p>使用 <a class="reference internal" href="sys.html#sys.unraisablehook" title="sys.unraisablehook"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.unraisablehook()</span></code></a> 来捕获不可引发的异常的上下文管理器。</p>
<p>存储异常值 (<code class="docutils literal notranslate"><span class="pre">cm.unraisable.exc_value</span></code>) 会创建一个引用循环。 引用循环将在上下文管理器退出时被显式地打破。</p>
<p>存储对象 (<code class="docutils literal notranslate"><span class="pre">cm.unraisable.object</span></code>) 如果被设置为一个正在最终化的对象则可以恢复它。 退出上下文管理器将清除已存在对象。</p>
<p>用法：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">support</span><span class="o">.</span><span class="n">catch_unraisable_exception</span><span class="p">()</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
    <span class="c1"># code creating an &quot;unraisable exception&quot;</span>
    <span class="o">...</span>

    <span class="c1"># check the unraisable exception: use cm.unraisable</span>
    <span class="o">...</span>

<span class="c1"># cm.unraisable attribute no longer exists at this point</span>
<span class="c1"># (to break a reference cycle)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">3.8 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.load_package_tests">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">load_package_tests</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pkg_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standard_tests</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pattern</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.load_package_tests" title="永久链接至目标">¶</a></dt>
<dd><p>在测试包中使用的 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> <code class="docutils literal notranslate"><span class="pre">load_tests</span></code> 协议的通用实现。 <em>pkg_dir</em> 是包的根目录；<em>loader</em>, <em>standard_tests</em> 和 <em>pattern</em> 是 <code class="docutils literal notranslate"><span class="pre">load_tests</span></code> 所期望的参数。 在简单的情况下，测试包的 <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> 可以是下面这样的:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">test.support</span> <span class="kn">import</span> <span class="n">load_package_tests</span>

<span class="k">def</span> <span class="nf">load_tests</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">load_package_tests</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.detect_api_mismatch">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">detect_api_mismatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ref_api</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">other_api</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.detect_api_mismatch" title="永久链接至目标">¶</a></dt>
<dd><p>返回未在 <em>other_api</em> 中找到的 <em>ref_api</em> 的属性、函数或方法的集合，除去在 <em>ignore</em> 中指明的要在这个检查中忽略的已定义条目列表。</p>
<p>在默认情况下这将跳过以 '_' 打头的私有属性但包括所有魔术方法，即以 '__' 打头和结尾的方法。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.5 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.patch">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">patch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test_instance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">object_to_patch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">attr_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.patch" title="永久链接至目标">¶</a></dt>
<dd><p>用 <em>new_value</em> 重载 <em>object_to_patch.attr_name</em>。并向 <em>test_instance</em> 添加清理过程以便为 <em>attr_name</em> 恢复 <em>object_to_patch</em>。 <em>attr_name</em> 应当是 <em>object_to_patch</em> 的一个有效属性。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.run_in_subinterp">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">run_in_subinterp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.run_in_subinterp" title="永久链接至目标">¶</a></dt>
<dd><p>在子解释器中运行 <em>code</em>。 如果启用了 <a class="reference internal" href="tracemalloc.html#module-tracemalloc" title="tracemalloc: Trace memory allocations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">tracemalloc</span></code></a> 则会引发 <a class="reference internal" href="unittest.html#unittest.SkipTest" title="unittest.SkipTest"><code class="xref py py-exc docutils literal notranslate"><span class="pre">unittest.SkipTest</span></code></a>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.check_free_after_iterating">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">check_free_after_iterating</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.check_free_after_iterating" title="永久链接至目标">¶</a></dt>
<dd><p>断言 <em>cls</em> 的实例在迭代后被释放。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.missing_compiler_executable">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">missing_compiler_executable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmd_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.missing_compiler_executable" title="永久链接至目标">¶</a></dt>
<dd><p>检查在 <em>cmd_names</em> 中列出名称的或者当 <em>cmd_names</em> 为空时所有的编译器可执行文件是否存在并返回第一个丢失的可执行文件或者如果未发现任何丢失则返回 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.check__all__">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">check__all__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test_case</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">module</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name_of_module</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">not_exported</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.check__all__" title="永久链接至目标">¶</a></dt>
<dd><p>断言 <em>module</em> 的 <code class="docutils literal notranslate"><span class="pre">__all__</span></code> 变量包含全部公共名称。</p>
<p>模块的公共名称（它的 API）是根据它们是否符合公共名称惯例并在 <em>module</em> 中被定义来自动检测的。</p>
<p><em>name_of_module</em> 参数可以（用字符串或元组的形式）指定一个 API 可以被定义为什么模块以便被检测为一个公共 API。 一种这样的情况会在 <em>module</em> 从其他模块，可能是一个 C 后端 (如 <code class="docutils literal notranslate"><span class="pre">csv</span></code> 和它的 <code class="docutils literal notranslate"><span class="pre">_csv</span></code>) 导入其公共 API 的某一组成部分时发生。</p>
<p><em>extra</em> 参数可以是一个在其他情况下不会被自动检测为 &quot;public&quot; 的名称集合，例如没有适当 <code class="docutils literal notranslate"><span class="pre">__module__</span></code> 属性的对象。 如果提供该参数，它将被添加到自动检测到的对象中。</p>
<p><em>not_exported</em> 参数可以是一个不可被当作公共 API 的一部分的名称集合，即使其名称没有显式指明这一点。</p>
<p>用法示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bar</span>
<span class="kn">import</span> <span class="nn">foo</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">support</span>

<span class="k">class</span> <span class="nc">MiscTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test__all__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">support</span><span class="o">.</span><span class="n">check__all__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">OtherTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test__all__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;BAR_CONST&#39;</span><span class="p">,</span> <span class="s1">&#39;FOO_CONST&#39;</span><span class="p">}</span>
        <span class="n">not_exported</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;baz&#39;</span><span class="p">}</span>  <span class="c1"># Undocumented name.</span>
        <span class="c1"># bar imports part of its API from _bar.</span>
        <span class="n">support</span><span class="o">.</span><span class="n">check__all__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;_bar&#39;</span><span class="p">),</span>
                             <span class="n">extra</span><span class="o">=</span><span class="n">extra</span><span class="p">,</span> <span class="n">not_exported</span><span class="o">=</span><span class="n">not_exported</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">3.6 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.skip_if_broken_multiprocessing_synchronize">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">skip_if_broken_multiprocessing_synchronize</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.skip_if_broken_multiprocessing_synchronize" title="永久链接至目标">¶</a></dt>
<dd><p>如果没有 <code class="xref py py-mod docutils literal notranslate"><span class="pre">multiprocessing.synchronize</span></code> 模块，没有可用的 semaphore 实现，或者如果创建一个锁会引发 <a class="reference internal" href="exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a> 则跳过测试。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.10 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.check_disallow_instantiation">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">check_disallow_instantiation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test_case</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tp</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.check_disallow_instantiation" title="永久链接至目标">¶</a></dt>
<dd><p>断言类型 <em>tp</em> 不能使用 <em>args</em> 和 <em>kwds</em> 来实例化。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.10 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.adjust_int_max_str_digits">
<span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">adjust_int_max_str_digits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_digits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.adjust_int_max_str_digits" title="永久链接至目标">¶</a></dt>
<dd><p>This function returns a context manager that will change the global
<a class="reference internal" href="sys.html#sys.set_int_max_str_digits" title="sys.set_int_max_str_digits"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.set_int_max_str_digits()</span></code></a> setting for the duration of the
context to allow execution of test code that needs a different limit
on the number of digits when converting between an integer and string.</p>
<div class="versionadded">
<p><span class="versionmodified added">3.11 新版功能.</span></p>
</div>
</dd></dl>

<p><a class="reference internal" href="#module-test.support" title="test.support: Support for Python's regression test suite."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code></a> 模块定义了以下的类:</p>
<dl class="py class">
<dt class="sig sig-object py" id="test.support.SuppressCrashReport">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">SuppressCrashReport</span></span><a class="headerlink" href="#test.support.SuppressCrashReport" title="永久链接至目标">¶</a></dt>
<dd><p>一个用于在预期会使子进程崩溃的测试时尽量防止弹出崩溃对话框的上下文管理器。</p>
<p>在 Windows 上，它会使用 <a class="reference external" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms680621.aspx">SetErrorMode</a> 来禁用 Windows 错误报告对话框。</p>
<p>在 UNIX 上，会使用 <a class="reference internal" href="resource.html#resource.setrlimit" title="resource.setrlimit"><code class="xref py py-func docutils literal notranslate"><span class="pre">resource.setrlimit()</span></code></a> 来将 <a class="reference internal" href="resource.html#resource.RLIMIT_CORE" title="resource.RLIMIT_CORE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">resource.RLIMIT_CORE</span></code></a> 的软限制设为 0 以防止创建核心转储文件。</p>
<p>在这两个平台上，旧值都将被 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__exit__()</span></code> 恢复。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.SaveSignals">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">SaveSignals</span></span><a class="headerlink" href="#test.support.SaveSignals" title="永久链接至目标">¶</a></dt>
<dd><p>用于保存和恢复由 Python 句柄的所注册的信号处理句柄。</p>
<dl class="py method">
<dt class="sig sig-object py" id="test.support.SaveSignals.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.SaveSignals.save" title="永久链接至目标">¶</a></dt>
<dd><p>将信号处理句柄保存到一个将信号编号映射到当前信号处理句柄的字典。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="test.support.SaveSignals.restore">
<span class="sig-name descname"><span class="pre">restore</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.SaveSignals.restore" title="永久链接至目标">¶</a></dt>
<dd><p>将来自 <a class="reference internal" href="#test.support.SaveSignals.save" title="test.support.SaveSignals.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> 字典的信号编号设置到已保存的处理句柄上。</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.Matcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">Matcher</span></span><a class="headerlink" href="#test.support.Matcher" title="永久链接至目标">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="test.support.Matcher.matches">
<span class="sig-name descname"><span class="pre">matches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.Matcher.matches" title="永久链接至目标">¶</a></dt>
<dd><p>尝试对单个字典与所提供的参数进行匹配。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="test.support.Matcher.match_value">
<span class="sig-name descname"><span class="pre">match_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.Matcher.match_value" title="永久链接至目标">¶</a></dt>
<dd><p>尝试对单个已存储值 (<em>dv</em>) 与所提供的值 (<em>v</em>) 进行匹配。</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.BasicTestRunner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.</span></span><span class="sig-name descname"><span class="pre">BasicTestRunner</span></span><a class="headerlink" href="#test.support.BasicTestRunner" title="永久链接至目标">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="test.support.BasicTestRunner.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.BasicTestRunner.run" title="永久链接至目标">¶</a></dt>
<dd><p>运行 <em>test</em> 并返回结果。</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-test.support.socket_helper">
<span id="test-support-socket-helper-utilities-for-socket-tests"></span><h1><a class="reference internal" href="#module-test.support.socket_helper" title="test.support.socket_helper: Support for socket tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.socket_helper</span></code></a> --- 用于套接字测试的工具<a class="headerlink" href="#module-test.support.socket_helper" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support.socket_helper" title="test.support.socket_helper: Support for socket tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.socket_helper</span></code></a> 模块提供了对套接字测试的支持。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.9 新版功能.</span></p>
</div>
<dl class="py data">
<dt class="sig sig-object py" id="test.support.socket_helper.IPV6_ENABLED">
<span class="sig-prename descclassname"><span class="pre">test.support.socket_helper.</span></span><span class="sig-name descname"><span class="pre">IPV6_ENABLED</span></span><a class="headerlink" href="#test.support.socket_helper.IPV6_ENABLED" title="永久链接至目标">¶</a></dt>
<dd><p>设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 如果主机打开IPv6, 否则 <code class="docutils literal notranslate"><span class="pre">False</span></code> .</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.socket_helper.find_unused_port">
<span class="sig-prename descclassname"><span class="pre">test.support.socket_helper.</span></span><span class="sig-name descname"><span class="pre">find_unused_port</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">family</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">socket.AF_INET</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">socktype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">socket.SOCK_STREAM</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.socket_helper.find_unused_port" title="永久链接至目标">¶</a></dt>
<dd><p>返回一个应当适合绑定的未使用端口。 这是通过创建一个与 <code class="docutils literal notranslate"><span class="pre">sock</span></code> 形参相同协议族和类型的临时套接字来达成的 (默认为 <a class="reference internal" href="socket.html#socket.AF_INET" title="socket.AF_INET"><code class="xref py py-const docutils literal notranslate"><span class="pre">AF_INET</span></code></a>, <a class="reference internal" href="socket.html#socket.SOCK_STREAM" title="socket.SOCK_STREAM"><code class="xref py py-const docutils literal notranslate"><span class="pre">SOCK_STREAM</span></code></a>)，并将其绑定到指定的主机地址 (默认为 <code class="docutils literal notranslate"><span class="pre">0.0.0.0</span></code>) 并将端口设为 0，以从 OS 引出一个未使用的瞬时端口。 这个临时套接字随后将被关闭并删除，然后返回该瞬时端口。</p>
<p>这个方法或 <a class="reference internal" href="#test.support.socket_helper.bind_port" title="test.support.socket_helper.bind_port"><code class="xref py py-func docutils literal notranslate"><span class="pre">bind_port()</span></code></a> 应当被用于任何在测试期间需要绑定到特定端口的测试。 具体使用哪个取决于调用方代码是否会创建 Python 套接字，或者是否需要在构造器中提供或向外部程序提供未使用的端口（例如传给 openssl 的 s_server 模式的 <code class="docutils literal notranslate"><span class="pre">-accept</span></code> 参数）。 在可能的情况下将总是优先使用 <a class="reference internal" href="#test.support.socket_helper.bind_port" title="test.support.socket_helper.bind_port"><code class="xref py py-func docutils literal notranslate"><span class="pre">bind_port()</span></code></a> 而非 <a class="reference internal" href="#test.support.socket_helper.find_unused_port" title="test.support.socket_helper.find_unused_port"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_unused_port()</span></code></a>。 不建议使用硬编码的端口因为将使测试的多个实例无法同时运行，这对 buildbot 来说是个问题。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.socket_helper.bind_port">
<span class="sig-prename descclassname"><span class="pre">test.support.socket_helper.</span></span><span class="sig-name descname"><span class="pre">bind_port</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sock</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">host</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">HOST</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.socket_helper.bind_port" title="永久链接至目标">¶</a></dt>
<dd><p>将套接字绑定到一个空闲端口并返回端口号。 这依赖于瞬时端口以确保我们能使用一个未绑定端口。 这很重要因为可能会有许多测试同时运行，特别是在 buildbot 环境中。 如果 <code class="docutils literal notranslate"><span class="pre">sock.family</span></code> 为 <a class="reference internal" href="socket.html#socket.AF_INET" title="socket.AF_INET"><code class="xref py py-const docutils literal notranslate"><span class="pre">AF_INET</span></code></a> 而 <code class="docutils literal notranslate"><span class="pre">sock.type</span></code> 为 <a class="reference internal" href="socket.html#socket.SOCK_STREAM" title="socket.SOCK_STREAM"><code class="xref py py-const docutils literal notranslate"><span class="pre">SOCK_STREAM</span></code></a>，并且套接字上设置了 <code class="xref py py-const docutils literal notranslate"><span class="pre">SO_REUSEADDR</span></code> 或 <code class="xref py py-const docutils literal notranslate"><span class="pre">SO_REUSEPORT</span></code> 则此方法将引发异常。 测试绝不应该为 TCP/IP 套接字设置这些套接字选项。 唯一需要设置这些选项的情况是通过多个 UDP 套接字来测试组播。</p>
<p>此外，如果 <code class="xref py py-const docutils literal notranslate"><span class="pre">SO_EXCLUSIVEADDRUSE</span></code> 套接字选项是可用的（例如在 Windows 上），它将在套接字上被设置。 这将阻止其他任何人在测试期间绑定到我们的主机/端口。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.socket_helper.bind_unix_socket">
<span class="sig-prename descclassname"><span class="pre">test.support.socket_helper.</span></span><span class="sig-name descname"><span class="pre">bind_unix_socket</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sock</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">addr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.socket_helper.bind_unix_socket" title="永久链接至目标">¶</a></dt>
<dd><p>Bind a Unix socket, raising <a class="reference internal" href="unittest.html#unittest.SkipTest" title="unittest.SkipTest"><code class="xref py py-exc docutils literal notranslate"><span class="pre">unittest.SkipTest</span></code></a> if
<a class="reference internal" href="exceptions.html#PermissionError" title="PermissionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PermissionError</span></code></a> is raised.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.socket_helper.skip_unless_bind_unix_socket">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.socket_helper.</span></span><span class="sig-name descname"><span class="pre">skip_unless_bind_unix_socket</span></span><a class="headerlink" href="#test.support.socket_helper.skip_unless_bind_unix_socket" title="永久链接至目标">¶</a></dt>
<dd><p>一个用于运行需要 Unix 套接字 <code class="docutils literal notranslate"><span class="pre">bind()</span></code> 功能的测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.socket_helper.transient_internet">
<span class="sig-prename descclassname"><span class="pre">test.support.socket_helper.</span></span><span class="sig-name descname"><span class="pre">transient_internet</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resource_name</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errnos</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.socket_helper.transient_internet" title="永久链接至目标">¶</a></dt>
<dd><p>一个在互联网连接的各种问题以异常的形式表现出来时会引发 <a class="reference internal" href="#test.support.ResourceDenied" title="test.support.ResourceDenied"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceDenied</span></code></a> 的上下文管理器。</p>
</dd></dl>

</section>
<section id="module-test.support.script_helper">
<span id="test-support-script-helper-utilities-for-the-python-execution-tests"></span><h1><a class="reference internal" href="#module-test.support.script_helper" title="test.support.script_helper: Support for Python's script execution tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.script_helper</span></code></a> --- 用于 Python 执行测试工具<a class="headerlink" href="#module-test.support.script_helper" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support.script_helper" title="test.support.script_helper: Support for Python's script execution tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.script_helper</span></code></a> 模块提供了对 Python 的脚本执行测试的支持。</p>
<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.interpreter_requires_environment">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">interpreter_requires_environment</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.interpreter_requires_environment" title="永久链接至目标">¶</a></dt>
<dd><p>如果 <code class="docutils literal notranslate"><span class="pre">sys.executable</span> <span class="pre">interpreter</span></code> 需要环境变量才能运行则返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
<p>这被设计用来配合 <code class="docutils literal notranslate"><span class="pre">&#64;unittest.skipIf()</span></code> 以便标注需要使用to annotate tests that need to use an <code class="docutils literal notranslate"><span class="pre">assert_python*()</span></code> 函数来启动隔离模式 (<code class="docutils literal notranslate"><span class="pre">-I</span></code>) 或无环境模式 (<code class="docutils literal notranslate"><span class="pre">-E</span></code>) 子解释器的测试。</p>
<p>正常的编译和测试运行不会进入这种状况但它在尝试从一个使用 Python 的当前家目录查找逻辑找不到明确的家目录的解释器运行标准库测试套件时有可能发生。</p>
<p>设置 <span class="target" id="index-10"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONHOME"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONHOME</span></code></a> 是一种能让大多数测试套件在这种情况下运行的办法。 <span class="target" id="index-11"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONPATH"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a> 或 <span class="target" id="index-12"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONUSERSITE</span></code> 是另外两个可影响解释器是否能启动的常见环境变量。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.run_python_until_end">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">run_python_until_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">env_vars</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.run_python_until_end" title="永久链接至目标">¶</a></dt>
<dd><p>基于 <em>env_vars</em> 设置环境以便在子进程中运行解释器。 它的值可以包括 <code class="docutils literal notranslate"><span class="pre">__isolated</span></code>, <code class="docutils literal notranslate"><span class="pre">__cleanenv</span></code>, <code class="docutils literal notranslate"><span class="pre">__cwd</span></code>, and <code class="docutils literal notranslate"><span class="pre">TERM</span></code>。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.9 版更改: </span>此函数不会再从 <em>stderr</em> 去除空格符。</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.assert_python_ok">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">assert_python_ok</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">env_vars</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.assert_python_ok" title="永久链接至目标">¶</a></dt>
<dd><p>断言附带 <em>args</em> 和可选的环境变量 <em>env_vars</em> 运行解释器会成功 (<code class="docutils literal notranslate"><span class="pre">rc</span> <span class="pre">==</span> <span class="pre">0</span></code>) 并返回一个 <code class="docutils literal notranslate"><span class="pre">(return</span> <span class="pre">code,</span> <span class="pre">stdout,</span> <span class="pre">stderr)</span></code> 元组。</p>
<p>如果设置了 <em>__cleanenv</em> 仅限关键字形参，<em>env_vars</em> 会被用作一个全新的环境。</p>
<p>Python 是以隔离模式 (命令行选项 <code class="docutils literal notranslate"><span class="pre">-I</span></code>) 启动的，除非 <em>__isolated</em> 仅限关键字形参被设为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.9 版更改: </span>此函数不会再从 <em>stderr</em> 去除空格符。</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.assert_python_failure">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">assert_python_failure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">env_vars</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.assert_python_failure" title="永久链接至目标">¶</a></dt>
<dd><p>断言附带 <em>args</em> 和可选的环境变量 <em>env_vars</em> 运行解释器会失败 (<code class="docutils literal notranslate"><span class="pre">rc</span> <span class="pre">!=</span> <span class="pre">0</span></code>) 并返回一个 <code class="docutils literal notranslate"><span class="pre">(return</span> <span class="pre">code,</span> <span class="pre">stdout,</span> <span class="pre">stderr)</span></code> 元组。</p>
<p>更多选项请参阅 <a class="reference internal" href="#test.support.script_helper.assert_python_ok" title="test.support.script_helper.assert_python_ok"><code class="xref py py-func docutils literal notranslate"><span class="pre">assert_python_ok()</span></code></a>。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.9 版更改: </span>此函数不会再从 <em>stderr</em> 去除空格符。</p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.spawn_python">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">spawn_python</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stdout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">subprocess.PIPE</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stderr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">subprocess.STDOUT</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.spawn_python" title="永久链接至目标">¶</a></dt>
<dd><p>使用给定的参数运行一个 Python 子进程。</p>
<p><em>kw</em> 是要传给 <a class="reference internal" href="subprocess.html#subprocess.Popen" title="subprocess.Popen"><code class="xref py py-func docutils literal notranslate"><span class="pre">subprocess.Popen()</span></code></a> 的额外关键字参数。 返回一个 <a class="reference internal" href="subprocess.html#subprocess.Popen" title="subprocess.Popen"><code class="xref py py-class docutils literal notranslate"><span class="pre">subprocess.Popen</span></code></a> 对象。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.kill_python">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">kill_python</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.kill_python" title="永久链接至目标">¶</a></dt>
<dd><p>运行给定的 <a class="reference internal" href="subprocess.html#subprocess.Popen" title="subprocess.Popen"><code class="xref py py-class docutils literal notranslate"><span class="pre">subprocess.Popen</span></code></a> 进程直至完成并返回 stdout。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.make_script">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">make_script</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">script_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">script_basename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">omit_suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.make_script" title="永久链接至目标">¶</a></dt>
<dd><p>在路径 <em>script_dir</em> 和 <em>script_basename</em> 中创建包含 <em>source</em> 的脚本。 如果 <em>omit_suffix</em> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则为名称添加 <code class="docutils literal notranslate"><span class="pre">.py</span></code>。 返回完整的脚本路径。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.make_zip_script">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">make_zip_script</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">zip_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zip_basename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">script_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name_in_zip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.make_zip_script" title="永久链接至目标">¶</a></dt>
<dd><p>使用 <em>zip_dir</em> 和 <em>zip_basename</em> 创建扩展名为 <code class="docutils literal notranslate"><span class="pre">zip</span></code> 的 zip 文件，其中包含 <em>script_name</em> 中的文件。 <em>name_in_zip</em> 为归档名。 返回一个包含 <code class="docutils literal notranslate"><span class="pre">(full</span> <span class="pre">path,</span> <span class="pre">full</span> <span class="pre">path</span> <span class="pre">of</span> <span class="pre">archive</span> <span class="pre">name)</span></code> 的元组。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.make_pkg">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">make_pkg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pkg_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.make_pkg" title="永久链接至目标">¶</a></dt>
<dd><p>创建一个名为 <em>pkg_dir</em> 的目录，其中包含一个 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 文件并以 <em>init_source</em> 作为其内容。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.script_helper.make_zip_pkg">
<span class="sig-prename descclassname"><span class="pre">test.support.script_helper.</span></span><span class="sig-name descname"><span class="pre">make_zip_pkg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">zip_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zip_basename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pkg_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">script_basename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compiled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.script_helper.make_zip_pkg" title="永久链接至目标">¶</a></dt>
<dd><p>使用 <em>zip_dir</em> 和 <em>zip_basename</em> 创建一个 zip 包目录，其中包含一个空的 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 文件和一个包含 <em>source</em> 的文件 <em>script_basename</em>。 如果 <em>compiled</em> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，则两个源文件将被编译并添加到 zip 包中。 返回一个以完整 zip 路径和 zip 文件归档名为元素的元组。</p>
</dd></dl>

</section>
<section id="module-test.support.bytecode_helper">
<span id="test-support-bytecode-helper-support-tools-for-testing-correct-bytecode-generation"></span><h1><a class="reference internal" href="#module-test.support.bytecode_helper" title="test.support.bytecode_helper: Support tools for testing correct bytecode generation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.bytecode_helper</span></code></a> --- 用于测试正确字节码生成的支持工具<a class="headerlink" href="#module-test.support.bytecode_helper" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support.bytecode_helper" title="test.support.bytecode_helper: Support tools for testing correct bytecode generation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.bytecode_helper</span></code></a> 模块提供了对测试和检查字节码生成的支持。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.9 新版功能.</span></p>
</div>
<p>The module defines the following class:</p>
<dl class="py class">
<dt class="sig sig-object py" id="test.support.bytecode_helper.BytecodeTestCase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.bytecode_helper.</span></span><span class="sig-name descname"><span class="pre">BytecodeTestCase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">unittest.TestCase</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.bytecode_helper.BytecodeTestCase" title="永久链接至目标">¶</a></dt>
<dd><p>这个类具有用于检查字节码的自定义断言。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="test.support.bytecode_helper.BytecodeTestCase.get_disassembly_as_string">
<span class="sig-prename descclassname"><span class="pre">BytecodeTestCase.</span></span><span class="sig-name descname"><span class="pre">get_disassembly_as_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">co</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.bytecode_helper.BytecodeTestCase.get_disassembly_as_string" title="永久链接至目标">¶</a></dt>
<dd><p>以字符串形式返回 <em>co</em> 的汇编码。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="test.support.bytecode_helper.BytecodeTestCase.assertInBytecode">
<span class="sig-prename descclassname"><span class="pre">BytecodeTestCase.</span></span><span class="sig-name descname"><span class="pre">assertInBytecode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">argval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">_UNSPECIFIED</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.bytecode_helper.BytecodeTestCase.assertInBytecode" title="永久链接至目标">¶</a></dt>
<dd><p>如果找到 <em>opname</em> 则返回 instr，否则抛出 <a class="reference internal" href="exceptions.html#AssertionError" title="AssertionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code></a>。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="test.support.bytecode_helper.BytecodeTestCase.assertNotInBytecode">
<span class="sig-prename descclassname"><span class="pre">BytecodeTestCase.</span></span><span class="sig-name descname"><span class="pre">assertNotInBytecode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">argval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">_UNSPECIFIED</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.bytecode_helper.BytecodeTestCase.assertNotInBytecode" title="永久链接至目标">¶</a></dt>
<dd><p>如果找到 <em>opname</em> 则抛出 <a class="reference internal" href="exceptions.html#AssertionError" title="AssertionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code></a>。</p>
</dd></dl>

</section>
<section id="module-test.support.threading_helper">
<span id="test-support-threading-helper-utilities-for-threading-tests"></span><h1><a class="reference internal" href="#module-test.support.threading_helper" title="test.support.threading_helper: Support for threading tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.threading_helper</span></code></a> --- 用于线程测试的工具<a class="headerlink" href="#module-test.support.threading_helper" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support.threading_helper" title="test.support.threading_helper: Support for threading tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.threading_helper</span></code></a> 模块提供了对线程测试的支持。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.10 新版功能.</span></p>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="test.support.threading_helper.join_thread">
<span class="sig-prename descclassname"><span class="pre">test.support.threading_helper.</span></span><span class="sig-name descname"><span class="pre">join_thread</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">thread</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.threading_helper.join_thread" title="永久链接至目标">¶</a></dt>
<dd><p>在 <em>timeout</em> 秒之内合并一个 <em>thread</em>。 如果线程在 <em>timeout</em> 秒后仍然存活则引发 <a class="reference internal" href="exceptions.html#AssertionError" title="AssertionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code></a>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.threading_helper.reap_threads">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.threading_helper.</span></span><span class="sig-name descname"><span class="pre">reap_threads</span></span><a class="headerlink" href="#test.support.threading_helper.reap_threads" title="永久链接至目标">¶</a></dt>
<dd><p>用于确保即使测试失败线程仍然会被清理的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.threading_helper.start_threads">
<span class="sig-prename descclassname"><span class="pre">test.support.threading_helper.</span></span><span class="sig-name descname"><span class="pre">start_threads</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">threads</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unlock</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.threading_helper.start_threads" title="永久链接至目标">¶</a></dt>
<dd><p>启动 <em>threads</em> 的上下文管理器，该参数为一个线程序列。 <em>unlock</em> 是一个在所有线程启动之后被调用的函数，即使引发了异常也会执行；一个例子是 <a class="reference internal" href="threading.html#threading.Event.set" title="threading.Event.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Event.set()</span></code></a>。 <code class="docutils literal notranslate"><span class="pre">start_threads</span></code> 将在退出时尝试合并已启动的线程。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.threading_helper.threading_cleanup">
<span class="sig-prename descclassname"><span class="pre">test.support.threading_helper.</span></span><span class="sig-name descname"><span class="pre">threading_cleanup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">original_values</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.threading_helper.threading_cleanup" title="永久链接至目标">¶</a></dt>
<dd><p>清理未在 <em>original_values</em> 中指定的线程。 被设计为如果有一个测试在后台离开正在运行的线程时会发出警告。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.threading_helper.threading_setup">
<span class="sig-prename descclassname"><span class="pre">test.support.threading_helper.</span></span><span class="sig-name descname"><span class="pre">threading_setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.threading_helper.threading_setup" title="永久链接至目标">¶</a></dt>
<dd><p>返回当前线程计数和悬空线程的副本。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.threading_helper.wait_threads_exit">
<span class="sig-prename descclassname"><span class="pre">test.support.threading_helper.</span></span><span class="sig-name descname"><span class="pre">wait_threads_exit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.threading_helper.wait_threads_exit" title="永久链接至目标">¶</a></dt>
<dd><p>等待直到 <code class="docutils literal notranslate"><span class="pre">with</span></code> 语句中所有已创建线程退出的上下文管理器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.threading_helper.catch_threading_exception">
<span class="sig-prename descclassname"><span class="pre">test.support.threading_helper.</span></span><span class="sig-name descname"><span class="pre">catch_threading_exception</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.threading_helper.catch_threading_exception" title="永久链接至目标">¶</a></dt>
<dd><p>使用 <a class="reference internal" href="threading.html#threading.excepthook" title="threading.excepthook"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.excepthook()</span></code></a> 来捕获 <a class="reference internal" href="threading.html#threading.Thread" title="threading.Thread"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.Thread</span></code></a> 异常的上下文管理器。</p>
<p>当异常被捕获时要设置的属性:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exc_type</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exc_value</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exc_traceback</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thread</span></code></p></li>
</ul>
<p>参见 <a class="reference internal" href="threading.html#threading.excepthook" title="threading.excepthook"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.excepthook()</span></code></a> 文档。</p>
<p>这些属性在上下文管理器退出时将被删除。</p>
<p>用法：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">threading_helper</span><span class="o">.</span><span class="n">catch_threading_exception</span><span class="p">()</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
    <span class="c1"># code spawning a thread which raises an exception</span>
    <span class="o">...</span>

    <span class="c1"># check the thread exception, use cm attributes:</span>
    <span class="c1"># exc_type, exc_value, exc_traceback, thread</span>
    <span class="o">...</span>

<span class="c1"># exc_type, exc_value, exc_traceback, thread attributes of cm no longer</span>
<span class="c1"># exists at this point</span>
<span class="c1"># (to avoid reference cycles)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">3.8 新版功能.</span></p>
</div>
</dd></dl>

</section>
<section id="module-test.support.os_helper">
<span id="test-support-os-helper-utilities-for-os-tests"></span><h1><a class="reference internal" href="#module-test.support.os_helper" title="test.support.os_helper: Support for os tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.os_helper</span></code></a> --- 用于操作系统测试的工具<a class="headerlink" href="#module-test.support.os_helper" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support.os_helper" title="test.support.os_helper: Support for os tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.os_helper</span></code></a> 模块提供了对操作系统测试的支持。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.10 新版功能.</span></p>
</div>
<dl class="py data">
<dt class="sig sig-object py" id="test.support.os_helper.FS_NONASCII">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">FS_NONASCII</span></span><a class="headerlink" href="#test.support.os_helper.FS_NONASCII" title="永久链接至目标">¶</a></dt>
<dd><p>一个可通过 <a class="reference internal" href="os.html#os.fsencode" title="os.fsencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.fsencode()</span></code></a> 编码的非 ASCII 字符。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.os_helper.SAVEDCWD">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">SAVEDCWD</span></span><a class="headerlink" href="#test.support.os_helper.SAVEDCWD" title="永久链接至目标">¶</a></dt>
<dd><p>设置为 <a class="reference internal" href="os.html#os.getcwd" title="os.getcwd"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.getcwd()</span></code></a>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.os_helper.TESTFN">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">TESTFN</span></span><a class="headerlink" href="#test.support.os_helper.TESTFN" title="永久链接至目标">¶</a></dt>
<dd><p>设置为一个可以安全地用作临时文件名的名称。 任何被创建的临时文件都应当被关闭和撤销链接（移除）。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.os_helper.TESTFN_NONASCII">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">TESTFN_NONASCII</span></span><a class="headerlink" href="#test.support.os_helper.TESTFN_NONASCII" title="永久链接至目标">¶</a></dt>
<dd><p>如果存在的话，设置为一个包含 <a class="reference internal" href="#test.support.os_helper.FS_NONASCII" title="test.support.os_helper.FS_NONASCII"><code class="xref py py-data docutils literal notranslate"><span class="pre">FS_NONASCII</span></code></a> 字符的文件名。 这会确保当文件名存在时，它可使用默认文件系统编码格式来编码和解码。 这允许需要非 ASCII 文件名的测试在其不可用的平台上被方便地跳过。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.os_helper.TESTFN_UNENCODABLE">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">TESTFN_UNENCODABLE</span></span><a class="headerlink" href="#test.support.os_helper.TESTFN_UNENCODABLE" title="永久链接至目标">¶</a></dt>
<dd><p>设置为一个应当在严格模式下不可使用文件系统编码格式来编码的文件名（str 类型）。 如果无法生成这样的文件名则可以为 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.os_helper.TESTFN_UNDECODABLE">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">TESTFN_UNDECODABLE</span></span><a class="headerlink" href="#test.support.os_helper.TESTFN_UNDECODABLE" title="永久链接至目标">¶</a></dt>
<dd><p>设置为一个应当在严格模式下不可使用文件系统编码格式来编码的文件名（bytes 类型）。 如果无法生成这样的文件名则可以为 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="test.support.os_helper.TESTFN_UNICODE">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">TESTFN_UNICODE</span></span><a class="headerlink" href="#test.support.os_helper.TESTFN_UNICODE" title="永久链接至目标">¶</a></dt>
<dd><p>设置为用于临时文件的非 ASCII 名称。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.os_helper.EnvironmentVarGuard">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">EnvironmentVarGuard</span></span><a class="headerlink" href="#test.support.os_helper.EnvironmentVarGuard" title="永久链接至目标">¶</a></dt>
<dd><p>用于临时性地设置或取消设置环境变量的类。 其实例可被用作上下文管理器并具有完整的字典接口用来查询/修改下层的 <code class="docutils literal notranslate"><span class="pre">os.environ</span></code>。 在从上下文管理器退出之后所有通过此实例对环境变量进行的修改都将被回滚。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.1 版更改: </span>增加了字典接口。</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.os_helper.FakePath">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">FakePath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.FakePath" title="永久链接至目标">¶</a></dt>
<dd><p>简单的 <a class="reference internal" href="../glossary.html#term-path-like-object"><span class="xref std std-term">path-like object</span></a>。 它实现了 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__fspath__()</span></code> 方法，该方法将返回 <em>path</em> 参数。 如果 <em>path</em> 为一个异常，它将在 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__fspath__()</span></code> 中被引发。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="test.support.os_helper.EnvironmentVarGuard.set">
<span class="sig-prename descclassname"><span class="pre">EnvironmentVarGuard.</span></span><span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">envvar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.EnvironmentVarGuard.set" title="永久链接至目标">¶</a></dt>
<dd><p>临时性地将环境变量 <code class="docutils literal notranslate"><span class="pre">envvar</span></code> 的值设为 <code class="docutils literal notranslate"><span class="pre">value</span></code>。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="test.support.os_helper.EnvironmentVarGuard.unset">
<span class="sig-prename descclassname"><span class="pre">EnvironmentVarGuard.</span></span><span class="sig-name descname"><span class="pre">unset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">envvar</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.EnvironmentVarGuard.unset" title="永久链接至目标">¶</a></dt>
<dd><p>临时性地取消设置环境变量 <code class="docutils literal notranslate"><span class="pre">envvar</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.can_symlink">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">can_symlink</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.can_symlink" title="永久链接至目标">¶</a></dt>
<dd><p>如果操作系统支持符号链接则返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>，否则返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.can_xattr">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">can_xattr</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.can_xattr" title="永久链接至目标">¶</a></dt>
<dd><p>如果操作系统支持 xattr 支返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>，否则返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.change_cwd">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">change_cwd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quiet</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.change_cwd" title="永久链接至目标">¶</a></dt>
<dd><p>一个临时性地将当前工作目录改为 <em>path</em> 并输出该目录的上下文管理器。</p>
<p>如果 <em>quiet</em> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，此上下文管理器将在发生错误时引发一个异常。 在其他情况下，它将只发出一个警告并将当前工作目录保持原状。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.create_empty_file">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">create_empty_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.create_empty_file" title="永久链接至目标">¶</a></dt>
<dd><p>创建一个名为 <em>filename</em> 的空文件。 如果文件已存在，则清空其内容。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.fd_count">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">fd_count</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.fd_count" title="永久链接至目标">¶</a></dt>
<dd><p>统计打开的文件描述符数量。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.fs_is_case_insensitive">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">fs_is_case_insensitive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.fs_is_case_insensitive" title="永久链接至目标">¶</a></dt>
<dd><p>如果 <em>directory</em> 的文件系统对大小写敏感则返回 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.make_bad_fd">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">make_bad_fd</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.make_bad_fd" title="永久链接至目标">¶</a></dt>
<dd><p>通过打开并关闭临时文件来创建一个无效的文件描述符，并返回其描述器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.rmdir">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">rmdir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.rmdir" title="永久链接至目标">¶</a></dt>
<dd><p>在 <em>filename</em> 上调用 <a class="reference internal" href="os.html#os.rmdir" title="os.rmdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.rmdir()</span></code></a>。 在 Windows 平台上，这将使用一个检测文件是否存在的等待循环来包装，需要这样做是因为反病毒程序会保持文件打开并阻止其被删除。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.rmtree">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">rmtree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.rmtree" title="永久链接至目标">¶</a></dt>
<dd><p>在 <em>path</em> 上调用 <a class="reference internal" href="shutil.html#shutil.rmtree" title="shutil.rmtree"><code class="xref py py-func docutils literal notranslate"><span class="pre">shutil.rmtree()</span></code></a> 或者调用 <a class="reference internal" href="os.html#os.lstat" title="os.lstat"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.lstat()</span></code></a> 和 <a class="reference internal" href="os.html#os.rmdir" title="os.rmdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.rmdir()</span></code></a> 来移除一个路径及其内容。 与 <a class="reference internal" href="#test.support.os_helper.rmdir" title="test.support.os_helper.rmdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">rmdir()</span></code></a> 一样，在 Windows 平台上这将使用一个检测文件是否存在的等待循环来包装。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.skip_unless_symlink">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">skip_unless_symlink</span></span><a class="headerlink" href="#test.support.os_helper.skip_unless_symlink" title="永久链接至目标">¶</a></dt>
<dd><p>一个用于运行需要符号链接支持的测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.skip_unless_xattr">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">skip_unless_xattr</span></span><a class="headerlink" href="#test.support.os_helper.skip_unless_xattr" title="永久链接至目标">¶</a></dt>
<dd><p>一个用于运行需要 xattr 支持的测试的装饰器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.temp_cwd">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">temp_cwd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tempcwd'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quiet</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.temp_cwd" title="永久链接至目标">¶</a></dt>
<dd><p>一个临时性地创建新目录并改变当前工作目录（CWD）的上下文管理器。</p>
<p>临时性地改变当前工作目录之前此上下文管理器会在当前目录下创建一个名为 <em>name</em> 的临时目录。 如果 <em>name</em> 为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则会使用 <a class="reference internal" href="tempfile.html#tempfile.mkdtemp" title="tempfile.mkdtemp"><code class="xref py py-func docutils literal notranslate"><span class="pre">tempfile.mkdtemp()</span></code></a> 创建临时目录。</p>
<p>如果 <em>quiet</em> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 并且无法创建或修改 CWD，则会引发一个错误。 在其他情况下，只会引发一个警告并使用原始 CWD。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.temp_dir">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">temp_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quiet</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.temp_dir" title="永久链接至目标">¶</a></dt>
<dd><p>一个在 <em>path</em> 上创建临时目录并输出该目录的上下文管理器。</p>
<p>如果 <em>path</em> 为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则会使用 <a class="reference internal" href="tempfile.html#tempfile.mkdtemp" title="tempfile.mkdtemp"><code class="xref py py-func docutils literal notranslate"><span class="pre">tempfile.mkdtemp()</span></code></a> 来创建临时目录。 如果 <em>quiet</em> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则该上下文管理器在发生错误时会引发一个异常。 在其他情况下，如果 <em>path</em> 已被指定并且无法创建，则只会发出一个警告。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.temp_umask">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">temp_umask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">umask</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.temp_umask" title="永久链接至目标">¶</a></dt>
<dd><p>一个临时性地设置进程掩码的上下文管理器。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.os_helper.unlink">
<span class="sig-prename descclassname"><span class="pre">test.support.os_helper.</span></span><span class="sig-name descname"><span class="pre">unlink</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.os_helper.unlink" title="永久链接至目标">¶</a></dt>
<dd><p>在 <em>filename</em> 上调用 <a class="reference internal" href="os.html#os.unlink" title="os.unlink"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.unlink()</span></code></a>。 与 <a class="reference internal" href="#test.support.os_helper.rmdir" title="test.support.os_helper.rmdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">rmdir()</span></code></a> 一样，在 Windows 平台上这将使用一个检测文本是否存在的等待循环来包装。</p>
</dd></dl>

</section>
<section id="module-test.support.import_helper">
<span id="test-support-import-helper-utilities-for-import-tests"></span><h1><a class="reference internal" href="#module-test.support.import_helper" title="test.support.import_helper: Support for import tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.import_helper</span></code></a> --- 用于导入测试的工具<a class="headerlink" href="#module-test.support.import_helper" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support.import_helper" title="test.support.import_helper: Support for import tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.import_helper</span></code></a> 模块提供了对导入测试的支持。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.10 新版功能.</span></p>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="test.support.import_helper.forget">
<span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">forget</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.forget" title="永久链接至目标">¶</a></dt>
<dd><p>从 <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code> 移除名为 <em>module_name</em> 的模块并删除该模块的已编译字节码文件。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.import_helper.import_fresh_module">
<span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">import_fresh_module</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blocked</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deprecated</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.import_fresh_module" title="永久链接至目标">¶</a></dt>
<dd><p>此函数会在执行导入之前通过从 <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code> 移除指定模块来导入并返回指定 Python 模块的新副本。 请注意这不同于 <code class="xref py py-func docutils literal notranslate"><span class="pre">reload()</span></code>，原来的模块不会受到此操作的影响。</p>
<p><em>fresh</em> 是包含在执行导入之前还要从 <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code> 缓存中移除的附加模块名称的可迭代对象。</p>
<p><em>blocked</em> 是包含模块名称的可迭代对象，导入期间在模块缓存中它会被替换为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 以确保尝试导入将引发 <a class="reference internal" href="exceptions.html#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a>。</p>
<p>指定名称的模块以及任何在 <em>fresh</em> 和 <em>blocked</em> 形参中指明的模块会在开始导入之前被保存并在全新导入完成时被重新插入到 <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code> 中。</p>
<p>如果 <em>deprecated</em> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 则在此导入操作期间模块和包的弃用消息会被屏蔽。</p>
<p>如果指定名称的模块无法被导入则此函数将引发 <a class="reference internal" href="exceptions.html#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a>。</p>
<p>用法示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get copies of the warnings module for testing without affecting the</span>
<span class="c1"># version being used by the rest of the test suite. One copy uses the</span>
<span class="c1"># C implementation, the other is forced to use the pure Python fallback</span>
<span class="c1"># implementation</span>
<span class="n">py_warnings</span> <span class="o">=</span> <span class="n">import_fresh_module</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">blocked</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_warnings&#39;</span><span class="p">])</span>
<span class="n">c_warnings</span> <span class="o">=</span> <span class="n">import_fresh_module</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">fresh</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_warnings&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.import_helper.import_module">
<span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">import_module</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deprecated</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">required_on</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.import_module" title="永久链接至目标">¶</a></dt>
<dd><p>此函数会导入并返回指定名称的模块。 不同于正常的导入，如果模块无法被导入则此函数将引发 <a class="reference internal" href="unittest.html#unittest.SkipTest" title="unittest.SkipTest"><code class="xref py py-exc docutils literal notranslate"><span class="pre">unittest.SkipTest</span></code></a>。</p>
<p>如果 <em>deprecated</em> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 则在此导入操作期间模块和包的弃用消息会被屏蔽。 如果某个模块在特定平台上是必需的而在其他平台上是可选的，请为包含平台前缀的可迭代对象设置 <em>required_on</em>，此对象将与 <a class="reference internal" href="sys.html#sys.platform" title="sys.platform"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.platform</span></code></a> 进行比对。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.1 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.import_helper.modules_setup">
<span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">modules_setup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.modules_setup" title="永久链接至目标">¶</a></dt>
<dd><p>返回 <a class="reference internal" href="sys.html#sys.modules" title="sys.modules"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.modules</span></code></a> 的副本。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.import_helper.modules_cleanup">
<span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">modules_cleanup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">oldmodules</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.modules_cleanup" title="永久链接至目标">¶</a></dt>
<dd><p>移除 <em>oldmodules</em> 和 <code class="docutils literal notranslate"><span class="pre">encodings</span></code> 以外的模块以保留内部缓冲区。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.import_helper.unload">
<span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">unload</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.unload" title="永久链接至目标">¶</a></dt>
<dd><p>从 <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code> 中删除 <em>name</em>。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.import_helper.make_legacy_pyc">
<span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">make_legacy_pyc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.make_legacy_pyc" title="永久链接至目标">¶</a></dt>
<dd><p>将 <span class="target" id="index-13"></span><a class="pep reference external" href="https://peps.python.org/pep-3147/"><strong>PEP 3147</strong></a>/<span class="target" id="index-14"></span><a class="pep reference external" href="https://peps.python.org/pep-0488/"><strong>PEP 488</strong></a> pyc 文件移至旧版 pyc 位置并返回该旧版 pyc 文件的文件系统路径。 <em>source</em> 的值是源文件的文件系统路径。 它不必真实存在，但是 PEP 3147/488 pyc 文件必须存在。</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.import_helper.CleanImport">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">CleanImport</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">module_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.CleanImport" title="永久链接至目标">¶</a></dt>
<dd><p>强制导入以返回一个新的模块引用的上下文管理器。 这适用于测试模块层级的行为，例如在导入时发出 <a class="reference internal" href="exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 示例用法:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CleanImport</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">):</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>  <span class="c1"># New reference.</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.import_helper.DirsOnSysPath">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.import_helper.</span></span><span class="sig-name descname"><span class="pre">DirsOnSysPath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">paths</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.import_helper.DirsOnSysPath" title="永久链接至目标">¶</a></dt>
<dd><p>一个临时性地向 <a class="reference internal" href="sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a> 添加目录的上下文管理器。</p>
<p>这将创建 <a class="reference internal" href="sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a> 的一个副本，添加作为位置参数传入的任何目录，然后在上下文结束时将 <a class="reference internal" href="sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a> 还原到副本的设置。</p>
<p>请注意该上下文管理器代码块中 <em>所有</em> 对 <a class="reference internal" href="sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a> 的修改，包括对象的替换，都将在代码块结束时被还原。</p>
</dd></dl>

</section>
<section id="module-test.support.warnings_helper">
<span id="test-support-warnings-helper-utilities-for-warnings-tests"></span><h1><a class="reference internal" href="#module-test.support.warnings_helper" title="test.support.warnings_helper: Support for warnings tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.warnings_helper</span></code></a> --- 用于警告测试的工具<a class="headerlink" href="#module-test.support.warnings_helper" title="永久链接至标题">¶</a></h1>
<p><a class="reference internal" href="#module-test.support.warnings_helper" title="test.support.warnings_helper: Support for warnings tests."><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.warnings_helper</span></code></a> 模块提供了对警告测试的支持。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.10 新版功能.</span></p>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="test.support.warnings_helper.check_no_resource_warning">
<span class="sig-prename descclassname"><span class="pre">test.support.warnings_helper.</span></span><span class="sig-name descname"><span class="pre">check_no_resource_warning</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">testcase</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.warnings_helper.check_no_resource_warning" title="永久链接至目标">¶</a></dt>
<dd><p>检测是否没有任何 <a class="reference internal" href="exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a> 被引发的上下文管理器。 你必须在该上下文管理器结束之前移除可能发出 <a class="reference internal" href="exceptions.html#ResourceWarning" title="ResourceWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a> 的对象。</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.warnings_helper.check_syntax_warning">
<span class="sig-prename descclassname"><span class="pre">test.support.warnings_helper.</span></span><span class="sig-name descname"><span class="pre">check_syntax_warning</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">testcase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statement</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errtext</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lineno</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.warnings_helper.check_syntax_warning" title="永久链接至目标">¶</a></dt>
<dd><p>用于通过尝试编译 <em>statement</em> 来测试 <em>statement</em> 中的语法警告。 还会测试 <a class="reference internal" href="exceptions.html#SyntaxWarning" title="SyntaxWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxWarning</span></code></a> 是否只发出了一次，以及它在转成错误时是否将被转换为 <a class="reference internal" href="exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a>。 <em>testcase</em> 是用于测试的 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code></a> 实例。  <em>errtext</em> 是应当匹配所发出的 <a class="reference internal" href="exceptions.html#SyntaxWarning" title="SyntaxWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxWarning</span></code></a> 以及所引发的 <a class="reference internal" href="exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 的字符串表示形式的正则表达式。 如果 <em>lineno</em> 不为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则与警告和异常所在的行进行比较。 如果 <em>offset</em> 不为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则与异常的偏移量进行比较。</p>
<div class="versionadded">
<p><span class="versionmodified added">3.8 新版功能.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="test.support.warnings_helper.check_warnings">
<span class="sig-prename descclassname"><span class="pre">test.support.warnings_helper.</span></span><span class="sig-name descname"><span class="pre">check_warnings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">filters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quiet</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#test.support.warnings_helper.check_warnings" title="永久链接至目标">¶</a></dt>
<dd><p>一个用于 <a class="reference internal" href="warnings.html#warnings.catch_warnings" title="warnings.catch_warnings"><code class="xref py py-func docutils literal notranslate"><span class="pre">warnings.catch_warnings()</span></code></a> 以更容易地测试特定警告是否被正确引发的便捷包装器。 它大致等价于调用 <code class="docutils literal notranslate"><span class="pre">warnings.catch_warnings(record=True)</span></code> 并将 <a class="reference internal" href="warnings.html#warnings.simplefilter" title="warnings.simplefilter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">warnings.simplefilter()</span></code></a> 设为 <code class="docutils literal notranslate"><span class="pre">always</span></code> 并附带自动验证已记录结果的选项。</p>
<p><code class="docutils literal notranslate"><span class="pre">check_warnings</span></code> 接受 <code class="docutils literal notranslate"><span class="pre">(&quot;message</span> <span class="pre">regexp&quot;,</span> <span class="pre">WarningCategory)</span></code> 形式的 2 元组作为位置参数。 如果提供了一个或多个 <em>filters</em>，或者如果可选的关键字参数 <em>quiet</em> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则它会检查确认警告是符合预期的：每个已指定的过滤器必须匹配至少一个被包围的代码或测试失败时引发的警告，并且如果有任何未能匹配已指定过滤器的警告被引发则测试将失败。 要禁用这些检查中的第一项，请将 <em>quiet</em> 设为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p>
<p>如果未指定任何参数，则默认为:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">check_warnings</span><span class="p">((</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="ne">Warning</span><span class="p">),</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>在此情况下所有警告都会被捕获而不会引发任何错误。</p>
<p>在进入该上下文管理器时，将返回一个 <code class="xref py py-class docutils literal notranslate"><span class="pre">WarningRecorder</span></code> 实例。 来自 <a class="reference internal" href="warnings.html#warnings.catch_warnings" title="warnings.catch_warnings"><code class="xref py py-func docutils literal notranslate"><span class="pre">catch_warnings()</span></code></a> 的下层警告列表可通过该记录器对象的 <a class="reference internal" href="warnings.html#module-warnings" title="warnings: Issue warning messages and control their disposition."><code class="xref py py-attr docutils literal notranslate"><span class="pre">warnings</span></code></a> 属性来访问。 作为一个便捷方式，该对象中代表最近的警告的属性也可通过该记录器对象来直接访问（参见以下示例）。 如果未引发任何警告，则在其他情况下预期代表一个警告的任何对象属性都将返回 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</p>
<p>该记录器对象还有一个 <code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code> 方法，该方法会清空警告列表。</p>
<p>该上下文管理器被设计为像这样来使用:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">check_warnings</span><span class="p">((</span><span class="s2">&quot;assertion is always true&quot;</span><span class="p">,</span> <span class="ne">SyntaxWarning</span><span class="p">),</span>
                    <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)):</span>
    <span class="n">exec</span><span class="p">(</span><span class="s1">&#39;assert(False, &quot;Hey!&quot;)&#39;</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;Hide me!&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>在此情况下如果两个警告都未被引发，或是引发了其他的警告，则 <a class="reference internal" href="#test.support.warnings_helper.check_warnings" title="test.support.warnings_helper.check_warnings"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_warnings()</span></code></a> 将会引发一个错误。</p>
<p>当一个测试需要更深入地查看这些警告，而不是仅仅检查它们是否发生时，可以使用这样的代码:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">check_warnings</span><span class="p">(</span><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">warnings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">warnings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span>
    <span class="n">w</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
<p>在这里所有的警告都将被捕获，而测试代码会直接测试被捕获的警告。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">在 3.2 版更改: </span>新增可选参数 <em>filters</em> 和 <em>quiet</em>。</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="test.support.warnings_helper.WarningsRecorder">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">test.support.warnings_helper.</span></span><span class="sig-name descname"><span class="pre">WarningsRecorder</span></span><a class="headerlink" href="#test.support.warnings_helper.WarningsRecorder" title="永久链接至目标">¶</a></dt>
<dd><p>用于为单元测试记录警告的类。 请参阅以上 <a class="reference internal" href="#test.support.warnings_helper.check_warnings" title="test.support.warnings_helper.check_warnings"><code class="xref py py-func docutils literal notranslate"><span class="pre">check_warnings()</span></code></a> 的文档来了解详情。</p>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code> ---  Python 回归测试包</a><ul>
<li><a class="reference internal" href="#writing-unit-tests-for-the-test-package">为 <code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code> 包编写单元测试</a></li>
<li><a class="reference internal" href="#running-tests-using-the-command-line-interface">使用命令行界面运行测试</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-test.support"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support</span></code> --- 针对 Python 测试套件的工具</a></li>
<li><a class="reference internal" href="#module-test.support.socket_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.socket_helper</span></code> --- 用于套接字测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.script_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.script_helper</span></code> --- 用于 Python 执行测试工具</a></li>
<li><a class="reference internal" href="#module-test.support.bytecode_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.bytecode_helper</span></code> --- 用于测试正确字节码生成的支持工具</a></li>
<li><a class="reference internal" href="#module-test.support.threading_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.threading_helper</span></code> --- 用于线程测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.os_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.os_helper</span></code> --- 用于操作系统测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.import_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.import_helper</span></code> --- 用于导入测试的工具</a></li>
<li><a class="reference internal" href="#module-test.support.warnings_helper"><code class="xref py py-mod docutils literal notranslate"><span class="pre">test.support.warnings_helper</span></code> --- 用于警告测试的工具</a></li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="2to3.html"
                          title="上一章">2to3 --- Automated Python 2 to 3 code translation</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="debug.html"
                          title="下一章">调试和分析</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/test.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="debug.html" title="调试和分析"
             >下一页</a> |</li>
        <li class="right" >
          <a href="2to3.html" title="2to3 --- Automated Python 2 to 3 code translation"
             >上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 标准库</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="development.html" >开发工具</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code> ---  Python 回归测试包</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">版权所有</a> 2001-2022, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    See <a href="/license.html">History and License</a> for more information.<br />
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最后更新于 11月 24, 2022.
    <a href="/bugs.html">Found a bug</a>?
    <br />

    由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>

  </body>
</html>