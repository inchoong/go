
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Python 3.9 有什么新变化 &#8212; Python 3.11.0 文档</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?2022.1" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 3.11.0 文档 中搜索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="关于这些文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="copyright" title="版权所有" href="../copyright.html" />
    <link rel="next" title="Python 3.8 有什么新变化" href="3.8.html" />
    <link rel="prev" title="Python 3.10 有什么新变化" href="3.10.html" />
    <link rel="canonical" href="https://docs.python.org/3/whatsnew/3.9.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://www.python.org/" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="快速搜索"/>
            <input type="submit" value="转向"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.9 有什么新变化</a><ul>
<li><a class="reference internal" href="#summary-release-highlights">摘要 -- 发布重点</a></li>
<li><a class="reference internal" href="#you-should-check-for-deprecationwarning-in-your-code">请检查代码中的 DeprecationWarning。</a></li>
<li><a class="reference internal" href="#new-features">新的特性</a><ul>
<li><a class="reference internal" href="#dictionary-merge-update-operators">字典合并与更新运算符</a></li>
<li><a class="reference internal" href="#new-string-methods-to-remove-prefixes-and-suffixes">新增用于移除前缀和后缀的字符串方法</a></li>
<li><a class="reference internal" href="#type-hinting-generics-in-standard-collections">标准多项集中的类型标注泛型</a></li>
<li><a class="reference internal" href="#new-parser">新的解析器</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-language-changes">其他语言特性修改</a></li>
<li><a class="reference internal" href="#new-modules">新增模块</a><ul>
<li><a class="reference internal" href="#zoneinfo">zoneinfo</a></li>
<li><a class="reference internal" href="#graphlib">graphlib</a></li>
</ul>
</li>
<li><a class="reference internal" href="#improved-modules">改进的模块</a><ul>
<li><a class="reference internal" href="#ast">ast</a></li>
<li><a class="reference internal" href="#asyncio">asyncio</a></li>
<li><a class="reference internal" href="#compileall">compileall</a></li>
<li><a class="reference internal" href="#concurrent-futures">concurrent.futures</a></li>
<li><a class="reference internal" href="#curses">curses</a></li>
<li><a class="reference internal" href="#datetime">datetime</a></li>
<li><a class="reference internal" href="#distutils">distutils</a></li>
<li><a class="reference internal" href="#fcntl">fcntl</a></li>
<li><a class="reference internal" href="#ftplib">ftplib</a></li>
<li><a class="reference internal" href="#gc">gc</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#http">http</a></li>
<li><a class="reference internal" href="#idle-and-idlelib">IDLE 与 idlelib</a></li>
<li><a class="reference internal" href="#imaplib">imaplib</a></li>
<li><a class="reference internal" href="#importlib">importlib</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#ipaddress">ipaddress</a></li>
<li><a class="reference internal" href="#math">math</a></li>
<li><a class="reference internal" href="#multiprocessing">multiprocessing</a></li>
<li><a class="reference internal" href="#nntplib">nntplib</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#pathlib">pathlib</a></li>
<li><a class="reference internal" href="#pdb">pdb</a></li>
<li><a class="reference internal" href="#poplib">poplib</a></li>
<li><a class="reference internal" href="#pprint">pprint</a></li>
<li><a class="reference internal" href="#pydoc">pydoc</a></li>
<li><a class="reference internal" href="#random">random</a></li>
<li><a class="reference internal" href="#signal">signal</a></li>
<li><a class="reference internal" href="#smtplib">smtplib</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#time">time</a></li>
<li><a class="reference internal" href="#sys">sys</a></li>
<li><a class="reference internal" href="#tracemalloc">tracemalloc</a></li>
<li><a class="reference internal" href="#typing">typing</a></li>
<li><a class="reference internal" href="#unicodedata">unicodedata</a></li>
<li><a class="reference internal" href="#venv">venv</a></li>
<li><a class="reference internal" href="#xml">xml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimizations">性能优化</a></li>
<li><a class="reference internal" href="#deprecated">弃用</a></li>
<li><a class="reference internal" href="#removed">移除</a></li>
<li><a class="reference internal" href="#porting-to-python-3-9">移植到 Python 3.9</a><ul>
<li><a class="reference internal" href="#changes-in-the-python-api">Python API 的变化</a></li>
<li><a class="reference internal" href="#changes-in-the-c-api">C API 的变化</a></li>
<li><a class="reference internal" href="#cpython-bytecode-changes">CPython 字节码的改变</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-changes">构建的改变</a></li>
<li><a class="reference internal" href="#c-api-changes">C API 的改变</a><ul>
<li><a class="reference internal" href="#id1">新的特性</a></li>
<li><a class="reference internal" href="#id2">移植到 Python 3.9</a></li>
<li><a class="reference internal" href="#id3">移除</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notable-changes-in-python-3-9-1">Python 3.9.1 中的重要变化</a><ul>
<li><a class="reference internal" href="#id4">typing</a></li>
<li><a class="reference internal" href="#macos-11-0-big-sur-and-apple-silicon-mac-support">macOS 11.0 (Big Sur) 与 Apple Silicon Mac 支持</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notable-changes-in-python-3-9-2">Python 3.9.2 中的重要变化</a><ul>
<li><a class="reference internal" href="#collections-abc">collections.abc</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="3.10.html"
                          title="上一章">Python 3.10 有什么新变化</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="3.8.html"
                          title="下一章">Python 3.8 有什么新变化</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.9.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="3.8.html" title="Python 3.8 有什么新变化"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="3.10.html" title="Python 3.10 有什么新变化"
             accesskey="P">上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Python的新变化</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.9 有什么新变化</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-9">
<h1>Python 3.9 有什么新变化<a class="headerlink" href="#what-s-new-in-python-3-9" title="永久链接至标题">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">发布版本</dt>
<dd class="field-odd"><p>3.11.0</p>
</dd>
<dt class="field-even">日期</dt>
<dd class="field-even"><p>十一月 24, 2022</p>
</dd>
<dt class="field-odd">编者</dt>
<dd class="field-odd"><p>Łukasz Langa</p>
</dd>
</dl>
<p>本文介绍了 Python 3.9 相比 3.8 的新特性。 Python 3.9 发布于 2020 年 10 月 5 日。</p>
<p>详情请参阅 <a class="reference internal" href="changelog.html#changelog"><span class="std std-ref">更新日志</span></a>。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><span class="target" id="index-56"></span><a class="pep reference external" href="https://peps.python.org/pep-0596/"><strong>PEP 596</strong></a> - Python 3.9 发布计划</p>
</div>
<section id="summary-release-highlights">
<h2>摘要 -- 发布重点<a class="headerlink" href="#summary-release-highlights" title="永久链接至标题">¶</a></h2>
<p>新的语法特性：</p>
<ul class="simple">
<li><p><span class="target" id="index-57"></span><a class="pep reference external" href="https://peps.python.org/pep-0584/"><strong>PEP 584</strong></a>，为 <code class="docutils literal notranslate"><span class="pre">dict</span></code> 增加合并运算符；</p></li>
<li><p><span class="target" id="index-58"></span><a class="pep reference external" href="https://peps.python.org/pep-0585/"><strong>PEP 585</strong></a>，标准多项集中的类型标注泛型。</p></li>
<li><p><span class="target" id="index-59"></span><a class="pep reference external" href="https://peps.python.org/pep-0614/"><strong>PEP 614</strong></a>，放宽对装饰器的语法限制。</p></li>
</ul>
<p>新的内置特性：</p>
<ul class="simple">
<li><p><span class="target" id="index-60"></span><a class="pep reference external" href="https://peps.python.org/pep-0616/"><strong>PEP 616</strong></a>，移除前缀和后缀的字符串方法。</p></li>
</ul>
<p>标准库中的新特性:</p>
<ul class="simple">
<li><p><span class="target" id="index-61"></span><a class="pep reference external" href="https://peps.python.org/pep-0593/"><strong>PEP 593</strong></a>，灵活函数和变量注解；</p></li>
<li><p>添加了 <a class="reference internal" href="../library/os.html#os.pidfd_open" title="os.pidfd_open"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.pidfd_open()</span></code></a> 以允许不带竞争和信号的进程管理。</p></li>
</ul>
<p>解释器的改进:</p>
<ul class="simple">
<li><p><span class="target" id="index-62"></span><a class="pep reference external" href="https://peps.python.org/pep-0573/"><strong>PEP 573</strong></a>，从 C 扩展类型的方法快速访问模块状态；</p></li>
<li><p><span class="target" id="index-63"></span><a class="pep reference external" href="https://peps.python.org/pep-0617/"><strong>PEP 617</strong></a>，CPython 现在使用基于 PEG 的新解析器；</p></li>
<li><p>一些 Python 内置类型（range、tuple、set、frozenset、list、dict）现已使用 <span class="target" id="index-64"></span><a class="pep reference external" href="https://peps.python.org/pep-0590/"><strong>PEP 590</strong></a> vectorcall 加速；</p></li>
<li><p>垃圾回收不会因恢复的对象而阻塞；</p></li>
<li><p>一些 Python 模块（<code class="xref py py-mod docutils literal notranslate"><span class="pre">_abc</span></code>、<a class="reference internal" href="../library/audioop.html#module-audioop" title="audioop: Manipulate raw audio data. (已移除)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">audioop</span></code></a>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_bz2</span></code>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_codecs</span></code>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_contextvars</span></code>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_crypt</span></code>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_functools</span></code>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_json</span></code>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_locale</span></code>、<a class="reference internal" href="../library/math.html#module-math" title="math: Mathematical functions (sin() etc.)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">math</span></code></a>、<a class="reference internal" href="../library/operator.html#module-operator" title="operator: Functions corresponding to the standard operators."><code class="xref py py-mod docutils literal notranslate"><span class="pre">operator</span></code></a>、<a class="reference internal" href="../library/resource.html#module-resource" title="resource: An interface to provide resource usage information on the current process. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">resource</span></code></a>、<a class="reference internal" href="../library/time.html#module-time" title="time: Time access and conversions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">time</span></code></a>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_weakref</span></code>）现已使用 PEP 489 中定义的多段初始化；</p></li>
<li><p>一些标准库模块 (<a class="reference internal" href="../library/audioop.html#module-audioop" title="audioop: Manipulate raw audio data. (已移除)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">audioop</span></code></a>、<a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a>、<a class="reference internal" href="../library/grp.html#module-grp" title="grp: The group database (getgrnam() and friends). (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">grp</span></code></a>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_hashlib</span></code>、<a class="reference internal" href="../library/pwd.html#module-pwd" title="pwd: The password database (getpwnam() and friends). (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pwd</span></code></a>、<code class="xref py py-mod docutils literal notranslate"><span class="pre">_posixsubprocess</span></code>、<a class="reference internal" href="../library/random.html#module-random" title="random: Generate pseudo-random numbers with various common distributions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">random</span></code></a>、<a class="reference internal" href="../library/select.html#module-select" title="select: Wait for I/O completion on multiple streams."><code class="xref py py-mod docutils literal notranslate"><span class="pre">select</span></code></a>、<a class="reference internal" href="../library/struct.html#module-struct" title="struct: Interpret bytes as packed binary data."><code class="xref py py-mod docutils literal notranslate"><span class="pre">struct</span></code></a>、<a class="reference internal" href="../library/termios.html#module-termios" title="termios: POSIX style tty control. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">termios</span></code></a>、<a class="reference internal" href="../library/zlib.html#module-zlib" title="zlib: Low-level interface to compression and decompression routines compatible with gzip."><code class="xref py py-mod docutils literal notranslate"><span class="pre">zlib</span></code></a>) 现已使用 PEP 384 中定义的稳定 ABI。</p></li>
</ul>
<p>新的库模块：</p>
<ul class="simple">
<li><p><span class="target" id="index-65"></span><a class="pep reference external" href="https://peps.python.org/pep-0615/"><strong>PEP 615</strong></a>，标准库的 <a class="reference internal" href="../library/zoneinfo.html#module-zoneinfo" title="zoneinfo: IANA time zone support"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zoneinfo</span></code></a> 模块现已支持 IANA 时区数据库；</p></li>
<li><p>图的拓扑排序实现现在已由新的 <a class="reference internal" href="../library/graphlib.html#module-graphlib" title="graphlib: Functionality to operate with graph-like structures"><code class="xref py py-mod docutils literal notranslate"><span class="pre">graphlib</span></code></a> 模块提供。</p></li>
</ul>
<p>发布进程的变化:</p>
<ul class="simple">
<li><p><span class="target" id="index-66"></span><a class="pep reference external" href="https://peps.python.org/pep-0602/"><strong>PEP 602</strong></a>，CPython 采用年度发布周期。</p></li>
</ul>
</section>
<section id="you-should-check-for-deprecationwarning-in-your-code">
<h2>请检查代码中的 DeprecationWarning。<a class="headerlink" href="#you-should-check-for-deprecationwarning-in-your-code" title="永久链接至标题">¶</a></h2>
<p>Python 2.7 支持未终止时，为了实现向下兼容 Python 2.7，Python 3  保留了许多旧版功能。Python 2 的支持终止后，已经移除了一部分向下兼容层，剩余部分很快也会被移除。这几年，大部分兼容层都会触发 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 警告。例如，2012 年发布 Python 3.3 后，用 <code class="docutils literal notranslate"><span class="pre">collections.Mapping</span></code> 替代 <code class="docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code> 就会触发 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。</p>
<p>请用 <a class="reference internal" href="../using/cmdline.html#cmdoption-W"><code class="xref std std-option docutils literal notranslate"><span class="pre">-W</span></code></a> <code class="docutils literal notranslate"><span class="pre">default</span></code> 命令行选项测试应用程序来查看 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 和 <a class="reference internal" href="../library/exceptions.html#PendingDeprecationWarning" title="PendingDeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PendingDeprecationWarning</span></code></a>，甚至可以用 <a class="reference internal" href="../using/cmdline.html#cmdoption-W"><code class="xref std std-option docutils literal notranslate"><span class="pre">-W</span></code></a> <code class="docutils literal notranslate"><span class="pre">error</span></code> 将它们视为错误。 可以用 <a class="reference internal" href="../library/warnings.html#warning-filter"><span class="std std-ref">警告过滤器</span></a> 忽略来自第三方代码的警告。</p>
<p>Python 3.9 是最后一个提供 Python 2 向下兼容层的版本，以给予 Python 项目维护者更多时间移除 Python 2 支持，添加 Python 3.9 支持。</p>
<p><a class="reference internal" href="../library/collections.html#module-collections" title="collections: Container datatypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections</span></code></a> 模块中 <a class="reference internal" href="../library/collections.abc.html#collections-abstract-base-classes"><span class="std std-ref">抽象基类</span></a> 的别名，例如 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Mapping" title="collections.abc.Mapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Mapping</span></code></a> 的别名 <code class="docutils literal notranslate"><span class="pre">collections.Mapping</span></code> 会为向下兼容最后保留一个发行版。 这些内容将在 Python 3.10 中移除。</p>
<p>更通俗的说法是，请在 <a class="reference internal" href="../library/devmode.html#devmode"><span class="std std-ref">Python 开发模式</span></a> 下运行测试，这样做有助于让代码兼容 Python 的后续版本。</p>
<p>注：一些前期已弃用的内容也将在此 Python 版本中移除。 详见 <a class="reference internal" href="#removed-in-python-39"><span class="std std-ref">移除</span></a> 一节。</p>
</section>
<section id="new-features">
<h2>新的特性<a class="headerlink" href="#new-features" title="永久链接至标题">¶</a></h2>
<section id="dictionary-merge-update-operators">
<h3>字典合并与更新运算符<a class="headerlink" href="#dictionary-merge-update-operators" title="永久链接至标题">¶</a></h3>
<p>合并 (<code class="docutils literal notranslate"><span class="pre">|</span></code>) 与更新 (<code class="docutils literal notranslate"><span class="pre">|=</span></code>) 运算符已被加入内置的 <a class="reference internal" href="../library/stdtypes.html#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 类。 它们为现有的 <code class="docutils literal notranslate"><span class="pre">dict.update</span></code> 和 <code class="docutils literal notranslate"><span class="pre">{**d1,</span> <span class="pre">**d2}</span></code> 字典合并方法提供了补充。</p>
<p>示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1 from x&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2 from x&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2 from y&quot;</span><span class="p">,</span> <span class="s2">&quot;key3&quot;</span><span class="p">:</span> <span class="s2">&quot;value3 from y&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">|</span> <span class="n">y</span>
<span class="go">{&#39;key1&#39;: &#39;value1 from x&#39;, &#39;key2&#39;: &#39;value2 from y&#39;, &#39;key3&#39;: &#39;value3 from y&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">|</span> <span class="n">x</span>
<span class="go">{&#39;key2&#39;: &#39;value2 from x&#39;, &#39;key3&#39;: &#39;value3 from y&#39;, &#39;key1&#39;: &#39;value1 from x&#39;}</span>
</pre></div>
</div>
<p>详见 <span class="target" id="index-67"></span><a class="pep reference external" href="https://peps.python.org/pep-0584/"><strong>PEP 584</strong></a>。（Brandt Bucher 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36144">bpo-36144</a> 中的贡献。）</p>
</section>
<section id="new-string-methods-to-remove-prefixes-and-suffixes">
<h3>新增用于移除前缀和后缀的字符串方法<a class="headerlink" href="#new-string-methods-to-remove-prefixes-and-suffixes" title="永久链接至标题">¶</a></h3>
<p>增加了 <a class="reference internal" href="../library/stdtypes.html#str.removeprefix" title="str.removeprefix"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.removeprefix(prefix)</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#str.removesuffix" title="str.removesuffix"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.removesuffix(suffix)</span></code></a> 用于方便地从字符串移除不需要的前缀或后缀。 也增加了 <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, <code class="docutils literal notranslate"><span class="pre">bytearray</span></code> 以及 <code class="docutils literal notranslate"><span class="pre">collections.UserString</span></code> 的对应方法。 请参阅 <span class="target" id="index-68"></span><a class="pep reference external" href="https://peps.python.org/pep-0616/"><strong>PEP 616</strong></a> 了解详情。 （由 Dennis Sweeney 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39939">bpo-39939</a> 中贡献。）</p>
</section>
<section id="type-hinting-generics-in-standard-collections">
<h3>标准多项集中的类型标注泛型<a class="headerlink" href="#type-hinting-generics-in-standard-collections" title="永久链接至标题">¶</a></h3>
<p>在类型标注中现在你可以使用内置多项集类型例如 <code class="docutils literal notranslate"><span class="pre">list</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dict</span></code> 作为通用类型而不必从 <code class="docutils literal notranslate"><span class="pre">typing</span></code> 导入对应的大写形式类型名 (例如 <code class="docutils literal notranslate"><span class="pre">List</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Dict</span></code>)。 标准库中的其他一些类型现在同样也是通用的，例如 <code class="docutils literal notranslate"><span class="pre">queue.Queue</span></code>。</p>
<p>示例:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greet_all</span><span class="p">(</span><span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>详见 <span class="target" id="index-69"></span><a class="pep reference external" href="https://peps.python.org/pep-0585/"><strong>PEP 585</strong></a>。（由 Guido van Rossum、Ethan Smith 和 Batuhan Taşkaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39481">bpo-39481</a> 中贡献。）</p>
</section>
<section id="new-parser">
<h3>新的解析器<a class="headerlink" href="#new-parser" title="永久链接至标题">¶</a></h3>
<p>Python 3.9 使用于基于 <a class="reference external" href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">PEG</a> 的新解析器替代 <a class="reference external" href="https://en.wikipedia.org/wiki/LL_parser">LL(1)</a>。 新解析器的性能与旧解析器大致相当，但 PEG 在设计新语言特性时的形式化比 LL(1) 更灵活。 我们将在 Python 3.10 及之后版本中开始使用这种灵活性。</p>
<p><a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 模块会使用新解析器并会生成与旧解析器一致的 AST。</p>
<p>在 Python 3.10 中，旧解析器将被移除，依赖于它的所有功能也将被移除（主要是 <code class="xref py py-mod docutils literal notranslate"><span class="pre">parser</span></code> 模块，它早已被弃用）。  <em>只有</em> 在 Python 3.9 中，你可以使用命令行开关 (<code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">oldparser</span></code>) 或环境变量 (<code class="docutils literal notranslate"><span class="pre">PYTHONOLDPARSER=1</span></code>) 切换回 LL(1) 解析器。</p>
<p>请参阅 <span class="target" id="index-70"></span><a class="pep reference external" href="https://peps.python.org/pep-0617/"><strong>PEP 617</strong></a> 了解详情。 （由 Guido van Rossum, Pablo Galindo 和 Lysandros Nikolaou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40334">bpo-40334</a> 中贡献。）</p>
</section>
</section>
<section id="other-language-changes">
<h2>其他语言特性修改<a class="headerlink" href="#other-language-changes" title="永久链接至标题">¶</a></h2>
<ul>
<li><p><a class="reference internal" href="../library/functions.html#import__" title="__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a> 现在会引发 <a class="reference internal" href="../library/exceptions.html#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a> 而不是 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>，后者曾经会在相对导入超出其最高层级包时发生。 （由 Ngalim Siregar 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37444">bpo-37444</a> 中贡献。）</p></li>
<li><p>Python 现在会获取命令行中指定的脚本文件名 (例如: <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">script.py</span></code>) 的绝对路径: <a class="reference internal" href="../library/__main__.html#module-__main__" title="__main__: The environment where top-level code is run. Covers command-line interfaces, import-time behavior, and ``__name__ == '__main__'``."><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code></a> 模块的 <code class="docutils literal notranslate"><span class="pre">__file__</span></code> 属性将是一个绝对路径，而不是相对路径。 现在此路径在当前目录通过 <a class="reference internal" href="../library/os.html#os.chdir" title="os.chdir"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.chdir()</span></code></a> 被改变后仍将保持有效。 作为附带效果，回溯信息也将在此情况下为 <a class="reference internal" href="../library/__main__.html#module-__main__" title="__main__: The environment where top-level code is run. Covers command-line interfaces, import-time behavior, and ``__name__ == '__main__'``."><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code></a> 模块帧显示绝对路径。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=20443">bpo-20443</a> 中贡献。）</p></li>
<li><p>在 <a class="reference internal" href="../library/devmode.html#devmode"><span class="std std-ref">Python 开发模式</span></a> 以及 <a class="reference internal" href="../using/configure.html#debug-build"><span class="std std-ref">调试编译版本</span></a> 中，现在会针对字符串编码和解码操作检查 <em>encoding</em> 和 <em>errors</em> 参数。 例如: <a class="reference internal" href="../library/functions.html#open" title="open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#str.encode" title="str.encode"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.encode()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#bytes.decode" title="bytes.decode"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bytes.decode()</span></code></a>。</p>
<p>默认设置下，为保证性能，<em>errors</em> 参数只会在第一次发生编码/解码错误时被检查，并且对于空字符串 <em>encoding</em> 参数有时会被忽略。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37388">bpo-37388</a> 中贡献。）</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;.replace(&quot;&quot;,</span> <span class="pre">s,</span> <span class="pre">n)</span></code> 对于所有非零的 <code class="docutils literal notranslate"><span class="pre">n</span></code> 都将返回 <code class="docutils literal notranslate"><span class="pre">s</span></code> 而不是空字符串。 现在此方法会与 <code class="docutils literal notranslate"><span class="pre">&quot;&quot;.replace(&quot;&quot;,</span> <span class="pre">s)</span></code> 保持一致。 对于 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a> 对象也有类似的修改。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=28029">bpo-28029</a> 中贡献。）</p></li>
<li><p>任何有效的表达式现在都可被用作 <a class="reference internal" href="../glossary.html#term-decorator"><span class="xref std std-term">decorator</span></a>。 在之前版本中，相关语法则更为严格。 请参阅 <span class="target" id="index-71"></span><a class="pep reference external" href="https://peps.python.org/pep-0614/"><strong>PEP 614</strong></a> 了解详情。 （由 Brandt Bucher 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39702">bpo-39702</a> 中贡献。）</p></li>
<li><p>改进了 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块的帮助信息。 现在将为所有特殊形式和特殊通用别名 (例如 <code class="docutils literal notranslate"><span class="pre">Union</span></code> 和 <code class="docutils literal notranslate"><span class="pre">List</span></code>) 显示文档字符串。 使用 <a class="reference internal" href="../library/functions.html#help" title="help"><code class="xref py py-func docutils literal notranslate"><span class="pre">help()</span></code></a> 时传入通用别名例如 <code class="docutils literal notranslate"><span class="pre">List[int]</span></code> 将显示对应实体类型 (这里对应的是 <code class="docutils literal notranslate"><span class="pre">list</span></code>) 的帮助信息。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40257">bpo-40257</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../reference/expressions.html#agen.aclose" title="agen.aclose"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aclose()</span></code></a> / <a class="reference internal" href="../reference/expressions.html#agen.asend" title="agen.asend"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asend()</span></code></a> / <a class="reference internal" href="../reference/expressions.html#agen.athrow" title="agen.athrow"><code class="xref py py-meth docutils literal notranslate"><span class="pre">athrow()</span></code></a> 的并行运行现在已被禁止，且 <code class="docutils literal notranslate"><span class="pre">ag_running</span></code> 现在会反映异步生成器的实际运行状态。 （由 Yury Selivanov 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=30773">bpo-30773</a> 中贡献。）</p></li>
<li><p>调用 <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> 方法时发生的非预期错误不会再被 <a class="reference internal" href="../reference/expressions.html#in"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">in</span></code></a> 运算符以及 <a class="reference internal" href="../library/operator.html#module-operator" title="operator: Functions corresponding to the standard operators."><code class="xref py py-mod docutils literal notranslate"><span class="pre">operator</span></code></a> 的 <a class="reference internal" href="../library/operator.html#operator.contains" title="operator.contains"><code class="xref py py-func docutils literal notranslate"><span class="pre">contains()</span></code></a>, <a class="reference internal" href="../library/operator.html#operator.indexOf" title="operator.indexOf"><code class="xref py py-func docutils literal notranslate"><span class="pre">indexOf()</span></code></a> 和 <a class="reference internal" href="../library/operator.html#operator.countOf" title="operator.countOf"><code class="xref py py-func docutils literal notranslate"><span class="pre">countOf()</span></code></a> 中的 <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> 所掩盖。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40824">bpo-40824</a> 中贡献。）</p></li>
<li><p>未加圆括号的 lambda 表达式不能再作为推导式和生成器表达式的 <code class="docutils literal notranslate"><span class="pre">if</span></code> 子句的表达式部分。 请参阅 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41848">bpo-41848</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43755">bpo-43755</a> 了解详情。</p></li>
</ul>
</section>
<section id="new-modules">
<h2>新增模块<a class="headerlink" href="#new-modules" title="永久链接至标题">¶</a></h2>
<section id="zoneinfo">
<h3>zoneinfo<a class="headerlink" href="#zoneinfo" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/zoneinfo.html#module-zoneinfo" title="zoneinfo: IANA time zone support"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zoneinfo</span></code></a> 模块为标准库引入了 IANA 时区数据库。 它添加了 <a class="reference internal" href="../library/zoneinfo.html#zoneinfo.ZoneInfo" title="zoneinfo.ZoneInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">zoneinfo.ZoneInfo</span></code></a>，这是一个基于系统时区数据的实体 <a class="reference internal" href="../library/datetime.html#datetime.tzinfo" title="datetime.tzinfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.tzinfo</span></code></a> 实现。</p>
<p>示例:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zoneinfo</span> <span class="kn">import</span> <span class="n">ZoneInfo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Daylight saving time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">ZoneInfo</span><span class="p">(</span><span class="s2">&quot;America/Los_Angeles&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
<span class="go">2020-10-31 12:00:00-07:00</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span><span class="o">.</span><span class="n">tzname</span><span class="p">()</span>
<span class="go">&#39;PDT&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Standard time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
<span class="go">2020-11-07 12:00:00-08:00</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">tzname</span><span class="p">())</span>
<span class="go">PST</span>
</pre></div>
</div>
<p>作为不包含 IANA 数据库的平台的一个回退数据源，还以第一方软件包的形式发布了 <a class="reference external" href="https://pypi.org/project/tzdata/"><code class="docutils literal notranslate"><span class="pre">tzdata</span></code></a> 模块 -- 通过 PyPI 发行并由 CPython 核心团队维护。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<dl class="simple">
<dt><span class="target" id="index-72"></span><a class="pep reference external" href="https://peps.python.org/pep-0615/"><strong>PEP 615</strong></a> -- 在标准库中支持 IANA 时区数据库</dt><dd><p>PEP 由 Paul Ganssle 撰写并实现</p>
</dd>
</dl>
</div>
</section>
<section id="graphlib">
<h3>graphlib<a class="headerlink" href="#graphlib" title="永久链接至标题">¶</a></h3>
<p>添加了新的 <a class="reference internal" href="../library/graphlib.html#module-graphlib" title="graphlib: Functionality to operate with graph-like structures"><code class="xref py py-mod docutils literal notranslate"><span class="pre">graphlib</span></code></a> 模块，其中包含 <a class="reference internal" href="../library/graphlib.html#graphlib.TopologicalSorter" title="graphlib.TopologicalSorter"><code class="xref py py-class docutils literal notranslate"><span class="pre">graphlib.TopologicalSorter</span></code></a> 类来提供图的拓扑排序功能。 （由 Pablo Galindo, Tim Peters 和 Larry Hastings 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=17005">bpo-17005</a> 中贡献。）</p>
</section>
</section>
<section id="improved-modules">
<h2>改进的模块<a class="headerlink" href="#improved-modules" title="永久链接至标题">¶</a></h2>
<section id="ast">
<h3>ast<a class="headerlink" href="#ast" title="永久链接至标题">¶</a></h3>
<p>将 <em>indent</em> 选项添加到 <a class="reference internal" href="../library/ast.html#ast.dump" title="ast.dump"><code class="xref py py-func docutils literal notranslate"><span class="pre">dump()</span></code></a>，这允许它产生多行缩进的输出。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37995">bpo-37995</a> 中贡献。）</p>
<p>添加了 <a class="reference internal" href="../library/ast.html#ast.unparse" title="ast.unparse"><code class="xref py py-func docutils literal notranslate"><span class="pre">ast.unparse()</span></code></a> 作为 <a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 模块中的一个函数，它可被用来反解析 <a class="reference internal" href="../library/ast.html#ast.AST" title="ast.AST"><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.AST</span></code></a> 对象并产生相应的代码字符串，当它被解析时将会产生一个等价的 <a class="reference internal" href="../library/ast.html#ast.AST" title="ast.AST"><code class="xref py py-class docutils literal notranslate"><span class="pre">ast.AST</span></code></a> 对象。 （由 Pablo Galindo 和 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38870">bpo-38870</a> 中贡献。）</p>
<p>为 AST 节点添加了文档字符串，其中包含 ASDL 签名，可被用来构造对应的节点。 （由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39638">bpo-39638</a> 中贡献。）</p>
</section>
<section id="asyncio">
<h3>asyncio<a class="headerlink" href="#asyncio" title="永久链接至标题">¶</a></h3>
<p>出于重要的安全性考量，<a class="reference internal" href="../library/asyncio-eventloop.html#asyncio.loop.create_datagram_endpoint" title="asyncio.loop.create_datagram_endpoint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.loop.create_datagram_endpoint()</span></code></a> 的 <em>reuse_address</em> 形参不再被支持。 这是由 UDP 中的套接字选项 <code class="docutils literal notranslate"><span class="pre">SO_REUSEADDR</span></code> 的行为导致的。 更多细节请参阅 <code class="docutils literal notranslate"><span class="pre">loop.create_datagram_endpoint()</span></code> 的文档。 （由 Kyle Stanley, Antoine Pitrou 和 Yury Selivanov 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37228">bpo-37228</a> 中贡献。。）</p>
<p>添加了新的 <a class="reference internal" href="../glossary.html#term-coroutine"><span class="xref std std-term">coroutine</span></a> <a class="reference internal" href="../library/asyncio-eventloop.html#asyncio.loop.shutdown_default_executor" title="asyncio.loop.shutdown_default_executor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shutdown_default_executor()</span></code></a>，它可为等待 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="concurrent.futures.ThreadPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code></a> 结束关闭的默认执行器安排关闭日程操作。 此外，<a class="reference internal" href="../library/asyncio-runner.html#asyncio.run" title="asyncio.run"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.run()</span></code></a> 已被更新以使用新的 <a class="reference internal" href="../glossary.html#term-coroutine"><span class="xref std std-term">coroutine</span></a>。 （由 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34037">bpo-34037</a> 中贡献。）</p>
<p>添加了 <a class="reference internal" href="../library/asyncio-policy.html#asyncio.PidfdChildWatcher" title="asyncio.PidfdChildWatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">asyncio.PidfdChildWatcher</span></code></a>，这是一个 Linux 专属的子监视器实现，它负责轮询进程的文件描述符。 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38692">bpo-38692</a>)</p>
<p>添加了新的 <a class="reference internal" href="../glossary.html#term-coroutine"><span class="xref std std-term">coroutine</span></a> <a class="reference internal" href="../library/asyncio-task.html#asyncio.to_thread" title="asyncio.to_thread"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.to_thread()</span></code></a>。 它主要被用于在单独线程中运行 IO 密集型函数以避免阻塞事件循环，实质上就相当于是 <a class="reference internal" href="../library/asyncio-eventloop.html#asyncio.loop.run_in_executor" title="asyncio.loop.run_in_executor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run_in_executor()</span></code></a> 的高层级版本，可直接接受关键字参数。 （由 Kyle Stanley 和 Yury Selivanov 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=32309">bpo-32309</a> 中贡献。）</p>
<p>当由于超时而取消任务时，<a class="reference internal" href="../library/asyncio-task.html#asyncio.wait_for" title="asyncio.wait_for"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.wait_for()</span></code></a> 现在将会等待直到也在 <em>timeout</em> 值 &lt;= 0 的情况下完成取消。 就像 timeout 值为正数时一样。 （由 Elvis Pranskevichus 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=32751">bpo-32751</a> 中贡献。）</p>
<p>当附带 <a class="reference internal" href="../library/ssl.html#ssl.SSLSocket" title="ssl.SSLSocket"><code class="xref py py-class docutils literal notranslate"><span class="pre">ssl.SSLSocket</span></code></a> 套接字调用不兼容的方法时 <a class="reference internal" href="../library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 现在会引发 <code class="xref py py-exc docutils literal notranslate"><span class="pre">TyperError</span></code>。 （由 Ido Michael 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37404">bpo-37404</a> 中贡献。）</p>
</section>
<section id="compileall">
<h3>compileall<a class="headerlink" href="#compileall" title="永久链接至标题">¶</a></h3>
<p>为重复的 <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> 文件添加了使用硬软件的可能性: <em>hardlink_dupes</em> 形参以及 --hardlink-dupes 命令行选项。 （由 Lumír 'Frenzy' Balhar 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40495">bpo-40495</a> 中贡献。）</p>
<p>新增了一些用于在结果 <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> 文件中操纵路径的选项: <em>stripdir</em>, <em>prependdir</em>, <em>limit_sl_dest</em> 形参以及 -s, -p, -e 命令行选项。 并使得为优化等级多次指定选项成为可能。 （由 Lumír 'Frenzy' Balhar 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38112">bpo-38112</a> 中贡献。）</p>
</section>
<section id="concurrent-futures">
<h3>concurrent.futures<a class="headerlink" href="#concurrent-futures" title="永久链接至标题">¶</a></h3>
<p>将新的 <em>cancel_futures</em> 形参添加到 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.Executor.shutdown" title="concurrent.futures.Executor.shutdown"><code class="xref py py-meth docutils literal notranslate"><span class="pre">concurrent.futures.Executor.shutdown()</span></code></a>，可以取消尚未开始运行的所有挂起的 Future，而不必等待它们完成运行再关闭执行器。 （由 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39349">bpo-39349</a> 中贡献。）</p>
<p>从 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="concurrent.futures.ThreadPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ThreadPoolExecutor</span></code></a> 和 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessPoolExecutor</span></code></a> 中移除了守护线程。 这改善与与子解释器的兼容性及它们在关闭进程时的可预测性。 （由 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39812">bpo-39812</a> 中贡献。）</p>
<p>现在 <a class="reference internal" href="../library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessPoolExecutor</span></code></a> 中的工作进程仅会在没有可重用的空闲工作进程时按需产生。 这优化了启动开销并减少了由空闲工作进程导致的 CPU 时间损失。 （由 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39207">bpo-39207</a> 中贡献。）</p>
</section>
<section id="curses">
<h3>curses<a class="headerlink" href="#curses" title="永久链接至标题">¶</a></h3>
<p>增加了 <a class="reference internal" href="../library/curses.html#curses.get_escdelay" title="curses.get_escdelay"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.get_escdelay()</span></code></a>, <a class="reference internal" href="../library/curses.html#curses.set_escdelay" title="curses.set_escdelay"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.set_escdelay()</span></code></a>, <a class="reference internal" href="../library/curses.html#curses.get_tabsize" title="curses.get_tabsize"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.get_tabsize()</span></code></a> 以及 <a class="reference internal" href="../library/curses.html#curses.set_tabsize" title="curses.set_tabsize"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.set_tabsize()</span></code></a> 函数。（由 Anthony Sottile 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38312">bpo-38312</a> 中贡献。）</p>
</section>
<section id="datetime">
<h3>datetime<a class="headerlink" href="#datetime" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/datetime.html#datetime.date" title="datetime.date"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.date</span></code></a> 的 <a class="reference internal" href="../library/datetime.html#datetime.date.isocalendar" title="datetime.date.isocalendar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">isocalendar()</span></code></a> 以及 <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> 的 <a class="reference internal" href="../library/datetime.html#datetime.datetime.isocalendar" title="datetime.datetime.isocalendar"><code class="xref py py-meth docutils literal notranslate"><span class="pre">isocalendar()</span></code></a> 等方法现在将返回 <a class="reference internal" href="../library/collections.html#collections.namedtuple" title="collections.namedtuple"><code class="xref py py-func docutils literal notranslate"><span class="pre">namedtuple()</span></code></a> 而不是 <a class="reference internal" href="../library/stdtypes.html#tuple" title="tuple"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=24416">bpo-24416</a> 中贡献。）</p>
</section>
<section id="distutils">
<h3>distutils<a class="headerlink" href="#distutils" title="永久链接至标题">¶</a></h3>
<p><strong class="command">upload</strong> 命令现在会创建 SHA2-256 和 Blake2b-256 哈希摘要。 它会在禁用 MD5 摘要的平台上跳过 MD5。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40698">bpo-40698</a> 中贡献。）</p>
</section>
<section id="fcntl">
<h3>fcntl<a class="headerlink" href="#fcntl" title="永久链接至标题">¶</a></h3>
<p>增加了 <code class="xref py py-data docutils literal notranslate"><span class="pre">F_OFD_GETLK</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">F_OFD_SETLK</span></code> 和 <code class="xref py py-data docutils literal notranslate"><span class="pre">F_OFD_SETLKW</span></code> 等常量。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38602">bpo-38602</a> 中贡献。）</p>
</section>
<section id="ftplib">
<h3>ftplib<a class="headerlink" href="#ftplib" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/ftplib.html#ftplib.FTP" title="ftplib.FTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">FTP</span></code></a> 和 <a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS" title="ftplib.FTP_TLS"><code class="xref py py-class docutils literal notranslate"><span class="pre">FTP_TLS</span></code></a> 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39259">bpo-39259</a> 中贡献。）</p>
</section>
<section id="gc">
<h3>gc<a class="headerlink" href="#gc" title="永久链接至标题">¶</a></h3>
<p>当垃圾回收器进行某些复活对象的收集时（在终结器被执行之后这些对象可以在隔离周期之外被访问），不会阻止对所有仍然无法访问的对象的收集。 （由 Pablo Galindo 和 Tim Peters 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38379">bpo-38379</a> 中贡献。）</p>
<p>增加了一个新的函数 <a class="reference internal" href="../library/gc.html#gc.is_finalized" title="gc.is_finalized"><code class="xref py py-func docutils literal notranslate"><span class="pre">gc.is_finalized()</span></code></a> 用来检测一个对象是否已被垃圾回收器所终结。 （由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39322">bpo-39322</a> 中贡献。）</p>
</section>
<section id="hashlib">
<h3>hashlib<a class="headerlink" href="#hashlib" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/hashlib.html#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code class="xref py py-mod docutils literal notranslate"><span class="pre">hashlib</span></code></a> 模块现在会在可能的情况下使用 OpenSSL 中的 SHA3 哈希和 SHAKE XOF。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37630">bpo-37630</a> 中贡献。）</p>
<p>内置的哈希模块现在可通过 <code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">--without-builtin-hashlib-hashes</span></code> 禁用或通过 <code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">--with-builtin-hashlib-hashes=sha3,blake2</span></code> 这样的形式有选择地启用以强制使用基于 OpenSSL 的实现。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40479">bpo-40479</a> 中贡献）</p>
</section>
<section id="http">
<h3>http<a class="headerlink" href="#http" title="永久链接至标题">¶</a></h3>
<p>添加 HTTP 状态码 <code class="docutils literal notranslate"><span class="pre">103</span> <span class="pre">EARLY_HINTS</span></code>, <code class="docutils literal notranslate"><span class="pre">418</span> <span class="pre">IM_A_TEAPOT</span></code> 和 <code class="docutils literal notranslate"><span class="pre">425</span> <span class="pre">TOO_EARLY</span></code> 到 <a class="reference internal" href="../library/http.html#http.HTTPStatus" title="http.HTTPStatus"><code class="xref py py-class docutils literal notranslate"><span class="pre">http.HTTPStatus</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39509">bpo-39509</a> 以及 Ross Rhodes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39507">bpo-39507</a> 中贡献。）</p>
</section>
<section id="idle-and-idlelib">
<h3>IDLE 与 idlelib<a class="headerlink" href="#idle-and-idlelib" title="永久链接至标题">¶</a></h3>
<p>添加了切换光标闪烁停止的选项。 （由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4603">bpo-4603</a> 中贡献。）</p>
<p>Esc 键现在会关闭 IDLE 补全提示窗口。 （由 Johnny Najera 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38944">bpo-38944</a> 中贡献。）</p>
<p>添加关键字到模块名称补全列表。 （由 Terry J. Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37765">bpo-37765</a> 中贡献。）</p>
<p>3.9 维护版本中的新内容</p>
<p>使 IDLE 调用 <a class="reference internal" href="../library/sys.html#sys.excepthook" title="sys.excepthook"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.excepthook()</span></code></a> （当启动时没有 '-n' ）。用户钩子以前是被忽略的。 (由 Ken Hilton 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43008">bpo-43008</a> 中贡献。)</p>
<p>上述修改已被反向移植到 3.8 维护发行版中。</p>
<p>重新安排设置对话框。 将常规选项卡分成 Windows 和 Shell/Ed 选项卡。 将扩展帮助菜单的帮助源移至扩展标签。为新选项留出空间，并缩短对话框。后者使对话框更适合小屏幕。 (由 Terry Jan Reedy 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40468">bpo-40468</a> 。) 将缩进空间设置从字体标签移到新的 Windows 标签。 (由 Mark Roseman 和 Terry Jan Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=33962">bpo-33962</a> 中提供)。</p>
<p>Apply syntax highlighting to <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> files. (Contributed by Alex
Waygood and Terry Jan Reedy in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=45447">bpo-45447</a>.)</p>
</section>
<section id="imaplib">
<h3>imaplib<a class="headerlink" href="#imaplib" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4" title="imaplib.IMAP4"><code class="xref py py-class docutils literal notranslate"><span class="pre">IMAP4</span></code></a> 和 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4_SSL" title="imaplib.IMAP4_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">IMAP4_SSL</span></code></a> 的构造器具有可选的 <em>timeout</em> 形参。 并且，现在 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4.open" title="imaplib.IMAP4.open"><code class="xref py py-meth docutils literal notranslate"><span class="pre">open()</span></code></a> 方法也具有可选的 <em>timeout</em> 形参提供同样的修改。 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4_SSL" title="imaplib.IMAP4_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">IMAP4_SSL</span></code></a> 和 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4_stream" title="imaplib.IMAP4_stream"><code class="xref py py-class docutils literal notranslate"><span class="pre">IMAP4_stream</span></code></a> 中被重载的方法也应用了这个修改。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38615">bpo-38615</a> 中贡献。）</p>
<p>增加了 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4.unselect" title="imaplib.IMAP4.unselect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">imaplib.IMAP4.unselect()</span></code></a>。 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4.unselect" title="imaplib.IMAP4.unselect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">imaplib.IMAP4.unselect()</span></code></a> 会释放关联到选定邮箱的服务器资源并将服务器返回到已认证状态。 此命令会执行与 <a class="reference internal" href="../library/imaplib.html#imaplib.IMAP4.close" title="imaplib.IMAP4.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">imaplib.IMAP4.close()</span></code></a> 相同的动作，区别在于它不会从当前选定邮箱中永久性地移除消息。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40375">bpo-40375</a> 中贡献。）</p>
</section>
<section id="importlib">
<h3>importlib<a class="headerlink" href="#importlib" title="永久链接至标题">¶</a></h3>
<p>为提升与 import 语句的一致性，现在 <a class="reference internal" href="../library/importlib.html#importlib.util.resolve_name" title="importlib.util.resolve_name"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.resolve_name()</span></code></a> 对于无效的相对导入尝试会引发 <a class="reference internal" href="../library/exceptions.html#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a> 而不是 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 （由 Ngalim Siregar 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37444">bpo-37444</a> 中贡献。）</p>
<p>发布不可变模块对象的导入加载器除了发布单独模块以外现在也可以发布不可变包。 （由 Dino Viehland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39336">bpo-39336</a> 中贡献。）</p>
<p>添加了带有对包数据中子目录支持的 <a class="reference internal" href="../library/importlib.resources.html#importlib.resources.files" title="importlib.resources.files"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.resources.files()</span></code></a> 函数，与 <code class="docutils literal notranslate"><span class="pre">importlib_resources</span></code> 1.5 版的反向端口相匹配。（由 Jason R. Coombs 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39791">bpo-39791</a> 中贡献。）</p>
<p>来自 <code class="docutils literal notranslate"><span class="pre">importlib_metadata</span></code> 1.6.1 版的已更新 <code class="docutils literal notranslate"><span class="pre">importlib.metadata</span></code>。</p>
</section>
<section id="inspect">
<h3>inspect<a class="headerlink" href="#inspect" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/inspect.html#inspect.BoundArguments.arguments" title="inspect.BoundArguments.arguments"><code class="xref py py-attr docutils literal notranslate"><span class="pre">inspect.BoundArguments.arguments</span></code></a> 已从 <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code> 改为常规字典。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36350">bpo-36350</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39775">bpo-39775</a> 中贡献。）</p>
</section>
<section id="ipaddress">
<h3>ipaddress<a class="headerlink" href="#ipaddress" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/ipaddress.html#module-ipaddress" title="ipaddress: IPv4/IPv6 manipulation library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ipaddress</span></code></a> 现在支持 IPv6 作用域地址（即带有 <code class="docutils literal notranslate"><span class="pre">%&lt;scope_id&gt;</span></code> 前缀的 IPv6 地址）。</p>
<p>IPv6 作用域地址可使用 <a class="reference internal" href="../library/ipaddress.html#ipaddress.IPv6Address" title="ipaddress.IPv6Address"><code class="xref py py-class docutils literal notranslate"><span class="pre">ipaddress.IPv6Address</span></code></a> 来解析。 作用域的区 ID 如果存在，可通过 <a class="reference internal" href="../library/ipaddress.html#ipaddress.IPv6Address.scope_id" title="ipaddress.IPv6Address.scope_id"><code class="xref py py-attr docutils literal notranslate"><span class="pre">scope_id</span></code></a> 属性来获取。 （由 Oleksandr Pavliuk 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34788">bpo-34788</a> 中贡献。）</p>
<p>从 Python 3.9.5 开始 <a class="reference internal" href="../library/ipaddress.html#module-ipaddress" title="ipaddress: IPv4/IPv6 manipulation library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ipaddress</span></code></a> 模块不再接受 IPv4 地址字符串中有任何前缀的零。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36384">bpo-36384</a> 中贡献。）</p>
</section>
<section id="math">
<h3>math<a class="headerlink" href="#math" title="永久链接至标题">¶</a></h3>
<p>对 <a class="reference internal" href="../library/math.html#math.gcd" title="math.gcd"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.gcd()</span></code></a> 函数进行了扩展以处理多个参数。 在之前版本中，它只支持两个参数。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39648">bpo-39648</a> 中贡献。）</p>
<p>增加了 <a class="reference internal" href="../library/math.html#math.lcm" title="math.lcm"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.lcm()</span></code></a>: 返回指定参数的最小公倍数。 （由 Mark Dickinson, Ananthakrishnan 和 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39479">bpo-39479</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39648">bpo-39648</a> 中贡献。）</p>
<p>增加了 <a class="reference internal" href="../library/math.html#math.nextafter" title="math.nextafter"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.nextafter()</span></code></a>: 返回从 <em>x</em> 往 <em>y</em> 方向的下一个浮点数值。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39288">bpo-39288</a> 中贡献。）</p>
<p>增加了 <a class="reference internal" href="../library/math.html#math.ulp" title="math.ulp"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.ulp()</span></code></a>: 返回一个浮点数的最小有效比特位。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39310">bpo-39310</a> 中贡献。）</p>
</section>
<section id="multiprocessing">
<h3>multiprocessing<a class="headerlink" href="#multiprocessing" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/multiprocessing.html#multiprocessing.SimpleQueue" title="multiprocessing.SimpleQueue"><code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.SimpleQueue</span></code></a> 类新增了 <a class="reference internal" href="../library/multiprocessing.html#multiprocessing.SimpleQueue.close" title="multiprocessing.SimpleQueue.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a> 方法用来显式地关闭队列。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=30966">bpo-30966</a> 中贡献。）</p>
</section>
<section id="nntplib">
<h3>nntplib<a class="headerlink" href="#nntplib" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/nntplib.html#nntplib.NNTP" title="nntplib.NNTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">NNTP</span></code></a> 和 <a class="reference internal" href="../library/nntplib.html#nntplib.NNTP_SSL" title="nntplib.NNTP_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">NNTP_SSL</span></code></a> 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39259">bpo-39259</a> 中贡献。）</p>
</section>
<section id="os">
<h3>os<a class="headerlink" href="#os" title="永久链接至标题">¶</a></h3>
<p>增加了 <a class="reference internal" href="../library/os.html#os.CLD_KILLED" title="os.CLD_KILLED"><code class="xref py py-data docutils literal notranslate"><span class="pre">CLD_KILLED</span></code></a> 和 <a class="reference internal" href="../library/os.html#os.CLD_STOPPED" title="os.CLD_STOPPED"><code class="xref py py-data docutils literal notranslate"><span class="pre">CLD_STOPPED</span></code></a> 作为 <code class="xref py py-attr docutils literal notranslate"><span class="pre">si_code</span></code>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38493">bpo-38493</a> 中贡献。）</p>
<p>对外公开了 Linux 专属的 <a class="reference internal" href="../library/os.html#os.pidfd_open" title="os.pidfd_open"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.pidfd_open()</span></code></a> (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38692">bpo-38692</a>) 和 <a class="reference internal" href="../library/os.html#os.P_PIDFD" title="os.P_PIDFD"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.P_PIDFD</span></code></a> (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38713">bpo-38713</a>) 用于文件描述符的进程管理。</p>
<p>现在 <a class="reference internal" href="../library/os.html#os.unsetenv" title="os.unsetenv"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.unsetenv()</span></code></a> 函数在 Windows 上也已可用。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39413">bpo-39413</a> 中贡献。）</p>
<p>现在 <a class="reference internal" href="../library/os.html#os.putenv" title="os.putenv"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.putenv()</span></code></a> 和 <a class="reference internal" href="../library/os.html#os.unsetenv" title="os.unsetenv"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.unsetenv()</span></code></a> 函数将总是可用。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39395">bpo-39395</a> 中贡献。）</p>
<p>增加了 <a class="reference internal" href="../library/os.html#os.waitstatus_to_exitcode" title="os.waitstatus_to_exitcode"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.waitstatus_to_exitcode()</span></code></a> 函数：将等待状态转换为退出码。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40094">bpo-40094</a> 中贡献。）</p>
</section>
<section id="pathlib">
<h3>pathlib<a class="headerlink" href="#pathlib" title="永久链接至标题">¶</a></h3>
<p>增加了 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.readlink" title="pathlib.Path.readlink"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.readlink()</span></code></a>，其行为类似于 <a class="reference internal" href="../library/os.html#os.readlink" title="os.readlink"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.readlink()</span></code></a>。 （由 Girts Folkmanis 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=30618">bpo-30618</a> 中贡献。）</p>
</section>
<section id="pdb">
<h3>pdb<a class="headerlink" href="#pdb" title="永久链接至标题">¶</a></h3>
<p>在 Windows 上 <a class="reference internal" href="../library/pdb.html#pdb.Pdb" title="pdb.Pdb"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pdb</span></code></a> 现在支持 <code class="docutils literal notranslate"><span class="pre">~/.pdbrc</span></code>。 （由 Tim Hopper 和 Dan Lidral-Porter 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=20523">bpo-20523</a> 中贡献。）</p>
</section>
<section id="poplib">
<h3>poplib<a class="headerlink" href="#poplib" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/poplib.html#poplib.POP3" title="poplib.POP3"><code class="xref py py-class docutils literal notranslate"><span class="pre">POP3</span></code></a> 和 <a class="reference internal" href="../library/poplib.html#poplib.POP3_SSL" title="poplib.POP3_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">POP3_SSL</span></code></a> 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39259">bpo-39259</a> 中贡献。）</p>
</section>
<section id="pprint">
<h3>pprint<a class="headerlink" href="#pprint" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/pprint.html#module-pprint" title="pprint: Data pretty printer."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pprint</span></code></a> 能美化打印 <a class="reference internal" href="../library/types.html#types.SimpleNamespace" title="types.SimpleNamespace"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.SimpleNamespace</span></code></a>。 （由 Carl Bordum Hansen 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37376">bpo-37376</a> 中贡献。）</p>
</section>
<section id="pydoc">
<h3>pydoc<a class="headerlink" href="#pydoc" title="永久链接至标题">¶</a></h3>
<p>文档字符串的显示现在不仅针对类、函数、方法等，也针对任何具有自己的 <code class="docutils literal notranslate"><span class="pre">__doc__</span></code> 属性的对象。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40257">bpo-40257</a> 中贡献。）</p>
</section>
<section id="random">
<h3>random<a class="headerlink" href="#random" title="永久链接至标题">¶</a></h3>
<p>增加了新的 <code class="xref py py-attr docutils literal notranslate"><span class="pre">random.Random.randbytes</span></code> 方法：生成随机字节串。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40286">bpo-40286</a> 中贡献。）</p>
</section>
<section id="signal">
<h3>signal<a class="headerlink" href="#signal" title="永久链接至标题">¶</a></h3>
<p>对外公开了 Linux 专属的 <a class="reference internal" href="../library/signal.html#signal.pidfd_send_signal" title="signal.pidfd_send_signal"><code class="xref py py-func docutils literal notranslate"><span class="pre">signal.pidfd_send_signal()</span></code></a> 用于向使用文件描述符而非 pid 的进程发送信号。 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38712">bpo-38712</a>)</p>
</section>
<section id="smtplib">
<h3>smtplib<a class="headerlink" href="#smtplib" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP" title="smtplib.SMTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP</span></code></a> 和 <a class="reference internal" href="../library/smtplib.html#smtplib.SMTP_SSL" title="smtplib.SMTP_SSL"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMTP_SSL</span></code></a> 当它们的构造器所给定的超时参数为零以防止创建非阻塞套接字时会引发 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-class docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39259">bpo-39259</a> 中贡献。）</p>
<p>现在 <a class="reference internal" href="../library/smtplib.html#smtplib.LMTP" title="smtplib.LMTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">LMTP</span></code></a> 构造器具有可选的 <em>timeout</em> 形参。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39329">bpo-39329</a> 中贡献。）</p>
</section>
<section id="socket">
<h3>socket<a class="headerlink" href="#socket" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/socket.html#module-socket" title="socket: Low-level networking interface."><code class="xref py py-mod docutils literal notranslate"><span class="pre">socket</span></code></a> 模块现在会在 Linux 4.1 或更高版本上导出 <a class="reference internal" href="../library/socket.html#socket.CAN_RAW_JOIN_FILTERS" title="socket.CAN_RAW_JOIN_FILTERS"><code class="xref py py-data docutils literal notranslate"><span class="pre">CAN_RAW_JOIN_FILTERS</span></code></a> 常量。 （由 Stefan Tatschner 和 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=25780">bpo-25780</a> 中贡献。）</p>
<p>现在 socket 模块会在支持的平台上支持 <a class="reference internal" href="../library/socket.html#socket.CAN_J1939" title="socket.CAN_J1939"><code class="xref py py-data docutils literal notranslate"><span class="pre">CAN_J1939</span></code></a> 协议。 （由 Karl Ding 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40291">bpo-40291</a> 上贡献。）</p>
<p>现在 socket 模块具有 <a class="reference internal" href="../library/socket.html#socket.send_fds" title="socket.send_fds"><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.send_fds()</span></code></a> 和 <a class="reference internal" href="../library/socket.html#socket.recv_fds" title="socket.recv_fds"><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.recv_fds()</span></code></a> 函数。 （由 Joannah Nanjekye, Shinya Okano 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=28724">bpo-28724</a> 中贡献。）</p>
</section>
<section id="time">
<h3>time<a class="headerlink" href="#time" title="永久链接至标题">¶</a></h3>
<p>On AIX, <a class="reference internal" href="../library/time.html#time.thread_time" title="time.thread_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">thread_time()</span></code></a> is now implemented with <code class="docutils literal notranslate"><span class="pre">thread_cputime()</span></code>
which has nanosecond resolution, rather than
<code class="docutils literal notranslate"><span class="pre">clock_gettime(CLOCK_THREAD_CPUTIME_ID)</span></code> which has a resolution of 10 milliseconds.
(Contributed by Batuhan Taskaya in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40192">bpo-40192</a>)</p>
</section>
<section id="sys">
<h3>sys<a class="headerlink" href="#sys" title="永久链接至标题">¶</a></h3>
<p>增加了新的 <a class="reference internal" href="../library/sys.html#sys.platlibdir" title="sys.platlibdir"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.platlibdir</span></code></a> 属性：平台专属库目录的名称。 它被用于构建标准库的路径以及已安装扩展模块的路径。 它在大多数平台上等于 <code class="docutils literal notranslate"><span class="pre">&quot;lib&quot;</span></code>。 在 Fedora 和 SuSE 上，它等于 64 位平台上的 <code class="docutils literal notranslate"><span class="pre">&quot;lib64&quot;</span></code>。 （由 Jan Matějek, Matěj Cepl, Charalampos Stratakis 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1294959">bpo-1294959</a> 中贡献。）</p>
<p>之前的版本中，<a class="reference internal" href="../library/sys.html#sys.stderr" title="sys.stderr"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.stderr</span></code></a> 在非交互模式时是带块缓冲的。 现在 <code class="docutils literal notranslate"><span class="pre">stderr</span></code> 默认总是为行缓冲的。 （由 Jendrik Seipp 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=13601">bpo-13601</a> 中贡献。）</p>
</section>
<section id="tracemalloc">
<h3>tracemalloc<a class="headerlink" href="#tracemalloc" title="永久链接至标题">¶</a></h3>
<p>增加了 <a class="reference internal" href="../library/tracemalloc.html#tracemalloc.reset_peak" title="tracemalloc.reset_peak"><code class="xref py py-func docutils literal notranslate"><span class="pre">tracemalloc.reset_peak()</span></code></a> 用于将跟踪的内存块峰值大小设为当前大小，以测量特定代码段的峰值。 （由 Huon Wilson 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40630">bpo-40630</a> 中贡献。）</p>
</section>
<section id="typing">
<h3>typing<a class="headerlink" href="#typing" title="永久链接至标题">¶</a></h3>
<p><span class="target" id="index-73"></span><a class="pep reference external" href="https://peps.python.org/pep-0593/"><strong>PEP 593</strong></a> 引入了一种 <a class="reference internal" href="../library/typing.html#typing.Annotated" title="typing.Annotated"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Annotated</span></code></a> 类型以使用上下文专属的元数据来装饰现有类型，并将新的 <code class="docutils literal notranslate"><span class="pre">include_extras</span></code> 形参添加到 <a class="reference internal" href="../library/typing.html#typing.get_type_hints" title="typing.get_type_hints"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.get_type_hints()</span></code></a> 以在运行时访问元数据。 （由 Till Varoquaux 和 Konstantin Kashin 贡献。）</p>
</section>
<section id="unicodedata">
<h3>unicodedata<a class="headerlink" href="#unicodedata" title="永久链接至标题">¶</a></h3>
<p>Unicode 数据库已更新到 13.0.0 版。 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39926">bpo-39926</a>)。</p>
</section>
<section id="venv">
<h3>venv<a class="headerlink" href="#venv" title="永久链接至标题">¶</a></h3>
<p>由 <a class="reference internal" href="../library/venv.html#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> 所提供的激活脚本现在总是会使用 <code class="docutils literal notranslate"><span class="pre">__VENV_PROMPT__</span></code> 设置的值来一致地指明它们的自定义提示符。 在之前版本中某些脚本会无条件地使用 <code class="docutils literal notranslate"><span class="pre">__VENV_PROMPT__</span></code>，而另一些脚本只在其恰好被设置时（这是默认情况）才会使用，还有的脚本会改用 <code class="docutils literal notranslate"><span class="pre">__VENV_NAME__</span></code>。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37663">bpo-37663</a> 中贡献。）</p>
</section>
<section id="xml">
<h3>xml<a class="headerlink" href="#xml" title="永久链接至标题">¶</a></h3>
<p>当把 <a class="reference internal" href="../library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code></a> 序列化为 XML 文件时属性内部的空白字符现在将被保留。 不同的行结束符不会再被正规化为 &quot;n&quot;。 这是对于如何解读 XML 规范 2.11 节的相关讨论的最终结果。 （由 Mefistotelis 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39011">bpo-39011</a> 中贡献。）</p>
</section>
</section>
<section id="optimizations">
<h2>性能优化<a class="headerlink" href="#optimizations" title="永久链接至标题">¶</a></h2>
<ul>
<li><p>优化了在推导式中为临时变量赋值的惯用方式。 现在推导式中的 <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">y</span> <span class="pre">in</span> <span class="pre">[expr]</span></code> 会与简单赋值语句 <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">expr</span></code> 一样快速。 例如:</p>
<blockquote>
<div><p>sums = [s for s in [0] for x in data for s in [s + x]]</p>
</div></blockquote>
<p>不同于 <code class="docutils literal notranslate"><span class="pre">:=</span></code> 运算符，这个惯用方式不会使变量泄露到外部作用域中。</p>
<p>（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=32856">bpo-32856</a> 中贡献。）</p>
</li>
<li><p>优化了多线程应用中的信号处理。 如果一个线程不是获得信号的主线程，字节码求值循环不会在每条字节码指令上被打断以检查无法被处理的挂起信号。 只有主解释器的主线程能够处理信号。</p>
<p>在之前版本中，字节码求值循环会在每条指令上被打断直到主线程处理了信号。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40010">bpo-40010</a> 上贡献。）</p>
</li>
<li><p>在 FreeBSD 上使用 <code class="docutils literal notranslate"><span class="pre">closefrom()</span></code> 优化了 <a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: Subprocess management."><code class="xref py py-mod docutils literal notranslate"><span class="pre">subprocess</span></code></a> 模块。 （由 Ed Maste, Conrad Meyer, Kyle Evans, Kubilay Kocak 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38061">bpo-38061</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../c-api/long.html#c.PyLong_FromDouble" title="PyLong_FromDouble"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_FromDouble()</span></code></a> is now up to 1.87x faster for values that
fit into <span class="c-expr sig sig-inline c"><span class="kt">long</span></span>.
(Contributed by Sergey Fedoseev in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37986">bpo-37986</a>.)</p></li>
<li><p>多个 Python 内置类型 (<a class="reference internal" href="../library/stdtypes.html#range" title="range"><code class="xref py py-class docutils literal notranslate"><span class="pre">range</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#tuple" title="tuple"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#frozenset" title="frozenset"><code class="xref py py-class docutils literal notranslate"><span class="pre">frozenset</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#list" title="list"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict" title="dict"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>) 现在通过使用 <span class="target" id="index-74"></span><a class="pep reference external" href="https://peps.python.org/pep-0590/"><strong>PEP 590</strong></a> 向量调用协议得到加速。 （由 Dong-hee Na, Mark Shannon, Jeroen Demeyer 和 Petr Viktorin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37207">bpo-37207</a> 中贡献。）</p></li>
<li><p>当另一集合远大于基础集合的情况下优化了 <code class="xref py py-func docutils literal notranslate"><span class="pre">difference_update()</span></code> 的性能。 （由 Evgeny Kapun 提议，由 Michele Orrù 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8425">bpo-8425</a> 中贡献代码。）</p></li>
<li><p>Python 的小对象分配器 (<code class="docutils literal notranslate"><span class="pre">obmalloc.c</span></code>) 现在允许（至多）一个空位可用于立即重用，而不必将其返回给 OS。 这可以防止简单循环中的多余消耗，在每次迭代中可以创建和销毁全新的空位。 （由 Tim Peters 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37257">bpo-37257</a> 中贡献。）</p></li>
<li><p>浮点数运算中的 <a class="reference internal" href="../glossary.html#term-floor-division"><span class="xref std std-term">floor division</span></a> 现在会有更好的性能。 并且此运算的 <a class="reference internal" href="../library/exceptions.html#ZeroDivisionError" title="ZeroDivisionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code></a> 的消息也已更新。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39434">bpo-39434</a> 中贡献。）</p></li>
<li><p>使用 UTF-8 和 ascii 编解码器解码短 ASCII 字符串现在会加快大约 15%。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37348">bpo-37348</a> 中贡献。）</p></li>
</ul>
<p>以下是对从 Python 3.4 到 Python 3.9 的提升提升情况的总结:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Python version                       3.4     3.5     3.6     3.7     3.8    3.9
--------------                       ---     ---     ---     ---     ---    ---

Variable and attribute read access:
    read_local                       7.1     7.1     5.4     5.1     3.9    3.9
    read_nonlocal                    7.1     8.1     5.8     5.4     4.4    4.5
    read_global                     15.5    19.0    14.3    13.6     7.6    7.8
    read_builtin                    21.1    21.6    18.5    19.0     7.5    7.8
    read_classvar_from_class        25.6    26.5    20.7    19.5    18.4   17.9
    read_classvar_from_instance     22.8    23.5    18.8    17.1    16.4   16.9
    read_instancevar                32.4    33.1    28.0    26.3    25.4   25.3
    read_instancevar_slots          27.8    31.3    20.8    20.8    20.2   20.5
    read_namedtuple                 73.8    57.5    45.0    46.8    18.4   18.7
    read_boundmethod                37.6    37.9    29.6    26.9    27.7   41.1

Variable and attribute write access:
    write_local                      8.7     9.3     5.5     5.3     4.3    4.3
    write_nonlocal                  10.5    11.1     5.6     5.5     4.7    4.8
    write_global                    19.7    21.2    18.0    18.0    15.8   16.7
    write_classvar                  92.9    96.0   104.6   102.1    39.2   39.8
    write_instancevar               44.6    45.8    40.0    38.9    35.5   37.4
    write_instancevar_slots         35.6    36.1    27.3    26.6    25.7   25.8

Data structure read access:
    read_list                       24.2    24.5    20.8    20.8    19.0   19.5
    read_deque                      24.7    25.5    20.2    20.6    19.8   20.2
    read_dict                       24.3    25.7    22.3    23.0    21.0   22.4
    read_strdict                    22.6    24.3    19.5    21.2    18.9   21.5

Data structure write access:
    write_list                      27.1    28.5    22.5    21.6    20.0   20.0
    write_deque                     28.7    30.1    22.7    21.8    23.5   21.7
    write_dict                      31.4    33.3    29.3    29.2    24.7   25.4
    write_strdict                   28.4    29.9    27.5    25.2    23.1   24.5

Stack (or queue) operations:
    list_append_pop                 93.4   112.7    75.4    74.2    50.8   50.6
    deque_append_pop                43.5    57.0    49.4    49.2    42.5   44.2
    deque_append_popleft            43.7    57.3    49.7    49.7    42.8   46.4

Timing loop:
    loop_overhead                    0.5     0.6     0.4     0.3     0.3    0.3
</pre></div>
</div>
<p>以上结果是由以下变量访问基准测试脚本所生成的: <code class="docutils literal notranslate"><span class="pre">Tools/scripts/var_access_benchmark.py</span></code>。 该基准测试脚本以纳秒为单位显示时间。 基准测试数据是在一块 <a class="reference external" href="https://ark.intel.com/content/www/us/en/ark/products/76088/intel-core-i7-4960hq-processor-6m-cache-up-to-3-80-ghz.html">Intel® Core™ i7-4960HQ 处理器</a> 运行从 <a class="reference external" href="https://www.python.org/downloads/mac-osx/">python.org</a> 获取的 macOS 64 位编译版本所得到的。</p>
</section>
<section id="deprecated">
<h2>弃用<a class="headerlink" href="#deprecated" title="永久链接至标题">¶</a></h2>
<ul>
<li><p>distutils 的 <code class="docutils literal notranslate"><span class="pre">bdist_msi</span></code> 命令现在已被弃用，请改用 <code class="docutils literal notranslate"><span class="pre">bdist_wheel</span></code> (wheel 包)。 （由 Hugo van Kemenade 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39586">bpo-39586</a> 中贡献。）</p></li>
<li><p>目前 <a class="reference internal" href="../library/math.html#math.factorial" title="math.factorial"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.factorial()</span></code></a> 接受具有非负整数值的 <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> 实例 (如 <code class="docutils literal notranslate"><span class="pre">5.0</span></code>)。 对于非整数和负浮点数它会引发 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 此行为现在已被弃用。 在未来的 Python 版本中对所有浮点数都将引发 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37315">bpo-37315</a> 中贡献。）</p></li>
<li><p><code class="xref py py-mod docutils literal notranslate"><span class="pre">parser</span></code> 和 <code class="xref py py-mod docutils literal notranslate"><span class="pre">symbol</span></code> 模块已被弃用并将在未来的 Python 版本中移除。 对于大多数用例，用户都可以使用 <a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 模块来控制抽象语法树 (AST) 的生成和编译阶段。</p></li>
<li><p>公有 C API 函数 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlags()</span></code>, <code class="xref c c-func docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlagsFilename()</span></code>, <code class="xref c c-func docutils literal notranslate"><span class="pre">PyParser_SimpleParseFileFlags()</span></code> 和 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyNode_Compile()</span></code> 已被弃用并将在 Python 3.10 版与旧解析器一起被移除。</p></li>
<li><p>在布尔运算中使用 <a class="reference internal" href="../library/constants.html#NotImplemented" title="NotImplemented"><code class="xref py py-data docutils literal notranslate"><span class="pre">NotImplemented</span></code></a> 已被弃用，因为它几乎必定是不正确的富比较运算符实现的结果。 它将在未来的 Python 版本中引发 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 （由 Josh Rosenberg 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35712">bpo-35712</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/random.html#module-random" title="random: Generate pseudo-random numbers with various common distributions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">random</span></code></a> 模块目前接受任何可哈希类型作为可能的种子值。 不幸的是，某些这样的类型并不保证具有确定性的哈希值。 在 Python 3.9 之后，该模块将限定其种子值为 <a class="reference internal" href="../library/constants.html#None" title="None"><code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code></a>, <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 以及 <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytearray</span></code></a>。</p></li>
<li><p>打开 <a class="reference internal" href="../library/gzip.html#gzip.GzipFile" title="gzip.GzipFile"><code class="xref py py-class docutils literal notranslate"><span class="pre">GzipFile</span></code></a> 文件用于写入而不指定 <em>mode</em> 参数的特性已被弃用。 在未来的 Python 版本中将总是默认打开用于读取。 在打开文件用于写入时请指定 <em>mode</em> 参数以静默相关警告信息。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=28286">bpo-28286</a> 中贡献。）</p></li>
<li><p>弃用了 <code class="xref py py-class docutils literal notranslate"><span class="pre">_tkinter.TkappType</span></code> 的 <code class="docutils literal notranslate"><span class="pre">split()</span></code> 方法而改用 <code class="docutils literal notranslate"><span class="pre">splitlist()</span></code> 方法，此方法具有更稳定且可预测的行为。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38371">bpo-38371</a> 中贡献。）</p></li>
<li><p>将协程对象显式传递给 <a class="reference internal" href="../library/asyncio-task.html#asyncio.wait" title="asyncio.wait"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.wait()</span></code></a> 的做法已被弃用并且将在 3.11 版中被移除。 （由 Yury Selivanov 和 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34790">bpo-34790</a> 中贡献。）</p></li>
<li><p>binhex4 和 hexbin4 标准现已被弃用。 <code class="xref py py-mod docutils literal notranslate"><span class="pre">binhex</span></code> 模块和下列 <a class="reference internal" href="../library/binascii.html#module-binascii" title="binascii: Tools for converting between binary and various ASCII-encoded binary representations."><code class="xref py py-mod docutils literal notranslate"><span class="pre">binascii</span></code></a> 函数现已被弃用:</p>
<ul class="simple">
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">b2a_hqx()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">a2b_hqx()</span></code></p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">rlecode_hqx()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">rledecode_hqx()</span></code></p></li>
</ul>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39353">bpo-39353</a> 中贡献。）</p>
</li>
<li><p><a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 类 <code class="docutils literal notranslate"><span class="pre">slice</span></code>, <code class="docutils literal notranslate"><span class="pre">Index</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ExtSlice</span></code> 被视为已弃用并将在未来的 Python 版本中被移除。 应当使用 <code class="docutils literal notranslate"><span class="pre">value</span></code> 本身而不再是 <code class="docutils literal notranslate"><span class="pre">Index(value)</span></code>。 应当使用 <code class="docutils literal notranslate"><span class="pre">Tuple(slices,</span> <span class="pre">Load())</span></code> 而不再是 <code class="docutils literal notranslate"><span class="pre">ExtSlice(slices)</span></code>。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34822">bpo-34822</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 类 <code class="docutils literal notranslate"><span class="pre">Suite</span></code>, <code class="docutils literal notranslate"><span class="pre">Param</span></code>, <code class="docutils literal notranslate"><span class="pre">AugLoad</span></code> 和 <code class="docutils literal notranslate"><span class="pre">AugStore</span></code> 被视为已弃用并将在未来的 Python 版本中被移除。 它们不会被解析器所生成且不会被 Python 3 中的代码生成器所接受。 （由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39639">bpo-39639</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39969">bpo-39969</a> 中以及 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39988">bpo-39988</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../c-api/init.html#c.PyEval_InitThreads" title="PyEval_InitThreads"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_InitThreads()</span></code></a> 和 <a class="reference internal" href="../c-api/init.html#c.PyEval_ThreadsInitialized" title="PyEval_ThreadsInitialized"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_ThreadsInitialized()</span></code></a> 函数现已被弃用并将在 Python 3.11 中被移除。 调用 <a class="reference internal" href="../c-api/init.html#c.PyEval_InitThreads" title="PyEval_InitThreads"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_InitThreads()</span></code></a> 现在没有任何效果。 自 Python 3.7 起 <a class="reference internal" href="../glossary.html#term-GIL"><span class="xref std std-term">GIL</span></a> 会由 <a class="reference internal" href="../c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a> 初始化。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39877">bpo-39877</a> 中贡献。）</p></li>
<li><p>传入 <code class="docutils literal notranslate"><span class="pre">None</span></code> 作为 <a class="reference internal" href="../library/shlex.html#shlex.split" title="shlex.split"><code class="xref py py-func docutils literal notranslate"><span class="pre">shlex.split()</span></code></a> 函数的第一个参数的做法已被弃用。 （由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=33262">bpo-33262</a> 中贡献。）</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">smtpd.MailmanProxy()</span></code> 现在已被弃用，因为它在没有外部模块 <code class="docutils literal notranslate"><span class="pre">mailman</span></code> 的情况下无法使用。 （由 Samuel Colvin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35800">bpo-35800</a> 中贡献。）</p></li>
<li><p>现在 <a class="reference internal" href="../library/2to3.html#module-lib2to3" title="lib2to3: The 2to3 library"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lib2to3</span></code></a> 模块将发出 <a class="reference internal" href="../library/exceptions.html#PendingDeprecationWarning" title="PendingDeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PendingDeprecationWarning</span></code></a>。 Python 3.9 已切换到 PEG 解析器 (参见 <span class="target" id="index-75"></span><a class="pep reference external" href="https://peps.python.org/pep-0617/"><strong>PEP 617</strong></a>)，Python 3.10 可以会包含 lib2to3 的 LL(1) 解析器所不能解析的新语法。 <code class="docutils literal notranslate"><span class="pre">lib2to3</span></code> 模块可能会在未来的 Python 版本中被移出标准库。 请考虑使用第三方替换例如 <a class="reference external" href="https://libcst.readthedocs.io/">LibCST</a> 或 <a class="reference external" href="https://parso.readthedocs.io/">parso</a>。 （由 Carl Meyer 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40360">bpo-40360</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/random.html#random.shuffle" title="random.shuffle"><code class="xref py py-func docutils literal notranslate"><span class="pre">random.shuffle()</span></code></a> 的 <em>random</em> 形参已被弃用。 （由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40465">bpo-40465</a> 中贡献。）</p></li>
</ul>
</section>
<section id="removed">
<span id="removed-in-python-39"></span><h2>移除<a class="headerlink" href="#removed" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">unittest.mock.__version__</span></code> 上的错误版本已经被移除。</p></li>
<li><p><a class="reference internal" href="../library/nntplib.html#nntplib.NNTP" title="nntplib.NNTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">nntplib.NNTP</span></code></a>: <code class="docutils literal notranslate"><span class="pre">xpath()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">xgtitle()</span></code> 方法已被移除。 这些方法自 Python 3.3 起已被弃用。 一般来说，这些扩展都不再为 NNTP 服务管理员所支持或启用。 对于 <code class="docutils literal notranslate"><span class="pre">xgtitle()</span></code>，请改用 <a class="reference internal" href="../library/nntplib.html#nntplib.NNTP.descriptions" title="nntplib.NNTP.descriptions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">nntplib.NNTP.descriptions()</span></code></a> 或 <a class="reference internal" href="../library/nntplib.html#nntplib.NNTP.description" title="nntplib.NNTP.description"><code class="xref py py-meth docutils literal notranslate"><span class="pre">nntplib.NNTP.description()</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39366">bpo-39366</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/array.html#array.array" title="array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array.array</span></code></a>: <code class="docutils literal notranslate"><span class="pre">tostring()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">fromstring()</span></code> 方法已被移除。 它们分别是 <code class="docutils literal notranslate"><span class="pre">tobytes()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">frombytes()</span></code> 的别名，自 Python 3.2 起已被弃用。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38916">bpo-38916</a> 中贡献。）</p></li>
<li><p>未写入文档的 <code class="docutils literal notranslate"><span class="pre">sys.callstats()</span></code> 函数已被移除。 自 Python 3.7 起它就已被弃用并且总是会返回 <a class="reference internal" href="../library/constants.html#None" title="None"><code class="xref py py-const docutils literal notranslate"><span class="pre">None</span></code></a>。 它需要一个特殊的构建选项 <code class="docutils literal notranslate"><span class="pre">CALL_PROFILE</span></code> 而该选项在 Python 3.7 中已被移除。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37414">bpo-37414</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sys.getcheckinterval()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">sys.setcheckinterval()</span></code> 函数已被移除。 它们自 Python 3.2 起已被弃用。 请改用 <a class="reference internal" href="../library/sys.html#sys.getswitchinterval" title="sys.getswitchinterval"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.getswitchinterval()</span></code></a> 和 <a class="reference internal" href="../library/sys.html#sys.setswitchinterval" title="sys.setswitchinterval"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.setswitchinterval()</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37392">bpo-37392</a> 中贡献。）</p></li>
<li><p>C 函数 <code class="docutils literal notranslate"><span class="pre">PyImport_Cleanup()</span></code> 已被移除。 它原本的文档为: &quot;清空模块表。 仅限内部使用。&quot; （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36710">bpo-36710</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_dummy_thread</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dummy_threading</span></code> 模块已被移除。 这些模块自 Python 3.7 起已被弃用，它们需要线程支持。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37312">bpo-37312</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aifc.open()</span></code> 的别名 <code class="docutils literal notranslate"><span class="pre">aifc.openfp()</span></code>，<code class="docutils literal notranslate"><span class="pre">sunau.open()</span></code> 的别名 <code class="docutils literal notranslate"><span class="pre">sunau.openfp()</span></code>，以及 <a class="reference internal" href="../library/wave.html#wave.open" title="wave.open"><code class="xref py py-func docutils literal notranslate"><span class="pre">wave.open()</span></code></a> 的别名 <code class="docutils literal notranslate"><span class="pre">wave.openfp()</span></code> 已被移除。 它们自 Python 3.7 起已被弃用。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37320">bpo-37320</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/threading.html#threading.Thread" title="threading.Thread"><code class="xref py py-class docutils literal notranslate"><span class="pre">threading.Thread</span></code></a> 的 <code class="xref py py-meth docutils literal notranslate"><span class="pre">isAlive()</span></code> 方法已被移除。 它自 Python 3.8 起已被弃用。 请改用 <a class="reference internal" href="../library/threading.html#threading.Thread.is_alive" title="threading.Thread.is_alive"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_alive()</span></code></a>。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37804">bpo-37804</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ElementTree</span></code></a> 模块中 <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.ElementTree" title="xml.etree.ElementTree.ElementTree"><code class="xref py py-class docutils literal notranslate"><span class="pre">ElementTree</span></code></a> 和 <a class="reference internal" href="../library/xml.etree.elementtree.html#xml.etree.ElementTree.Element" title="xml.etree.ElementTree.Element"><code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></a> 等类的 <code class="docutils literal notranslate"><span class="pre">getchildren()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">getiterator()</span></code> 方法已被移除。 它们在 Python 3.2 中已被弃用。 请使用 <code class="docutils literal notranslate"><span class="pre">iter(x)</span></code> 或 <code class="docutils literal notranslate"><span class="pre">list(x)</span></code> 替代 <code class="docutils literal notranslate"><span class="pre">x.getchildren()</span></code> 并用 <code class="docutils literal notranslate"><span class="pre">x.iter()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">list(x.iter())</span></code> 替代 <code class="docutils literal notranslate"><span class="pre">x.getiterator()</span></code>。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36543">bpo-36543</a> 中贡献。）</p></li>
<li><p>旧的 <a class="reference internal" href="../library/plistlib.html#module-plistlib" title="plistlib: Generate and parse Apple plist files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">plistlib</span></code></a> API 已被移除，它自 Python 3.4 起已被弃用。 请使用 <a class="reference internal" href="../library/plistlib.html#plistlib.load" title="plistlib.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">load()</span></code></a>, <a class="reference internal" href="../library/plistlib.html#plistlib.loads" title="plistlib.loads"><code class="xref py py-func docutils literal notranslate"><span class="pre">loads()</span></code></a>, <a class="reference internal" href="../library/plistlib.html#plistlib.dump" title="plistlib.dump"><code class="xref py py-func docutils literal notranslate"><span class="pre">dump()</span></code></a> 和 <a class="reference internal" href="../library/plistlib.html#plistlib.dumps" title="plistlib.dumps"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a> 等函数。 此外，<em>use_builtin_types</em> 形参已被移除而总是会使用 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a> 对象。 （由 Jon Janzen 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36409">bpo-36409</a> 中贡献。）</p></li>
<li><p>C 函数 <code class="docutils literal notranslate"><span class="pre">PyGen_NeedsFinalizing</span></code> 已被移除。 它未被写入文档、未经测试，且自 <span class="target" id="index-76"></span><a class="pep reference external" href="https://peps.python.org/pep-0442/"><strong>PEP 442</strong></a> 实现之后未在 CPython 的任何地方被使用。 由 Joannah Nanjekye 提供补丁。 （由 Joannah Nanjekye 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=15088">bpo-15088</a> 中贡献。）</p></li>
<li><p>自 Python 3.1 起被弃用的别名 <code class="docutils literal notranslate"><span class="pre">base64.encodestring()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">base64.decodestring()</span></code> 已被移除：请改用 <a class="reference internal" href="../library/base64.html#base64.encodebytes" title="base64.encodebytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">base64.encodebytes()</span></code></a> 和 <a class="reference internal" href="../library/base64.html#base64.decodebytes" title="base64.decodebytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">base64.decodebytes()</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39351">bpo-39351</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fractions.gcd()</span></code> 函数已被移除，它自 Python 3.5 起被弃用 (<a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=22486">bpo-22486</a>)：请改用 <a class="reference internal" href="../library/math.html#math.gcd" title="math.gcd"><code class="xref py py-func docutils literal notranslate"><span class="pre">math.gcd()</span></code></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39350">bpo-39350</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal notranslate"><span class="pre">bz2.BZ2File</span></code></a> 的 <em>buffering</em> 形参已被移除。 它自 Python 3.0 起即被忽略，使用它将会引发 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 请传入一个打开文件对象来控制文件的打开方式。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39357">bpo-39357</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/json.html#json.loads" title="json.loads"><code class="xref py py-func docutils literal notranslate"><span class="pre">json.loads()</span></code></a> 的 <em>encoding</em> 形参已被移除。 它在 Python 3.1 中已被弃用和忽略；自 Python 3.8 起使用它将会引发 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39377">bpo-39377</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">(await</span> <span class="pre">asyncio.lock):</span></code> 和 <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">(yield</span> <span class="pre">from</span> <span class="pre">asyncio.lock):</span></code> 语句已不再受支持，请改用 <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span> <span class="pre">lock</span></code>。 <code class="docutils literal notranslate"><span class="pre">asyncio.Condition</span></code> 和 <code class="docutils literal notranslate"><span class="pre">asyncio.Semaphore</span></code> 也同样如此。 （由 Andrew Svetlov 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34793">bpo-34793</a> 中贡献。）</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.getcounts()</span></code> 函数，<code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">showalloccount</span></code> 命令行选项以及 C 结构体 <a class="reference internal" href="../c-api/init_config.html#c.PyConfig" title="PyConfig"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyConfig</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">show_alloc_count</span></code> 字段已被移除。 它们需要使用定义了 <code class="docutils literal notranslate"><span class="pre">COUNT_ALLOCS</span></code> 宏的特殊 Python 编译版本。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39489">bpo-39489</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/typing.html#typing.NamedTuple" title="typing.NamedTuple"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.NamedTuple</span></code></a> 类的 <code class="docutils literal notranslate"><span class="pre">_field_types</span></code> 属性已被移除。 它自 Python 3.8 起已被弃用。 请改用 <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code> 属性。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40182">bpo-40182</a> 中贡献。）</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">symtable.SymbolTable.has_exec()</span></code> 方法已被移除。 它自 2006 年起已被弃用，当被调用时仅会返回 <code class="docutils literal notranslate"><span class="pre">False</span></code>。 （由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40208">bpo-40208</a> 中贡献。）</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.Task.current_task()</span></code> 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.Task.all_tasks()</span></code> 已被移除。 它们自 Python 3.7 起已被弃用，你可以改用 <a class="reference internal" href="../library/asyncio-task.html#asyncio.current_task" title="asyncio.current_task"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.current_task()</span></code></a> 和 <a class="reference internal" href="../library/asyncio-task.html#asyncio.all_tasks" title="asyncio.all_tasks"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.all_tasks()</span></code></a>。 （由 Rémi Lapeyre 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40967">bpo-40967</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/html.parser.html#html.parser.HTMLParser" title="html.parser.HTMLParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">html.parser.HTMLParser</span></code></a> 类的 <code class="docutils literal notranslate"><span class="pre">unescape()</span></code> 方法已被移除（它自 Python 3.4 起已被弃用）。 应当使用 <a class="reference internal" href="../library/html.html#html.unescape" title="html.unescape"><code class="xref py py-func docutils literal notranslate"><span class="pre">html.unescape()</span></code></a> 来将字符引用转换为对应的 unicode 字符。</p></li>
</ul>
</section>
<section id="porting-to-python-3-9">
<h2>移植到 Python 3.9<a class="headerlink" href="#porting-to-python-3-9" title="永久链接至标题">¶</a></h2>
<p>本节列出了先前描述的更改以及可能需要更改代码的其他错误修正.</p>
<section id="changes-in-the-python-api">
<h3>Python API 的变化<a class="headerlink" href="#changes-in-the-python-api" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../library/functions.html#import__" title="__import__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__import__()</span></code></a> 和 <a class="reference internal" href="../library/importlib.html#importlib.util.resolve_name" title="importlib.util.resolve_name"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.resolve_name()</span></code></a> 现在会引发 <a class="reference internal" href="../library/exceptions.html#ImportError" title="ImportError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportError</span></code></a> 取代之前所引发的 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>。 捕获特定异常类型并同时支持 Python 3.9 和更早版本的调用者将需要使用 <code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">(ImportError,</span> <span class="pre">ValueError):</span></code> 来同时捕获两者。</p></li>
<li><p><a class="reference internal" href="../library/venv.html#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> 激活脚本不再将 <code class="docutils literal notranslate"><span class="pre">__VENV_PROMPT__</span></code> 被设为 <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> 的情况作为特例处理。</p></li>
<li><p><a class="reference internal" href="../library/select.html#select.epoll.unregister" title="select.epoll.unregister"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select.epoll.unregister()</span></code></a> 方法不会再忽略 <a class="reference internal" href="../library/errno.html#errno.EBADF" title="errno.EBADF"><code class="xref py py-data docutils literal notranslate"><span class="pre">EBADF</span></code></a> 错误。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39239">bpo-39239</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><code class="xref py py-class docutils literal notranslate"><span class="pre">bz2.BZ2File</span></code></a> 的 <em>compresslevel</em> 形参已成为仅限关键字形参，因为 <em>buffering</em> 形参已被移除。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39357">bpo-39357</a> 中贡献。）</p></li>
<li><p>简化了 AST 的抽取操作。 简单索引将以它们的值来代表，扩展切片将以元组形式来代表。 <code class="docutils literal notranslate"><span class="pre">Index(value)</span></code> 将返回 <code class="docutils literal notranslate"><span class="pre">value</span></code> 本身，<code class="docutils literal notranslate"><span class="pre">ExtSlice(slices)</span></code> 将返回 <code class="docutils literal notranslate"><span class="pre">Tuple(slices,</span> <span class="pre">Load())</span></code>。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34822">bpo-34822</a> 中贡献。）</p></li>
<li><p>当使用了 <a class="reference internal" href="../using/cmdline.html#cmdoption-E"><code class="xref std std-option docutils literal notranslate"><span class="pre">-E</span></code></a> 或 <a class="reference internal" href="../using/cmdline.html#cmdoption-I"><code class="xref std std-option docutils literal notranslate"><span class="pre">-I</span></code></a> 命令行参数时 <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> 模块现在会忽略 <span class="target" id="index-77"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONCASEOK"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONCASEOK</span></code></a> 环境变量。</p></li>
<li><p><em>encoding</em> 形参已作为仅限关键字形参被添加到 <a class="reference internal" href="../library/ftplib.html#ftplib.FTP" title="ftplib.FTP"><code class="xref py py-class docutils literal notranslate"><span class="pre">ftplib.FTP</span></code></a> 和 <a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS" title="ftplib.FTP_TLS"><code class="xref py py-class docutils literal notranslate"><span class="pre">ftplib.FTP_TLS</span></code></a> 类，并且默认编码格式由 Latin-1 改为 UTF-8 以遵循 <span class="target" id="index-78"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2640.html"><strong>RFC 2640</strong></a>。</p></li>
<li><p><a class="reference internal" href="../library/asyncio-eventloop.html#asyncio.loop.shutdown_default_executor" title="asyncio.loop.shutdown_default_executor"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncio.loop.shutdown_default_executor()</span></code></a> 已被添加到 <a class="reference internal" href="../library/asyncio-eventloop.html#asyncio.AbstractEventLoop" title="asyncio.AbstractEventLoop"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractEventLoop</span></code></a>，这意味着继承自它的替代事件循环应当定义此方法。 （由 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34037">bpo-34037</a> 中贡献。）</p></li>
<li><p>更新了 <a class="reference internal" href="../library/__future__.html#module-__future__" title="__future__: Future statement definitions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">__future__</span></code></a> 模块中未来特性旗标的常量值以防止与编译器旗标相冲突。 在之前版本中 <code class="docutils literal notranslate"><span class="pre">PyCF_ALLOW_TOP_LEVEL_AWAIT</span></code> 会与 <code class="docutils literal notranslate"><span class="pre">CO_FUTURE_DIVISION</span></code> 发生冲突。 （由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39562">bpo-39562</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">array('u')</span></code> 现在使用 <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> 作为 C 类型而不是 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE</span></code>。 这个改变不会影响其行为，因为自 Python 3.3 起 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE</span></code> 是 <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> 的别名。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34538">bpo-34538</a> 中贡献。）</p></li>
<li><p>现在 <a class="reference internal" href="../library/logging.html#logging.getLogger" title="logging.getLogger"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.getLogger()</span></code></a> API 当传入名称 <code class="docutils literal notranslate"><span class="pre">'root'</span></code> 时将返回根日志记录器，而在之前它则返回一个名为 <code class="docutils literal notranslate"><span class="pre">'root'</span></code> 的非根日志记录器。 这可能会影响到用户代码明确希望使用一个名为 <code class="docutils literal notranslate"><span class="pre">'root'</span></code> 的非根日志记录器，或在某个名为 <code class="docutils literal notranslate"><span class="pre">'root.py'</span></code> 的最高层级模块中使用 <code class="docutils literal notranslate"><span class="pre">logging.getLogger(__name__)</span></code> 来实例化日志记录器的情况。 （由 Vinay Sajip 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37742">bpo-37742</a> 中贡献。）</p></li>
<li><p>现在 <a class="reference internal" href="../library/pathlib.html#pathlib.PurePath" title="pathlib.PurePath"><code class="xref py py-class docutils literal notranslate"><span class="pre">PurePath</span></code></a> 的拆分处理当传入 <code class="docutils literal notranslate"><span class="pre">str</span></code> 或 <a class="reference internal" href="../library/pathlib.html#pathlib.PurePath" title="pathlib.PurePath"><code class="xref py py-class docutils literal notranslate"><span class="pre">PurePath</span></code></a> 的实例以外的对象时会返回 <code class="docutils literal notranslate"><span class="pre">NotImplemented</span></code> 而不是引发 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 这将允许创建不继承自上述类型的兼容类。 （由 Roger Aiudi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34775">bpo-34775</a> 中贡献。）</p></li>
<li><p>从 Python 3.9.5 开始 <a class="reference internal" href="../library/ipaddress.html#module-ipaddress" title="ipaddress: IPv4/IPv6 manipulation library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ipaddress</span></code></a> 模块不再接受 IPv4 地址字符串中有任何前缀的零。 前缀的零有歧义且会被某些库解读为八进制数字。 例如旧版函数 <a class="reference internal" href="../library/socket.html#socket.inet_aton" title="socket.inet_aton"><code class="xref py py-func docutils literal notranslate"><span class="pre">socket.inet_aton()</span></code></a> 就瘵前缀的零视为八进制数字。 最新 <a class="reference internal" href="../library/socket.html#socket.inet_pton" title="socket.inet_pton"><code class="xref py py-func docutils literal notranslate"><span class="pre">inet_pton()</span></code></a> 的 glibc 实现则不接受任何前缀的零。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36384">bpo-36384</a> 中贡献）。</p></li>
<li><p><a class="reference internal" href="../library/codecs.html#codecs.lookup" title="codecs.lookup"><code class="xref py py-func docutils literal notranslate"><span class="pre">codecs.lookup()</span></code></a> 现在会以与 <code class="xref py py-func docutils literal notranslate"><span class="pre">encodings.normalize_encoding()</span></code> 相同的方式正规化编码格式名称，不同之处在于 <a class="reference internal" href="../library/codecs.html#codecs.lookup" title="codecs.lookup"><code class="xref py py-func docutils literal notranslate"><span class="pre">codecs.lookup()</span></code></a> 还会将名称转换为小写形式。 例如``&quot;latex+latin1&quot;`` 编写格式名称现在会被正规化为 <code class="docutils literal notranslate"><span class="pre">&quot;latex_latin1&quot;</span></code>。 （由 Jordon Xu 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37751">bpo-37751</a> 中贡献。）</p></li>
</ul>
</section>
<section id="changes-in-the-c-api">
<h3>C API 的变化<a class="headerlink" href="#changes-in-the-c-api" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>Instances of <a class="reference internal" href="../c-api/typeobj.html#heap-types"><span class="std std-ref">堆分配类型</span></a> 的实例（例如使用 <a class="reference internal" href="../c-api/type.html#c.PyType_FromSpec" title="PyType_FromSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpec()</span></code></a> 和类似 API 创建的实例）自 Python 3.8 起会带有一个对其类型对象的引用。 正如 Python 3.8 的 &quot;C API 的变化&quot; 部分所述，对于大多数情况来说，这应当不会有任何副作用，但对于具有自定义 <a class="reference internal" href="../c-api/typeobj.html#c.PyTypeObject.tp_traverse" title="PyTypeObject.tp_traverse"><code class="xref c c-member docutils literal notranslate"><span class="pre">tp_traverse</span></code></a> 函数的类型来说，则要确保所有堆分配类型的自定义 <code class="docutils literal notranslate"><span class="pre">tp_traverse</span></code> 函数可访问对象的类型。</p>
<blockquote>
<div><p>示例:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"></span>
<span class="nf">foo_traverse</span><span class="p">(</span><span class="n">foo_struct</span><span class="w"> </span><span class="o">*</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">visitproc</span><span class="w"> </span><span class="n">visit</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="c1">// Rest of the traverse function</span>
<span class="cp">#if PY_VERSION_HEX &gt;= 0x03090000</span>
<span class="w">    </span><span class="c1">// This was not needed before Python 3.9 (Python issue 35810 and 40217)</span>
<span class="w">    </span><span class="n">Py_VISIT</span><span class="p">(</span><span class="n">Py_TYPE</span><span class="p">(</span><span class="n">self</span><span class="p">));</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div></blockquote>
<p>如果你的遍历函数委托给了其基类（或其他类）的 <code class="docutils literal notranslate"><span class="pre">tp_traverse</span></code>，则要确保 <code class="docutils literal notranslate"><span class="pre">Py_TYPE(self)</span></code> 只被访问一次。 请注意应当只有 <a class="reference internal" href="../c-api/typeobj.html#heap-types"><span class="std std-ref">堆类型</span></a> 可访问 <code class="docutils literal notranslate"><span class="pre">tp_traverse</span></code> 中的类型。</p>
<blockquote>
<div><p>举例来说，如果你的 <code class="docutils literal notranslate"><span class="pre">tp_traverse</span></code> 函数包括以下内容:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">base</span><span class="o">-&gt;</span><span class="n">tp_traverse</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">visit</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>则要添加:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#if PY_VERSION_HEX &gt;= 0x03090000</span>
<span class="w">    </span><span class="c1">// This was not needed before Python 3.9 (bpo-35810 and bpo-40217)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">base</span><span class="o">-&gt;</span><span class="n">tp_flags</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Py_TPFLAGS_HEAPTYPE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// a heap type&#39;s tp_traverse already visited Py_TYPE(self)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Py_VISIT</span><span class="p">(</span><span class="n">Py_TYPE</span><span class="p">(</span><span class="n">self</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="cp">#else</span>
</pre></div>
</div>
</div></blockquote>
<p>（参阅 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35810">bpo-35810</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40217">bpo-40217</a> 了解更多信息。）</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyEval_CallObject</span></code>, <code class="docutils literal notranslate"><span class="pre">PyEval_CallFunction</span></code>, <code class="docutils literal notranslate"><span class="pre">PyEval_CallMethod</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyEval_CallObjectWithKeywords</span></code> 函数已被弃用。 请改用 <a class="reference internal" href="../c-api/call.html#c.PyObject_Call" title="PyObject_Call"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_Call()</span></code></a> 及其变化形式。 （详情参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=29548">bpo-29548</a>。）</p></li>
</ul>
</section>
<section id="cpython-bytecode-changes">
<h3>CPython 字节码的改变<a class="headerlink" href="#cpython-bytecode-changes" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>添加了 <a class="reference internal" href="../library/dis.html#opcode-LOAD_ASSERTION_ERROR"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">LOAD_ASSERTION_ERROR</span></code></a> 操作码用于处理 <a class="reference internal" href="../reference/simple_stmts.html#assert"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">assert</span></code></a> 语句。 在之前的版本中，如果 <a class="reference internal" href="../library/exceptions.html#AssertionError" title="AssertionError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code></a> 异常被屏蔽则 assert 语句将不能正常运作。 （由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34880">bpo-34880</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/dis.html#opcode-COMPARE_OP"><code class="xref std std-opcode docutils literal notranslate"><span class="pre">COMPARE_OP</span></code></a> 操作码已被拆分为四个单独指令:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">COMPARE_OP</span></code> 用于富比较</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IS_OP</span></code> 用于 'is' 和 'is not' 检测</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONTAINS_OP</span></code> 用于 'in' 和 'not in' 检测</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JUMP_IF_NOT_EXC_MATCH</span></code> 用于检查 'try-except' 语句中的异常。</p></li>
</ul>
<p>（由 Mark Shannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39156">bpo-39156</a> 中贡献。）</p>
</li>
</ul>
</section>
</section>
<section id="build-changes">
<h2>构建的改变<a class="headerlink" href="#build-changes" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>将 <code class="docutils literal notranslate"><span class="pre">--with-platlibdir</span></code> 选项添加到 <code class="docutils literal notranslate"><span class="pre">configure</span></code> 脚本：平台专属库目录的名称，保存在新的 <a class="reference internal" href="../library/sys.html#sys.platlibdir" title="sys.platlibdir"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.platlibdir</span></code></a> 属性中。 请参阅 <a class="reference internal" href="../library/sys.html#sys.platlibdir" title="sys.platlibdir"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.platlibdir</span></code></a> 属性了解详情。 （由 Jan Matějek, Matěj Cepl, Charalampos Stratakis 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1294959">bpo-1294959</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COUNT_ALLOCS</span></code> 特殊构建宏已被移除。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39489">bpo-39489</a> 中贡献。）</p></li>
<li><p>在非 Windows 平台上，现在需要用 <code class="xref c c-func docutils literal notranslate"><span class="pre">setenv()</span></code> 和 <code class="xref c c-func docutils literal notranslate"><span class="pre">unsetenv()</span></code> 函数来构建 Python。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39395">bpo-39395</a> 中贡献。）</p></li>
<li><p>在非 Windows 平台上，创建 <code class="docutils literal notranslate"><span class="pre">bdist_wininst</span></code> 安装器现在已不受官方支持。 （详情参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=10945">bpo-10945</a>。）</p></li>
<li><p>When building Python on macOS from source, <code class="docutils literal notranslate"><span class="pre">_tkinter</span></code> now links with
non-system Tcl and Tk frameworks if they are installed in
<code class="docutils literal notranslate"><span class="pre">/Library/Frameworks</span></code>, as had been the case on older releases
of macOS. If a macOS SDK is explicitly configured, by using
<a class="reference internal" href="../using/configure.html#cmdoption-1"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-universalsdk</span></code></a> or <code class="docutils literal notranslate"><span class="pre">-isysroot</span></code>, only the SDK itself is
searched. The default behavior can still be overridden with
<code class="docutils literal notranslate"><span class="pre">--with-tcltk-includes</span></code> and <code class="docutils literal notranslate"><span class="pre">--with-tcltk-libs</span></code>.
(Contributed by Ned Deily in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34956">bpo-34956</a>.)</p></li>
<li><p>Python 现在可以针对 Windows 10 ARM64 进行编译。 （由 Steve Dower 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=33125">bpo-33125</a> 中贡献。）</p></li>
<li><p>现在当使用 <code class="docutils literal notranslate"><span class="pre">--pgo</span></code> 时一些单独的测试会被跳过。 这些测试显著增加了 PGO 任务的时间并且可能无助于提升最终可执行文件的优化程度。 这样能使任务加速大约 15 倍。 运行完整的单元测试是很慢的。 这个改变可能导致优化程序稍差的构建，因为将被执行的代码分支不够多。 如果你愿意等待更缓慢的构建，则可以使用 <code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">[..]</span> <span class="pre">PROFILE_TASK=&quot;-m</span> <span class="pre">test</span> <span class="pre">--pgo-extended&quot;</span></code> 来恢复旧版本的行为。 我们不保证哪个 PGO 任务集能产生更快的构建。 关心此问题的用户应当自行运行相关基准测试，因为结果可能取决于具体环境、工作负载以及编译工具链。 （请参阅 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36044">bpo-36044</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37707">bpo-37707</a> 了解详情。）</p></li>
</ul>
</section>
<section id="c-api-changes">
<h2>C API 的改变<a class="headerlink" href="#c-api-changes" title="永久链接至标题">¶</a></h2>
<section id="id1">
<h3>新的特性<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul>
<li><p><span class="target" id="index-79"></span><a class="pep reference external" href="https://peps.python.org/pep-0573/"><strong>PEP 573</strong></a>: 添加了 <a class="reference internal" href="../c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a> 用于通过类来关联一个模块；<a class="reference internal" href="../c-api/type.html#c.PyType_GetModule" title="PyType_GetModule"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_GetModule()</span></code></a> 和 <a class="reference internal" href="../c-api/type.html#c.PyType_GetModuleState" title="PyType_GetModuleState"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_GetModuleState()</span></code></a> 用于获取模块及其状态；以及 <a class="reference internal" href="../c-api/structures.html#c.PyCMethod" title="PyCMethod"><code class="xref c c-data docutils literal notranslate"><span class="pre">PyCMethod</span></code></a> 和 <code class="xref c c-data docutils literal notranslate"><span class="pre">METH_METHOD</span></code> 用于允许一个方法访问其定义所在的类。 （由 Marcel Plch 和 Petr Viktorin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38787">bpo-38787</a> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../c-api/frame.html#c.PyFrame_GetCode" title="PyFrame_GetCode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFrame_GetCode()</span></code></a> 函数：获取帧代码。 增加了 <a class="reference internal" href="../c-api/frame.html#c.PyFrame_GetBack" title="PyFrame_GetBack"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFrame_GetBack()</span></code></a> 函数：获取帧的下一个外部帧。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40421">bpo-40421</a> 中贡献。）</p></li>
<li><p>将 <a class="reference internal" href="../c-api/frame.html#c.PyFrame_GetLineNumber" title="PyFrame_GetLineNumber"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFrame_GetLineNumber()</span></code></a> 添加到受限的 C API。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40421">bpo-40421</a> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../c-api/init.html#c.PyThreadState_GetInterpreter" title="PyThreadState_GetInterpreter"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThreadState_GetInterpreter()</span></code></a> 和 <a class="reference internal" href="../c-api/init.html#c.PyInterpreterState_Get" title="PyInterpreterState_Get"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyInterpreterState_Get()</span></code></a> 函数用于获取解释器。 增加了 <a class="reference internal" href="../c-api/init.html#c.PyThreadState_GetFrame" title="PyThreadState_GetFrame"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThreadState_GetFrame()</span></code></a> 函数用于获取 Python 线程状态的当前帧。 增加了 <a class="reference internal" href="../c-api/init.html#c.PyThreadState_GetID" title="PyThreadState_GetID"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyThreadState_GetID()</span></code></a> 函数：获取 Python 线程状态的唯一标识符。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39947">bpo-39947</a> 中贡献。）</p></li>
<li><p>将新的公有 <a class="reference internal" href="../c-api/call.html#c.PyObject_CallNoArgs" title="PyObject_CallNoArgs"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_CallNoArgs()</span></code></a> 函数添加到 C API，该函数可不带任何参数调用一个 Python 可调用对象。 它是不带参数调用 Python 可调用对象最有效率的方式。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37194">bpo-37194</a> 中贡献。）</p></li>
<li><p>受限 C API 中的改变（如果定义了 <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> 宏）:</p>
<ul class="simple">
<li><p>提供 <a class="reference internal" href="../c-api/exceptions.html#c.Py_EnterRecursiveCall" title="Py_EnterRecursiveCall"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_EnterRecursiveCall()</span></code></a> 和 <a class="reference internal" href="../c-api/exceptions.html#c.Py_LeaveRecursiveCall" title="Py_LeaveRecursiveCall"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_LeaveRecursiveCall()</span></code></a> 作为常规函数用于受限 API。 在之前版本中是使用宏定义，但这些宏不能与无法访问 <code class="docutils literal notranslate"><span class="pre">PyThreadState.recursion_depth</span></code> 字段的受限 C API 一同编译（该结构体在受限 C API 中是不透明的）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyObject_INIT()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyObject_INIT_VAR()</span></code> 已成为常规“不透明”函数以隐藏实现细节。</p></li>
</ul>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38644">bpo-38644</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39542">bpo-39542</a> 中贡献。）</p>
</li>
<li><p>增加了 <a class="reference internal" href="../c-api/module.html#c.PyModule_AddType" title="PyModule_AddType"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_AddType()</span></code></a> 函数以协助将类型加入到模块中。 （由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40024">bpo-40024</a> 中贡献。）</p></li>
<li><p>将 <a class="reference internal" href="../c-api/gcsupport.html#c.PyObject_GC_IsTracked" title="PyObject_GC_IsTracked"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GC_IsTracked()</span></code></a> 和 <a class="reference internal" href="../c-api/gcsupport.html#c.PyObject_GC_IsFinalized" title="PyObject_GC_IsFinalized"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GC_IsFinalized()</span></code></a> 函数添加到公有 API 以允许分别查询 Python 对象当前是正在被追踪还是已经被垃圾回收器所终结。 （由 Pablo Galindo Salgado 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40241">bpo-40241</a> 中贡献。）</p></li>
<li><p>增加了 <code class="xref c c-func docutils literal notranslate"><span class="pre">_PyObject_FunctionStr()</span></code> 以获取函数类对象的用户友好的表示形式。 （由 Jeroen Demeyer 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37645">bpo-37645</a> 中修正。）</p></li>
<li><p>增加了 <a class="reference internal" href="../c-api/call.html#c.PyObject_CallOneArg" title="PyObject_CallOneArg"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_CallOneArg()</span></code></a> 用于调用具有一个位置参数的对象（由 Jeroen Demeyer 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37483">bpo-37483</a> 中修正。）</p></li>
</ul>
</section>
<section id="id2">
<h3>移植到 Python 3.9<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">PyInterpreterState.eval_frame</span></code> (<span class="target" id="index-80"></span><a class="pep reference external" href="https://peps.python.org/pep-0523/"><strong>PEP 523</strong></a>) 现在需要有新的强制性形参 <em>tstate</em> (<code class="docutils literal notranslate"><span class="pre">PyThreadState*</span></code>)。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38500">bpo-38500</a> 中贡献。）</p></li>
<li><p>扩展模块: <a class="reference internal" href="../c-api/module.html#c.PyModuleDef" title="PyModuleDef"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyModuleDef</span></code></a> 的 <a class="reference internal" href="../c-api/module.html#c.PyModuleDef.m_traverse" title="PyModuleDef.m_traverse"><code class="xref c c-member docutils literal notranslate"><span class="pre">m_traverse</span></code></a>, <a class="reference internal" href="../c-api/module.html#c.PyModuleDef.m_clear" title="PyModuleDef.m_clear"><code class="xref c c-member docutils literal notranslate"><span class="pre">m_clear</span></code></a> 和 <a class="reference internal" href="../c-api/module.html#c.PyModuleDef.m_free" title="PyModuleDef.m_free"><code class="xref c c-member docutils literal notranslate"><span class="pre">m_free</span></code></a> 等函数在模块状态被请求但尚未被分配时将不会再被调用。 这种情况出现在模块被创建之后且模块被执行 (<a class="reference internal" href="../c-api/module.html#c.Py_mod_exec" title="Py_mod_exec"><code class="xref c c-data docutils literal notranslate"><span class="pre">Py_mod_exec</span></code></a> 函数) 之前的时刻。 更准确地说，这些函数在 <a class="reference internal" href="../c-api/module.html#c.PyModuleDef.m_size" title="PyModuleDef.m_size"><code class="xref c c-member docutils literal notranslate"><span class="pre">m_size</span></code></a> 大于 0 并且模块状态（即 <a class="reference internal" href="../c-api/module.html#c.PyModule_GetState" title="PyModule_GetState"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetState()</span></code></a> 的返回值）为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 时将不会被调用。</p>
<p>没有模块状态的扩展模块 (<code class="docutils literal notranslate"><span class="pre">m_size</span> <span class="pre">&lt;=</span> <span class="pre">0</span></code>) 不会受到影响。</p>
</li>
<li><p>现在如果 <a class="reference internal" href="../c-api/init.html#c.Py_AddPendingCall" title="Py_AddPendingCall"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_AddPendingCall()</span></code></a> 是在子解释器内部被调用，该函数会被排入子解释器的调用日程，而不是由主解释器调用。 每个子解释器现在都拥有它们自己的调用日程列表。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39984">bpo-39984</a> 中贡献。）</p></li>
<li><p>当 <code class="docutils literal notranslate"><span class="pre">-E</span></code> 选项被使用 (如果 <a class="reference internal" href="../c-api/init_config.html#c.PyConfig.use_environment" title="PyConfig.use_environment"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.use_environment</span></code></a> 设为 <code class="docutils literal notranslate"><span class="pre">0</span></code>) 时将不再使用 Windows 注册表来初始化 <a class="reference internal" href="../library/sys.html#sys.path" title="sys.path"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.path</span></code></a>。 这会影响在 Windows 上嵌入 Python 的操作。 （由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=8901">bpo-8901</a> 中贡献。）</p></li>
<li><p>全局变量 <a class="reference internal" href="../c-api/tuple.html#c.PyStructSequence_UnnamedField" title="PyStructSequence_UnnamedField"><code class="xref c c-data docutils literal notranslate"><span class="pre">PyStructSequence_UnnamedField</span></code></a> 现在为常量并且指向一个字符串常量。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38650">bpo-38650</a> 中贡献。）</p></li>
<li><p>现在 <code class="xref c c-type docutils literal notranslate"><span class="pre">PyGC_Head</span></code> 结构是不透明的。 它只在内部 C API (<code class="docutils literal notranslate"><span class="pre">pycore_gc.h</span></code>) 中定义。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40241">bpo-40241</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_COPY</span></code>, <code class="docutils literal notranslate"><span class="pre">Py_UNICODE_FILL</span></code>, <code class="docutils literal notranslate"><span class="pre">PyUnicode_WSTR_LENGTH</span></code>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromUnicode" title="PyUnicode_FromUnicode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromUnicode()</span></code></a>, <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUnicode" title="PyUnicode_AsUnicode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicode()</span></code></a>, <code class="docutils literal notranslate"><span class="pre">_PyUnicode_AsUnicode</span></code> 以及 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUnicodeAndSize" title="PyUnicode_AsUnicodeAndSize"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUnicodeAndSize()</span></code></a> 在 C 中被标记为已弃用。 它们自 Python 3.3 起就已被 <span class="target" id="index-81"></span><a class="pep reference external" href="https://peps.python.org/pep-0393/"><strong>PEP 393</strong></a> 弃用。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36346">bpo-36346</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../c-api/sys.html#c.Py_FatalError" title="Py_FatalError"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_FatalError()</span></code></a> 函数会被一个自动记录当前函数名称的宏所替代，除非已定义了 <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> 宏。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39882">bpo-39882</a> 中贡献。）</p></li>
<li><p>vectorcall 协议现在要求调用者只传入字符串作为键名。 （请参阅 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37540">bpo-37540</a> 了解详情。）</p></li>
<li><p>多个宏和函数的实现细节现在已被隐藏:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../c-api/gcsupport.html#c.PyObject_IS_GC" title="PyObject_IS_GC"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_IS_GC()</span></code></a> 宏已被转换为函数。</p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_NEW()</span></code> 宏已成为 <a class="reference internal" href="../c-api/allocation.html#c.PyObject_New" title="PyObject_New"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_New()</span></code></a> 宏的别名，而 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_NEW_VAR()</span></code> 宏已成为 <a class="reference internal" href="../c-api/allocation.html#c.PyObject_NewVar" title="PyObject_NewVar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_NewVar()</span></code></a> 宏的别名。  它们将不再直接访问 <a class="reference internal" href="../c-api/typeobj.html#c.PyTypeObject.tp_basicsize" title="PyTypeObject.tp_basicsize"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyTypeObject.tp_basicsize</span></code></a> 成员。</p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_GET_WEAKREFS_LISTPTR()</span></code> 宏已被转换为函数：该宏会直接访问 <a class="reference internal" href="../c-api/typeobj.html#c.PyTypeObject.tp_weaklistoffset" title="PyTypeObject.tp_weaklistoffset"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyTypeObject.tp_weaklistoffset</span></code></a> 成员。</p></li>
<li><p><a class="reference internal" href="../c-api/buffer.html#c.PyObject_CheckBuffer" title="PyObject_CheckBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_CheckBuffer()</span></code></a> 宏已被转换为函数：该宏会直接访问 <a class="reference internal" href="../c-api/typeobj.html#c.PyTypeObject.tp_as_buffer" title="PyTypeObject.tp_as_buffer"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyTypeObject.tp_as_buffer</span></code></a> 成员。</p></li>
<li><p>现在 <a class="reference internal" href="../c-api/number.html#c.PyIndex_Check" title="PyIndex_Check"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyIndex_Check()</span></code></a> 总是被声明为不透明函数以隐藏实现细节；<code class="docutils literal notranslate"><span class="pre">PyIndex_Check()</span></code> 宏已被移除。 该宏会直接访问 <a class="reference internal" href="../c-api/typeobj.html#c.PyTypeObject.tp_as_number" title="PyTypeObject.tp_as_number"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyTypeObject.tp_as_number</span></code></a> 成员。</p></li>
</ul>
<p>（详情请参阅 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40170">bpo-40170</a>。）</p>
</li>
</ul>
</section>
<section id="id3">
<h3>移除<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pyfpe.h</span></code> 的 <code class="docutils literal notranslate"><span class="pre">PyFPE_START_PROTECT()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyFPE_END_PROTECT()</span></code> 宏已从受限的 C API 中被排除。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38835">bpo-38835</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../c-api/typeobj.html#type-structs"><span class="std std-ref">PyTypeObject</span></a> 的 <code class="docutils literal notranslate"><span class="pre">tp_print</span></code> 空位已被移除。 它在 Python 2.7 及之前的版本中被用来将对象打印到文件。 自 Python 3.0 起，它已被忽略并且不再使用。 （由 Jeroen Demeyer 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36974">bpo-36974</a> 中贡献。）</p></li>
<li><p>受限 C API 中的改变（如果定义了 <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> 宏）:</p>
<ul class="simple">
<li><p>以下函数已从受限 C API 中排除:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">PyThreadState_DeleteCurrent()</span></code> （由 Joannah Nanjekye 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37878">bpo-37878</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_CheckRecursionLimit</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_NewReference()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_ForgetReference()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_PyTraceMalloc_NewReference()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_GetRefTotal()</span></code></p></li>
<li><p>在受限 C API 中从未使用的垃圾箱机制。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyTrash_UNWIND_LEVEL</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_TRASHCAN_BEGIN_CONDITION</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_TRASHCAN_BEGIN</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_TRASHCAN_END</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_TRASHCAN_SAFE_BEGIN</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_TRASHCAN_SAFE_END</span></code></p></li>
</ul>
</li>
<li><p>已将下列函数和定义移至内部 C API:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_PyDebug_PrintTotalRefs()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_PrintReferences()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_PrintReferenceAddresses()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_tracemalloc_config</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_Py_AddToAllObjects()</span></code> (<code class="docutils literal notranslate"><span class="pre">Py_TRACE_REFS</span></code> 构建专属)</p></li>
</ul>
</li>
</ul>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38644">bpo-38644</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39542">bpo-39542</a> 中贡献。）</p>
</li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">_PyRuntime.getframe</span></code> 钩子并移除了 <code class="docutils literal notranslate"><span class="pre">_PyThreadState_GetFrame</span></code> 宏，该宏是 <code class="docutils literal notranslate"><span class="pre">_PyRuntime.getframe</span></code> 的一个别名。 它们仅由内部 C API 对外公开。 同样地移除了 <code class="docutils literal notranslate"><span class="pre">PyThreadFrameGetter</span></code> 类型。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39946">bpo-39946</a> 中贡献。）</p></li>
<li><p>从 C API 移除了下列函数。 请显式地调用 <a class="reference internal" href="../c-api/gcsupport.html#c.PyGC_Collect" title="PyGC_Collect"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyGC_Collect()</span></code></a> 来清空所有自由列表。 （由 Inada Naoki 和 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37340">bpo-37340</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38896">bpo-38896</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40428">bpo-40428</a> 中贡献。）</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyAsyncGen_ClearFreeLists()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyContext_ClearFreeList()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyDict_ClearFreeList()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyFloat_ClearFreeList()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyFrame_ClearFreeList()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyList_ClearFreeList()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyMethod_ClearFreeList()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyCFunction_ClearFreeList()</span></code>: 绑定方法对象的自由列表已被移除。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PySet_ClearFreeList()</span></code>: 集合自由列表已在 Python 3.4 中被移除。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyTuple_ClearFreeList()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyUnicode_ClearFreeList()</span></code>: Unicode 自由列表已在 Python 3.3 中被移除。</p></li>
</ul>
</li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">_PyUnicode_ClearStaticStrings()</span></code> 函数。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39465">bpo-39465</a> 中贡献。）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE_MATCH</span></code>。 它已被 <span class="target" id="index-82"></span><a class="pep reference external" href="https://peps.python.org/pep-0393/"><strong>PEP 393</strong></a> 所弃用，并自 Python 3.3 起不再可用。 可以改用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Tailmatch" title="PyUnicode_Tailmatch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Tailmatch()</span></code></a> 函数。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36346">bpo-36346</a> 中贡献。）</p></li>
<li><p>清除了已定义但未实现的接口的头文件。 被移除了公共 API 符号有: <code class="docutils literal notranslate"><span class="pre">_PyBytes_InsertThousandsGroupingLocale</span></code>, <code class="docutils literal notranslate"><span class="pre">_PyBytes_InsertThousandsGrouping</span></code>, <code class="docutils literal notranslate"><span class="pre">_Py_InitializeFromArgs</span></code>, <code class="docutils literal notranslate"><span class="pre">_Py_InitializeFromWideArgs</span></code>, <code class="docutils literal notranslate"><span class="pre">_PyFloat_Repr</span></code>, <code class="docutils literal notranslate"><span class="pre">_PyFloat_Digits</span></code>, <code class="docutils literal notranslate"><span class="pre">_PyFloat_DigitsInit</span></code>, <code class="docutils literal notranslate"><span class="pre">PyFrame_ExtendStack</span></code>, <code class="docutils literal notranslate"><span class="pre">_PyAIterWrapper_Type</span></code>, <code class="docutils literal notranslate"><span class="pre">PyNullImporter_Type</span></code>, <code class="docutils literal notranslate"><span class="pre">PyCmpWrapper_Type</span></code>, <code class="docutils literal notranslate"><span class="pre">PySortWrapper_Type</span></code>, <code class="docutils literal notranslate"><span class="pre">PyNoArgsFunction</span></code>。 （由 Pablo Galindo Salgado 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39372">bpo-39372</a> 中贡献。）</p></li>
</ul>
</section>
</section>
<section id="notable-changes-in-python-3-9-1">
<h2>Python 3.9.1 中的重要变化<a class="headerlink" href="#notable-changes-in-python-3-9-1" title="永久链接至标题">¶</a></h2>
<section id="id4">
<h3>typing<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../library/typing.html#typing.Literal" title="typing.Literal"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Literal</span></code></a> 的行为被改为遵循 <span class="target" id="index-83"></span><a class="pep reference external" href="https://peps.python.org/pep-0586/"><strong>PEP 586</strong></a> 并匹配该 PEP 所描述的静态类型检查器的行为。</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 现在将是去重复的形参。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 对象间的相等性比较现在将是顺序无关的。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 比较现在会考虑类型。 例如 <code class="docutils literal notranslate"><span class="pre">Literal[0]</span> <span class="pre">==</span> <span class="pre">Literal[False]</span></code> 之前的结果值为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。 现在则为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。 为支持此改变，内部使用的类型缓存现在也支持区分类型。</p></li>
<li><p>现在如果有任何一个参数不为 <a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a>，<code class="docutils literal notranslate"><span class="pre">Literal</span></code> 对象将在相等性比较期间引发 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 请注意使用可变参数声明 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 将不会抛出异常:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Literal</span><span class="p">[{</span><span class="mi">0</span><span class="p">}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Literal</span><span class="p">[{</span><span class="mi">0</span><span class="p">}]</span> <span class="o">==</span> <span class="n">Literal</span><span class="p">[{</span><span class="kc">False</span><span class="p">}]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">unhashable type: &#39;set&#39;</span>
</pre></div>
</div>
</li>
</ol>
<p>（由 Yurii Karabas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42345">bpo-42345</a> 中贡献。）</p>
</section>
<section id="macos-11-0-big-sur-and-apple-silicon-mac-support">
<h3>macOS 11.0 (Big Sur) 与 Apple Silicon Mac 支持<a class="headerlink" href="#macos-11-0-big-sur-and-apple-silicon-mac-support" title="永久链接至标题">¶</a></h3>
<p>对于 3.9.1 版来说，Python 现在完全支持在 macOS 11.0 (Big Sur) 和 Apple Silicon Macs (基于 <code class="docutils literal notranslate"><span class="pre">ARM64</span></code> 架构) 上构建和运行。 现在提供了一个新的通用构建类型 <code class="docutils literal notranslate"><span class="pre">universal2</span></code>，用于在一组可执行文件上原生支持 <code class="docutils literal notranslate"><span class="pre">ARM64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Intel</span> <span class="pre">64</span></code>。 二进制文件现在也可以在当前版本的 macOS 上编译以部署到多种较旧的 macOS 版本上 (已测试 10.9)，同时会基于运行时所使用的操作系统版本让某些较新的 OS 功能和选项有条件地可用 (&quot;弱链接&quot;) 。</p>
<p>（由 Ronald Oussoren 和 Lawrence D'Anna 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41100">bpo-41100</a> 中贡献。）</p>
</section>
</section>
<section id="notable-changes-in-python-3-9-2">
<h2>Python 3.9.2 中的重要变化<a class="headerlink" href="#notable-changes-in-python-3-9-2" title="永久链接至标题">¶</a></h2>
<section id="collections-abc">
<h3>collections.abc<a class="headerlink" href="#collections-abc" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 泛型会将类型形参展平，类似于 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Callable</span></code></a> 当前所做的那样。 这意味着 <code class="docutils literal notranslate"><span class="pre">collections.abc.Callable[[int,</span> <span class="pre">str],</span> <span class="pre">str]</span></code> 的 <code class="docutils literal notranslate"><span class="pre">__args__</span></code> 将为 <code class="docutils literal notranslate"><span class="pre">(int,</span> <span class="pre">str,</span> <span class="pre">str)</span></code>；之前则为 <code class="docutils literal notranslate"><span class="pre">([int,</span> <span class="pre">str],</span> <span class="pre">str)</span></code>。 为了允许这个改变，<a class="reference internal" href="../library/types.html#types.GenericAlias" title="types.GenericAlias"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.GenericAlias</span></code></a> 现在可以被子类化，并且在抽取 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 类型时将返回一个子类。 通过 <a class="reference internal" href="../library/typing.html#typing.get_args" title="typing.get_args"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.get_args()</span></code></a> 或 <code class="docutils literal notranslate"><span class="pre">__args__</span></code> 访问参数的代码需要考虑到这个改变。 对于无效的 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 参数化形式可能会发出 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>，这在 Python 3.9.1 中可能会静默地传递。 这个 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 将在 Python 3.10 中变为 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 （由 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42195">bpo-42195</a> 中贡献。）</p>
</section>
<section id="urllib-parse">
<h3>urllib.parse<a class="headerlink" href="#urllib-parse" title="永久链接至标题">¶</a></h3>
<p>早先的 Python 版本允许使用 <code class="docutils literal notranslate"><span class="pre">;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> 作为 <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qs()</span></code></a> 和 <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.parse_qsl" title="urllib.parse.parse_qsl"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qsl()</span></code></a> 中 query 形参的分隔键。 出于安全考虑，也为了遵循更新的 W3C 推荐设置，这已被改为只允许单个分隔键，默认为 <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>。 这一改变还会影响 <a class="reference internal" href="../library/cgi.html#cgi.parse" title="cgi.parse"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgi.parse()</span></code></a> 和 <a class="reference internal" href="../library/cgi.html#cgi.parse_multipart" title="cgi.parse_multipart"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgi.parse_multipart()</span></code></a> 因为它们在内部使用了受影响的函数。 要了解更多细节，请查看它们各自的文档。 （由 Adam Goldschmidt, Senthil Kumaran 和 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42967">bpo-42967</a> 中贡献。）</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.9 有什么新变化</a><ul>
<li><a class="reference internal" href="#summary-release-highlights">摘要 -- 发布重点</a></li>
<li><a class="reference internal" href="#you-should-check-for-deprecationwarning-in-your-code">请检查代码中的 DeprecationWarning。</a></li>
<li><a class="reference internal" href="#new-features">新的特性</a><ul>
<li><a class="reference internal" href="#dictionary-merge-update-operators">字典合并与更新运算符</a></li>
<li><a class="reference internal" href="#new-string-methods-to-remove-prefixes-and-suffixes">新增用于移除前缀和后缀的字符串方法</a></li>
<li><a class="reference internal" href="#type-hinting-generics-in-standard-collections">标准多项集中的类型标注泛型</a></li>
<li><a class="reference internal" href="#new-parser">新的解析器</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-language-changes">其他语言特性修改</a></li>
<li><a class="reference internal" href="#new-modules">新增模块</a><ul>
<li><a class="reference internal" href="#zoneinfo">zoneinfo</a></li>
<li><a class="reference internal" href="#graphlib">graphlib</a></li>
</ul>
</li>
<li><a class="reference internal" href="#improved-modules">改进的模块</a><ul>
<li><a class="reference internal" href="#ast">ast</a></li>
<li><a class="reference internal" href="#asyncio">asyncio</a></li>
<li><a class="reference internal" href="#compileall">compileall</a></li>
<li><a class="reference internal" href="#concurrent-futures">concurrent.futures</a></li>
<li><a class="reference internal" href="#curses">curses</a></li>
<li><a class="reference internal" href="#datetime">datetime</a></li>
<li><a class="reference internal" href="#distutils">distutils</a></li>
<li><a class="reference internal" href="#fcntl">fcntl</a></li>
<li><a class="reference internal" href="#ftplib">ftplib</a></li>
<li><a class="reference internal" href="#gc">gc</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#http">http</a></li>
<li><a class="reference internal" href="#idle-and-idlelib">IDLE 与 idlelib</a></li>
<li><a class="reference internal" href="#imaplib">imaplib</a></li>
<li><a class="reference internal" href="#importlib">importlib</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#ipaddress">ipaddress</a></li>
<li><a class="reference internal" href="#math">math</a></li>
<li><a class="reference internal" href="#multiprocessing">multiprocessing</a></li>
<li><a class="reference internal" href="#nntplib">nntplib</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#pathlib">pathlib</a></li>
<li><a class="reference internal" href="#pdb">pdb</a></li>
<li><a class="reference internal" href="#poplib">poplib</a></li>
<li><a class="reference internal" href="#pprint">pprint</a></li>
<li><a class="reference internal" href="#pydoc">pydoc</a></li>
<li><a class="reference internal" href="#random">random</a></li>
<li><a class="reference internal" href="#signal">signal</a></li>
<li><a class="reference internal" href="#smtplib">smtplib</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#time">time</a></li>
<li><a class="reference internal" href="#sys">sys</a></li>
<li><a class="reference internal" href="#tracemalloc">tracemalloc</a></li>
<li><a class="reference internal" href="#typing">typing</a></li>
<li><a class="reference internal" href="#unicodedata">unicodedata</a></li>
<li><a class="reference internal" href="#venv">venv</a></li>
<li><a class="reference internal" href="#xml">xml</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimizations">性能优化</a></li>
<li><a class="reference internal" href="#deprecated">弃用</a></li>
<li><a class="reference internal" href="#removed">移除</a></li>
<li><a class="reference internal" href="#porting-to-python-3-9">移植到 Python 3.9</a><ul>
<li><a class="reference internal" href="#changes-in-the-python-api">Python API 的变化</a></li>
<li><a class="reference internal" href="#changes-in-the-c-api">C API 的变化</a></li>
<li><a class="reference internal" href="#cpython-bytecode-changes">CPython 字节码的改变</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-changes">构建的改变</a></li>
<li><a class="reference internal" href="#c-api-changes">C API 的改变</a><ul>
<li><a class="reference internal" href="#id1">新的特性</a></li>
<li><a class="reference internal" href="#id2">移植到 Python 3.9</a></li>
<li><a class="reference internal" href="#id3">移除</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notable-changes-in-python-3-9-1">Python 3.9.1 中的重要变化</a><ul>
<li><a class="reference internal" href="#id4">typing</a></li>
<li><a class="reference internal" href="#macos-11-0-big-sur-and-apple-silicon-mac-support">macOS 11.0 (Big Sur) 与 Apple Silicon Mac 支持</a></li>
</ul>
</li>
<li><a class="reference internal" href="#notable-changes-in-python-3-9-2">Python 3.9.2 中的重要变化</a><ul>
<li><a class="reference internal" href="#collections-abc">collections.abc</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="3.10.html"
                          title="上一章">Python 3.10 有什么新变化</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="3.8.html"
                          title="下一章">Python 3.8 有什么新变化</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.9.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="3.8.html" title="Python 3.8 有什么新变化"
             >下一页</a> |</li>
        <li class="right" >
          <a href="3.10.html" title="Python 3.10 有什么新变化"
             >上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python的新变化</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.9 有什么新变化</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">版权所有</a> 2001-2022, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    See <a href="/license.html">History and License</a> for more information.<br />
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最后更新于 11月 24, 2022.
    <a href="/bugs.html">Found a bug</a>?
    <br />

    由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>

  </body>
</html>