
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>__main__ --- 最高层级代码环境 &#8212; Python 3.11.0 文档</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?2022.1" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 3.11.0 文档 中搜索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="关于这些文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="copyright" title="版权所有" href="../copyright.html" />
    <link rel="next" title="warnings —— 警告信息的控制" href="warnings.html" />
    <link rel="prev" title="builtins --- 内建对象" href="builtins.html" />
    <link rel="canonical" href="https://docs.python.org/3/library/__main__.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://www.python.org/" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="快速搜索"/>
            <input type="submit" value="转向"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code> --- 最高层级代码环境</a><ul>
<li><a class="reference internal" href="#name-main"><code class="docutils literal notranslate"><span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code></a><ul>
<li><a class="reference internal" href="#what-is-the-top-level-code-environment">什么是“最高层级代码环境”？</a></li>
<li><a class="reference internal" href="#idiomatic-usage">常见用法</a></li>
<li><a class="reference internal" href="#packaging-considerations">打包考量</a></li>
</ul>
</li>
<li><a class="reference internal" href="#main-py-in-python-packages">Python 包中的 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code></a><ul>
<li><a class="reference internal" href="#id1">常见用法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#import-main"><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">__main__</span></code></a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="builtins.html"
                          title="上一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">builtins</span></code> --- 内建对象</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="warnings.html"
                          title="下一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code> —— 警告信息的控制</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/__main__.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="warnings.html" title="warnings —— 警告信息的控制"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="builtins.html" title="builtins --- 内建对象"
             accesskey="P">上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 标准库</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="python.html" accesskey="U">Python运行时服务</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code> --- 最高层级代码环境</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-__main__">
<span id="main-top-level-code-environment"></span><h1><a class="reference internal" href="#module-__main__" title="__main__: The environment where top-level code is run. Covers command-line interfaces, import-time behavior, and ``__name__ == '__main__'``."><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code></a> --- 最高层级代码环境<a class="headerlink" href="#module-__main__" title="永久链接至标题">¶</a></h1>
<hr class="docutils" />
<p>在 Python 中，特殊名称 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 被用于两个重要的构造:</p>
<ol class="arabic simple">
<li><p>程序的最高层级环境的名称，可以使用 <code class="docutils literal notranslate"><span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> 表达式来检查它；以及</p></li>
<li><p>Python 包中的 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 文件。</p></li>
</ol>
<p>这两种机制都有 Python 模块有关；用户如何与它们交互以及它们之间如何交互。 下文将进行详细说明。 如果你还不了解 Python 模块，请查看教程 <a class="reference internal" href="../tutorial/modules.html#tut-modules"><span class="std std-ref">模块</span></a> 一节的介绍。</p>
<section id="name-main">
<span id="name-equals-main"></span><h2><code class="docutils literal notranslate"><span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code><a class="headerlink" href="#name-main" title="永久链接至标题">¶</a></h2>
<p>当一个 Python 模块或包被导入时，<code class="docutils literal notranslate"><span class="pre">__name__</span></code> 会被设为模块的名称。 通常，这将是 Python 文件本身的名称去掉 <code class="docutils literal notranslate"><span class="pre">.py</span></code> 后缀:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">configparser</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">configparser</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;configparser&#39;</span>
</pre></div>
</div>
<p>如果文件是包的组成部分，则 <code class="docutils literal notranslate"><span class="pre">__name__</span></code> 还将包括父包的路径:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">process</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">process</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;concurrent.futures.process&#39;</span>
</pre></div>
</div>
<p>不过，如果模块是在最高层级代码环境中执行的，则它的 <code class="docutils literal notranslate"><span class="pre">__name__</span></code> 会被设为字符串 <code class="docutils literal notranslate"><span class="pre">'__main__'</span></code>。</p>
<section id="what-is-the-top-level-code-environment">
<h3>什么是“最高层级代码环境”？<a class="headerlink" href="#what-is-the-top-level-code-environment" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">__main__</span></code> 是最高层级代码运行所在环境的名称。 “最高层级代码”即用户指定最先启动运行的 Python 模块。 它被称为“最高层级”是因为它将导入程序所需的所有其他模块。 有时“最高层级代码”也被称为应用的 <em>入口点</em>。</p>
<p>最高层级代码环境可以是:</p>
<ul>
<li><p>一个交互提示符的作用域:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="vm">__name__</span>
<span class="go">&#39;__main__&#39;</span>
</pre></div>
</div>
</li>
<li><p>作为文件参数传给 Python 解释器的 Python 模块:</p>
<blockquote>
<div><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 helloworld.py
<span class="go">Hello, world!</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>作为 <a class="reference internal" href="../using/cmdline.html#cmdoption-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> 参数传给 Python 解释器的 Python 模块或包:</p>
<blockquote>
<div><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 -m tarfile
<span class="go">usage: tarfile.py [-h] [-v] (...)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Python 解释器从标准输入中读取的 Python 代码:</p>
<blockquote>
<div><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">echo</span> <span class="s2">&quot;import this&quot;</span> <span class="p">|</span> python3
<span class="go">The Zen of Python, by Tim Peters</span>

<span class="go">Beautiful is better than ugly.</span>
<span class="go">Explicit is better than implicit.</span>
<span class="go">...</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>作为 <a class="reference internal" href="../using/cmdline.html#cmdoption-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">-c</span></code></a> 参数传递给 Python 解释器的 Python 代码:</p>
<blockquote>
<div><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 -c <span class="s2">&quot;import this&quot;</span>
<span class="go">The Zen of Python, by Tim Peters</span>

<span class="go">Beautiful is better than ugly.</span>
<span class="go">Explicit is better than implicit.</span>
<span class="go">...</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p>在以上每个情形中，顶级模块的 <code class="docutils literal notranslate"><span class="pre">__name__</span></code>  被设置为 <code class="docutils literal notranslate"><span class="pre">'__main__'</span></code> 。</p>
<p>因此，一个模块可以通过检查自己的 <code class="docutils literal notranslate"><span class="pre">__name__</span></code>  ，来发现它是否在顶层环境中运行。这是允许在模块没有从导入语句中初始化的情况下，有条件地执行代码的一个常见的语句:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Execute when the module is not initialized from an import statement.</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p>关于在所有情况下 <code class="docutils literal notranslate"><span class="pre">__name__</span></code> 是如何设置的细节，请看教程部分 <a class="reference internal" href="../tutorial/modules.html#tut-modules"><span class="std std-ref">模块</span></a> 。</p>
</div>
</section>
<section id="idiomatic-usage">
<h3>常见用法<a class="headerlink" href="#idiomatic-usage" title="永久链接至标题">¶</a></h3>
<p>有些模块包含了仅供脚本使用的代码，比如解析命令行参数或从标准输入获取数据。 如果这样的模块被从不同的模块中导入，例如为了单元测试，脚本代码也会无意中执行。</p>
<p>这就是 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> 代码块的用武之地。除非模块在顶层环境中被执行，否则该块内的代码不会运行。</p>
<p>将尽可能少的语句放在下面的 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name___</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> 块中可以提高代码的清晰度和正确性。最常见的，一个名为 <code class="docutils literal notranslate"><span class="pre">main</span></code> 的函数封装了程序的主要行为:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># echo.py</span>

<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">phrase</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
   <span class="sd">&quot;&quot;&quot;A dummy wrapper around print.&quot;&quot;&quot;</span>
   <span class="c1"># for demonstration purposes, you can imagine that there is some</span>
   <span class="c1"># valuable and reusable logic inside this function</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">phrase</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Echo the input arguments to standard output&quot;&quot;&quot;</span>
    <span class="n">phrase</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">echo</span><span class="p">(</span><span class="n">phrase</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>  <span class="c1"># next section explains the use of sys.exit</span>
</pre></div>
</div>
<p>请注意，如果模块没有将代码封装在 <code class="docutils literal notranslate"><span class="pre">main</span></code> 函数内，而是直接放在 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> 块内，那么这个 <code class="docutils literal notranslate"><span class="pre">phrase</span></code> 变量对整个模块来说就是全局变量。 这很容易出错，因为模块内的其他函数可能会无意中使用全局变量而不是局部名称。 一个 <code class="docutils literal notranslate"><span class="pre">main</span></code> 函数解决了这个问题。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">main</span></code> 函数有一个额外的好处，就是 <code class="docutils literal notranslate"><span class="pre">echo</span></code> 函数本身是孤立的，可以在其他地方导入。当 <code class="docutils literal notranslate"><span class="pre">echo.py</span></code> 被导入时，<code class="docutils literal notranslate"><span class="pre">echo</span></code> 和 <code class="docutils literal notranslate"><span class="pre">main</span></code> 函数将被定义，但它们都不会被调用，因为 <code class="docutils literal notranslate"><span class="pre">__name__</span> <span class="pre">!=</span> <span class="pre">'__main__'</span></code> 。</p>
</section>
<section id="packaging-considerations">
<h3>打包考量<a class="headerlink" href="#packaging-considerations" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">main</span></code> 函数经常被用来创建命令行工具，把它们指定为控制台脚本的入口点。 当这样做时，<a class="reference external" href="https://pip.pypa.io/">pip</a> 将函数调用插入到模板脚本中，其中 <code class="docutils literal notranslate"><span class="pre">main</span></code> 的返回值被传递到 <a class="reference internal" href="sys.html#sys.exit" title="sys.exit"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.exit()</span></code></a> 。例如:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>由于 <code class="docutils literal notranslate"><span class="pre">main</span></code> 调用被包裹在 <a class="reference internal" href="sys.html#sys.exit" title="sys.exit"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.exit()</span></code></a> 中，期望你的函数将返回一些可被 <a class="reference internal" href="sys.html#sys.exit" title="sys.exit"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.exit()</span></code></a> 作为输入而接受的值；通常为一个整数或 <code class="docutils literal notranslate"><span class="pre">None</span></code> （如果你的函数没有返回语句，则隐含返回）。</p>
<p>通过主动遵循这一惯例，我们的模块在直接运行时（即 <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">echo.py</span></code> ）会有相同的行为，如果我们以后把它打包成可用 pip 安装的包中的控制台脚本入口，它也会有相同的行为。</p>
<p>特别的是，要小心从你的 <code class="docutils literal notranslate"><span class="pre">main</span></code> 函数中返回字符串。 <a class="reference internal" href="sys.html#sys.exit" title="sys.exit"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.exit()</span></code></a> 将把一个字符串参数解释为失败信息，所以你的程序将有一个 <code class="docutils literal notranslate"><span class="pre">1</span></code> 的退出代码，表示失败。并且这个字符串将被写入 <a class="reference internal" href="sys.html#sys.stderr" title="sys.stderr"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a> 。 前面的 <code class="docutils literal notranslate"><span class="pre">echo.py</span></code> 例子举例说明了使用 <code class="docutils literal notranslate"><span class="pre">sys.exit(main())</span></code> 的约定。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference external" href="https://packaging.python.org/">Python 打包用户指南</a> 包含了一系列关于如何用现代工具分发和安装 Python 包的教程和参考资料。</p>
</div>
</section>
</section>
<section id="main-py-in-python-packages">
<h2>Python 包中的 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code><a class="headerlink" href="#main-py-in-python-packages" title="永久链接至标题">¶</a></h2>
<p>如果你不熟悉Python包，请参阅本教程的 <a class="reference internal" href="../tutorial/modules.html#tut-packages"><span class="std std-ref">包</span></a> 一节。最常见的是， <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 文件被用来为一个包提供命令行接口。假设有下面这个虚构的包，&quot;bandclass&quot;:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bandclass
  ├── __init__.py
  ├── __main__.py
  └── student.py
</pre></div>
</div>
<p>当使用 <a class="reference internal" href="../using/cmdline.html#cmdoption-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> 标志从命令行直接调用软件包本身时，将执行 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 。比如说。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 -m bandclass
</pre></div>
</div>
<p>这个命令将导致 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 的运行。你如何利用这一机制将取决于你所编写的软件包的性质，但在这个假设的案例中，允许教师搜索学生可能是有意义的:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># bandclass/__main__.py</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">.student</span> <span class="kn">import</span> <span class="n">search_students</span>

<span class="n">student_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found student: </span><span class="si">{</span><span class="n">search_students</span><span class="p">(</span><span class="n">student_name</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>注意， <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">.student</span> <span class="pre">import</span> <span class="pre">search_students</span></code> 是一个相对导入的例子。 这种导入方式可以在引用一个包内的模块时使用。 更多细节，请参见教程 <a class="reference internal" href="../tutorial/modules.html#tut-modules"><span class="std std-ref">模块</span></a> 中的 <a class="reference internal" href="../tutorial/modules.html#intra-package-references"><span class="std std-ref">子包参考</span></a> 一节。</p>
<section id="id1">
<h3>常见用法<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 的内容通常不是用 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> 区块围起来的。 相反，这些文件保持简短，功能从其他模块执行。 那些其他模块可以很容易地进行单元测试，并且可以适当地重复使用。</p>
<p>如果使用，一个 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> 区块仍然会像预期的那样对包内的 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 文件起作用，因为如果导入，它的 <code class="docutils literal notranslate"><span class="pre">__name__</span></code> 属性将包括包的路径:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">asyncio.__main__</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">asyncio</span><span class="o">.</span><span class="n">__main__</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;asyncio.__main__&#39;</span>
</pre></div>
</div>
<p>但这对 .zip 文件的根目录中的 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 文件不起作用。 因此，为了保持一致性，像下面提到的 <a class="reference internal" href="venv.html#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> 这样的最小 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 是首选。</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p>参见 <a class="reference internal" href="venv.html#module-venv" title="venv: Creation of virtual environments."><code class="xref py py-mod docutils literal notranslate"><span class="pre">venv</span></code></a> 以了解标准库中最小 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 的软件包示例。它不包含一个 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code> 块。你可以用 <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">[directory]</span></code> 调用它。</p>
<p>参见 <a class="reference internal" href="runpy.html#module-runpy" title="runpy: Locate and run Python modules without importing them first."><code class="xref py py-mod docutils literal notranslate"><span class="pre">runpy</span></code></a> 以了解更多关于 <a class="reference internal" href="../using/cmdline.html#cmdoption-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> 标志对解释器可执行包的细节。</p>
<p>参见 <a class="reference internal" href="zipapp.html#module-zipapp" title="zipapp: Manage executable Python zip archives"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zipapp</span></code></a> 了解如何运行打包成 <em>.zip</em> 文件的应用程序。在这种情况下，Python 会在归档文件的根目录下寻找一个 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 文件。</p>
</div>
</section>
</section>
<section id="import-main">
<h2><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">__main__</span></code><a class="headerlink" href="#import-main" title="永久链接至标题">¶</a></h2>
<p>不管 Python 程序是用哪个模块启动的，在同一程序中运行的其他模块可以通过导入 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 模块来导入顶级环境的范围 ( <a class="reference internal" href="../glossary.html#term-namespace"><span class="xref std std-term">namespace</span></a> )。这并不是导入一个 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> 文件，而是导入使用特殊名称 <code class="docutils literal notranslate"><span class="pre">'__main__'</span></code> 的哪个模块。</p>
<p>下面是一个使用 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 命名空间的模块的例子:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># namely.py</span>

<span class="kn">import</span> <span class="nn">__main__</span>

<span class="k">def</span> <span class="nf">did_user_define_their_name</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;my_name&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">__main__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_user_name</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">did_user_define_their_name</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Define the variable `my_name`!&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;__file__&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">__main__</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">__main__</span><span class="o">.</span><span class="n">my_name</span><span class="p">,</span> <span class="s2">&quot;found in file&quot;</span><span class="p">,</span> <span class="n">__main__</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">__main__</span><span class="o">.</span><span class="n">my_name</span><span class="p">)</span>
</pre></div>
</div>
<p>该模块的用法示例如下:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start.py</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">namely</span> <span class="kn">import</span> <span class="n">print_user_name</span>

<span class="c1"># my_name = &quot;Dinsdale&quot;</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">print_user_name</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">ve</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
<p>现在，如果我们启动我们的程序，结果会是这样的:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 start.py
<span class="go">Define the variable `my_name`!</span>
</pre></div>
</div>
<p>该程序的退出代码为 1 ，表明有错误。取消对 <code class="docutils literal notranslate"><span class="pre">my_name</span> <span class="pre">=</span> <span class="pre">&quot;Dinsdale&quot;</span></code> 这一行的注释，就可以修复程序，现在它的退出状态代码为 0 ，表示成功。</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python3 start.py
<span class="go">Dinsdale found in file /path/to/start.py</span>
</pre></div>
</div>
<p>请注意，导入 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 不会导致无意中运行旨在用于脚本的顶层代码的问题，这些代码被放在模块 <code class="docutils literal notranslate"><span class="pre">start</span></code> 的 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code> 块中。为什么这样做？</p>
<p>Python 解释器启动时会在 <a class="reference internal" href="sys.html#sys.modules" title="sys.modules"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.modules</span></code></a> 中插入一个空的 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 模块，并通过运行顶层代码来填充它。 在我们的例子中这就是 <code class="docutils literal notranslate"><span class="pre">start</span></code> 模块，它逐行运行并导入 <code class="docutils literal notranslate"><span class="pre">namely</span></code>。 反过来，<code class="docutils literal notranslate"><span class="pre">namely</span></code> 会导入 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> (这其实是 <code class="docutils literal notranslate"><span class="pre">start</span></code>)。 这就是一个导入循环！ 幸运的是，由于部分填充的 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 模块存在于 <a class="reference internal" href="sys.html#sys.modules" title="sys.modules"><code class="xref py py-attr docutils literal notranslate"><span class="pre">sys.modules</span></code></a> 中，Python 会将其传递给 <code class="docutils literal notranslate"><span class="pre">namely</span></code>。 请参阅导入系统参考资料中 <a class="reference internal" href="../reference/import.html#import-dunder-main"><span class="std std-ref">有关 __main__ 的特别考量</span></a> 来了解其中的详情。</p>
<p>Python REPL 是另一个 &quot;顶层环境 &quot;的例子，所以在 REPL 中定义的任何东西都成为 <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 范围的一部分:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">namely</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">namely</span><span class="o">.</span><span class="n">did_user_define_their_name</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">namely</span><span class="o">.</span><span class="n">print_user_name</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">Define the variable `my_name`!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_name</span> <span class="o">=</span> <span class="s1">&#39;Jabberwocky&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">namely</span><span class="o">.</span><span class="n">did_user_define_their_name</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">namely</span><span class="o">.</span><span class="n">print_user_name</span><span class="p">()</span>
<span class="go">Jabberwocky</span>
</pre></div>
</div>
<p>注意，在这种情况下， <code class="docutils literal notranslate"><span class="pre">__main__</span></code> 范围不包含 <code class="docutils literal notranslate"><span class="pre">__file__</span></code> 属性，因为它是交互式的。</p>
<p><code class="docutils literal notranslate"><span class="pre">__main__</span></code> 范围用于 <a class="reference internal" href="pdb.html#module-pdb" title="pdb: The Python debugger for interactive interpreters."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pdb</span></code></a> 和 <a class="reference internal" href="rlcompleter.html#module-rlcompleter" title="rlcompleter: Python identifier completion, suitable for the GNU readline library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlcompleter</span></code></a> 的实现。</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code> --- 最高层级代码环境</a><ul>
<li><a class="reference internal" href="#name-main"><code class="docutils literal notranslate"><span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code></a><ul>
<li><a class="reference internal" href="#what-is-the-top-level-code-environment">什么是“最高层级代码环境”？</a></li>
<li><a class="reference internal" href="#idiomatic-usage">常见用法</a></li>
<li><a class="reference internal" href="#packaging-considerations">打包考量</a></li>
</ul>
</li>
<li><a class="reference internal" href="#main-py-in-python-packages">Python 包中的 <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code></a><ul>
<li><a class="reference internal" href="#id1">常见用法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#import-main"><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">__main__</span></code></a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="builtins.html"
                          title="上一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">builtins</span></code> --- 内建对象</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="warnings.html"
                          title="下一章"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code> —— 警告信息的控制</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/library/__main__.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="warnings.html" title="warnings —— 警告信息的控制"
             >下一页</a> |</li>
        <li class="right" >
          <a href="builtins.html" title="builtins --- 内建对象"
             >上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python 标准库</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="python.html" >Python运行时服务</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code> --- 最高层级代码环境</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">版权所有</a> 2001-2022, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    See <a href="/license.html">History and License</a> for more information.<br />
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最后更新于 11月 24, 2022.
    <a href="/bugs.html">Found a bug</a>?
    <br />

    由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>

  </body>
</html>