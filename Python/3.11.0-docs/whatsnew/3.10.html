
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Python 3.10 有什么新变化 &#8212; Python 3.11.0 文档</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pydoctheme.css?2022.1" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    
    <script src="../_static/sidebar.js"></script>
    
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Python 3.11.0 文档 中搜索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="关于这些文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="copyright" title="版权所有" href="../copyright.html" />
    <link rel="next" title="Python 3.9 有什么新变化" href="3.9.html" />
    <link rel="prev" title="What&#39;s New In Python 3.11" href="3.11.html" />
    <link rel="canonical" href="https://docs.python.org/3/whatsnew/3.10.html" />
    
      
    

    
    <style>
      @media only screen {
        table.full-width-table {
            width: 100%;
        }
      }
    </style>
<link rel="shortcut icon" type="image/png" href="../_static/py.svg" />
            <script type="text/javascript" src="../_static/copybutton.js"></script>
            <script type="text/javascript" src="../_static/menu.js"></script> 

  </head>
<body>
<div class="mobile-nav">
    <input type="checkbox" id="menuToggler" class="toggler__input" aria-controls="navigation"
           aria-pressed="false" aria-expanded="false" role="button" aria-label="Menu" />
    <label for="menuToggler" class="toggler__label">
        <span></span>
    </label>
    <nav class="nav-content" role="navigation">
         <a href="https://www.python.org/" class="nav-logo">
             <img src="../_static/py.svg" alt="Logo"/>
         </a>
        <div class="version_switcher_placeholder"></div>
        <form role="search" class="search" action="../search.html" method="get">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="search-icon">
                <path fill-rule="nonzero"
                        d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 001.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 00-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 005.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#444"></path>
            </svg>
            <input type="text" name="q" aria-label="快速搜索"/>
            <input type="submit" value="转向"/>
        </form>
    </nav>
    <div class="menu-wrapper">
        <nav class="menu" role="navigation" aria-label="main navigation">
            <div class="language_switcher_placeholder"></div>
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.10 有什么新变化</a><ul>
<li><a class="reference internal" href="#summary-release-highlights">摘要 -- 发布重点</a></li>
<li><a class="reference internal" href="#new-features">新的特性</a><ul>
<li><a class="reference internal" href="#parenthesized-context-managers">带圆括号的上下文管理器</a></li>
<li><a class="reference internal" href="#better-error-messages">更清楚的错误消息</a><ul>
<li><a class="reference internal" href="#syntaxerrors">SyntaxError</a></li>
<li><a class="reference internal" href="#indentationerrors">IndentationError</a></li>
<li><a class="reference internal" href="#attributeerrors">AttributeError</a></li>
<li><a class="reference internal" href="#nameerrors">NameError</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pep-626-precise-line-numbers-for-debugging-and-other-tools">PEP 626：在调试和其他工具中使用精确的行号</a></li>
<li><a class="reference internal" href="#pep-634-structural-pattern-matching">PEP 634：结构化模式匹配</a><ul>
<li><a class="reference internal" href="#syntax-and-operations">语法与操作</a></li>
<li><a class="reference internal" href="#declarative-approach">声明性方式</a></li>
<li><a class="reference internal" href="#simple-pattern-match-to-a-literal">简单模式：匹配一个字面值</a><ul>
<li><a class="reference internal" href="#behavior-without-the-wildcard">无通配符的行为</a></li>
</ul>
</li>
<li><a class="reference internal" href="#patterns-with-a-literal-and-variable">带有字面值和变量的模式</a></li>
<li><a class="reference internal" href="#patterns-and-classes">模式和类</a><ul>
<li><a class="reference internal" href="#patterns-with-positional-parameters">带有位置参数的模式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nested-patterns">嵌套模式</a></li>
<li><a class="reference internal" href="#complex-patterns-and-the-wildcard">复杂模式和通配符</a></li>
<li><a class="reference internal" href="#guard">约束项</a></li>
<li><a class="reference internal" href="#other-key-features">其他关键特性</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-encodingwarning-and-encoding-locale-option">可选的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code> 和 <code class="docutils literal notranslate"><span class="pre">encoding=&quot;locale&quot;</span></code> 选项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-features-related-to-type-hints">有关类型提示的新增特性</a><ul>
<li><a class="reference internal" href="#pep-604-new-type-union-operator">PEP 604: 新的类型联合运算符</a></li>
<li><a class="reference internal" href="#pep-612-parameter-specification-variables">PEP 612: 形参规格变量</a></li>
<li><a class="reference internal" href="#pep-613-typealias">PEP 613: 类型别名</a></li>
<li><a class="reference internal" href="#pep-647-user-defined-type-guards">PEP 647: 用户自定义的类型保护器</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-language-changes">其他语言特性修改</a></li>
<li><a class="reference internal" href="#new-modules">新增模块</a></li>
<li><a class="reference internal" href="#improved-modules">改进的模块</a><ul>
<li><a class="reference internal" href="#asyncio">asyncio</a></li>
<li><a class="reference internal" href="#argparse">argparse</a></li>
<li><a class="reference internal" href="#array">array</a></li>
<li><a class="reference internal" href="#asynchat-asyncore-smtpd">asynchat、asyncore 和 smtpd</a></li>
<li><a class="reference internal" href="#base64">base64</a></li>
<li><a class="reference internal" href="#bdb">bdb</a></li>
<li><a class="reference internal" href="#bisect">bisect</a></li>
<li><a class="reference internal" href="#codecs">编码器</a></li>
<li><a class="reference internal" href="#collections-abc">collections.abc</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#curses">curses</a></li>
<li><a class="reference internal" href="#dataclasses">dataclasses</a><ul>
<li><a class="reference internal" href="#slots">__slots__</a></li>
<li><a class="reference internal" href="#keyword-only-fields">仅限关键字字段</a></li>
</ul>
</li>
<li><a class="reference internal" href="#distutils">distutils</a></li>
<li><a class="reference internal" href="#doctest">doctest</a></li>
<li><a class="reference internal" href="#encodings">encodings</a></li>
<li><a class="reference internal" href="#enum">enum</a></li>
<li><a class="reference internal" href="#fileinput">fileinput</a></li>
<li><a class="reference internal" href="#faulthandler">faulthandler</a></li>
<li><a class="reference internal" href="#gc">gc</a></li>
<li><a class="reference internal" href="#glob">glob</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#hmac">hmac</a></li>
<li><a class="reference internal" href="#idle-and-idlelib">IDLE 与 idlelib</a></li>
<li><a class="reference internal" href="#importlib-metadata">importlib.metadata</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#linecache">linecache</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#os-path">os.path</a></li>
<li><a class="reference internal" href="#pathlib">pathlib</a></li>
<li><a class="reference internal" href="#platform">平台</a></li>
<li><a class="reference internal" href="#pprint">pprint</a></li>
<li><a class="reference internal" href="#py-compile">py_compile</a></li>
<li><a class="reference internal" href="#pyclbr">pyclbr</a></li>
<li><a class="reference internal" href="#shelve">shelve</a></li>
<li><a class="reference internal" href="#statistics">statistics</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#sys">sys</a></li>
<li><a class="reference internal" href="#thread">_thread</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#traceback">traceback</a></li>
<li><a class="reference internal" href="#types">types</a></li>
<li><a class="reference internal" href="#typing">typing</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#xml">xml</a></li>
<li><a class="reference internal" href="#zipimport">zipimport</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimizations">性能优化</a></li>
<li><a class="reference internal" href="#deprecated">弃用</a></li>
<li><a class="reference internal" href="#removed">移除</a></li>
<li><a class="reference internal" href="#porting-to-python-3-10">移植到 Python 3.10</a><ul>
<li><a class="reference internal" href="#changes-in-the-python-syntax">Python 语法中的变化</a></li>
<li><a class="reference internal" href="#changes-in-the-python-api">Python API 的变化</a></li>
<li><a class="reference internal" href="#changes-in-the-c-api">C API 的变化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cpython-bytecode-changes">CPython 字节码的改变</a></li>
<li><a class="reference internal" href="#build-changes">编译版的变化</a></li>
<li><a class="reference internal" href="#c-api-changes">C API 的变化</a><ul>
<li><a class="reference internal" href="#pep-652-maintaining-the-stable-abi">PEP 652：稳定版 ABI 的维护</a></li>
<li><a class="reference internal" href="#id1">新的特性</a></li>
<li><a class="reference internal" href="#id2">移植到 Python 3.10</a></li>
<li><a class="reference internal" href="#id3">弃用</a></li>
<li><a class="reference internal" href="#id4">移除</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="3.11.html"
                          title="上一章">What's New In Python 3.11</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="3.9.html"
                          title="下一章">Python 3.9 有什么新变化</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.10.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </nav>
    </div>
</div>

  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="3.9.html" title="Python 3.9 有什么新变化"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="3.11.html" title="What&#39;s New In Python 3.11"
             accesskey="P">上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Python的新变化</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.10 有什么新变化</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-10">
<h1>Python 3.10 有什么新变化<a class="headerlink" href="#what-s-new-in-python-3-10" title="永久链接至标题">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">发布版本</dt>
<dd class="field-odd"><p>3.11.0</p>
</dd>
<dt class="field-even">日期</dt>
<dd class="field-even"><p>十一月 24, 2022</p>
</dd>
<dt class="field-odd">编者</dt>
<dd class="field-odd"><p>Pablo Galindo Salgado</p>
</dd>
</dl>
<p>这篇文章介绍了 Python 3.10 相比 3.9 增加的新特性。 Python 3.10 发布于 2021 年 10 月 14 日。 更详细的信息可参阅 <a class="reference internal" href="changelog.html#changelog"><span class="std std-ref">更新日志</span></a>。</p>
<section id="summary-release-highlights">
<h2>摘要 -- 发布重点<a class="headerlink" href="#summary-release-highlights" title="永久链接至标题">¶</a></h2>
<p>新的语法特性：</p>
<ul class="simple">
<li><p><span class="target" id="index-76"></span><a class="pep reference external" href="https://peps.python.org/pep-0634/"><strong>PEP 634</strong></a>, 结构化模式匹配: 规范说明</p></li>
<li><p><span class="target" id="index-77"></span><a class="pep reference external" href="https://peps.python.org/pep-0635/"><strong>PEP 635</strong></a>, 结构化模式匹配: 动机与理由</p></li>
<li><p><span class="target" id="index-78"></span><a class="pep reference external" href="https://peps.python.org/pep-0636/"><strong>PEP 636</strong></a>, 结构化模式匹配: 教程</p></li>
<li><p><a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=12782">bpo-12782</a>，加圆括号的上下文管理器现在正式被允许使用。</p></li>
</ul>
<p>标准库中的新特性：</p>
<ul class="simple">
<li><p><span class="target" id="index-79"></span><a class="pep reference external" href="https://peps.python.org/pep-0618/"><strong>PEP 618</strong></a>，向 zip 添加可选的长度检查。</p></li>
</ul>
<p>解释器的改进：</p>
<ul class="simple">
<li><p><span class="target" id="index-80"></span><a class="pep reference external" href="https://peps.python.org/pep-0626/"><strong>PEP 626</strong></a>，在调试和其他工具中使用精确的行号。</p></li>
</ul>
<p>新的类型标注特性：</p>
<ul class="simple">
<li><p><span class="target" id="index-81"></span><a class="pep reference external" href="https://peps.python.org/pep-0604/"><strong>PEP 604</strong></a>，允许 X | Y 形式的联合类型写法</p></li>
<li><p><span class="target" id="index-82"></span><a class="pep reference external" href="https://peps.python.org/pep-0613/"><strong>PEP 613</strong></a>，显式类型别名</p></li>
<li><p><span class="target" id="index-83"></span><a class="pep reference external" href="https://peps.python.org/pep-0612/"><strong>PEP 612</strong></a>，形参规格变量</p></li>
</ul>
<p>重要的弃用、移除或限制：</p>
<ul class="simple">
<li><p><span class="target" id="index-84"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a>，要求 OpenSSL 1.1.1 或更新的版本</p></li>
<li><p><span class="target" id="index-85"></span><a class="pep reference external" href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a>，弃用 distutils 模块。</p></li>
<li><p><span class="target" id="index-86"></span><a class="pep reference external" href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a>，弃用并准备移除 PyUnicodeObject 中的 wstr 成员。</p></li>
<li><p><span class="target" id="index-87"></span><a class="pep reference external" href="https://peps.python.org/pep-0624/"><strong>PEP 624</strong></a>，移除 Py_UNICODE 编码器 API</p></li>
<li><p><span class="target" id="index-88"></span><a class="pep reference external" href="https://peps.python.org/pep-0597/"><strong>PEP 597</strong></a>，增加可选的 EncodingWarning</p></li>
</ul>
</section>
<section id="new-features">
<h2>新的特性<a class="headerlink" href="#new-features" title="永久链接至标题">¶</a></h2>
<section id="parenthesized-context-managers">
<span id="whatsnew310-pep563"></span><h3>带圆括号的上下文管理器<a class="headerlink" href="#parenthesized-context-managers" title="永久链接至标题">¶</a></h3>
<p>现在已支持使用外层圆括号来使多个上下文管理器可以连续多行地书写。 这允许将过长的上下文管理器集能够以与之前 import 语句类似的方式格式化为多行的形式。 例如，以下这些示例写法现在都是有效的:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="p">(</span><span class="n">CtxManager</span><span class="p">()</span> <span class="k">as</span> <span class="n">example</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span>
    <span class="n">CtxManager1</span><span class="p">(),</span>
    <span class="n">CtxManager2</span><span class="p">()</span>
<span class="p">):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span><span class="n">CtxManager1</span><span class="p">()</span> <span class="k">as</span> <span class="n">example</span><span class="p">,</span>
      <span class="n">CtxManager2</span><span class="p">()):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span><span class="n">CtxManager1</span><span class="p">(),</span>
      <span class="n">CtxManager2</span><span class="p">()</span> <span class="k">as</span> <span class="n">example</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">with</span> <span class="p">(</span>
    <span class="n">CtxManager1</span><span class="p">()</span> <span class="k">as</span> <span class="n">example1</span><span class="p">,</span>
    <span class="n">CtxManager2</span><span class="p">()</span> <span class="k">as</span> <span class="n">example2</span>
<span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>在被包含的分组末尾过可以使用一个逗号作为结束：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="p">(</span>
    <span class="n">CtxManager1</span><span class="p">()</span> <span class="k">as</span> <span class="n">example1</span><span class="p">,</span>
    <span class="n">CtxManager2</span><span class="p">()</span> <span class="k">as</span> <span class="n">example2</span><span class="p">,</span>
    <span class="n">CtxManager3</span><span class="p">()</span> <span class="k">as</span> <span class="n">example3</span><span class="p">,</span>
<span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>这个新语法使用了新解析器的非 LL(1) 功能。 请查看 <span class="target" id="index-89"></span><a class="pep reference external" href="https://peps.python.org/pep-0617/"><strong>PEP 617</strong></a> 来了解更多细节。</p>
<p>（由 Guido van Rossum, Pablo Galindo 和 Lysandros Nikolaou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=12782">bpo-12782</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40334">bpo-40334</a> 中贡献。）</p>
</section>
<section id="better-error-messages">
<h3>更清楚的错误消息<a class="headerlink" href="#better-error-messages" title="永久链接至标题">¶</a></h3>
<section id="syntaxerrors">
<h4>SyntaxError<a class="headerlink" href="#syntaxerrors" title="永久链接至标题">¶</a></h4>
<p>现在当解析包含有未关闭括号的代码时解释器会包括未关闭括号的位置而不是显示 <em>SyntaxError: unexpected EOF while parsing</em> 并指向某个不正确的位置。 例如，考虑以下代码（注意未关闭的 “ { ”）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">27</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">29</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">37</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="mi">38</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">39</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">45</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">46</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">47</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">48</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">49</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">54</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="n">some_other_code</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
</pre></div>
</div>
<p>之前版本的解释器会报告令人迷惑的语法错误位置：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;example.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span>
    <span class="n">some_other_code</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
                    <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
</pre></div>
</div>
<p>但在 Python 3.10 中则会发出信息量更多的错误提示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;example.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">27</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">29</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">37</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
               <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="s1">&#39;{&#39;</span> <span class="n">was</span> <span class="n">never</span> <span class="n">closed</span>
</pre></div>
</div>
<p>类似地，涉及未关闭字符串字面值 (单重引号和三重引号) 的错误现在会指向字符串的开头而不是报告 EOF/EOL。</p>
<p>这些改进的灵感来自 PyPy 解释器之前所进行的工作。</p>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42864">bpo-42864</a> 以及 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40176">bpo-40176</a> 中贡献。）</p>
<p>解释器所引发的 <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 异常现在将高亮构成语法错误本身的完整异常错误内容，而不是仅提示检测到问题的位置。 这样，不再（同 Python 3.10 之前那样）仅显示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
           <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">Generator expression must be parenthesized</span>
</pre></div>
</div>
<p>现在 Python 3.10 将这样显示异常：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
           <span class="p p-Marker">^^^^^^^^^^^^^^^^^^^^</span>
<span class="gr">SyntaxError</span>: <span class="n">Generator expression must be parenthesized</span>
</pre></div>
</div>
<p>这个改进是由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43914">bpo-43914</a> 中贡献的。</p>
<p>大量新增的专门化 <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 异常消息已被添加。 其中最主要的一些如下所示：</p>
<ul>
<li><p>在代码块之前缺失 <code class="docutils literal notranslate"><span class="pre">:</span></code>：</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="n">event_horizon</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;</span> <span class="n">event_horizon</span>
                                      <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">expected &#39;:&#39;</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42997">bpo-42997</a>.)</p>
</div></blockquote>
</li>
<li><p>在推导式的目标中有不带圆括号的元组:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="s1">&#39;1234&#39;</span><span class="p">)}</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="s1">&#39;1234&#39;</span><span class="p">)}</span>
     <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">did you forget parentheses around the comprehension target?</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43017">bpo-43017</a>.)</p>
</div></blockquote>
</li>
<li><p>在多项集字面值中和表达式之间缺失逗号:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span><span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span><span class="n">y</span><span class="p">:</span> <span class="mi">2</span>
<span class="gp">... </span><span class="n">z</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
    <span class="n">y</span><span class="p">:</span> <span class="mi">2</span>
       <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">invalid syntax. Perhaps you forgot a comma?</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43822">bpo-43822</a>.)</p>
</div></blockquote>
</li>
<li><p>多个异常类型不带圆括号：</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">build_dyson_sphere</span><span class="p">()</span>
<span class="gp">... </span><span class="k">except</span> <span class="n">NotEnoughScienceError</span><span class="p">,</span> <span class="n">NotEnoughResourcesError</span><span class="p">:</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
    <span class="k">except</span> <span class="n">NotEnoughScienceError</span><span class="p">,</span> <span class="n">NotEnoughResourcesError</span><span class="p">:</span>
           <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">multiple exception types must be parenthesized</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43149">bpo-43149</a>.)</p>
</div></blockquote>
</li>
<li><p>字典字面值中缺失 <code class="docutils literal notranslate"><span class="pre">:</span></code> 和值：</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span><span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span><span class="n">y</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span><span class="n">z</span><span class="p">:</span>
<span class="gp">... </span><span class="p">}</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">4</span>
    <span class="n">z</span><span class="p">:</span>
     <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">expression expected after dictionary key and &#39;:&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span> <span class="n">w</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span> <span class="n">w</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
                        <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">&#39;:&#39; expected after dictionary key</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43823">bpo-43823</a>.)</p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">try</span></code> 代码块不带 <code class="docutils literal notranslate"><span class="pre">except</span></code> 或 <code class="docutils literal notranslate"><span class="pre">finally</span></code> 代码块:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">... </span><span class="n">something</span> <span class="o">=</span> <span class="mi">3</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
    <span class="n">something</span>  <span class="o">=</span> <span class="mi">3</span>
    <span class="p p-Marker">^^^^^^^^^</span>
<span class="gr">SyntaxError</span>: <span class="n">expected &#39;except&#39; or &#39;finally&#39; block</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44305">bpo-44305</a>.)</p>
</div></blockquote>
</li>
<li><p>在比较中使用 <code class="docutils literal notranslate"><span class="pre">=</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">==</span></code>：</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">event_horizon</span><span class="p">:</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="k">if</span> <span class="n">rocket</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">event_horizon</span><span class="p">:</span>
                       <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">cannot assign to attribute here. Maybe you meant &#39;==&#39; instead of &#39;=&#39;?</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43797">bpo-43797</a>.)</p>
</div></blockquote>
</li>
<li><p>在 f-字符串中使用 <code class="docutils literal notranslate"><span class="pre">*</span></code>：</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s2">&quot;Black holes </span><span class="si">{</span><span class="o">*</span><span class="n">all_black_holes</span><span class="si">}</span><span class="s2"> and revelations&quot;</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="p">(</span><span class="o">*</span><span class="n">all_black_holes</span><span class="p">)</span>
     <span class="p p-Marker">^</span>
<span class="gr">SyntaxError</span>: <span class="n">f-string: cannot use starred expression here</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41064">bpo-41064</a>.)</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="indentationerrors">
<h4>IndentationError<a class="headerlink" href="#indentationerrors" title="永久链接至标题">¶</a></h4>
<p>许多 <a class="reference internal" href="../library/exceptions.html#IndentationError" title="IndentationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">IndentationError</span></code></a> 异常现在具有更多上下文来提示是何种代码块需要缩进，包括语句的位置：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="gp">... </span>   <span class="k">if</span> <span class="n">lel</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">3</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p p-Marker">^</span>
<span class="gr">IndentationError</span>: <span class="n">expected an indented block after &#39;if&#39; statement in line 2</span>
</pre></div>
</div>
</section>
<section id="attributeerrors">
<h4>AttributeError<a class="headerlink" href="#attributeerrors" title="永久链接至标题">¶</a></h4>
<p>当打印 <a class="reference internal" href="../library/exceptions.html#AttributeError" title="AttributeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> 时，<code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 将提供引发异常的对象中类似属性名称的建议：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">collections</span><span class="o">.</span><span class="n">namedtoplo</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">AttributeError</span>: <span class="n">module &#39;collections&#39; has no attribute &#39;namedtoplo&#39;. Did you mean: namedtuple?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38530">bpo-38530</a> 中贡献。）</p>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">警告</p>
<p>请注意如果未调用 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 来显示错误则此特性将没有效果，这可能发生在使用了某些其他自定义错误显示函数的时候。 这在某些 REPL 例如 IPython 上是一种常见的情况。</p>
</div>
</div></blockquote>
</section>
<section id="nameerrors">
<h4>NameError<a class="headerlink" href="#nameerrors" title="永久链接至标题">¶</a></h4>
<p>当打印解释器所引发的 <a class="reference internal" href="../library/exceptions.html#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a> 时，<code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 将提供引发异常的函数中类似变量名称的建议：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">schwarzschild_black_hole</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schwarschild_black_hole</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">NameError</span>: <span class="n">name &#39;schwarschild_black_hole&#39; is not defined. Did you mean: schwarzschild_black_hole?</span>
</pre></div>
</div>
<p>（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38530">bpo-38530</a> 中贡献。）</p>
<blockquote>
<div><div class="admonition warning">
<p class="admonition-title">警告</p>
<p>请注意如果未调用 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_Display()</span></code> 来显示错误则此特性将没有效果，这可能发生在使用了某些其他自定义错误显示函数的时候。 这在某些 REPL 例如 IPython 中是一种常见的情况。</p>
</div>
</div></blockquote>
</section>
</section>
<section id="pep-626-precise-line-numbers-for-debugging-and-other-tools">
<h3>PEP 626：在调试和其他工具中使用精确的行号<a class="headerlink" href="#pep-626-precise-line-numbers-for-debugging-and-other-tools" title="永久链接至标题">¶</a></h3>
<p>PEP 626 带来了更精确可靠的行号用于调试、性能分析和测试工具。 所有被执行的代码行都会并且只有被执行的代码行才会生成带有正确行号的追踪事件。</p>
<p>帧对象的 <code class="docutils literal notranslate"><span class="pre">f_lineno</span></code> 属性将总是包含预期的行号。</p>
<p>代码对象的 <code class="docutils literal notranslate"><span class="pre">co_lnotab</span></code> 属性已被弃用并将在 3.12 中被移除。 需要从偏移量转换为行号的代码应改用新的 <code class="docutils literal notranslate"><span class="pre">co_lines()</span></code> 方法。</p>
</section>
<section id="pep-634-structural-pattern-matching">
<h3>PEP 634：结构化模式匹配<a class="headerlink" href="#pep-634-structural-pattern-matching" title="永久链接至标题">¶</a></h3>
<p>增加了采用模式加上相应动作的 <em>match 语句</em> 和 <em>case 语句</em> 的形式的结构化模式匹配。 模式由序列、映射、基本数据类型以及类实例构成。 模式匹配使得程序能够从复杂的数据类型中提取信息、根据数据结构实现分支，并基于不同的数据形式应用特定的动作。</p>
<section id="syntax-and-operations">
<h4>语法与操作<a class="headerlink" href="#syntax-and-operations" title="永久链接至标题">¶</a></h4>
<p>模式匹配的通用语法如下:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">subject</span><span class="p">:</span>
    <span class="k">case</span> <span class="o">&lt;</span><span class="n">pattern_1</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_1</span><span class="o">&gt;</span>
    <span class="k">case</span> <span class="o">&lt;</span><span class="n">pattern_2</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_2</span><span class="o">&gt;</span>
    <span class="k">case</span> <span class="o">&lt;</span><span class="n">pattern_3</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_3</span><span class="o">&gt;</span>
    <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">action_wildcard</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>match 语句接受一个表达式并将其值与以一个或多个 case 语句块形式给出的一系列模式进行比较。 具体来说，模式匹配的操作如下：</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>使用具有特定类型和形状的数据 (<code class="docutils literal notranslate"><span class="pre">subject</span></code>)</p></li>
<li><p>针对 <code class="docutils literal notranslate"><span class="pre">subject</span></code> 在 <code class="docutils literal notranslate"><span class="pre">match</span></code> 语句中求值</p></li>
<li><p>从上到下对 subject 与 <code class="docutils literal notranslate"><span class="pre">case</span></code> 语句中的每个模式进行比较直到确认匹配到一个模式。</p></li>
<li><p>执行与被确认匹配的模式相关联的动作。</p></li>
<li><p>如果没有确认到一个完全的匹配，则如果提供了使用通配符 <code class="docutils literal notranslate"><span class="pre">_</span></code> 的最后一个 case 语句，则它将被用作已匹配模式。 如果没有确认到一个完全的匹配并且不存在使用通配符的 case 语句，则整个 match 代码块不执行任何操作。</p></li>
</ol>
</div></blockquote>
</section>
<section id="declarative-approach">
<h4>声明性方式<a class="headerlink" href="#declarative-approach" title="永久链接至标题">¶</a></h4>
<p>读者可能是通过 C, Java 或 JavaScript (以及其他许多语言) 中的 switch 语句将一个目标 (数据对象) 与一个字面值 (模式) 进行匹配的简单例子了解到模式匹配的概念的。 switch 语句常常被用来将一个对象/表达式与包含在 case 语句中的字面值进行比较。</p>
<p>更强大的模式匹配例子可以在 Scala 和 Elixir 等语言中找到。 这种结构化模式匹配方式是“声明性”的并且会显式地为所要匹配的数据指定条件（模式）。</p>
<p>虽然使用嵌套的“if”语句的“命令性”系列指令可以被用来完成类似结构化模式匹配的效果，但它没有“声明性”方式那样清晰。 相反地，“声明性”方式指定了一个匹配所要满足的条件，并且通过其显式的模式使之更为易读。 虽然结构化模式匹配可以采取将一个变量与一个 case 语句中的字面值进行比较的最简单形式来使用，但它对于 Python 的真正价值在于其针对目标类型和形状的处理操作。</p>
</section>
<section id="simple-pattern-match-to-a-literal">
<h4>简单模式：匹配一个字面值<a class="headerlink" href="#simple-pattern-match-to-a-literal" title="永久链接至标题">¶</a></h4>
<p>让我们把这个例子看作是模式匹配的最简单形式：一个值，即主词，被匹配到几个字面值，即模式。在下面的例子中，<code class="docutils literal notranslate"><span class="pre">status</span></code> 是匹配语句的主词。模式是每个 case 语句，字面值代表请求状态代码。匹配后，将执行与该 case 相关的动作：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">http_error</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">status</span><span class="p">:</span>
        <span class="k">case</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Bad request&quot;</span>
        <span class="k">case</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Not found&quot;</span>
        <span class="k">case</span> <span class="mi">418</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;I&#39;m a teapot&quot;</span>
        <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Something&#39;s wrong with the internet&quot;</span>
</pre></div>
</div>
<p>如果传给上述函数的 <code class="docutils literal notranslate"><span class="pre">status</span></code> 为 418，则会返回 &quot;I'm a teapot&quot;。 如果传给上述函数的 <code class="docutils literal notranslate"><span class="pre">status</span></code> 为 500，则带有 <code class="docutils literal notranslate"><span class="pre">_</span></code> 的 case 语句将作为通配符匹配，并会返回 &quot;Something's wrong with the internet&quot;。 请注意最后一个代码块：变量名 <code class="docutils literal notranslate"><span class="pre">_</span></code> 将作为 <em>通配符</em> 并确保目标将总是被匹配。 <code class="docutils literal notranslate"><span class="pre">_</span></code> 的使用是可选的。</p>
<p>你可以使用 <code class="docutils literal notranslate"><span class="pre">|</span></code> （“ or ”）在一个模式中组合几个字面值:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="mi">401</span> <span class="o">|</span> <span class="mi">403</span> <span class="o">|</span> <span class="mi">404</span><span class="p">:</span>
    <span class="k">return</span> <span class="s2">&quot;Not allowed&quot;</span>
</pre></div>
</div>
<section id="behavior-without-the-wildcard">
<h5>无通配符的行为<a class="headerlink" href="#behavior-without-the-wildcard" title="永久链接至标题">¶</a></h5>
<p>如果我们修改上面的例子，去掉最后一个 case 块，这个例子就变成:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">http_error</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">status</span><span class="p">:</span>
        <span class="k">case</span> <span class="mi">400</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Bad request&quot;</span>
        <span class="k">case</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Not found&quot;</span>
        <span class="k">case</span> <span class="mi">418</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;I&#39;m a teapot&quot;</span>
</pre></div>
</div>
<p>如果不在 case 语句中使用 <code class="docutils literal notranslate"><span class="pre">_</span></code>，可能会出现不存在匹配的情况。如果不存在匹配，则行为是一个 no-op。例如，如果传入了值为 500 的 <code class="docutils literal notranslate"><span class="pre">status</span></code> ，就会发生 no-op。</p>
</section>
</section>
<section id="patterns-with-a-literal-and-variable">
<h4>带有字面值和变量的模式<a class="headerlink" href="#patterns-with-a-literal-and-variable" title="永久链接至标题">¶</a></h4>
<p>模式可以看起来像解包形式，而且模式可以用来绑定变量。在这个例子中，一个数据点可以被解包为它的 x 坐标和 y 坐标:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># point is an (x, y) tuple</span>
<span class="k">match</span> <span class="n">point</span><span class="p">:</span>
    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Origin&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not a point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>第一个模式有两个字面值 <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0)</span></code> ，可以看作是上面所示字面值模式的扩展。接下来的两个模式结合了一个字面值和一个变量，而变量 <em>绑定</em> 了一个来自主词的值（<code class="docutils literal notranslate"><span class="pre">point</span></code>）。 第四种模式捕获了两个值，这使得它在概念上类似于解包赋值 <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">point</span></code> 。</p>
</section>
<section id="patterns-and-classes">
<h4>模式和类<a class="headerlink" href="#patterns-and-classes" title="永久链接至标题">¶</a></h4>
<p>如果你使用类来结构化你的数据，你可以使用类的名字，后面跟一个类似构造函数的参数列表，作为一种模式。这种模式可以将类的属性捕捉到变量中:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
    <span class="k">match</span> <span class="n">point</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Origin is the point&#39;s location.&quot;</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> and the point is on the y-axis.&quot;</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> and the point is on the x-axis.&quot;</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">Point</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The point is located somewhere else on the plane.&quot;</span><span class="p">)</span>
        <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not a point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<section id="patterns-with-positional-parameters">
<h5>带有位置参数的模式<a class="headerlink" href="#patterns-with-positional-parameters" title="永久链接至标题">¶</a></h5>
<p>你可以在某些为其属性提供了排序的内置类（例如 dataclass）中使用位置参数。 你也可以通过在你的类中设置 <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> 特殊属性来为模式中的属性定义一个专门的位置。 如果它被设为 (&quot;x&quot;, &quot;y&quot;)，则以下模式均为等价的（并且都是将 <code class="docutils literal notranslate"><span class="pre">y</span></code> 属性绑定到 <code class="docutils literal notranslate"><span class="pre">var</span></code> 变量）:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
<span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
<span class="n">Point</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="nested-patterns">
<h4>嵌套模式<a class="headerlink" href="#nested-patterns" title="永久链接至标题">¶</a></h4>
<p>模式可以任意地嵌套。 例如，如果我们的数据是由点组成的短列表，则它可以这样被匹配:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">points</span><span class="p">:</span>
    <span class="k">case</span> <span class="p">[]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No points in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The origin is the only point in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A single point </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2"> is in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Two points on the Y axis at </span><span class="si">{</span><span class="n">y1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y2</span><span class="si">}</span><span class="s2"> are in the list.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="k">_</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Something else is found in the list.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="complex-patterns-and-the-wildcard">
<h4>复杂模式和通配符<a class="headerlink" href="#complex-patterns-and-the-wildcard" title="永久链接至标题">¶</a></h4>
<p>到目前为止，这些例子仅在最后一个 case 语句中使用了 <code class="docutils literal notranslate"><span class="pre">_</span></code>。 但通配符可以被用在更复杂的模式中，例如 <code class="docutils literal notranslate"><span class="pre">('error',</span> <span class="pre">code,</span> <span class="pre">_)</span></code>。 举例来说:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">test_variable</span><span class="p">:</span>
    <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A warning has been received.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="k">_</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> occurred.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>在上述情况下，<code class="docutils literal notranslate"><span class="pre">test_variable</span></code> 将可匹配 ('error', code, 100) 和 ('error', code, 800)。</p>
</section>
<section id="guard">
<h4>约束项<a class="headerlink" href="#guard" title="永久链接至标题">¶</a></h4>
<p>我们可以向一个模式添加 <code class="docutils literal notranslate"><span class="pre">if</span></code> 子句，称为“约束项”。 如果约束项为假值，则 <code class="docutils literal notranslate"><span class="pre">match</span></code> 将继续尝试下一个 case 语句块。 请注意值的捕获发生在约束项被求值之前。:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">point</span><span class="p">:</span>
    <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The point is located on the diagonal Y=X at </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Point is not on the diagonal.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="other-key-features">
<h4>其他关键特性<a class="headerlink" href="#other-key-features" title="永久链接至标题">¶</a></h4>
<p>一些其他关键特性:</p>
<ul>
<li><p>类似于解包赋值，元组和列表模式具有完全相同的含义，而且实际上能匹配任意序列。 从技术上说，目标必须为一个序列。 因而，一个重要的例外是模式不能匹配迭代器。 而且，为了避免一个常见的错误，序列模式不能匹配字符串。</p></li>
<li><p>序列模式支持通配符: <code class="docutils literal notranslate"><span class="pre">[x,</span> <span class="pre">y,</span> <span class="pre">*rest]</span></code> 和 <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">*rest)</span></code> 的作用类似于解包赋值中的通配符。 在 <code class="docutils literal notranslate"><span class="pre">*</span></code> 之后的名称也可以为 <code class="docutils literal notranslate"><span class="pre">_</span></code>，因此 <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y,</span> <span class="pre">*_)</span></code> 可以匹配包含两个条目的序列而不必绑定其余的条目。</p></li>
<li><p>映射模式: <code class="docutils literal notranslate"><span class="pre">{&quot;bandwidth&quot;:</span> <span class="pre">b,</span> <span class="pre">&quot;latency&quot;:</span> <span class="pre">l}</span></code> 会从一个字典中捕获 <code class="docutils literal notranslate"><span class="pre">&quot;bandwidth&quot;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&quot;latency&quot;</span></code> 值。 与序列模式不同，额外的键会被忽略。  也支持通配符 <code class="docutils literal notranslate"><span class="pre">**rest</span></code>。 （但 <code class="docutils literal notranslate"><span class="pre">**_</span></code> 是冗余的，因而不被允许。）</p></li>
<li><p>子模式可使用 <code class="docutils literal notranslate"><span class="pre">as</span></code> 关键字来捕获:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="k">as</span> <span class="n">p2</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p>x1, y1, x2, y2 等绑定就如你在没有 <code class="docutils literal notranslate"><span class="pre">as</span></code> 子句的情况下所期望的，而 p2 会绑定目标的整个第二项。</p>
</li>
<li><p>大多数字面值是按相等性比较的。 但是，单例对象 <code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code> 和 <code class="docutils literal notranslate"><span class="pre">None</span></code> 则是按标识号比较的。</p></li>
<li><p>命名常量也可以在模式中使用。 这些命名常量必须为带点号的名称以防止常量被解读为捕获变量:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">match</span> <span class="n">color</span><span class="p">:</span>
    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I see red!&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grass is green&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLUE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m feeling the blues :(&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>完整规格说明参见 <span class="target" id="index-90"></span><a class="pep reference external" href="https://peps.python.org/pep-0634/"><strong>PEP 634</strong></a>。 动机与理由参见 <span class="target" id="index-91"></span><a class="pep reference external" href="https://peps.python.org/pep-0635/"><strong>PEP 635</strong></a>，更详细的教程参见 <span class="target" id="index-92"></span><a class="pep reference external" href="https://peps.python.org/pep-0636/"><strong>PEP 636</strong></a>。</p>
</section>
</section>
<section id="optional-encodingwarning-and-encoding-locale-option">
<span id="whatsnew310-pep597"></span><h3>可选的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code> 和 <code class="docutils literal notranslate"><span class="pre">encoding=&quot;locale&quot;</span></code> 选项<a class="headerlink" href="#optional-encodingwarning-and-encoding-locale-option" title="永久链接至标题">¶</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">TextIOWrapper</span></code> 和 <a class="reference internal" href="../library/functions.html#open" title="open"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a> 的默认编码格式取决于具体的平台和语言区域设置。 由于 UTF-8 被用于大多数 Unix 平台，当打开 UTF-8 文件 (例如 JSON, YAML, TOML, Markdown) 时省略 <code class="docutils literal notranslate"><span class="pre">encoding</span></code> 选项是一个非常常见的错误。 例如:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># BUG: &quot;rb&quot; mode or encoding=&quot;utf-8&quot; should be used.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>为了便于查找此类错误，增加了可选的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code>。 它会在 <a class="reference internal" href="../library/sys.html#sys.flags" title="sys.flags"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.flags.warn_default_encoding</span></code></a> 为真值并使用了语言区域指定的默认编码格式时被发出。</p>
<p>增加了 <code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">warn_default_encoding</span></code> 选项和 <span class="target" id="index-93"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNDEFAULTENCODING"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONWARNDEFAULTENCODING</span></code></a> 来启用相应警告。</p>
<p>请参阅 <a class="reference internal" href="../library/io.html#io-text-encoding"><span class="std std-ref">文本编码格式</span></a> 了解更多信息。</p>
</section>
</section>
<section id="new-features-related-to-type-hints">
<span id="new-feat-related-type-hints"></span><h2>有关类型提示的新增特性<a class="headerlink" href="#new-features-related-to-type-hints" title="永久链接至标题">¶</a></h2>
<p>本节介绍了涉及 <span class="target" id="index-94"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> 类型提示和 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块的主要改变。</p>
<section id="pep-604-new-type-union-operator">
<h3>PEP 604: 新的类型联合运算符<a class="headerlink" href="#pep-604-new-type-union-operator" title="永久链接至标题">¶</a></h3>
<p>引入了启用 <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">|</span> <span class="pre">Y</span></code> 语法的类型联合运算符。 这提供了一种表示 '类型 X 或类型 Y' 的相比使用 <a class="reference internal" href="../library/typing.html#typing.Union" title="typing.Union"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code></a> 更清晰的方式，特别是在类型提示中。</p>
<p>在之前的 Python 版本中，要为可接受多种类型参数的函数应用类型提示，使用的是 <a class="reference internal" href="../library/typing.html#typing.Union" title="typing.Union"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code></a>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>类型提示现在可以使用更简洁的写法:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
<p>这个新增语法也被接受作为 <a class="reference internal" href="../library/functions.html#isinstance" title="isinstance"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#issubclass" title="issubclass"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a> 的第二个参数:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>详情参见 <a class="reference internal" href="../library/stdtypes.html#types-union"><span class="std std-ref">union 类型</span></a> 和 <span class="target" id="index-95"></span><a class="pep reference external" href="https://peps.python.org/pep-0604/"><strong>PEP 604</strong></a>。</p>
<p>（由 Maggie Moss 和 Philippe Prados 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41428">bpo-41428</a> 中贡献，并由 Yurii Karabas 和 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44490">bpo-44490</a> 中补充。）</p>
</section>
<section id="pep-612-parameter-specification-variables">
<h3>PEP 612: 形参规格变量<a class="headerlink" href="#pep-612-parameter-specification-variables" title="永久链接至标题">¶</a></h3>
<p>在 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块中新增了两个选项以改进用于 <span class="target" id="index-96"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> 的 <code class="docutils literal notranslate"><span class="pre">Callable</span></code> 提供给静态类型检查器的信息。</p>
<p>第一个选项是形参规格变量。 它们被用来将一个可调用对象的形参类型转发给另一个可调用对象 —— 这种模式常见于高阶函数和装饰器。 使用示例可在 <a class="reference internal" href="../library/typing.html#typing.ParamSpec" title="typing.ParamSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpec</span></code></a> 中找到。 在之前版本中，没有一种简单办法能以如此精确的方式对形参类型的依赖性进行类型标注。</p>
<p>第二个选项是新的 <code class="docutils literal notranslate"><span class="pre">Concatenate</span></code> 运算符。 它与形参规格变量一起使用以便对增加或移除了其他可调用对象的高阶可调用对象进行类型标注。 使用示例可以在 <a class="reference internal" href="../library/typing.html#typing.Concatenate" title="typing.Concatenate"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Concatenate</span></code></a> 中找到。</p>
<p>请参阅 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Callable</span></code></a>, <a class="reference internal" href="../library/typing.html#typing.ParamSpec" title="typing.ParamSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpec</span></code></a>, <a class="reference internal" href="../library/typing.html#typing.Concatenate" title="typing.Concatenate"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Concatenate</span></code></a>, <a class="reference internal" href="../library/typing.html#typing.ParamSpecArgs" title="typing.ParamSpecArgs"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpecArgs</span></code></a>, <a class="reference internal" href="../library/typing.html#typing.ParamSpecKwargs" title="typing.ParamSpecKwargs"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.ParamSpecKwargs</span></code></a> 和 <span class="target" id="index-97"></span><a class="pep reference external" href="https://peps.python.org/pep-0612/"><strong>PEP 612</strong></a> 来了解更多细节。</p>
<p>（由 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41559">bpo-41559</a> 中贡献，并由 Jelle Zijlstra 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43783">bpo-43783</a> 中加以少量改进。 PEP 由 Mark Mendoza 撰写。）</p>
</section>
<section id="pep-613-typealias">
<h3>PEP 613: 类型别名<a class="headerlink" href="#pep-613-typealias" title="永久链接至标题">¶</a></h3>
<p><span class="target" id="index-98"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> 引入了类型别名的概念，只要求它们是不带标注的最高层级赋值。 这种简单性有时会使得类型检查器难以区分类型别名和普通赋值，特别是当涉及到前向引用或无效类型的时候。 例如在比较:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">StrCache</span> <span class="o">=</span> <span class="s1">&#39;Cache[str]&#39;</span>  <span class="c1"># a type alias</span>
<span class="n">LOG_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;LOG[DEBUG]&#39;</span>  <span class="c1"># a module constant</span>
</pre></div>
</div>
<p>现在 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块具有一个特殊值 <code class="xref py py-data docutils literal notranslate"><span class="pre">TypeAlias</span></code> 可让你更明确地声明类型别名:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">StrCache</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="s1">&#39;Cache[str]&#39;</span>  <span class="c1"># a type alias</span>
<span class="n">LOG_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;LOG[DEBUG]&#39;</span>  <span class="c1"># a module constant</span>
</pre></div>
</div>
<p>请参阅 <span class="target" id="index-99"></span><a class="pep reference external" href="https://peps.python.org/pep-0613/"><strong>PEP 613</strong></a> 了解详情。</p>
<p>（由 Mikhail Golubev 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41923">bpo-41923</a> 中贡献。）</p>
</section>
<section id="pep-647-user-defined-type-guards">
<h3>PEP 647: 用户自定义的类型保护器<a class="headerlink" href="#pep-647-user-defined-type-guards" title="永久链接至标题">¶</a></h3>
<p><code class="xref py py-data docutils literal notranslate"><span class="pre">TypeGuard</span></code> 已被添加到 <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块用来标注类型保护器函数并改进在类型细化期间提供给静态类型分析器的信息。 要了解更多信息，请参阅 <code class="xref py py-data docutils literal notranslate"><span class="pre">TypeGuard</span></code> 的文档以及 <span class="target" id="index-100"></span><a class="pep reference external" href="https://peps.python.org/pep-0647/"><strong>PEP 647</strong></a>。</p>
<p>（由 Ken Jin 和 Guido van Rossum 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43766">bpo-43766</a> 中贡献。 PEP 由 Eric Traut 撰写。）</p>
</section>
</section>
<section id="other-language-changes">
<h2>其他语言特性修改<a class="headerlink" href="#other-language-changes" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> 类型新增了一个方法 <a class="reference internal" href="../library/stdtypes.html#int.bit_count" title="int.bit_count"><code class="xref py py-meth docutils literal notranslate"><span class="pre">int.bit_count()</span></code></a>，返回给定整数的二进制展开中值为一的位数，或称“比特计量”。 （由 Niklas Fiekas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=29882">bpo-29882</a> 中贡献。）</p></li>
<li><p>现在 <a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.keys()</span></code></a>, <a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.values()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dict.items()</span></code></a> 所返回的视图都有一个 <code class="docutils literal notranslate"><span class="pre">mapping</span></code> 属性，它给出包装了原始字典的 <a class="reference internal" href="../library/types.html#types.MappingProxyType" title="types.MappingProxyType"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.MappingProxyType</span></code></a> 对象。 （由 Dennis Sweeney 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40890">bpo-40890</a> 中贡献。）</p></li>
<li><p><span class="target" id="index-101"></span><a class="pep reference external" href="https://peps.python.org/pep-0618/"><strong>PEP 618</strong></a>: 现在 <a class="reference internal" href="../library/functions.html#zip" title="zip"><code class="xref py py-func docutils literal notranslate"><span class="pre">zip()</span></code></a> 函数有一个可选的 <code class="docutils literal notranslate"><span class="pre">strict</span></code> 旗标，用于要求所有可迭代对象的长度都相等。</p></li>
<li><p>接受整数参数的内置和扩展函数不再接受 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">Decimal</span></code></a>, <a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Fraction</span></code></a> 以及其他可被转换为整数但会丢失精度（即具有 <a class="reference internal" href="../reference/datamodel.html#object.__int__" title="object.__int__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__int__()</span></code></a> 方法但没有 <a class="reference internal" href="../reference/datamodel.html#object.__index__" title="object.__index__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__index__()</span></code></a> 方法）的对象。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37999">bpo-37999</a> 中贡献。）</p></li>
<li><p>如果 <a class="reference internal" href="../reference/datamodel.html#object.__ipow__" title="object.__ipow__"><code class="xref py py-func docutils literal notranslate"><span class="pre">object.__ipow__()</span></code></a> 返回 <a class="reference internal" href="../library/constants.html#NotImplemented" title="NotImplemented"><code class="xref py py-const docutils literal notranslate"><span class="pre">NotImplemented</span></code></a>，该运算符将正确地按照预期回退至 <a class="reference internal" href="../reference/datamodel.html#object.__pow__" title="object.__pow__"><code class="xref py py-func docutils literal notranslate"><span class="pre">object.__pow__()</span></code></a> 和 <a class="reference internal" href="../reference/datamodel.html#object.__rpow__" title="object.__rpow__"><code class="xref py py-func docutils literal notranslate"><span class="pre">object.__rpow__()</span></code></a>。 （由 Alex Shkop 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38302">bpo-38302</a> 中贡献。）</p></li>
<li><p>现在赋值表达式可以不带圆括号地在集合字面值和集合推导式中使用，也可以在序列索引号中使用（但不能用于切片）。</p></li>
<li><p>函数具有一个新的 <code class="docutils literal notranslate"><span class="pre">__builtins__</span></code> 属性，当函数被执行时它会被用于查找内置符号，而不是在 <code class="docutils literal notranslate"><span class="pre">__globals__['__builtins__']</span></code> 中查找。 如果 <code class="docutils literal notranslate"><span class="pre">__globals__[&quot;__builtins__&quot;]</span></code> 存在则该属性将基于它来初始化，否则将基于当前的内置函数。 （由 Mark Shannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42990">bpo-42990</a> 中贡献。）</p></li>
<li><p>增加了两个新的内置函数 —— <a class="reference internal" href="../library/functions.html#aiter" title="aiter"><code class="xref py py-func docutils literal notranslate"><span class="pre">aiter()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#anext" title="anext"><code class="xref py py-func docutils literal notranslate"><span class="pre">anext()</span></code></a> 以分别提供与 <a class="reference internal" href="../library/functions.html#iter" title="iter"><code class="xref py py-func docutils literal notranslate"><span class="pre">iter()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#next" title="next"><code class="xref py py-func docutils literal notranslate"><span class="pre">next()</span></code></a> 对应的异步版本。 （由 Joshua Bronson, Daniel Pope 和 Justin Wang 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31861">bpo-31861</a> 中贡献。）</p></li>
<li><p>静态方法 (<a class="reference internal" href="../library/functions.html#staticmethod" title="staticmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;staticmethod</span></code></a>) 和类方法 (<a class="reference internal" href="../library/functions.html#classmethod" title="classmethod"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;classmethod</span></code></a>) 现在会继承方法属性 (<code class="docutils literal notranslate"><span class="pre">__module__</span></code>, <code class="docutils literal notranslate"><span class="pre">__name__</span></code>, <code class="docutils literal notranslate"><span class="pre">__qualname__</span></code>, <code class="docutils literal notranslate"><span class="pre">__doc__</span></code>, <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code>) 并具有一个新的 <code class="docutils literal notranslate"><span class="pre">__wrapped__</span></code> 属性。 此外，静态方法现在还是与常规函数一样的可调用对象。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43682">bpo-43682</a> 中贡献。）</p></li>
<li><p>复杂目标的注解（ <span class="target" id="index-102"></span><a class="pep reference external" href="https://peps.python.org/pep-0526/"><strong>PEP 526</strong></a> 定义的除 <code class="docutils literal notranslate"><span class="pre">simple</span> <span class="pre">name</span></code> 之外的一切复杂目标）在运行时不再受 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code> 的影响。（由Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42737">bpo-42737</a> 中贡献）。</p></li>
<li><p>类和模块对象现在可以按需创建空的注解字典。为保证向下兼容，这些注解数据将存储于对象的 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 中。这改进了 <code class="docutils literal notranslate"><span class="pre">__annotations__</span></code> 的最佳用法；更多信息请参阅 <a class="reference internal" href="../howto/annotations.html#annotations-howto"><span class="std std-ref">对象注解属性的最佳实践</span></a> 。（由 Larry Hastings 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43901">bpo-43901</a> 中贡献）</p></li>
<li><p>由于会产生副作用，现在 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code> 时禁止使用包含 <code class="docutils literal notranslate"><span class="pre">yield</span></code> 、 <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> 、 <code class="docutils literal notranslate"><span class="pre">await</span></code> 或已命名表达式的注解。（由 Batuhan Taskaya 在  <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42725">bpo-42725</a> 中贡献）</p></li>
<li><p>未绑定变量、<code class="docutils literal notranslate"><span class="pre">super()</span></code> 和其他可能改变符号表处理的表达式，现在在 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code> 时不能用作注解。（由 Batuhan Taskaya 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42725">bpo-42725</a> 中贡献）</p></li>
<li><p><a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a> 类型和 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><code class="xref py py-class docutils literal notranslate"><span class="pre">decimal.Decimal</span></code></a> 类型的 NaN 值的哈希值现在取决于对象身份。以前，即便 NaN 值彼此不等，也都是哈希为 <code class="docutils literal notranslate"><span class="pre">0</span></code>。在创建包含多个 NaN 的字典和集合时，由于哈希冲突过度，导致了运行代价可能会二次方增长。（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43475">bpo-43475</a> 中贡献）</p></li>
<li><p>当删除 <a class="reference internal" href="../library/constants.html#debug__" title="__debug__"><code class="xref py py-const docutils literal notranslate"><span class="pre">__debug__</span></code></a> 常量时，将产生一个 <a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> （而不是 <a class="reference internal" href="../library/exceptions.html#NameError" title="NameError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NameError</span></code></a> ）。 (由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=45000">bpo-45000</a> 中贡献。)</p></li>
<li><p><a class="reference internal" href="../library/exceptions.html#SyntaxError" title="SyntaxError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SyntaxError</span></code></a> 异常现在有 <code class="docutils literal notranslate"><span class="pre">end_lineno</span></code> 和 <code class="docutils literal notranslate"><span class="pre">end_offset</span></code> 属性。 如果不确定的话，它们将是 <code class="docutils literal notranslate"><span class="pre">None</span></code> 。(由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43914">bpo-43914</a> 中贡献。)</p></li>
</ul>
</section>
<section id="new-modules">
<h2>新增模块<a class="headerlink" href="#new-modules" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>无。</p></li>
</ul>
</section>
<section id="improved-modules">
<h2>改进的模块<a class="headerlink" href="#improved-modules" title="永久链接至标题">¶</a></h2>
<section id="asyncio">
<h3>asyncio<a class="headerlink" href="#asyncio" title="永久链接至标题">¶</a></h3>
<p>加入了缺失的 <code class="xref py py-meth docutils literal notranslate"><span class="pre">connect_accepted_socket()</span></code> 方法。（由 Alex Grönholm 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41332">bpo-41332</a> 中贡献）</p>
</section>
<section id="argparse">
<h3>argparse<a class="headerlink" href="#argparse" title="永久链接至标题">¶</a></h3>
<p>在 argparse 的帮助中，将“可选参数”这一误导性短语改为“可选项”。某些测试代码如果依赖精确的输出匹配，可能需要调整。（由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=9694">bpo-9694</a> 中贡献）</p>
</section>
<section id="array">
<h3>array<a class="headerlink" href="#array" title="永久链接至标题">¶</a></h3>
<p>现在， <a class="reference internal" href="../library/array.html#array.array" title="array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array.array</span></code></a>  的 <a class="reference internal" href="../library/array.html#array.array.index" title="array.array.index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">index()</span></code></a> 方法拥有可选的 <em>start</em> 和 <em>stop</em> 参数。（由 Anders Lorentsen 和 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31956">bpo-31956</a> 中贡献）</p>
</section>
<section id="asynchat-asyncore-smtpd">
<h3>asynchat、asyncore 和 smtpd<a class="headerlink" href="#asynchat-asyncore-smtpd" title="永久链接至标题">¶</a></h3>
<p>从 Python 3.6 开始，这些模块在其文档中已被标为废弃。现在这三个模块都增加了一个导入时警告 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。</p>
</section>
<section id="base64">
<h3>base64<a class="headerlink" href="#base64" title="永久链接至标题">¶</a></h3>
<p>增加 <a class="reference internal" href="../library/base64.html#base64.b32hexencode" title="base64.b32hexencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">base64.b32hexencode()</span></code></a> 和 <a class="reference internal" href="../library/base64.html#base64.b32hexdecode" title="base64.b32hexdecode"><code class="xref py py-func docutils literal notranslate"><span class="pre">base64.b32hexdecode()</span></code></a> 以支持带有扩展十六进制字母的 Base32 编码。</p>
</section>
<section id="bdb">
<h3>bdb<a class="headerlink" href="#bdb" title="永久链接至标题">¶</a></h3>
<p>增加 <code class="xref py py-meth docutils literal notranslate"><span class="pre">clearBreakpoints()</span></code> ，用于重置所有已设断点。（由 Irit Katriel 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=24160">bpo-24160</a> 中贡献）</p>
</section>
<section id="bisect">
<h3>bisect<a class="headerlink" href="#bisect" title="永久链接至标题">¶</a></h3>
<p>增加了为 <a class="reference internal" href="../library/bisect.html#module-bisect" title="bisect: Array bisection algorithms for binary searching."><code class="xref py py-mod docutils literal notranslate"><span class="pre">bisect</span></code></a> 模块中的 API 提供 <em>key</em> 函数的可能性。(由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=4356">bpo-4356</a> 中贡献。)</p>
</section>
<section id="codecs">
<h3>编码器<a class="headerlink" href="#codecs" title="永久链接至标题">¶</a></h3>
<p>增加一个 <a class="reference internal" href="../library/codecs.html#codecs.unregister" title="codecs.unregister"><code class="xref py py-func docutils literal notranslate"><span class="pre">codecs.unregister()</span></code></a> 函数，用于取消对编解码器搜索函数的注册。（由 Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41842">bpo-41842</a> 中贡献）</p>
</section>
<section id="collections-abc">
<h3>collections.abc<a class="headerlink" href="#collections-abc" title="永久链接至标题">¶</a></h3>
<p>现在， <a class="reference internal" href="../library/stdtypes.html#types-genericalias"><span class="std std-ref">parameterized generic</span></a> 的  <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">__args__</span></code> 与 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Callable</span></code></a> 一致了。 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> generic 现在将类型参数扁平化了，类似于 <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Callable</span></code></a> 当前的做法。这意味着 <code class="docutils literal notranslate"><span class="pre">collections.abc.Callable[[int,</span> <span class="pre">str],</span> <span class="pre">str]</span></code> 将带有 <code class="docutils literal notranslate"><span class="pre">(int,</span> <span class="pre">str,</span> <span class="pre">str)</span></code> 的参数 <code class="docutils literal notranslate"><span class="pre">__args__</span></code>；以前是 <code class="docutils literal notranslate"><span class="pre">([int,</span> <span class="pre">str],</span> <span class="pre">str)</span></code> 。为了做到这一变化，  <a class="reference internal" href="../library/types.html#types.GenericAlias" title="types.GenericAlias"><code class="xref py py-class docutils literal notranslate"><span class="pre">types.GenericAlias</span></code></a> 现在可以被子类化，当对 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 类型进行下标访问时，将返回一个子类。注意，<a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a>  非法的参数化形式可能会触发  <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> ，而在 Python 3.9 中可能就静默了。（由 Ken Jin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42195">bpo-42195</a> 中贡献）</p>
</section>
<section id="contextlib">
<h3>contextlib<a class="headerlink" href="#contextlib" title="永久链接至标题">¶</a></h3>
<p>增加了一个上下文管理器 <a class="reference internal" href="../library/contextlib.html#contextlib.aclosing" title="contextlib.aclosing"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextlib.aclosing()</span></code></a> ，以便能安全关闭异步生成器和代表异步释放资源的对象。（由 Joongi Kim 和 John Belmonte 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41229">bpo-41229</a> 中贡献）</p>
<p>为 <a class="reference internal" href="../library/contextlib.html#contextlib.nullcontext" title="contextlib.nullcontext"><code class="xref py py-func docutils literal notranslate"><span class="pre">contextlib.nullcontext()</span></code></a> 加入异步上下文管理器支持。由 Tom Gringauz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41543">bpo-41543</a> 中贡献）</p>
<p>加入 <code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncContextDecorator</span></code>，以便支持用异步上下文管理器作为装饰器。</p>
</section>
<section id="curses">
<h3>curses<a class="headerlink" href="#curses" title="永久链接至标题">¶</a></h3>
<p>在 ncurses 6.1 中增加的扩展颜色函数将会由 <a class="reference internal" href="../library/curses.html#curses.color_content" title="curses.color_content"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.color_content()</span></code></a> 、 <a class="reference internal" href="../library/curses.html#curses.init_color" title="curses.init_color"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.init_color()</span></code></a> 、 <a class="reference internal" href="../library/curses.html#curses.init_pair" title="curses.init_pair"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.init_pair()</span></code></a> 和 <a class="reference internal" href="../library/curses.html#curses.pair_content" title="curses.pair_content"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.pair_content()</span></code></a> 透明地使用。新增的函数 <a class="reference internal" href="../library/curses.html#curses.has_extended_color_support" title="curses.has_extended_color_support"><code class="xref py py-func docutils literal notranslate"><span class="pre">curses.has_extended_color_support()</span></code></a> 将指明下层的 ncurses 库是否提供了扩展颜色支持。（由 Jeffrey Kintscher 和 Hans Petter Jansson 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36982">bpo-36982</a> 中贡献）</p>
<p>现在常量 <code class="docutils literal notranslate"><span class="pre">BUTTON5_*</span></code> 如果是由底层的 curses 库提供的，则会在 <a class="reference internal" href="../library/curses.html#module-curses" title="curses: An interface to the curses library, providing portable terminal handling. (Unix)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">curses</span></code></a> 模块中体现。（由 Zackery Spytz 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39273">bpo-39273</a> 中贡献）</p>
</section>
<section id="dataclasses">
<h3>dataclasses<a class="headerlink" href="#dataclasses" title="永久链接至标题">¶</a></h3>
<section id="slots">
<h4>__slots__<a class="headerlink" href="#slots" title="永久链接至标题">¶</a></h4>
<p>在 <a class="reference internal" href="../library/dataclasses.html#dataclasses.dataclass" title="dataclasses.dataclass"><code class="xref py py-func docutils literal notranslate"><span class="pre">dataclasses.dataclass()</span></code></a> 装饰器中添加 <code class="docutils literal notranslate"><span class="pre">slots</span></code> 参数。(由 Yurii Karabas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42269">bpo-42269</a> 中贡献)</p>
</section>
<section id="keyword-only-fields">
<h4>仅限关键字字段<a class="headerlink" href="#keyword-only-fields" title="永久链接至标题">¶</a></h4>
<p>数据类现在支持在生成的 __init__ 方法中只用关键字的字段。 有许多方法可以指定只用关键字的字段。</p>
<p>你可以说每一个字段都是仅限关键字的:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Birthday</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">birthday</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">birthday</span></code> 都是生成的 __init__ 方法的仅限关键字的参数。</p>
<p>你可以在每个字段的基础上指定仅限关键字：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Birthday</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">birthday</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>这里的只有 <code class="docutils literal notranslate"><span class="pre">birthday</span></code> 是仅限关键字。如果你在单个字段上设置 <code class="docutils literal notranslate"><span class="pre">kw_only</span></code> ，要注意由于仅限关键字的字段需要跟在非仅限关键字的字段后面，所以有关于重新排序的规则。 详情请看完整的数据类文件。</p>
<p>你也可以指定 KW_ONLY 标记后面的所有字段都是仅限关键字的。 这可能是最常见的用法：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">KW_ONLY</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">_</span><span class="p">:</span> <span class="n">KW_ONLY</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">z</span></code> and <code class="docutils literal notranslate"><span class="pre">t</span></code> are keyword-only parameters, while <code class="docutils literal notranslate"><span class="pre">x</span></code> and
<code class="docutils literal notranslate"><span class="pre">y</span></code> are not.
(Contributed by Eric V. Smith in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43532">bpo-43532</a>.)</p>
</section>
</section>
<section id="distutils">
<span id="distutils-deprecated"></span><h3>distutils<a class="headerlink" href="#distutils" title="永久链接至标题">¶</a></h3>
<p>整个 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 包已被废弃，将在 Python 3.12 中移除。其用指定包构建程序的功能已被第三方软件包 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 和 <code class="docutils literal notranslate"><span class="pre">packaging</span></code> 完全取代，而且大多数其他常用的 API 在标准库的其他地方都可以调用（如 <a class="reference internal" href="../library/platform.html#module-platform" title="platform: Retrieves as much platform identifying data as possible."><code class="xref py py-mod docutils literal notranslate"><span class="pre">platform</span></code></a> 、 <a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shutil</span></code></a> 、 <a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: Subprocess management."><code class="xref py py-mod docutils literal notranslate"><span class="pre">subprocess</span></code></a> 或 <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sysconfig</span></code></a>）。目前没有迁移 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 其他功能的计划，用到其他功能的应用程序应该准备好自己保留一份拷贝。请参考 <span class="target" id="index-103"></span><a class="pep reference external" href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a> 。</p>
<p>在 Python 3.8 中废弃的 <code class="docutils literal notranslate"><span class="pre">bdist_wininst</span></code> 命令已被移除。现在在 Windows 中发布二进制包推荐采用 <code class="docutils literal notranslate"><span class="pre">bdist_wheel</span></code> 命令。（由 Victor Stinner 在  <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42802">bpo-42802</a> 中贡献）</p>
</section>
<section id="doctest">
<h3>doctest<a class="headerlink" href="#doctest" title="永久链接至标题">¶</a></h3>
<p>若模块中没有定义 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> ，则回退至使用 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中贡献）</p>
</section>
<section id="encodings">
<h3>encodings<a class="headerlink" href="#encodings" title="永久链接至标题">¶</a></h3>
<p>现在 <code class="xref py py-func docutils literal notranslate"><span class="pre">encodings.normalize_encoding()</span></code> 会忽略非 ASCII 字符。（由 Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39337">bpo-39337</a> 中贡献）</p>
</section>
<section id="enum">
<h3>enum<a class="headerlink" href="#enum" title="永久链接至标题">¶</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code> <code class="xref py py-func docutils literal notranslate"><span class="pre">__repr__()</span></code> now returns <code class="docutils literal notranslate"><span class="pre">enum_name.member_name</span></code> and
<code class="xref py py-func docutils literal notranslate"><span class="pre">__str__()</span></code> now returns <code class="docutils literal notranslate"><span class="pre">member_name</span></code>.  Stdlib enums available as
module constants have a <a class="reference internal" href="../library/functions.html#repr" title="repr"><code class="xref py py-func docutils literal notranslate"><span class="pre">repr()</span></code></a> of <code class="docutils literal notranslate"><span class="pre">module_name.member_name</span></code>.
(Contributed by Ethan Furman in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40066">bpo-40066</a>.)</p>
<p>Add <a class="reference internal" href="../library/enum.html#enum.StrEnum" title="enum.StrEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.StrEnum</span></code></a> for enums where all members are strings.
(Contributed by Ethan Furman in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41816">bpo-41816</a>.)</p>
</section>
<section id="fileinput">
<h3>fileinput<a class="headerlink" href="#fileinput" title="永久链接至标题">¶</a></h3>
<p>在 <a class="reference internal" href="../library/fileinput.html#fileinput.input" title="fileinput.input"><code class="xref py py-func docutils literal notranslate"><span class="pre">fileinput.input()</span></code></a> 和 <a class="reference internal" href="../library/fileinput.html#fileinput.FileInput" title="fileinput.FileInput"><code class="xref py py-class docutils literal notranslate"><span class="pre">fileinput.FileInput</span></code></a> 中增加了  <em>encoding</em> 和 <em>errors</em> 形参。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43712">bpo-43712</a> 中贡献。）</p>
<p>现在 <a class="reference internal" href="../library/fileinput.html#fileinput.hook_compressed" title="fileinput.hook_compressed"><code class="xref py py-func docutils literal notranslate"><span class="pre">fileinput.hook_compressed()</span></code></a> 会在 <em>mode</em> 为 &quot;r&quot; 且文件被压缩时返回 <code class="xref py py-class docutils literal notranslate"><span class="pre">TextIOWrapper</span></code>，与未压缩文件一致。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=5758">bpo-5758</a> 中贡献。）</p>
</section>
<section id="faulthandler">
<h3>faulthandler<a class="headerlink" href="#faulthandler" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/faulthandler.html#module-faulthandler" title="faulthandler: Dump the Python traceback."><code class="xref py py-mod docutils literal notranslate"><span class="pre">faulthandler</span></code></a> 模块会检测在垃圾回收期间是否发生严重错误。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44466">bpo-44466</a> 中贡献）</p>
</section>
<section id="gc">
<h3>gc<a class="headerlink" href="#gc" title="永久链接至标题">¶</a></h3>
<p>为 <a class="reference internal" href="../library/gc.html#gc.get_objects" title="gc.get_objects"><code class="xref py py-func docutils literal notranslate"><span class="pre">gc.get_objects()</span></code></a>, <a class="reference internal" href="../library/gc.html#gc.get_referrers" title="gc.get_referrers"><code class="xref py py-func docutils literal notranslate"><span class="pre">gc.get_referrers()</span></code></a> 和 <a class="reference internal" href="../library/gc.html#gc.get_referents" title="gc.get_referents"><code class="xref py py-func docutils literal notranslate"><span class="pre">gc.get_referents()</span></code></a> 添加了审计钩子。 （由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43439">bpo-43439</a> 中贡献。）</p>
</section>
<section id="glob">
<h3>glob<a class="headerlink" href="#glob" title="永久链接至标题">¶</a></h3>
<p>在 <a class="reference internal" href="../library/glob.html#glob.glob" title="glob.glob"><code class="xref py py-func docutils literal notranslate"><span class="pre">glob()</span></code></a> 和 <a class="reference internal" href="../library/glob.html#glob.iglob" title="glob.iglob"><code class="xref py py-func docutils literal notranslate"><span class="pre">iglob()</span></code></a> 中增加了 <em>root_dir</em> 和 <em>dir_fd</em> 形参，用于指定搜索的根目录。（由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38144">bpo-38144</a> 中贡献）</p>
</section>
<section id="hashlib">
<h3>hashlib<a class="headerlink" href="#hashlib" title="永久链接至标题">¶</a></h3>
<p>hashlib 模块要求 OpenSSL 1.1.1 或更新版本。 （由 Christian Heimes 在 <span class="target" id="index-104"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43669">bpo-43669</a> 中贡献。）</p>
<p>hashlib 模块已初步支持 OpenSSL 3.0.0。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38820">bpo-38820</a> 及其他问题事项中贡献。）</p>
<p>纯 Python 的回退版 <a class="reference internal" href="../library/hashlib.html#hashlib.pbkdf2_hmac" title="hashlib.pbkdf2_hmac"><code class="xref py py-func docutils literal notranslate"><span class="pre">pbkdf2_hmac()</span></code></a> 已被弃用。 未来 PBKDF2-HMAC 将仅在 Python 带有 OpenSSL 编译时才可用。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43880">bpo-43880</a> 中贡献）</p>
</section>
<section id="hmac">
<h3>hmac<a class="headerlink" href="#hmac" title="永久链接至标题">¶</a></h3>
<p>现在 hmac 模块会在内部使用 OpenSSL 的 HMAC 实现。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40645">bpo-40645</a> 中贡献。）</p>
</section>
<section id="idle-and-idlelib">
<h3>IDLE 与 idlelib<a class="headerlink" href="#idle-and-idlelib" title="永久链接至标题">¶</a></h3>
<p>使 IDLE 调用 <a class="reference internal" href="../library/sys.html#sys.excepthook" title="sys.excepthook"><code class="xref py py-func docutils literal notranslate"><span class="pre">sys.excepthook()</span></code></a> （当启动时没有 '-n' ）。用户钩子以前是被忽略的。 (由 Ken Hilton 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43008">bpo-43008</a> 中贡献。)</p>
<p>重新安排设置对话框。 将常规选项卡分成 Windows 和 Shell/Ed 选项卡。 将扩展帮助菜单的帮助源移至扩展标签。为新选项留出空间，并缩短对话框。后者使对话框更适合小屏幕。 (由 Terry Jan Reedy 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40468">bpo-40468</a> 。) 将缩进空间设置从字体标签移到新的 Windows 标签。 (由 Mark Roseman 和 Terry Jan Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=33962">bpo-33962</a> 中提供)。</p>
<p>上述变化已被反向移植到 3.9 维护版本中。</p>
<p>增加了 Shell 侧栏。 将主提示符（“&gt;&gt;&gt;”）移至侧栏。二级提示符（“...”）也加入侧栏。在编辑器的行号侧栏上鼠标单击和可选的拖动，会选定一行或多行文本。在选定文本行后右击将显示包含“copy with prompts”的上下文菜单。这会将侧栏的提示符与选定文本行合并。该选项也会在文本的上下文菜单中显示。（由 Tal Einat 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37903">bpo-37903</a> 中贡献）</p>
<p>使用空格而不是制表符来缩进交互式代码。 这使得交互式代码条目 &quot;看起来很正确&quot;。 使之可行是增加 shell 侧边栏的一个主要动机。 (由 Terry Jan Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37892">bpo-37892</a> 中贡献。)</p>
<p>在模式匹配语句中高亮显示新的 <a class="reference internal" href="../reference/lexical_analysis.html#soft-keywords"><span class="std std-ref">软关键字</span></a> <a class="reference internal" href="../reference/compound_stmts.html#match"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">match</span></code></a> 、 <a class="reference internal" href="../reference/compound_stmts.html#match"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">case</span></code></a> 和 <a class="reference internal" href="../reference/compound_stmts.html#wildcard-patterns"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">_</span></code></a>。 但这种高亮显示并不完美，某些极端情况下还会出现错误，包括 <code class="docutils literal notranslate"><span class="pre">case</span></code> 模式中的一些 <code class="docutils literal notranslate"><span class="pre">_</span></code>。 （由 Tal Einat 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44010">bpo-44010</a> 中贡献。）</p>
<p>3.10 维护版本中的新内容。</p>
<p>Apply syntax highlighting to <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> files. (Contributed by Alex
Waygood and Terry Jan Reedy in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=45447">bpo-45447</a>.)</p>
<p>Include prompts when saving Shell with inputs and outputs.
(Contributed by Terry Jan Reedy in <a class="reference external" href="https://github.com/python/cpython/issues/95191">gh-95191</a>.)</p>
</section>
<section id="importlib-metadata">
<h3>importlib.metadata<a class="headerlink" href="#importlib-metadata" title="永久链接至标题">¶</a></h3>
<p>与 <code class="docutils literal notranslate"><span class="pre">importlib_metadata</span></code> 4.6（<a class="reference external" href="https://importlib-metadata.readthedocs.io/en/latest/history.html">history</a>）的功能一致。</p>
<p>现在 <a class="reference internal" href="../library/importlib.metadata.html#entry-points"><span class="std std-ref">importlib.metadata entry points</span></a> 通过一个新的 <code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.metadata.EntryPoints</span></code> 类，为由组和名称选择入口点提供了更好的体验。关于废弃之处和用法的更多信息，请参见文档中的兼容性说明。</p>
<p>添加了 <code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.metadata.packages_distributions()</span></code>，用于将顶级 Python 模块和包解析为其 <code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.metadata.Distributions</span></code>。</p>
</section>
<section id="inspect">
<h3>inspect<a class="headerlink" href="#inspect" title="永久链接至标题">¶</a></h3>
<p>若模块中没有定义 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> ，则回退至使用 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中贡献）</p>
<p>加入了 <a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a>，以便安全地对对象中定义的注解进行求值。<a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a> 也可以正确地解析字符串化的注解。 <a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a> 现在应是访问任何 Python 对象注解字典的最佳实践；关于注解最佳用法的更多信息，请参见 <a class="reference internal" href="../howto/annotations.html#annotations-howto"><span class="std std-ref">对象注解属性的最佳实践</span></a>。与之关联的， <a class="reference internal" href="../library/inspect.html#inspect.signature" title="inspect.signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.signature()</span></code></a> 、 <a class="reference internal" href="../library/inspect.html#inspect.Signature.from_callable" title="inspect.Signature.from_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.Signature.from_callable()</span></code></a> 和 <code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.Signature.from_function()</span></code> 现在也调用  <a class="reference internal" href="../library/inspect.html#inspect.get_annotations" title="inspect.get_annotations"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.get_annotations()</span></code></a> 来获取注解信息。这意味着 <a class="reference internal" href="../library/inspect.html#inspect.signature" title="inspect.signature"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.signature()</span></code></a> 和 <a class="reference internal" href="../library/inspect.html#inspect.Signature.from_callable" title="inspect.Signature.from_callable"><code class="xref py py-func docutils literal notranslate"><span class="pre">inspect.Signature.from_callable()</span></code></a> 现在也可以解析字符串化的注解了。（由 Larry Hastings 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43817">bpo-43817</a> 中贡献）</p>
</section>
<section id="itertools">
<h3>itertools<a class="headerlink" href="#itertools" title="永久链接至标题">¶</a></h3>
<p>添加了 <a class="reference internal" href="../library/itertools.html#itertools.pairwise" title="itertools.pairwise"><code class="xref py py-func docutils literal notranslate"><span class="pre">itertools.pairwise()</span></code></a> （由 Raymond Hettinger 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38200">bpo-38200</a> 中贡献。）</p>
</section>
<section id="linecache">
<h3>linecache<a class="headerlink" href="#linecache" title="永久链接至标题">¶</a></h3>
<p>若模块中没有定义 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> ，则回退至使用 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中贡献）</p>
</section>
<section id="os">
<h3>os<a class="headerlink" href="#os" title="永久链接至标题">¶</a></h3>
<p>为 VxWorks 实时操作系统加入 <a class="reference internal" href="../library/os.html#os.cpu_count" title="os.cpu_count"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.cpu_count()</span></code></a>  的支持。（由 Peixing Xin 在:issue:<cite>41440</cite> 中贡献）</p>
<p>加入一个新函数 <a class="reference internal" href="../library/os.html#os.eventfd" title="os.eventfd"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.eventfd()</span></code></a> 及其助手函数，以封装 Linux 的系统调用 <code class="docutils literal notranslate"><span class="pre">eventfd2</span></code> 。(由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41001">bpo-41001</a> 中贡献）</p>
<p>加入 <a class="reference internal" href="../library/os.html#os.splice" title="os.splice"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.splice()</span></code></a>，以便在两个文件描述符之间移动数据，而无需在内核地址空间和用户地址空间之间进行复制，其中一个文件描述符必须指向某个管道。（由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41625">bpo-41625</a> 中贡献）</p>
<p>为 macOS 加入 <a class="reference internal" href="../library/os.html#os.O_EVTONLY" title="os.O_EVTONLY"><code class="xref py py-data docutils literal notranslate"><span class="pre">O_EVTONLY</span></code></a> 、<a class="reference internal" href="../library/os.html#os.O_FSYNC" title="os.O_FSYNC"><code class="xref py py-data docutils literal notranslate"><span class="pre">O_FSYNC</span></code></a> 、 <a class="reference internal" href="../library/os.html#os.O_SYMLINK" title="os.O_SYMLINK"><code class="xref py py-data docutils literal notranslate"><span class="pre">O_SYMLINK</span></code></a> 和 <a class="reference internal" href="../library/os.html#os.O_NOFOLLOW_ANY" title="os.O_NOFOLLOW_ANY"><code class="xref py py-data docutils literal notranslate"><span class="pre">O_NOFOLLOW_ANY</span></code></a> 。（由 Dong-hee Na 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43106">bpo-43106</a> 中贡献）</p>
</section>
<section id="os-path">
<h3>os.path<a class="headerlink" href="#os-path" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/os.path.html#os.path.realpath" title="os.path.realpath"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.path.realpath()</span></code></a> 可接受一个关键字参数 <em>strict</em>。 若设为 <code class="docutils literal notranslate"><span class="pre">True</span></code> ，则在路径不存在或遭遇循环符号链接时，会触发 <a class="reference internal" href="../library/exceptions.html#OSError" title="OSError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OSError</span></code></a>。 （由 Barney Gale 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43757">bpo-43757</a> 中贡献。）</p>
</section>
<section id="pathlib">
<h3>pathlib<a class="headerlink" href="#pathlib" title="永久链接至标题">¶</a></h3>
<p>Add slice support to <a class="reference internal" href="../library/pathlib.html#pathlib.PurePath.parents" title="pathlib.PurePath.parents"><code class="xref py py-attr docutils literal notranslate"><span class="pre">PurePath.parents</span></code></a>.
(Contributed by Joshua Cannon in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35498">bpo-35498</a>.)</p>
<p>Add negative indexing support to <a class="reference internal" href="../library/pathlib.html#pathlib.PurePath.parents" title="pathlib.PurePath.parents"><code class="xref py py-attr docutils literal notranslate"><span class="pre">PurePath.parents</span></code></a>.
(Contributed by Yaroslav Pankovych in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=21041">bpo-21041</a>.)</p>
<p>加入 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.hardlink_to" title="pathlib.Path.hardlink_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Path.hardlink_to</span></code></a> 方法，取代 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.link_to" title="pathlib.Path.link_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">link_to()</span></code></a>。该新方法的参数顺序与 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.symlink_to" title="pathlib.Path.symlink_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">symlink_to()</span></code></a> 相同。（由 Barney Gale 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39950">bpo-39950</a> 中）</p>
<p>现在 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.stat" title="pathlib.Path.stat"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.stat()</span></code></a> 和 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.chmod" title="pathlib.Path.chmod"><code class="xref py py-meth docutils literal notranslate"><span class="pre">chmod()</span></code></a> 接受一个关键字参数 <em>follow_symlinks</em> ，以便与 <a class="reference internal" href="../library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code></a> 模块中的对应函数保持一致。（由  Barney Gale 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39906">bpo-39906</a> ）</p>
</section>
<section id="platform">
<h3>平台<a class="headerlink" href="#platform" title="永久链接至标题">¶</a></h3>
<p>Add <a class="reference internal" href="../library/platform.html#platform.freedesktop_os_release" title="platform.freedesktop_os_release"><code class="xref py py-func docutils literal notranslate"><span class="pre">platform.freedesktop_os_release()</span></code></a> to retrieve operation system
identification from <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/os-release.html">freedesktop.org os-release</a> standard file.
(Contributed by Christian Heimes in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=28468">bpo-28468</a>.)</p>
</section>
<section id="pprint">
<h3>pprint<a class="headerlink" href="#pprint" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/pprint.html#pprint.pprint" title="pprint.pprint"><code class="xref py py-func docutils literal notranslate"><span class="pre">pprint.pprint()</span></code></a> 接受一个新的关键字参数 <code class="docutils literal notranslate"><span class="pre">underscore_numbers</span></code>。（由 sblondon 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42914">bpo-42914</a> ）</p>
<p>现在 <a class="reference internal" href="../library/pprint.html#module-pprint" title="pprint: Data pretty printer."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pprint</span></code></a> 可以完美打印 <a class="reference internal" href="../library/dataclasses.html#dataclasses.dataclass" title="dataclasses.dataclass"><code class="xref py py-class docutils literal notranslate"><span class="pre">dataclasses.dataclass</span></code></a> 实例。（由 Lewis Gaul 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43080">bpo-43080</a> ）</p>
</section>
<section id="py-compile">
<h3>py_compile<a class="headerlink" href="#py-compile" title="永久链接至标题">¶</a></h3>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">py_compile'</span> <span class="pre">的命令行界面加入</span> <span class="pre">`</span></code>--quiet`` 选项。（由 Gregory Schevchenko 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38731">bpo-38731</a> ）</p>
</section>
<section id="pyclbr">
<h3>pyclbr<a class="headerlink" href="#pyclbr" title="永久链接至标题">¶</a></h3>
<p>在 <code class="xref py py-func docutils literal notranslate"><span class="pre">pyclbr.readline()</span></code> 和 <code class="xref py py-func docutils literal notranslate"><span class="pre">pyclbr.readline_ex()</span></code> 返回的结果树中的``Function`` 和 <code class="docutils literal notranslate"><span class="pre">Class</span></code> 对象上增加一个 <code class="docutils literal notranslate"><span class="pre">end_lineno</span></code> 属性。与现有的（开始）``lineno`` 相匹配。（由 Aviral Srivastava 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38307">bpo-38307</a>）</p>
</section>
<section id="shelve">
<h3>shelve<a class="headerlink" href="#shelve" title="永久链接至标题">¶</a></h3>
<p>现在 <a class="reference internal" href="../library/shelve.html#module-shelve" title="shelve: Python object persistence."><code class="xref py py-mod docutils literal notranslate"><span class="pre">shelve</span></code></a> 模块在创建打包时，默认采用 <a class="reference internal" href="../library/pickle.html#pickle.DEFAULT_PROTOCOL" title="pickle.DEFAULT_PROTOCOL"><code class="xref py py-data docutils literal notranslate"><span class="pre">pickle.DEFAULT_PROTOCOL</span></code></a>，而不是 <a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Convert Python objects to streams of bytes and back."><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> 协议 <code class="docutils literal notranslate"><span class="pre">3</span></code> 。（由 Zackery Spytz 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=34204">bpo-34204</a> ）</p>
</section>
<section id="statistics">
<h3>statistics<a class="headerlink" href="#statistics" title="永久链接至标题">¶</a></h3>
<p>加入 <a class="reference internal" href="../library/statistics.html#statistics.covariance" title="statistics.covariance"><code class="xref py py-func docutils literal notranslate"><span class="pre">covariance()</span></code></a> 、Pearson 的 <a class="reference internal" href="../library/statistics.html#statistics.correlation" title="statistics.correlation"><code class="xref py py-func docutils literal notranslate"><span class="pre">correlation()</span></code></a> 和简单的 <a class="reference internal" href="../library/statistics.html#statistics.linear_regression" title="statistics.linear_regression"><code class="xref py py-func docutils literal notranslate"><span class="pre">linear_regression()</span></code></a> 函数。（由 Tymoteusz Wołodźko 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38490">bpo-38490</a> ）</p>
</section>
<section id="site">
<h3>site<a class="headerlink" href="#site" title="永久链接至标题">¶</a></h3>
<p>若模块中没有定义 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> ，则回退至使用 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 。（由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42133">bpo-42133</a> 中贡献）</p>
</section>
<section id="socket">
<h3>socket<a class="headerlink" href="#socket" title="永久链接至标题">¶</a></h3>
<p>现在异常 <a class="reference internal" href="../library/socket.html#socket.timeout" title="socket.timeout"><code class="xref py py-exc docutils literal notranslate"><span class="pre">socket.timeout</span></code></a> 是 <a class="reference internal" href="../library/exceptions.html#TimeoutError" title="TimeoutError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TimeoutError</span></code></a> 的别名。（由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42413">bpo-42413</a> 中贡献。）</p>
<p>加入用 <code class="docutils literal notranslate"><span class="pre">IPPROTO_MPTCP</span></code> 创建 MPTCP 套接字的选项（由 Rui Cunha 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43571">bpo-43571</a> ）</p>
<p>加入 <code class="docutils literal notranslate"><span class="pre">IP_RECVTOS</span></code> 选项，以便接收服务类型（ToS）或 DSCP/ECN 字段（由 Georg Sauthoff 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44077">bpo-44077</a> ）</p>
</section>
<section id="ssl">
<h3>ssl<a class="headerlink" href="#ssl" title="永久链接至标题">¶</a></h3>
<p>ssl 模块要求 OpenSSL 1.1.1 或更新版本。 （由 Christian Heimes 在 <span class="target" id="index-105"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43669">bpo-43669</a> 中贡献。）</p>
<p>ssl 模块已初步支持 OpenSSL 3.0.0 和新选项 <a class="reference internal" href="../library/ssl.html#ssl.OP_IGNORE_UNEXPECTED_EOF" title="ssl.OP_IGNORE_UNEXPECTED_EOF"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_IGNORE_UNEXPECTED_EOF</span></code></a>。 （由 Christian Heimes 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38820">bpo-38820</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43794">bpo-43794</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43788">bpo-43788</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43791">bpo-43791</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43799">bpo-43799</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43920">bpo-43920</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43789">bpo-43789</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43811">bpo-43811</a> 中贡献。）</p>
<p>现在，已弃用函数和使用已弃用常量会导致 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.options" title="ssl.SSLContext.options"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ssl.SSLContext.options</span></code></a> 默认设置了 <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv2" title="ssl.OP_NO_SSLv2"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv2</span></code></a> 和 <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv3" title="ssl.OP_NO_SSLv3"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv3</span></code></a> ，因而设置此标记无法再次发出警告了。 <a class="reference internal" href="#whatsnew310-deprecated"><span class="std std-ref">弃用部分</span></a> 列出了已弃用的特性。 （由 Christian Heimes 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43880">bpo-43880</a> ）</p>
<p>现在，ssl 模块默认设置的安全性提高了。默认情况下，不具备前向安全性或 SHA-1 MAC 的加密算法会被禁用。二级安全禁止安全性低于 112 位的弱 RSA、DH 和 ECC 密钥。 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">SSLContext</span></code></a> 默认的最低版本协议为 TLS 1.2。这些设置是基于 Hynek Schlawack 的研究。（由 Christian Heimes 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43998">bpo-43998</a> ）</p>
<p>已弃用的协议 SSL 3.0, TLS 1.0 和 TLS 1.1 不再受到官方支持。Python 不会直接禁用。但 OpenSSL 编译选项、发行版配置、厂商补丁和加密套件可能会阻止握手成功。</p>
<p>为 <a class="reference internal" href="../library/ssl.html#ssl.get_server_certificate" title="ssl.get_server_certificate"><code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.get_server_certificate()</span></code></a> 函数加入 <em>timeout</em> 形参。（由 Zackery Spytz 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31870">bpo-31870</a> ）</p>
<p>ssl 模块用到了堆类型和多阶段初始化。（由 Christian Heimes 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42333">bpo-42333</a> ）</p>
<p>加入一个新的校验标记 <a class="reference internal" href="../library/ssl.html#ssl.VERIFY_X509_PARTIAL_CHAIN" title="ssl.VERIFY_X509_PARTIAL_CHAIN"><code class="xref py py-data docutils literal notranslate"><span class="pre">VERIFY_X509_PARTIAL_CHAIN</span></code></a>。（由 l0x 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40849">bpo-40849</a> ）</p>
</section>
<section id="sqlite3">
<h3>sqlite3<a class="headerlink" href="#sqlite3" title="永久链接至标题">¶</a></h3>
<p>为 <code class="xref py py-func docutils literal notranslate"><span class="pre">connect/handle()</span></code> 、 <a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.enable_load_extension" title="sqlite3.Connection.enable_load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">enable_load_extension()</span></code></a> 和 <a class="reference internal" href="../library/sqlite3.html#sqlite3.Connection.load_extension" title="sqlite3.Connection.load_extension"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_extension()</span></code></a> 加入审计事件。（由 Erlend E. Aasland 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43762">bpo-43762</a>）</p>
</section>
<section id="sys">
<h3>sys<a class="headerlink" href="#sys" title="永久链接至标题">¶</a></h3>
<p>加入了 <a class="reference internal" href="../library/sys.html#sys.orig_argv" title="sys.orig_argv"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.orig_argv</span></code></a> 属性：传给 Python 可执行文件的初始命令行参数列表。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=23427">bpo-23427</a> ）</p>
<p>添加了 <a class="reference internal" href="../library/sys.html#sys.stdlib_module_names" title="sys.stdlib_module_names"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdlib_module_names</span></code></a>，包含标准库模块名称的列表。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42955">bpo-42955</a> 中贡献。）</p>
</section>
<section id="thread">
<h3>_thread<a class="headerlink" href="#thread" title="永久链接至标题">¶</a></h3>
<p>现在， <a class="reference internal" href="../library/_thread.html#thread.interrupt_main" title="_thread.interrupt_main"><code class="xref py py-func docutils literal notranslate"><span class="pre">_thread.interrupt_main()</span></code></a> 接受一个可选的信号值参数进行模拟（默认仍为 <a class="reference internal" href="../library/signal.html#signal.SIGINT" title="signal.SIGINT"><code class="xref py py-data docutils literal notranslate"><span class="pre">signal.SIGINT</span></code></a>）。（由 Antoine Pitrou 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43356">bpo-43356</a> ）</p>
</section>
<section id="threading">
<h3>threading<a class="headerlink" href="#threading" title="永久链接至标题">¶</a></h3>
<p>加入 <a class="reference internal" href="../library/threading.html#threading.gettrace" title="threading.gettrace"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.gettrace()</span></code></a> 和 <a class="reference internal" href="../library/threading.html#threading.getprofile" title="threading.getprofile"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.getprofile()</span></code></a> ，分别用于获取 <a class="reference internal" href="../library/threading.html#threading.settrace" title="threading.settrace"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.settrace()</span></code></a> 和 <a class="reference internal" href="../library/threading.html#threading.setprofile" title="threading.setprofile"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.setprofile()</span></code></a> 设置的函数。（由Mario Corchero 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42251">bpo-42251</a> ）</p>
<p>加入 <a class="reference internal" href="../library/threading.html#threading.__excepthook__" title="threading.__excepthook__"><code class="xref py py-data docutils literal notranslate"><span class="pre">threading.__excepthook__</span></code></a> ，用于获取  <a class="reference internal" href="../library/threading.html#threading.excepthook" title="threading.excepthook"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.excepthook()</span></code></a> 的初始值，以防被设为一个差劲或其他的值。（由 Mario Corchero 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42308">bpo-42308</a> ）</p>
</section>
<section id="traceback">
<h3>traceback<a class="headerlink" href="#traceback" title="永久链接至标题">¶</a></h3>
<p>现在，<a class="reference internal" href="../library/traceback.html#traceback.format_exception" title="traceback.format_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception()</span></code></a> 、 <a class="reference internal" href="../library/traceback.html#traceback.format_exception_only" title="traceback.format_exception_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception_only()</span></code></a> 和 <a class="reference internal" href="../library/traceback.html#traceback.print_exception" title="traceback.print_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">print_exception()</span></code></a> 函数可以接受一个异常对象，作为唯一的位置参数。（由 Zackery Spytz 和 Matthias Bussonnier 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26389">bpo-26389</a>）</p>
</section>
<section id="types">
<h3>types<a class="headerlink" href="#types" title="永久链接至标题">¶</a></h3>
<p>重新引入 <a class="reference internal" href="../library/types.html#types.EllipsisType" title="types.EllipsisType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.EllipsisType</span></code></a> 、 <a class="reference internal" href="../library/types.html#types.NoneType" title="types.NoneType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.NoneType</span></code></a> 和 <a class="reference internal" href="../library/types.html#types.NotImplementedType" title="types.NotImplementedType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.NotImplementedType</span></code></a> 类，以提供一套新的类型，可供类型检查程序解释。（由 Bas van Beek 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41810">bpo-41810</a>）</p>
</section>
<section id="typing">
<h3>typing<a class="headerlink" href="#typing" title="永久链接至标题">¶</a></h3>
<p>主要的变化参阅 <a class="reference internal" href="#new-feat-related-type-hints"><span class="std std-ref">有关类型提示的新增特性</span></a> 。</p>
<p><a class="reference internal" href="../library/typing.html#typing.Literal" title="typing.Literal"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Literal</span></code></a> 的行为被改为遵循 <span class="target" id="index-106"></span><a class="pep reference external" href="https://peps.python.org/pep-0586/"><strong>PEP 586</strong></a> 并匹配该 PEP 所描述的静态类型检查器的行为。</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 现在将是去重后的形参。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 对象的相等性比较现在将与顺序无关。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Literal</span></code> 比较现在会考虑类型。 例如 <code class="docutils literal notranslate"><span class="pre">Literal[0]</span> <span class="pre">==</span> <span class="pre">Literal[False]</span></code> 之前的结果值为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。 现在则为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。 为支持此改变，内部使用的类型缓存现在也支持区分类型。</p></li>
<li><p>现在，如果 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 对象的任何参数都不是 <a class="reference internal" href="../glossary.html#term-hashable"><span class="xref std std-term">hashable</span></a> ，在相等性比较时将引发 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> 异常。请注意，在声明 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 时，参数不可哈希不会抛出错误：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Literal</span><span class="p">[{</span><span class="mi">0</span><span class="p">}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Literal</span><span class="p">[{</span><span class="mi">0</span><span class="p">}]</span> <span class="o">==</span> <span class="n">Literal</span><span class="p">[{</span><span class="kc">False</span><span class="p">}]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">TypeError</span>: <span class="n">unhashable type: &#39;set&#39;</span>
</pre></div>
</div>
</li>
</ol>
<p>（由 Yurii Karabas 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42345">bpo-42345</a> 中贡献。）</p>
<p>Add new function <a class="reference internal" href="../library/typing.html#typing.is_typeddict" title="typing.is_typeddict"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.is_typeddict()</span></code></a> to introspect if an annotation
is a <a class="reference internal" href="../library/typing.html#typing.TypedDict" title="typing.TypedDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.TypedDict</span></code></a>.
(Contributed by Patrick Reader in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41792">bpo-41792</a>.)</p>
<p>Subclasses of <code class="docutils literal notranslate"><span class="pre">typing.Protocol</span></code> which only have data variables declared
will now raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> when checked with <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> unless they
are decorated with <code class="xref py py-func docutils literal notranslate"><span class="pre">runtime_checkable()</span></code>.  Previously, these checks
passed silently.  Users should decorate their
subclasses with the <code class="xref py py-func docutils literal notranslate"><span class="pre">runtime_checkable()</span></code> decorator
if they want runtime protocols.
(Contributed by Yurii Karabas in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38908">bpo-38908</a>.)</p>
<p>Importing from the <code class="docutils literal notranslate"><span class="pre">typing.io</span></code> and <code class="docutils literal notranslate"><span class="pre">typing.re</span></code> submodules will now emit
<a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>.  These submodules have been deprecated since
Python 3.8 and will be removed in a future version of Python.  Anything
belonging to those submodules should be imported directly from
<a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> instead.
(Contributed by Sebastian Rittau in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38291">bpo-38291</a>.)</p>
</section>
<section id="unittest">
<h3>unittest<a class="headerlink" href="#unittest" title="永久链接至标题">¶</a></h3>
<p>加入新方法 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNoLogs" title="unittest.TestCase.assertNoLogs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNoLogs()</span></code></a> ，以补充现有的 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertLogs" title="unittest.TestCase.assertLogs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertLogs()</span></code></a>。（由 Kit Yan Choi 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39385">bpo-39385</a> ）</p>
</section>
<section id="urllib-parse">
<h3>urllib.parse<a class="headerlink" href="#urllib-parse" title="永久链接至标题">¶</a></h3>
<p>Python 3.10 以下版本允许在 <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.parse_qs" title="urllib.parse.parse_qs"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qs()</span></code></a> 和 <a class="reference internal" href="../library/urllib.parse.html#urllib.parse.parse_qsl" title="urllib.parse.parse_qsl"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.parse_qsl()</span></code></a> 中同时使用 <code class="docutils literal notranslate"><span class="pre">;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> 作为查询参数分隔符。出于安全考虑，并符合 W3C 最新的建议，这已经被修改为只允许用一种分隔符，默认值为 <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>。 这一改变也影响到了 <a class="reference internal" href="../library/cgi.html#cgi.parse" title="cgi.parse"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgi.parse()</span></code></a> 和 <a class="reference internal" href="../library/cgi.html#cgi.parse_multipart" title="cgi.parse_multipart"><code class="xref py py-func docutils literal notranslate"><span class="pre">cgi.parse_multipart()</span></code></a>，因为他们内部用到了这些函数。更多细节，请参阅各自的文档。（由 Adam Goldschmidt 、 Senthil Kumaran 和 Ken Jin 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42967">bpo-42967</a> ）</p>
</section>
<section id="xml">
<h3>xml<a class="headerlink" href="#xml" title="永久链接至标题">¶</a></h3>
<p>在 <a class="reference internal" href="../library/xml.sax.handler.html#module-xml.sax.handler" title="xml.sax.handler: Base classes for SAX event handlers."><code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.sax.handler</span></code></a> 模块中加入一个 <a class="reference internal" href="../library/xml.sax.handler.html#xml.sax.handler.LexicalHandler" title="xml.sax.handler.LexicalHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">LexicalHandler</span></code></a> 类。（由 Jonathan Gossage 和 Zackery Spytz 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35018">bpo-35018</a> ）</p>
</section>
<section id="zipimport">
<h3>zipimport<a class="headerlink" href="#zipimport" title="永久链接至标题">¶</a></h3>
<p>加入 <span class="target" id="index-107"></span><a class="pep reference external" href="https://peps.python.org/pep-0451/"><strong>PEP 451</strong></a> 相关的方法： <a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.find_spec" title="zipimport.zipimporter.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_spec()</span></code></a> 、<a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.create_module" title="zipimport.zipimporter.create_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">zipimport.zipimporter.create_module()</span></code></a> 和 <a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.exec_module" title="zipimport.zipimporter.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">zipimport.zipimporter.exec_module()</span></code></a>。（由 Brett Cannon 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42131">bpo-42131</a> ）</p>
<p>加入 <a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.invalidate_caches" title="zipimport.zipimporter.invalidate_caches"><code class="xref py py-meth docutils literal notranslate"><span class="pre">invalidate_caches()</span></code></a> 方法。（由 Desmond Cheong 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=14678">bpo-14678</a> ）</p>
</section>
</section>
<section id="optimizations">
<h2>性能优化<a class="headerlink" href="#optimizations" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>现在，构造函数 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-func docutils literal notranslate"><span class="pre">str()</span></code></a> 、 <a class="reference internal" href="../library/stdtypes.html#bytes" title="bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">bytes()</span></code></a> 和 <a class="reference internal" href="../library/stdtypes.html#bytearray" title="bytearray"><code class="xref py py-func docutils literal notranslate"><span class="pre">bytearray()</span></code></a> 速度更快了（小对象大约提速 30-40%）。（由 Serhiy Storchaka 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41334">bpo-41334</a> ）</p></li>
<li><p>现在， <a class="reference internal" href="../library/runpy.html#module-runpy" title="runpy: Locate and run Python modules without importing them first."><code class="xref py py-mod docutils literal notranslate"><span class="pre">runpy</span></code></a> 导入的模块变少了。<code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">module-name</span></code> 命令的启动时间平均加快 1.4 倍。在 Linux 上，Python 3.9 的 <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-I</span> <span class="pre">-m</span> <span class="pre">module-name</span></code> 导入了69个模块，而 Python 3.10 只导入了 51个模块（少了 18 个）。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41006">bpo-41006</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41718">bpo-41718</a>）</p></li>
<li><p>现在， <code class="docutils literal notranslate"><span class="pre">LOAD_ATTR</span></code> 指令会使用新的“单独操作码缓存”机制。对于常规属性大约会提速 36%，而对于槽位属性会加快 44%。（由 Pablo Galindo 和 Yury Selivanov 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42093">bpo-42093</a> ），并由 Guido van Rossum 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42927">bpo-42927</a>，基于最初在 PyPy 和 MicroPython 中实现的思路。）</p></li>
<li><p>现在，当用 <a class="reference internal" href="../using/configure.html#cmdoption-enable-optimizations"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-optimizations</span></code></a> 构建 Python 时，会在编译和链接命令行中添加 <code class="docutils literal notranslate"><span class="pre">-fno-semantic-interposition</span></code>。 这会让用带参数 <a class="reference internal" href="../using/configure.html#cmdoption-enable-shared"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-shared</span></code></a> 的  <code class="docutils literal notranslate"><span class="pre">gcc</span></code> 构建 Python 解释器时提速 30%。详情请参阅`这篇文章 &lt;<a class="reference external" href="https://developers.redhat.com/blog/2020/06/25/red-hat-enterprise-linux-8-2-brings-faster-python-3-8-run-speeds/">https://developers.redhat.com/blog/2020/06/25/red-hat-enterprise-linux-8-2-brings-faster-python-3-8-run-speeds/</a>&gt;`_ 。（由 Victor Stinner 和 Pablo Galindo 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38980">bpo-38980</a> ）</p></li>
<li><p><a class="reference internal" href="../library/bz2.html#module-bz2" title="bz2: Interfaces for bzip2 compression and decompression."><code class="xref py py-mod docutils literal notranslate"><span class="pre">bz2</span></code></a> / <a class="reference internal" href="../library/lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> / <a class="reference internal" href="../library/zlib.html#module-zlib" title="zlib: Low-level interface to compression and decompression routines compatible with gzip."><code class="xref py py-mod docutils literal notranslate"><span class="pre">zlib</span></code></a> 模块用了新的输出缓冲区管理代码，并在  <code class="docutils literal notranslate"><span class="pre">_compression.DecompressReader</span></code> 类中添加``.readall()`` 函数。现在，bz2 解压过程提速了 1.09 倍 ~ 1.17 倍，lzma 解压快了 1.20 倍 ~ 1.32 倍，<code class="docutils literal notranslate"><span class="pre">GzipFile.read(-1)</span></code> 快了 1.11 倍 ~ 1.18 倍。（由 Ma Lin 贡献，由 Gregory P. Smith 审查， <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41486">bpo-41486</a>）</p></li>
<li><p>When using stringized annotations, annotations dicts for functions are no longer
created when the function is created.  Instead, they are stored as a tuple of
strings, and the function object lazily converts this into the annotations dict
on demand.  This optimization cuts the CPU time needed to define an annotated
function by half.
(Contributed by Yurii Karabas and Inada Naoki in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42202">bpo-42202</a>.)</p></li>
<li><p>现在，子串搜索函数，如 <code class="docutils literal notranslate"><span class="pre">str1</span> <span class="pre">in</span> <span class="pre">str2</span></code> 和 <code class="docutils literal notranslate"><span class="pre">str2.find(str1)</span></code> ，有时会采用Crochemore &amp; Perrin的“二路归并”字符串搜索算法，以避免长字符串的二次检索行为。（由 Dennis Sweeney 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41972">bpo-41972</a> ）</p></li>
<li><p>Add micro-optimizations to <code class="docutils literal notranslate"><span class="pre">_PyType_Lookup()</span></code> to improve type attribute cache lookup
performance in the common case of cache hits. This makes the interpreter 1.04 times faster
on average. (Contributed by Dino Viehland in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43452">bpo-43452</a>.)</p></li>
<li><p>The following built-in functions now support the faster <span class="target" id="index-32"></span><a class="pep reference external" href="https://peps.python.org/pep-0590/"><strong>PEP 590</strong></a> vectorcall calling convention:
<a class="reference internal" href="../library/functions.html#map" title="map"><code class="xref py py-func docutils literal notranslate"><span class="pre">map()</span></code></a>, <a class="reference internal" href="../library/functions.html#filter" title="filter"><code class="xref py py-func docutils literal notranslate"><span class="pre">filter()</span></code></a>, <a class="reference internal" href="../library/functions.html#reversed" title="reversed"><code class="xref py py-func docutils literal notranslate"><span class="pre">reversed()</span></code></a>, <a class="reference internal" href="../library/functions.html#bool" title="bool"><code class="xref py py-func docutils literal notranslate"><span class="pre">bool()</span></code></a> and <a class="reference internal" href="../library/functions.html#float" title="float"><code class="xref py py-func docutils literal notranslate"><span class="pre">float()</span></code></a>.
(Contributed by Dong-hee Na and Jeroen Demeyer in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43575">bpo-43575</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43287">bpo-43287</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41922">bpo-41922</a>, <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41873">bpo-41873</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41870">bpo-41870</a>.)</p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">BZ2File</span></code> performance is improved by removing internal <code class="docutils literal notranslate"><span class="pre">RLock</span></code>.
This makes <code class="xref py py-class docutils literal notranslate"><span class="pre">BZ2File</span></code> thread unsafe in the face of multiple simultaneous
readers or writers, just like its equivalent classes in <a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a> and
<a class="reference internal" href="../library/lzma.html#module-lzma" title="lzma: A Python wrapper for the liblzma compression library."><code class="xref py py-mod docutils literal notranslate"><span class="pre">lzma</span></code></a> have always been.  (Contributed by Inada Naoki in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43785">bpo-43785</a>.)</p></li>
</ul>
</section>
<section id="deprecated">
<span id="whatsnew310-deprecated"></span><h2>弃用<a class="headerlink" href="#deprecated" title="永久链接至标题">¶</a></h2>
<ul>
<li><p>Currently Python accepts numeric literals immediately followed by keywords,
for example <code class="docutils literal notranslate"><span class="pre">0in</span> <span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">1or</span> <span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">0if</span> <span class="pre">1else</span> <span class="pre">2</span></code>.  It allows confusing
and ambiguous expressions like <code class="docutils literal notranslate"><span class="pre">[0x1for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code> (which can be
interpreted as <code class="docutils literal notranslate"><span class="pre">[0x1</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code> or <code class="docutils literal notranslate"><span class="pre">[0x1f</span> <span class="pre">or</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">y]</span></code>).  Starting in
this release, a deprecation warning is raised if the numeric literal is
immediately followed by one of keywords <a class="reference internal" href="../reference/expressions.html#and"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">and</span></code></a>, <a class="reference internal" href="../reference/compound_stmts.html#else"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">else</span></code></a>,
<a class="reference internal" href="../reference/compound_stmts.html#for"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">for</span></code></a>, <a class="reference internal" href="../reference/compound_stmts.html#if"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">if</span></code></a>, <a class="reference internal" href="../reference/expressions.html#in"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">in</span></code></a>, <a class="reference internal" href="../reference/expressions.html#is"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">is</span></code></a> and <a class="reference internal" href="../reference/expressions.html#or"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">or</span></code></a>.
In future releases it will be changed to syntax warning, and finally to
syntax error.
(Contributed by Serhiy Storchaka in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43833">bpo-43833</a>.)</p></li>
<li><p>本版本将开始发起一次协同任务，清理为兼容 Python 2.7 而保留的旧导入语义。 具体包括： <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_loader" title="importlib.abc.PathEntryFinder.find_loader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_loader()</span></code></a>/<a class="reference internal" href="../library/importlib.html#importlib.abc.Finder.find_module" title="importlib.abc.Finder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_module()</span></code></a> （被 <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_spec()</span></code> 取代）， <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.load_module" title="importlib.abc.Loader.load_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_module()</span></code></a> （被 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.exec_module" title="importlib.abc.Loader.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a> 取代）， <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.module_repr" title="importlib.abc.Loader.module_repr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">module_repr()</span></code></a> （将由导入系统处理）， <code class="docutils literal notranslate"><span class="pre">__package__</span></code> 属性 （被 <code class="docutils literal notranslate"><span class="pre">__spec__.parent</span></code> 取代）、 <code class="docutils literal notranslate"><span class="pre">__loader__</span></code> 属性（(被 <code class="docutils literal notranslate"><span class="pre">__spec__.loader</span></code> 取代）， 以及 <code class="docutils literal notranslate"><span class="pre">__cached__</span></code> 属性 （被 <code class="docutils literal notranslate"><span class="pre">__spec__.cached</span></code> 取代），都将逐渐被移除（还包括 <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> 中的其他类和方法）。 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a> 和/或 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 将在适当时刻触发，以助在过渡期内识别出那些需要更新的代码。</p></li>
<li><p>整个 <code class="docutils literal notranslate"><span class="pre">distutils</span></code> 命名空间已被弃用，并将在 Python 3.12 中被移除。 请参阅 <a class="reference internal" href="#distutils-deprecated"><span class="std std-ref">模块的变化</span></a> 一节了解更多信息。</p></li>
<li><p><a class="reference internal" href="../library/random.html#random.randrange" title="random.randrange"><code class="xref py py-func docutils literal notranslate"><span class="pre">random.randrange()</span></code></a> 的非整数参数已被弃用。 <a class="reference internal" href="../library/exceptions.html#ValueError" title="ValueError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> 已被弃用而应改用 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。（由 Serhiy Storchaka 和 Raymond Hettinger 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37319">bpo-37319</a> ）</p></li>
<li><p><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code class="xref py py-mod docutils literal notranslate"><span class="pre">importlib</span></code></a> 的各种 <code class="docutils literal notranslate"><span class="pre">load_module()</span></code> 方法自 Python 3.6 起就已被记录为弃用，现在还会触发 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。请改用 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.exec_module" title="importlib.abc.Loader.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a>。（由 Brett Cannon 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26131">bpo-26131</a> ）</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">zimport.zipimporter.load_module()</span></code> 已弃用并被 <a class="reference internal" href="../library/zipimport.html#zipimport.zipimporter.exec_module" title="zipimport.zipimporter.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a> 代替。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26131">bpo-26131</a> 中贡献。）</p></li>
<li><p>现在导入时使用 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.load_module" title="importlib.abc.Loader.load_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_module()</span></code></a> 会引发 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a> ，应改用 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.exec_module" title="importlib.abc.Loader.exec_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exec_module()</span></code></a>。 （由 Brett Cannon 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26131">bpo-26131</a> ）</p></li>
<li><p>现在导入系统使用 <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder.find_module" title="importlib.abc.MetaPathFinder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_module()</span></code></a> 和 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_module" title="importlib.abc.PathEntryFinder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_module()</span></code></a> 会引发 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a> 而应分别改用 <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder.find_spec" title="importlib.abc.MetaPathFinder.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_spec()</span></code></a> 和 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_spec" title="importlib.abc.PathEntryFinder.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_spec()</span></code></a>。 你可以使用 <a class="reference internal" href="../library/importlib.html#importlib.util.spec_from_loader" title="importlib.util.spec_from_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.spec_from_loader()</span></code></a> 来协助移植。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42134">bpo-42134</a> 中贡献。）</p></li>
<li><p>现在导入系统使用 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_loader" title="importlib.abc.PathEntryFinder.find_loader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_loader()</span></code></a> 会引发 <a class="reference internal" href="../library/exceptions.html#ImportWarning" title="ImportWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImportWarning</span></code></a> 而应改用 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_spec" title="importlib.abc.PathEntryFinder.find_spec"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_spec()</span></code></a>。 你可以使用 <a class="reference internal" href="../library/importlib.html#importlib.util.spec_from_loader" title="importlib.util.spec_from_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.spec_from_loader()</span></code></a> 来协助移植。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43672">bpo-43672</a> 中贡献。）</p></li>
<li><p>现在 <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder.find_module" title="importlib.abc.MetaPathFinder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_module()</span></code></a> ( <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.BuiltinImporter.find_module()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FrozenImporter.find_module()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.WindowsRegistryFinder.find_module()</span></code>, <a class="reference internal" href="../library/importlib.html#importlib.machinery.PathFinder.find_module" title="importlib.machinery.PathFinder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.PathFinder.find_module()</span></code></a>, <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder.find_module" title="importlib.abc.MetaPathFinder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder.find_module()</span></code></a>), <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_module" title="importlib.abc.PathEntryFinder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_module()</span></code></a> ( <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FileFinder.find_module()</span></code> ),  和 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder.find_loader" title="importlib.abc.PathEntryFinder.find_loader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder.find_loader()</span></code></a> ( <a class="reference internal" href="../library/importlib.html#importlib.machinery.FileFinder.find_loader" title="importlib.machinery.FileFinder.find_loader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FileFinder.find_loader()</span></code></a> ) 的各个实现会引发 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a> 并预定在 Python 3.12 中被移除（之前它们在 Python 3.4 中就被记录为已弃用）。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42135">bpo-42135</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/importlib.html#importlib.abc.Finder" title="importlib.abc.Finder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.Finder</span></code></a> 已被弃用 (包括它唯一的方法 <a class="reference internal" href="../library/importlib.html#importlib.abc.Finder.find_module" title="importlib.abc.Finder.find_module"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_module()</span></code></a>)。 <a class="reference internal" href="../library/importlib.html#importlib.abc.MetaPathFinder" title="importlib.abc.MetaPathFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.MetaPathFinder</span></code></a> 和 <a class="reference internal" href="../library/importlib.html#importlib.abc.PathEntryFinder" title="importlib.abc.PathEntryFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">importlib.abc.PathEntryFinder</span></code></a> 都不再继承该类。 用户应当改为继承这两个类中的一个。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42135">bpo-42135</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/imp.html#module-imp" title="imp: Access the implementation of the import statement. (已移除)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imp</span></code></a>, <a class="reference internal" href="../library/importlib.html#importlib.find_loader" title="importlib.find_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.find_loader()</span></code></a>, <code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.set_package_wrapper()</span></code>, <code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.set_loader_wrapper()</span></code>, <a class="reference internal" href="../library/importlib.html#importlib.util.module_for_loader" title="importlib.util.module_for_loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">importlib.util.module_for_loader()</span></code></a>, <a class="reference internal" href="../library/pkgutil.html#pkgutil.ImpImporter" title="pkgutil.ImpImporter"><code class="xref py py-class docutils literal notranslate"><span class="pre">pkgutil.ImpImporter</span></code></a> 和 <a class="reference internal" href="../library/pkgutil.html#pkgutil.ImpLoader" title="pkgutil.ImpLoader"><code class="xref py py-class docutils literal notranslate"><span class="pre">pkgutil.ImpLoader</span></code></a> 的弃用状态已被更新以将 Python 3.12 列为预定要移除它们的版本 (它们在之前的 Python 版本中已开始引发 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>)。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43720">bpo-43720</a> 中贡献。）.)</p></li>
<li><p>现在导入系统会先使用模块上的 <code class="docutils literal notranslate"><span class="pre">__spec__</span></code> 属性再回退到 <a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.module_repr" title="importlib.abc.Loader.module_repr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">module_repr()</span></code></a> 来使用模块的 <code class="docutils literal notranslate"><span class="pre">__repr__()</span></code> 方法。 对 <code class="docutils literal notranslate"><span class="pre">module_repr()</span></code> 的使用预定在 Python 3.12 中移除。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42137">bpo-42137</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../library/importlib.html#importlib.abc.Loader.module_repr" title="importlib.abc.Loader.module_repr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.abc.Loader.module_repr()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.FrozenLoader.module_repr()</span></code> 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">importlib.machinery.BuiltinLoader.module_repr()</span></code> 已被弃用并预定在 Python 3.12 中移除。 （由 Brett Cannon 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42136">bpo-42136</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sqlite3.OptimizedUnicode</span></code> 自 Python 3.3 起就被移出文档并设为过时，当时它是被设为 <a class="reference internal" href="../library/stdtypes.html#str" title="str"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> 的别名。 现在它已被弃用，预定在 Python 3.12 中移除。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42264">bpo-42264</a> 中贡献。）</p></li>
<li><p>现在如果没有正在运行的事件循环则 <a class="reference internal" href="../library/asyncio-eventloop.html#asyncio.get_event_loop" title="asyncio.get_event_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.get_event_loop()</span></code></a> 会发出弃用警告。 未来它将成为 <a class="reference internal" href="../library/asyncio-eventloop.html#asyncio.get_running_loop" title="asyncio.get_running_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_running_loop()</span></code></a> 的别名。 如果没有正在运行的事件循环并且没有显式地向 <a class="reference internal" href="../library/asyncio-future.html#asyncio.ensure_future" title="asyncio.ensure_future"><code class="xref py py-func docutils literal notranslate"><span class="pre">ensure_future()</span></code></a>, <a class="reference internal" href="../library/asyncio-future.html#asyncio.wrap_future" title="asyncio.wrap_future"><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap_future()</span></code></a>, <a class="reference internal" href="../library/asyncio-task.html#asyncio.gather" title="asyncio.gather"><code class="xref py py-func docutils literal notranslate"><span class="pre">gather()</span></code></a>, <a class="reference internal" href="../library/asyncio-task.html#asyncio.shield" title="asyncio.shield"><code class="xref py py-func docutils literal notranslate"><span class="pre">shield()</span></code></a>, <a class="reference internal" href="../library/asyncio-task.html#asyncio.as_completed" title="asyncio.as_completed"><code class="xref py py-func docutils literal notranslate"><span class="pre">as_completed()</span></code></a> 以及 <a class="reference internal" href="../library/asyncio-future.html#asyncio.Future" title="asyncio.Future"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a>, <a class="reference internal" href="../library/asyncio-task.html#asyncio.Task" title="asyncio.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">Task</span></code></a>, <a class="reference internal" href="../library/asyncio-stream.html#asyncio.StreamReader" title="asyncio.StreamReader"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReaderProtocol</span></code> 的构造器传入 <em>loop</em> 参数则隐式地创建 <a class="reference internal" href="../library/asyncio-future.html#asyncio.Future" title="asyncio.Future"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a> 或 <a class="reference internal" href="../library/asyncio-task.html#asyncio.Task" title="asyncio.Task"><code class="xref py py-class docutils literal notranslate"><span class="pre">Task</span></code></a> 对象的 <a class="reference internal" href="../library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 函数也会发出弃用警告。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39529">bpo-39529</a> 中贡献。）</p></li>
<li><p>未记入文档的内置函数 <code class="docutils literal notranslate"><span class="pre">sqlite3.enable_shared_cache</span></code> 现在已被弃用，预定在 Python 3.12 中移除。 SQLite3 强烈不建议使用它。  请参阅 <a class="reference external" href="https://sqlite.org/c3ref/enable_shared_cache.html">SQLite3 文档</a> 了解详情。  如果必须要使用共享缓冲区，请使用 <code class="docutils literal notranslate"><span class="pre">cache=shared</span></code> 查询参数来以 URI 模式打开数据库。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=24464">bpo-24464</a> 中贡献。）</p></li>
<li><p>以下 <code class="docutils literal notranslate"><span class="pre">threading</span></code> 方法已被弃用:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">threading.currentThread</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.current_thread" title="threading.current_thread"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.current_thread()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.activeCount</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.active_count" title="threading.active_count"><code class="xref py py-func docutils literal notranslate"><span class="pre">threading.active_count()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Condition.notifyAll</span></code> =&gt;
<a class="reference internal" href="../library/threading.html#threading.Condition.notify_all" title="threading.Condition.notify_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Condition.notify_all()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Event.isSet</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Event.is_set" title="threading.Event.is_set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">threading.Event.is_set()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Thread.setName</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.name" title="threading.Thread.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.name</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.thread.getName</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.name" title="threading.Thread.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.name</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Thread.isDaemon</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.daemon" title="threading.Thread.daemon"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.daemon</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threading.Thread.setDaemon</span></code> =&gt; <a class="reference internal" href="../library/threading.html#threading.Thread.daemon" title="threading.Thread.daemon"><code class="xref py py-attr docutils literal notranslate"><span class="pre">threading.Thread.daemon</span></code></a></p></li>
</ul>
<p>(Contributed by Jelle Zijlstra in <a class="reference external" href="https://github.com/python/cpython/issues/87889">gh-87889</a>.)</p>
</li>
<li><p><a class="reference internal" href="../library/pathlib.html#pathlib.Path.link_to" title="pathlib.Path.link_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.link_to()</span></code></a> 已被弃用并预定在 Python 3.12 中移除。 请改用 <a class="reference internal" href="../library/pathlib.html#pathlib.Path.hardlink_to" title="pathlib.Path.hardlink_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pathlib.Path.hardlink_to()</span></code></a>。 （由 Barney Gale 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39950">bpo-39950</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cgi.log()</span></code> 已被弃用并预定在 Python 3.12 中移除。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41139">bpo-41139</a> 中贡献。）</p></li>
<li><p>以下 <a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ssl</span></code></a> 特性自 Python 3.6, Python 3.7 或 OpenSSL 1.1.0 起已被弃用并将在 3.11 中移除:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv2" title="ssl.OP_NO_SSLv2"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv2</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_SSLv3" title="ssl.OP_NO_SSLv3"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_SSLv3</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_TLSv1" title="ssl.OP_NO_TLSv1"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_TLSv1_1" title="ssl.OP_NO_TLSv1_1"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1_1</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_TLSv1_2" title="ssl.OP_NO_TLSv1_2"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1_2</span></code></a> 及 <a class="reference internal" href="../library/ssl.html#ssl.OP_NO_TLSv1_3" title="ssl.OP_NO_TLSv1_3"><code class="xref py py-data docutils literal notranslate"><span class="pre">OP_NO_TLSv1_3</span></code></a> 会被 <code class="xref py py-attr docutils literal notranslate"><span class="pre">sslSSLContext.minimum_version</span></code> 和 <code class="xref py py-attr docutils literal notranslate"><span class="pre">sslSSLContext.maximum_version</span></code> 代替。</p></li>
<li><p><a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_SSLv2" title="ssl.PROTOCOL_SSLv2"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_SSLv2</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_SSLv3" title="ssl.PROTOCOL_SSLv3"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_SSLv3</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_SSLv23" title="ssl.PROTOCOL_SSLv23"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_SSLv23</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLSv1" title="ssl.PROTOCOL_TLSv1"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLSv1</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLSv1_1" title="ssl.PROTOCOL_TLSv1_1"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLSv1_1</span></code></a>, <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLSv1_2" title="ssl.PROTOCOL_TLSv1_2"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLSv1_2</span></code></a> 及 <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLS" title="ssl.PROTOCOL_TLS"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLS</span></code></a> 已被弃用并会被 <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLS_CLIENT" title="ssl.PROTOCOL_TLS_CLIENT"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLS_CLIENT</span></code></a> 和 <a class="reference internal" href="../library/ssl.html#ssl.PROTOCOL_TLS_SERVER" title="ssl.PROTOCOL_TLS_SERVER"><code class="xref py py-data docutils literal notranslate"><span class="pre">PROTOCOL_TLS_SERVER</span></code></a> 代替</p></li>
<li><p><a class="reference internal" href="../library/ssl.html#ssl.wrap_socket" title="ssl.wrap_socket"><code class="xref py py-func docutils literal notranslate"><span class="pre">wrap_socket()</span></code></a> 会被 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.wrap_socket()</span></code></a> 代替</p></li>
<li><p><a class="reference internal" href="../library/ssl.html#ssl.match_hostname" title="ssl.match_hostname"><code class="xref py py-func docutils literal notranslate"><span class="pre">match_hostname()</span></code></a></p></li>
<li><p><a class="reference internal" href="../library/ssl.html#ssl.RAND_pseudo_bytes" title="ssl.RAND_pseudo_bytes"><code class="xref py py-func docutils literal notranslate"><span class="pre">RAND_pseudo_bytes()</span></code></a>, <code class="xref py py-func docutils literal notranslate"><span class="pre">RAND_egd()</span></code></p></li>
<li><p>NPN 特性如 <a class="reference internal" href="../library/ssl.html#ssl.SSLSocket.selected_npn_protocol" title="ssl.SSLSocket.selected_npn_protocol"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLSocket.selected_npn_protocol()</span></code></a> 和 <a class="reference internal" href="../library/ssl.html#ssl.SSLContext.set_npn_protocols" title="ssl.SSLContext.set_npn_protocols"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ssl.SSLContext.set_npn_protocols()</span></code></a> 会被 ALPN 代替。</p></li>
</ul>
</li>
<li><p>线程调试 (<span class="target" id="index-108"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONTHREADDEBUG"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONTHREADDEBUG</span></code></a> 环境变量) 在 Python 3.10 中已被弃用并将在 Python 3.12 中移除。 此特性需要 <a class="reference internal" href="../using/configure.html#debug-build"><span class="std std-ref">Python 的调试编译版</span></a>。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=44584">bpo-44584</a> 中贡献。）</p></li>
<li><p>Importing from the <code class="docutils literal notranslate"><span class="pre">typing.io</span></code> and <code class="docutils literal notranslate"><span class="pre">typing.re</span></code> submodules will now emit
<a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>.  These submodules will be removed in a future version
of Python.  Anything belonging to these submodules should be imported directly
from <a class="reference internal" href="../library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> instead.
(Contributed by Sebastian Rittau in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=38291">bpo-38291</a>.)</p></li>
</ul>
</section>
<section id="removed">
<span id="whatsnew310-removed"></span><h2>移除<a class="headerlink" href="#removed" title="永久链接至标题">¶</a></h2>
<ul>
<li><p>移除了 <a class="reference internal" href="../library/functions.html#complex" title="complex"><code class="xref py py-class docutils literal notranslate"><span class="pre">complex</span></code></a> 类的特殊方法 <code class="docutils literal notranslate"><span class="pre">__int__</span></code>, <code class="docutils literal notranslate"><span class="pre">__float__</span></code>, <code class="docutils literal notranslate"><span class="pre">__floordiv__</span></code>, <code class="docutils literal notranslate"><span class="pre">__mod__</span></code>, <code class="docutils literal notranslate"><span class="pre">__divmod__</span></code>, <code class="docutils literal notranslate"><span class="pre">__rfloordiv__</span></code>, <code class="docutils literal notranslate"><span class="pre">__rmod__</span></code> 和 <code class="docutils literal notranslate"><span class="pre">__rdivmod__</span></code>。 它们总是会引发 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a>。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41974">bpo-41974</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ParserBase.error()</span></code> 方法（来自私有且未记入文档的 <code class="docutils literal notranslate"><span class="pre">_markupbase</span></code> 模块）已被移除。 <a class="reference internal" href="../library/html.parser.html#html.parser.HTMLParser" title="html.parser.HTMLParser"><code class="xref py py-class docutils literal notranslate"><span class="pre">html.parser.HTMLParser</span></code></a> 是 <code class="docutils literal notranslate"><span class="pre">ParserBase</span></code> 的唯一子类并且它的 <code class="docutils literal notranslate"><span class="pre">error()</span></code> 实现在 Python 3.5 中已被移除。 （由 Berker Peksag 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=31844">bpo-31844</a> 中贡献。）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">unicodedata.ucnhash_CAPI</span></code> 属性，它是一个内部 PyCapsule 对象。 相关联的私有 <code class="docutils literal notranslate"><span class="pre">_PyUnicode_Name_CAPI</span></code> 结构体已被移至内部 C API。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42157">bpo-42157</a> 中贡献。）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">parser</span></code> 模块，它在 3.9 中由于切换到新的 PEG 解析器而与仅被旧解析器所使用的 C 源文件和头文件一起被弃用，包括 <code class="docutils literal notranslate"><span class="pre">node.h</span></code>, <code class="docutils literal notranslate"><span class="pre">parser.h</span></code>, <code class="docutils literal notranslate"><span class="pre">graminit.h</span></code> 和 <code class="docutils literal notranslate"><span class="pre">grammar.h</span></code>。</p></li>
<li><p>移除了公有 C API 函数 <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlags</span></code>, <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlagsFilename</span></code>, <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseFileFlags</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyNode_Compile</span></code>，它们在 3.9 中由于切换到新的 PEG 解析器而被弃用。</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">formatter</span></code> 模块，它在 Python 3.4 中已被弃用。 它相当过时、极少被使用，并且未经测试。 它最初计划在 Python 3.6 中移除，但此移除被改为延迟到 Python 2.7 生命期结束之后。 现有用户应当将他们用到的所有类都拷贝到自己的代码中。 （由 Dong-hee Na 和 Terry J. Reedy 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42299">bpo-42299</a> 中贡献。）</p></li>
<li><p>移除了 <code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_GetWarningsModule()</span></code> 函数，现在它由于 _warnings 模块在 2.6 中被转换为内置模块而变得没有用处。 （由 Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42599">bpo-42599</a> 中贡献。）</p></li>
<li><p>从 <a class="reference internal" href="../library/collections.html#module-collections" title="collections: Container datatypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections</span></code></a> 模块中移除了已被弃用的 <a class="reference internal" href="../library/collections.abc.html#collections-abstract-base-classes"><span class="std std-ref">容器抽象基类</span></a> 的别名。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=37324">bpo-37324</a> 中贡献。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loop</span></code> 形参已从大部分 <a class="reference internal" href="../library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> 的 <a class="reference internal" href="../library/asyncio-api-index.html"><span class="doc">高层级 API</span></a> 中被移除，之前它们在 Python 3.8 中已被弃用。 这一改变的动机是多方面的:</p>
<ol class="arabic simple">
<li><p>这简化了高层级 API。</p></li>
<li><p>高层级 API 中的这些函数自 Python 3.7 起已经会隐式地获取当前线程正在运行的事件循环。 在大多数正常使用场景中都没有必要向 API 传入事件循环。</p></li>
<li><p>在处理不同线程中运行的事件循环时传递事件循环特别容易产生错误。</p></li>
</ol>
<p>请注意低层级 API 仍将接受 <code class="docutils literal notranslate"><span class="pre">loop</span></code>。 请参阅 <a class="reference internal" href="#changes-python-api"><span class="std std-ref">Python API 的变化</span></a> 来获取有关如何替换现有代码的示例。</p>
<p>（由 Yurii Karabas, Andrew Svetlov, Yury Selivanov 和 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42392">bpo-42392</a> 中贡献。）</p>
</li>
</ul>
</section>
<section id="porting-to-python-3-10">
<h2>移植到 Python 3.10<a class="headerlink" href="#porting-to-python-3-10" title="永久链接至标题">¶</a></h2>
<p>本节列出了先前描述的更改以及可能需要更改代码的其他错误修正.</p>
<section id="changes-in-the-python-syntax">
<h3>Python 语法中的变化<a class="headerlink" href="#changes-in-the-python-syntax" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>Deprecation warning is now emitted when compiling previously valid syntax
if the numeric literal is immediately followed by a keyword (like in <code class="docutils literal notranslate"><span class="pre">0in</span> <span class="pre">x</span></code>).
In future releases it will be changed to syntax warning, and finally to a
syntax error.  To get rid of the warning and make the code compatible with
future releases just add a space between the numeric literal and the
following keyword.
(Contributed by Serhiy Storchaka in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43833">bpo-43833</a>.)</p></li>
</ul>
</section>
<section id="changes-in-the-python-api">
<span id="changes-python-api"></span><h3>Python API 的变化<a class="headerlink" href="#changes-in-the-python-api" title="永久链接至标题">¶</a></h3>
<ul>
<li><p><a class="reference internal" href="../library/traceback.html#module-traceback" title="traceback: Print or retrieve a stack traceback."><code class="xref py py-mod docutils literal notranslate"><span class="pre">traceback</span></code></a> 模块中的 <a class="reference internal" href="../library/traceback.html#traceback.format_exception" title="traceback.format_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception()</span></code></a> 、 <a class="reference internal" href="../library/traceback.html#traceback.format_exception_only" title="traceback.format_exception_only"><code class="xref py py-func docutils literal notranslate"><span class="pre">format_exception_only()</span></code></a> 和 <a class="reference internal" href="../library/traceback.html#traceback.print_exception" title="traceback.print_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">print_exception()</span></code></a> 函数的 <em>etype</em> 参数已更名为 <em>exc</em> 。（由 Zackery Spytz 和 Matthias Bussonnier 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26389">bpo-26389</a> ）</p></li>
<li><p><a class="reference internal" href="../library/atexit.html#module-atexit" title="atexit: Register and execute cleanup functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">atexit</span></code></a> ： 在 Python 退出时，若用 <a class="reference internal" href="../library/atexit.html#atexit.register" title="atexit.register"><code class="xref py py-func docutils literal notranslate"><span class="pre">atexit.register()</span></code></a> 注册的回调失败，现在会记录其异常。以前，只有部分异常被记录，最后一个异常总是被静默忽略。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42639">bpo-42639</a> ）</p></li>
<li><p>现在，泛型 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 的类型参数扁平化了，类似于  <a class="reference internal" href="../library/typing.html#typing.Callable" title="typing.Callable"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Callable</span></code></a> 目前的做法。这意味着 <code class="docutils literal notranslate"><span class="pre">collections.abc.Callable[[int,</span> <span class="pre">str],</span> <span class="pre">str]</span></code> 的 <code class="docutils literal notranslate"><span class="pre">__args__</span></code> 将为 <code class="docutils literal notranslate"><span class="pre">(int,</span> <span class="pre">str,</span> <span class="pre">str)</span></code>；而以前是 <code class="docutils literal notranslate"><span class="pre">([int,</span> <span class="pre">str],</span> <span class="pre">str)</span></code>。 通过 <a class="reference internal" href="../library/typing.html#typing.get_args" title="typing.get_args"><code class="xref py py-func docutils literal notranslate"><span class="pre">typing.get_args()</span></code></a> 或 <code class="docutils literal notranslate"><span class="pre">__args__</span></code> 访问参数的代码需要考虑到这一变化。此外，为 <a class="reference internal" href="../library/collections.abc.html#collections.abc.Callable" title="collections.abc.Callable"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Callable</span></code></a> 给出无效参数可能会引发 <a class="reference internal" href="../library/exceptions.html#TypeError" title="TypeError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">TypeError</span></code></a> ，而在 Python 3.9 中则可能会静默传入。（由 Ken Jin 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42195">bpo-42195</a>）</p></li>
<li><p>现在，如果给定的形参不是 16 位无符号整数， <a class="reference internal" href="../library/socket.html#socket.htons" title="socket.htons"><code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.htons()</span></code></a> 和 <a class="reference internal" href="../library/socket.html#socket.ntohs" title="socket.ntohs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">socket.ntohs()</span></code></a> 会引发 <a class="reference internal" href="../library/exceptions.html#OverflowError" title="OverflowError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">OverflowError</span></code></a> 而非 <a class="reference internal" href="../library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>。 （由 Erlend E. Aasland 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42393">bpo-42393</a> 中贡献。）</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">loop</span></code> parameter has been removed from most of <a class="reference internal" href="../library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a>'s
<a class="reference internal" href="../library/asyncio-api-index.html"><span class="doc">high-level API</span></a> following deprecation
in Python 3.8.</p>
<p>现在如下协程：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">loop</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
</pre></div>
</div>
<p>应替换为：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">foo()</span></code> 被特别设计成 <em>不</em> 运行于当前线程的运行事件循环中（比如运行在另一个线程的事件循环中），请考虑使用 <a class="reference internal" href="../library/asyncio-task.html#asyncio.run_coroutine_threadsafe" title="asyncio.run_coroutine_threadsafe"><code class="xref py py-func docutils literal notranslate"><span class="pre">asyncio.run_coroutine_threadsafe()</span></code></a> 来代替。</p>
<p>（由 Yurii Karabas, Andrew Svetlov, Yury Selivanov 和 Kyle Stanley 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42392">bpo-42392</a> 中贡献。）</p>
</li>
<li><p>如果 <em>globals</em> 字典中没有 <code class="docutils literal notranslate"><span class="pre">&quot;__builtins__&quot;</span></code> 键，那么 <a class="reference internal" href="../library/types.html#types.FunctionType" title="types.FunctionType"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.FunctionType</span></code></a> 构造器现在将继承当前值，而不是用 <code class="docutils literal notranslate"><span class="pre">{&quot;None&quot;:</span> <span class="pre">None}</span></code>，这与 <a class="reference internal" href="../library/functions.html#eval" title="eval"><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code></a> 和 <a class="reference internal" href="../library/functions.html#exec" title="exec"><code class="xref py py-func docutils literal notranslate"><span class="pre">exec()</span></code></a> 函数一致。 利用 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">function(...):</span> <span class="pre">...</span></code> 定义一个 Python 函数则不受影响，globals 无法被这种语法覆盖：它也是继承了当前值。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42990">bpo-42990</a> 中贡献。）</p></li>
</ul>
</section>
<section id="changes-in-the-c-api">
<h3>C API 的变化<a class="headerlink" href="#changes-in-the-c-api" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>由于换成了新的 PEG 解析程序，C 语言 API 函数``PyParser_SimpleParseStringFlags``、<code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlagsFilename</span></code>、<code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseFileFlags</span></code>、<code class="docutils literal notranslate"><span class="pre">PyNode_Compile``以及这些函数用到的类型</span> <span class="pre">``struct</span> <span class="pre">_node</span></code> 已被删除。</p>
<p>现在应该用 <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a> 将源代码直接编译为代码对象。然后可以用 <a class="reference internal" href="../c-api/veryhigh.html#c.PyEval_EvalCode" title="PyEval_EvalCode"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyEval_EvalCode()</span></code></a> 之类的东西来对其求值。</p>
<p>特别地：</p>
<ul>
<li><p>先 <code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseStringFlags</span></code> 再 <code class="docutils literal notranslate"><span class="pre">PyNode_Compile</span></code> 的调用，可以由 <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a> 代替。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_SimpleParseFileFlags</span></code> 没有直接替代品。要从 <code class="docutils literal notranslate"><span class="pre">FILE</span> <span class="pre">*</span></code> 参数编译代码，需要先用 C 语言读取文件，然后将结果缓冲区传给  <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a>。</p></li>
<li><p>要编译一个 <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*</span></code> 给定文件名的文件，先显式打开该文件，再读取并进行编译。一种方法是利用 <a class="reference internal" href="../library/io.html#module-io" title="io: Core tools for working with streams."><code class="xref py py-mod docutils literal notranslate"><span class="pre">io</span></code></a> 模块的 <a class="reference internal" href="../c-api/import.html#c.PyImport_ImportModule" title="PyImport_ImportModule"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyImport_ImportModule()</span></code></a> 、 <a class="reference internal" href="../c-api/call.html#c.PyObject_CallMethod" title="PyObject_CallMethod"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyObject_CallMethod()</span></code></a> 、 <a class="reference internal" href="../c-api/bytes.html#c.PyBytes_AsString" title="PyBytes_AsString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyBytes_AsString()</span></code></a> 和 <a class="reference internal" href="../c-api/veryhigh.html#c.Py_CompileString" title="Py_CompileString"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_CompileString()</span></code></a>，如下图所示。（省略了声明和错误处理部分）</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">io_module</span> <span class="o">=</span> <span class="n">Import_ImportModule</span><span class="p">(</span><span class="s2">&quot;io&quot;</span><span class="p">);</span>
<span class="n">fileobject</span> <span class="o">=</span> <span class="n">PyObject_CallMethod</span><span class="p">(</span><span class="n">io_module</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;ss&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">);</span>
<span class="n">source_bytes_object</span> <span class="o">=</span> <span class="n">PyObject_CallMethod</span><span class="p">(</span><span class="n">fileobject</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">PyObject_CallMethod</span><span class="p">(</span><span class="n">fileobject</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="n">source_buf</span> <span class="o">=</span> <span class="n">PyBytes_AsString</span><span class="p">(</span><span class="n">source_bytes_object</span><span class="p">);</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">Py_CompileString</span><span class="p">(</span><span class="n">source_buf</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">Py_file_input</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>对于 <code class="docutils literal notranslate"><span class="pre">FrameObject</span></code> 对象， <code class="docutils literal notranslate"><span class="pre">f_lasti</span></code> 成员现在代表一个字码偏移，而不是字节码字符串的简单偏移。这意味着这个数字需要乘以 2 才能用于期望用字节偏移的 API （例如 <a class="reference internal" href="../c-api/code.html#c.PyCode_Addr2Line" title="PyCode_Addr2Line"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCode_Addr2Line()</span></code></a> ）。也请注意， <code class="docutils literal notranslate"><span class="pre">FrameObject</span></code> 对象的 <code class="docutils literal notranslate"><span class="pre">f_lasti</span></code> 成员不被认为是稳定的：请使用  <a class="reference internal" href="../c-api/frame.html#c.PyFrame_GetLineNumber" title="PyFrame_GetLineNumber"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyFrame_GetLineNumber()</span></code></a> 代替。</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="cpython-bytecode-changes">
<h2>CPython 字节码的改变<a class="headerlink" href="#cpython-bytecode-changes" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">MAKE_FUNCTION</span></code> instruction now accepts either a dict or a tuple of
strings as the function's annotations.
(Contributed by Yurii Karabas and Inada Naoki in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42202">bpo-42202</a>.)</p></li>
</ul>
</section>
<section id="build-changes">
<h2>编译版的变化<a class="headerlink" href="#build-changes" title="永久链接至标题">¶</a></h2>
<ul>
<li><p><span class="target" id="index-109"></span><a class="pep reference external" href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a> ：Python 现在要求 OpenSSL 1.1.1 以上版本。不再支持 OpenSSL 1.0.2。（由 Christian Heimes 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43669">bpo-43669</a> ）</p></li>
<li><p>编译 Python 现在需要用到 C99 函数 <code class="xref c c-func docutils literal notranslate"><span class="pre">snprintf()</span></code> 和 <code class="xref c c-func docutils literal notranslate"><span class="pre">vsnprintf()</span></code> 。(由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36020">bpo-36020</a> ）</p></li>
<li><p><a class="reference internal" href="../library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlite3</span></code></a> 需要 SQLite 3.7.15 以上版本。（由 Sergey Fedoseev 和 Erlend E. Aasland 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40744">bpo-40744</a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40810">bpo-40810</a> ）</p></li>
<li><p>现在， <a class="reference internal" href="../library/atexit.html#module-atexit" title="atexit: Register and execute cleanup functions."><code class="xref py py-mod docutils literal notranslate"><span class="pre">atexit</span></code></a> 模块必须编译为内置模块。（由 Victor Stinner 贡献于  <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42639">bpo-42639</a> ）</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">configure</span></code> 脚本中加入 <a class="reference internal" href="../using/configure.html#cmdoption-disable-test-modules"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disable-test-modules</span></code></a> 选项：不编译也不安装 test 模块。（由 Xavier de Gaye、Thomas Petazzoni 和 Peixing Xin 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=27640">bpo-27640</a>）</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">./configure</span></code> 脚本中加入 <a class="reference internal" href="../using/configure.html#cmdoption-with-wheel-pkg-dir"><code class="xref std std-option docutils literal notranslate"><span class="pre">--with-wheel-pkg-dir=PATH</span> <span class="pre">选项</span></code></a>。如果指定了该选项， <a class="reference internal" href="../library/ensurepip.html#module-ensurepip" title="ensurepip: Bootstrapping the &quot;pip&quot; installer into an existing Python installation or virtual environment."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ensurepip</span></code></a> 模块会在该目录下查找 <code class="docutils literal notranslate"><span class="pre">setuptools</span></code> 和 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 包：如果两者都存在，就会使用这些包，而不是surepip 绑定的包。</p>
<p>某些 Linux 发行版的打包策略建议不要绑定依赖关系。比如 Fedora 在``/usr/share/python-wheels/`` 目录下安装 wheel 包，而不安装``ensurepip._bundled`` 包。</p>
<p>（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42856">bpo-42856</a>）</p>
</li>
<li><p>增加了新的 <a class="reference internal" href="../using/configure.html#cmdoption-without-static-libpython"><code class="xref std std-option docutils literal notranslate"><span class="pre">configure</span> <span class="pre">--without-static-libpython</span> <span class="pre">选项</span></code></a> ，用于标明不编译 <code class="docutils literal notranslate"><span class="pre">libpythonMAJOR.MINOR.a</span></code> 静态库并且不安装 <code class="docutils literal notranslate"><span class="pre">python.o</span></code> 对象文件。</p>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43103">bpo-43103</a> 中贡献。）</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">configure</span></code> script now uses the <code class="docutils literal notranslate"><span class="pre">pkg-config</span></code> utility, if available,
to detect the location of Tcl/Tk headers and libraries.  As before, those
locations can be explicitly specified with the <code class="docutils literal notranslate"><span class="pre">--with-tcltk-includes</span></code>
and <code class="docutils literal notranslate"><span class="pre">--with-tcltk-libs</span></code> configuration options.
(Contributed by Manolis Stamatogiannakis in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42603">bpo-42603</a>.)</p></li>
<li><p>为 <code class="docutils literal notranslate"><span class="pre">configure</span></code> 脚本加入 <a class="reference internal" href="../using/configure.html#cmdoption-with-openssl-rpath"><code class="xref std std-option docutils literal notranslate"><span class="pre">--with-openssl-rpath</span></code></a> 选项。该选项简化了用定制版本 OpenSSL 编译 Python 的过程，例如 <code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">--with-openssl=/path/to/openssl</span> <span class="pre">--with-openssl-rpath=auto</span></code>。（由 Christian Heimes 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43466">bpo-43466</a> ）</p></li>
</ul>
</section>
<section id="c-api-changes">
<h2>C API 的变化<a class="headerlink" href="#c-api-changes" title="永久链接至标题">¶</a></h2>
<section id="pep-652-maintaining-the-stable-abi">
<h3>PEP 652：稳定版 ABI 的维护<a class="headerlink" href="#pep-652-maintaining-the-stable-abi" title="永久链接至标题">¶</a></h3>
<p>现在，用于扩展模块或嵌入 Python 的稳定版 ABI （应用程序二进制接口）已有显式的定义。 <a class="reference internal" href="../c-api/stable.html#stable"><span class="std std-ref">C API 的稳定性</span></a> 描述了 C API 和 ABI 稳定性保证和稳定版 ABI 的最佳实践。</p>
<p>（由 Petr Viktorin 在 <span class="target" id="index-110"></span><a class="pep reference external" href="https://peps.python.org/pep-0652/"><strong>PEP 652</strong></a> 和 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43795">bpo-43795</a> 中贡献。）.)</p>
</section>
<section id="id1">
<h3>新的特性<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>现在 <a class="reference internal" href="../c-api/number.html#c.PyNumber_Index" title="PyNumber_Index"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyNumber_Index()</span></code></a> 的结果一定是 <a class="reference internal" href="../library/functions.html#int" title="int"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> 类型。此前可能是 <code class="docutils literal notranslate"><span class="pre">int</span></code> 的子类实例。（由 Serhiy Storchaka 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40792">bpo-40792</a> ）</p></li>
<li><p>Add a new <a class="reference internal" href="../c-api/init_config.html#c.PyConfig.orig_argv" title="PyConfig.orig_argv"><code class="xref c c-member docutils literal notranslate"><span class="pre">orig_argv</span></code></a> member to the <a class="reference internal" href="../c-api/init_config.html#c.PyConfig" title="PyConfig"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyConfig</span></code></a>
structure: the list of the original command line arguments passed to the
Python executable.
(Contributed by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=23427">bpo-23427</a>.)</p></li>
<li><p>加入宏 <a class="reference internal" href="../c-api/datetime.html#c.PyDateTime_DATE_GET_TZINFO" title="PyDateTime_DATE_GET_TZINFO"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDateTime_DATE_GET_TZINFO()</span></code></a> 和 <a class="reference internal" href="../c-api/datetime.html#c.PyDateTime_TIME_GET_TZINFO" title="PyDateTime_TIME_GET_TZINFO"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDateTime_TIME_GET_TZINFO()</span></code></a> ，用于访问 <a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> 和 <a class="reference internal" href="../library/datetime.html#datetime.time" title="datetime.time"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.time</span></code></a> 对象的 <code class="docutils literal notranslate"><span class="pre">tzinfo</span></code> 属性。 （由 Zackery Spytz 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=30155">bpo-30155</a> ）</p></li>
<li><p>加入 <a class="reference internal" href="../c-api/codec.html#c.PyCodec_Unregister" title="PyCodec_Unregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCodec_Unregister()</span></code></a> 函数，用于注销编解码器检索函数。（由 Hai Shi 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41842">bpo-41842</a> ）</p></li>
<li><p>加入 <a class="reference internal" href="../c-api/iter.html#c.PyIter_Send" title="PyIter_Send"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyIter_Send()</span></code></a> 函数，可不触发 <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> 异常地向迭代器发送数据。（由 Vladimir Matveev 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41756">bpo-41756</a> ）</p></li>
<li><p>受限 C API 中加入了 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUTF8AndSize" title="PyUnicode_AsUTF8AndSize"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUTF8AndSize()</span></code></a> 。（由 Alex Gaynor 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41784">bpo-41784</a> ）</p></li>
<li><p>加入 <a class="reference internal" href="../c-api/module.html#c.PyModule_AddObjectRef" title="PyModule_AddObjectRef"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_AddObjectRef()</span></code></a> 函数：类似于 <a class="reference internal" href="../c-api/module.html#c.PyModule_AddObject" title="PyModule_AddObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyModule_AddObject()</span></code></a> 但在成功后不会偷取参数对象的引用计数。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=1635741">bpo-1635741</a> ）</p></li>
<li><p>加入 <a class="reference internal" href="../c-api/refcounting.html#c.Py_NewRef" title="Py_NewRef"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_NewRef()</span></code></a> 和 <a class="reference internal" href="../c-api/refcounting.html#c.Py_XNewRef" title="Py_XNewRef"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_XNewRef()</span></code></a> 函数，用于递增指定对象的引用计数并返回该对象。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42262">bpo-42262</a> ）</p></li>
<li><p>现在， <a class="reference internal" href="../c-api/type.html#c.PyType_FromSpecWithBases" title="PyType_FromSpecWithBases"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromSpecWithBases()</span></code></a> 和 <a class="reference internal" href="../c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a> 函数可接受一个类作为 <em>bases</em> 参数。（由 Serhiy Storchaka 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42423">bpo-42423</a> ）</p></li>
<li><p><a class="reference internal" href="../c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_FromModuleAndSpec()</span></code></a> 函数现在接受 NULL <code class="docutils literal notranslate"><span class="pre">tp_doc</span></code> 槽位。 （由 Hai Shi 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41832">bpo-41832</a> 中贡献。）</p></li>
<li><p><a class="reference internal" href="../c-api/type.html#c.PyType_GetSlot" title="PyType_GetSlot"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyType_GetSlot()</span></code></a> 函数现在可以接受 <a class="reference internal" href="../c-api/typeobj.html#static-types"><span class="std std-ref">静态类型</span></a>。 （由 Hai Shi 和 Petr Viktorin 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41073">bpo-41073</a> 中贡献。）</p></li>
<li><p>新增 <a class="reference internal" href="../c-api/set.html#c.PySet_CheckExact" title="PySet_CheckExact"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySet_CheckExact()</span></code></a> 函数到 C-API 用于检查一个对象是否是 <a class="reference internal" href="../library/stdtypes.html#set" title="set"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> 的实例但不是其子类型的实例。 （由 Pablo Galindo 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43277">bpo-43277</a> 中贡献。）</p></li>
<li><p>增加了 <a class="reference internal" href="../c-api/exceptions.html#c.PyErr_SetInterruptEx" title="PyErr_SetInterruptEx"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyErr_SetInterruptEx()</span></code></a>，它允许传入一个信号序号用于进行模拟。 （由 Antoine Pitrou 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43356">bpo-43356</a> 中贡献。）</p></li>
<li><p>现在，<a class="reference internal" href="../using/configure.html#debug-build"><span class="std std-ref">Python 以调试模式编译</span></a> 时也支持受限 C API 的使用了（需先定义 <code class="docutils literal notranslate"><span class="pre">Py_DEBUG</span></code> 宏）。在受限 C API 中，如果 Python 是以调试模式编译的，且 <code class="docutils literal notranslate"><span class="pre">Py_LIMITED_API</span></code> 宏以 Python 3.10 以上版本为目标，那么现在 <a class="reference internal" href="../c-api/refcounting.html#c.Py_INCREF" title="Py_INCREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_INCREF()</span></code></a> 和 <a class="reference internal" href="../c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF()</span></code></a> 函数实现为非透明的函数调用，而非直接访问 <a class="reference internal" href="../c-api/typeobj.html#c.PyObject.ob_refcnt" title="PyObject.ob_refcnt"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyObject.ob_refcnt</span></code></a> 成员。在调试模式下支持受限 C API 成为可能，是因为自 Python 3.8 起 <a class="reference internal" href="../c-api/structures.html#c.PyObject" title="PyObject"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a> 结构体在发布模式和调试模式下是相同的（参见 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36465">bpo-36465</a> ）。</p>
<p>在 <a class="reference internal" href="../using/configure.html#cmdoption-with-trace-refs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--with-trace-refs</span></code></a> 特殊编译方式下（<code class="docutils literal notranslate"><span class="pre">Py_TRACE_REFS</span></code> 宏），仍不支持使用受限 C API 。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43688">bpo-43688</a> ）</p>
</li>
<li><p>加入 <a class="reference internal" href="../c-api/structures.html#c.Py_Is" title="Py_Is"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Is(x,</span> <span class="pre">y)</span></code></a> 函数，用于测试 <em>x</em> 对象是否是 <em>y</em> 对象，等价于 Python 中的 <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code>。还加入了 <a class="reference internal" href="../c-api/structures.html#c.Py_IsNone" title="Py_IsNone"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IsNone()</span></code></a> 、 <a class="reference internal" href="../c-api/structures.html#c.Py_IsTrue" title="Py_IsTrue"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IsTrue()</span></code></a> 、 <a class="reference internal" href="../c-api/structures.html#c.Py_IsFalse" title="Py_IsFalse"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_IsFalse()</span></code></a> 函数，分别用于测试某对象是否为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 单例、<code class="docutils literal notranslate"><span class="pre">True</span></code> 单例或 <code class="docutils literal notranslate"><span class="pre">False</span></code> 单例。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43753">bpo-43753</a> ）</p></li>
<li><p>新增由 C 代码控制垃圾回收器的函数: <a class="reference internal" href="../c-api/gcsupport.html#c.PyGC_Enable" title="PyGC_Enable"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyGC_Enable()</span></code></a>, 、<a class="reference internal" href="../c-api/gcsupport.html#c.PyGC_Disable" title="PyGC_Disable"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyGC_Disable()</span></code></a> 、 <a class="reference internal" href="../c-api/gcsupport.html#c.PyGC_IsEnabled" title="PyGC_IsEnabled"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyGC_IsEnabled()</span></code></a>。这些函数允许从 C 代码激活、停止和查询垃圾回收器的状态，而不必导入 <a class="reference internal" href="../library/gc.html#module-gc" title="gc: Interface to the cycle-detecting garbage collector."><code class="xref py py-mod docutils literal notranslate"><span class="pre">gc</span></code></a> 模块。</p></li>
<li><p>新增 <code class="xref c c-data docutils literal notranslate"><span class="pre">Py_TPFLAGS_DISALLOW_INSTANTIATION</span></code> 类型标记，用于禁止创建类型实例。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43916">bpo-43916</a> ）</p></li>
<li><p>新增 <code class="xref c c-data docutils literal notranslate"><span class="pre">Py_TPFLAGS_IMMUTABLETYPE</span></code> 类型标记，用于创建不可变类型对象：类型的属性不可设置或删除。（由 Victor Stinner 和 Erlend E. Aasland 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43908">bpo-43908</a> ）</p></li>
</ul>
</section>
<section id="id2">
<h3>移植到 Python 3.10<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">PY_SSIZE_T_CLEAN</span></code> macro must now be defined to use
<a class="reference internal" href="../c-api/arg.html#c.PyArg_ParseTuple" title="PyArg_ParseTuple"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyArg_ParseTuple()</span></code></a> and <a class="reference internal" href="../c-api/arg.html#c.Py_BuildValue" title="Py_BuildValue"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_BuildValue()</span></code></a> formats which use
<code class="docutils literal notranslate"><span class="pre">#</span></code>: <code class="docutils literal notranslate"><span class="pre">es#</span></code>, <code class="docutils literal notranslate"><span class="pre">et#</span></code>, <code class="docutils literal notranslate"><span class="pre">s#</span></code>, <code class="docutils literal notranslate"><span class="pre">u#</span></code>, <code class="docutils literal notranslate"><span class="pre">y#</span></code>, <code class="docutils literal notranslate"><span class="pre">z#</span></code>, <code class="docutils literal notranslate"><span class="pre">U#</span></code> and <code class="docutils literal notranslate"><span class="pre">Z#</span></code>.
See <a class="reference internal" href="../c-api/arg.html#arg-parsing"><span class="std std-ref">解析参数并构建值变量</span></a> and <span class="target" id="index-36"></span><a class="pep reference external" href="https://peps.python.org/pep-0353/"><strong>PEP 353</strong></a>.
(Contributed by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40943">bpo-40943</a>.)</p></li>
<li><p>由于 <a class="reference internal" href="../c-api/structures.html#c.Py_REFCNT" title="Py_REFCNT"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_REFCNT()</span></code></a> 已改为内联静态函数，<code class="docutils literal notranslate"><span class="pre">Py_REFCNT(obj)</span> <span class="pre">=</span> <span class="pre">new_refcnt</span></code> 必须换成 <code class="docutils literal notranslate"><span class="pre">Py_SET_REFCNT(obj,</span> <span class="pre">new_refcnt)</span></code>: 参见 <a class="reference internal" href="../c-api/structures.html#c.Py_SET_REFCNT" title="Py_SET_REFCNT"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_SET_REFCNT()</span></code></a> （自 Python 3.9 起提供）。为保持向下兼容，可用此宏：</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#if PY_VERSION_HEX &lt; 0x030900A4</span>
<span class="c1">#  define Py_SET_REFCNT(obj, refcnt) ((Py_REFCNT(obj) = (refcnt)), (void)0)</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>（由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=39573">bpo-39573</a> 中贡献。）</p>
</li>
<li><p>由于历史原因，曾经允许调用 <a class="reference internal" href="../c-api/dict.html#c.PyDict_GetItem" title="PyDict_GetItem"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyDict_GetItem()</span></code></a> 时不带 <a class="reference internal" href="../glossary.html#term-GIL"><span class="xref std std-term">GIL</span></a> 。 现在则不行了。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=40839">bpo-40839</a> ）</p></li>
<li><p>现在， <code class="docutils literal notranslate"><span class="pre">PyUnicode_FromUnicode(NULL,</span> <span class="pre">size)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PyUnicode_FromStringAndSize(NULL,</span> <span class="pre">size)</span></code> 会引发 <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code>。 请利用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_New" title="PyUnicode_New"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_New()</span></code></a> 获得不带初始数据的 Unicode 对象。（由 Inada Naoki 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=36346">bpo-36346</a> ）</p></li>
<li><p>私有结构体 <code class="docutils literal notranslate"><span class="pre">_PyUnicode_Name_CAPI</span></code>  （PyCapsule API <code class="docutils literal notranslate"><span class="pre">unicodedata.ucnhash_CAPI</span></code> ）已被移入内部 C API。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42157">bpo-42157</a> ）</p></li>
<li><p><a class="reference internal" href="../c-api/init.html#c.Py_GetPath" title="Py_GetPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPath()</span></code></a>, <a class="reference internal" href="../c-api/init.html#c.Py_GetPrefix" title="Py_GetPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPrefix()</span></code></a>, <a class="reference internal" href="../c-api/init.html#c.Py_GetExecPrefix" title="Py_GetExecPrefix"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetExecPrefix()</span></code></a>,
<a class="reference internal" href="../c-api/init.html#c.Py_GetProgramFullPath" title="Py_GetProgramFullPath"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetProgramFullPath()</span></code></a>, <a class="reference internal" href="../c-api/init.html#c.Py_GetPythonHome" title="Py_GetPythonHome"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetPythonHome()</span></code></a> and
<a class="reference internal" href="../c-api/init.html#c.Py_GetProgramName" title="Py_GetProgramName"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_GetProgramName()</span></code></a> functions now return <code class="docutils literal notranslate"><span class="pre">NULL</span></code> if called before
<a class="reference internal" href="../c-api/init.html#c.Py_Initialize" title="Py_Initialize"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_Initialize()</span></code></a> (before Python is initialized). Use the new
<a class="reference internal" href="../c-api/init_config.html#init-config"><span class="std std-ref">Python初始化配置</span></a> API to get the <a class="reference internal" href="../c-api/init_config.html#init-path-config"><span class="std std-ref">Python Path Configuration</span></a>.
(Contributed by Victor Stinner in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=42260">bpo-42260</a>.)</p></li>
<li><p>宏 <a class="reference internal" href="../c-api/list.html#c.PyList_SET_ITEM" title="PyList_SET_ITEM"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyList_SET_ITEM()</span></code></a> 、 <a class="reference internal" href="../c-api/tuple.html#c.PyTuple_SET_ITEM" title="PyTuple_SET_ITEM"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyTuple_SET_ITEM()</span></code></a> 和 <a class="reference internal" href="../c-api/cell.html#c.PyCell_SET" title="PyCell_SET"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCell_SET()</span></code></a> 不可再用作左值或右值。例如，现在``x = PyList_SET_ITEM(a, b, c)`` 和 <code class="docutils literal notranslate"><span class="pre">PyList_SET_ITEM(a,</span> <span class="pre">b,</span> <span class="pre">c)</span> <span class="pre">=</span> <span class="pre">x</span></code> 会失败并提示编译器错误。 这可以防止 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(PyList_SET_ITEM</span> <span class="pre">(a,</span> <span class="pre">b,</span> <span class="pre">c)</span> <span class="pre">&lt;</span> <span class="pre">0)</span> <span class="pre">...</span></code> 之类的检测发生问题。（由 Zackery Spytz 和 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=30459">bpo-30459</a> ）</p></li>
<li><p>The non-limited API files <code class="docutils literal notranslate"><span class="pre">odictobject.h</span></code>, <code class="docutils literal notranslate"><span class="pre">parser_interface.h</span></code>,
<code class="docutils literal notranslate"><span class="pre">picklebufobject.h</span></code>, <code class="docutils literal notranslate"><span class="pre">pyarena.h</span></code>, <code class="docutils literal notranslate"><span class="pre">pyctype.h</span></code>, <code class="docutils literal notranslate"><span class="pre">pydebug.h</span></code>,
<code class="docutils literal notranslate"><span class="pre">pyfpe.h</span></code>, and <code class="docutils literal notranslate"><span class="pre">pytime.h</span></code> have been moved to the <code class="docutils literal notranslate"><span class="pre">Include/cpython</span></code>
directory. These files must not be included directly, as they are already
included in <code class="docutils literal notranslate"><span class="pre">Python.h</span></code>; see <a class="reference internal" href="../c-api/intro.html#api-includes"><span class="std std-ref">包含文件</span></a>. If they have
been included directly, consider including <code class="docutils literal notranslate"><span class="pre">Python.h</span></code> instead.
(Contributed by Nicholas Sim in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=35134">bpo-35134</a>.)</p></li>
<li><p>请用 <code class="xref c c-data docutils literal notranslate"><span class="pre">Py_TPFLAGS_IMMUTABLETYPE</span></code> 类型标记来创建不可变对象。 不要依赖 <code class="xref c c-data docutils literal notranslate"><span class="pre">Py_TPFLAGS_HEAPTYPE</span></code> 来确定类型对象是否可变；请改为检查是否设置了 <code class="xref c c-data docutils literal notranslate"><span class="pre">Py_TPFLAGS_IMMUTABLETYPE</span></code>。（由 Victor Stinner 和 Erlend E. Aasland 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43908">bpo-43908</a> ）</p></li>
<li><p>The undocumented function <code class="docutils literal notranslate"><span class="pre">Py_FrozenMain</span></code> has been removed from the
limited API. The function is mainly useful for custom builds of Python.
(Contributed by Petr Viktorin in <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=26241">bpo-26241</a>.)</p></li>
</ul>
</section>
<section id="id3">
<h3>弃用<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>现在 <code class="docutils literal notranslate"><span class="pre">PyUnicode_InternImmortal()</span></code> 函数已被弃用，并将在 Python 3.12 中移除：请改用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_InternInPlace" title="PyUnicode_InternInPlace"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_InternInPlace()</span></code></a>。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41692">bpo-41692</a> ）</p></li>
</ul>
</section>
<section id="id4">
<h3>移除<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE_str*</span></code> 函数，它被用于控制 <code class="docutils literal notranslate"><span class="pre">Py_UNICODE*</span></code> 字符串。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41123">bpo-41123</a> 中贡献。）</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strlen</span></code>: 使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GetLength" title="PyUnicode_GetLength"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_GetLength()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_GET_LENGTH" title="PyUnicode_GET_LENGTH"><code class="xref c c-macro docutils literal notranslate"><span class="pre">PyUnicode_GET_LENGTH</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strcat</span></code>: 使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CopyCharacters" title="PyUnicode_CopyCharacters"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CopyCharacters()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FromFormat()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strcpy</span></code>, <code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strncpy</span></code>: 使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_CopyCharacters" title="PyUnicode_CopyCharacters"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_CopyCharacters()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Substring" title="PyUnicode_Substring"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Substring()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strcmp</span></code>: 使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Compare" title="PyUnicode_Compare"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Compare()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strncmp</span></code>: 使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_Tailmatch" title="PyUnicode_Tailmatch"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_Tailmatch()</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strchr</span></code>, <code class="docutils literal notranslate"><span class="pre">Py_UNICODE_strrchr</span></code>: 使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_FindChar" title="PyUnicode_FindChar"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_FindChar()</span></code></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">PyUnicode_GetMax()</span></code>。 请迁移到新的 (<span class="target" id="index-111"></span><a class="pep reference external" href="https://peps.python.org/pep-0393/"><strong>PEP 393</strong></a>) API。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41103">bpo-41103</a> 中贡献。）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">PyLong_FromUnicode()</span></code>。 请迁移到 <a class="reference internal" href="../c-api/long.html#c.PyLong_FromUnicodeObject" title="PyLong_FromUnicodeObject"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyLong_FromUnicodeObject()</span></code></a>。 （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41103">bpo-41103</a> 中贡献。）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">PyUnicode_AsUnicodeCopy()</span></code>。 请使用 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsUCS4Copy" title="PyUnicode_AsUCS4Copy"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsUCS4Copy()</span></code></a> 或 <a class="reference internal" href="../c-api/unicode.html#c.PyUnicode_AsWideCharString" title="PyUnicode_AsWideCharString"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyUnicode_AsWideCharString()</span></code></a> （由 Inada Naoki 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41103">bpo-41103</a> 中贡献。）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">_Py_CheckRecursionLimit</span></code> 变量：它已被 <a class="reference internal" href="../c-api/init.html#c.PyInterpreterState" title="PyInterpreterState"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyInterpreterState</span></code></a> 结构体的 <code class="docutils literal notranslate"><span class="pre">ceval.recursion_limit</span></code> 所取代。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41834">bpo-41834</a> 中贡献。）</p></li>
<li><p>移除了未记入文档的宏 <code class="docutils literal notranslate"><span class="pre">Py_ALLOW_RECURSION</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Py_END_ALLOW_RECURSION</span></code> 以及 <a class="reference internal" href="../c-api/init.html#c.PyInterpreterState" title="PyInterpreterState"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyInterpreterState</span></code></a> 结构体的 <code class="docutils literal notranslate"><span class="pre">recursion_critical</span></code> 字段。 （由 Serhiy Storchaka 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41936">bpo-41936</a> 中贡献。）</p></li>
<li><p>移除了未记入文档的 <code class="docutils literal notranslate"><span class="pre">PyOS_InitInterrupts()</span></code> 函数。Python 初始化时已隐式安装了信号处理 handler：参见 <a class="reference internal" href="../c-api/init_config.html#c.PyConfig.install_signal_handlers" title="PyConfig.install_signal_handlers"><code class="xref c c-member docutils literal notranslate"><span class="pre">PyConfig.install_signal_handlers</span></code></a>。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=41713">bpo-41713</a> ）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">PyAST_Validate()</span></code> 函数。不能再使用公有 C API 来构建 AST 对象（<code class="docutils literal notranslate"><span class="pre">mod_ty</span></code> 类型）了。该函数已不属于受限 C API（<span class="target" id="index-112"></span><a class="pep reference external" href="https://peps.python.org/pep-0384/"><strong>PEP 384</strong></a> ）。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> ）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">symtable.h</span></code> 头文件及未写入文档的函数:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyST_GetScope()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PySymtable_Build()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PySymtable_BuildObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PySymtable_Free()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_SymtableString()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Py_SymtableStringObject()</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Py_SymtableString()</span></code> 函数误为稳定版 ABI 却无法使用，因为 <code class="docutils literal notranslate"><span class="pre">symtable.h</span></code> 头文件不属于受限 C API。</p>
<p>请改用 Python <a class="reference internal" href="../library/symtable.html#module-symtable" title="symtable: Interface to the compiler's internal symbol tables."><code class="xref py py-mod docutils literal notranslate"><span class="pre">symtable</span></code></a> 模块。 （由 Victor Stinner 在 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> 中贡献。）</p>
</li>
<li><p><a class="reference internal" href="../c-api/veryhigh.html#c.PyOS_ReadlineFunctionPointer" title="PyOS_ReadlineFunctionPointer"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyOS_ReadlineFunctionPointer()</span></code></a> 已从受限 C API 头文件和 <code class="docutils literal notranslate"><span class="pre">python3.dll</span></code> 中移除，此 dll 为 Windows 中的稳定版 ABI 库。由于该函数可接受一个 <code class="docutils literal notranslate"><span class="pre">FILE*</span></code> 参数，所以无法保证其 ABI 稳定性。（由 Petr Viktorin 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43868">bpo-43868</a> ）</p></li>
<li><p>移除了 <code class="docutils literal notranslate"><span class="pre">ast.h</span></code>, <code class="docutils literal notranslate"><span class="pre">asdl.h</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Python-ast.h</span></code> 头文件。 这些函数未入文档且不属于受限 C API。这些头文件中定义的大多数名称都不带 <code class="docutils literal notranslate"><span class="pre">Py</span></code> 前缀，因此可能会造成命名冲突。比如 <code class="docutils literal notranslate"><span class="pre">Python-ast.h</span></code> 定义了一个 <code class="docutils literal notranslate"><span class="pre">Yield</span></code> 宏，就会与另一个Windows <code class="docutils literal notranslate"><span class="pre">&lt;winbase.h&gt;</span></code> 头文件中的 <code class="docutils literal notranslate"><span class="pre">Yield</span></code> 冲突。请改用 Python <a class="reference internal" href="../library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code class="xref py py-mod docutils literal notranslate"><span class="pre">ast</span></code></a> 模块。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> ）</p></li>
<li><p>移除了用到 <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">_mod</span></code> 类型的编译器和解析器函数，因为公共的 AST C API 已被移除：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyAST_Compile()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyAST_CompileEx()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyAST_CompileObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyFuture_FromAST()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyFuture_FromASTObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromFile()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromFileObject()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromFilename()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromString()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyParser_ASTFromStringObject()</span></code></p></li>
</ul>
<p>这些函数未入文档且不属于受限 C API。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> ）</p>
</li>
<li><p>移除了包含下列函数的头文件 <code class="docutils literal notranslate"><span class="pre">pyarena.h</span></code> ：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_New()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_Free()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_Malloc()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyArena_AddPyObject()</span></code></p></li>
</ul>
<p>这些函数未记入文档，且不属于受限 C API，仅由编译器内部使用。（由 Victor Stinner 贡献于 <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43244">bpo-43244</a> ）</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PyThreadState.use_tracing</span></code> 成员已被删除，以优化 Python 。(由 Mark Shannon 在: issue:<cite>43760</cite> 中贡献。)</p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Python 3.10 有什么新变化</a><ul>
<li><a class="reference internal" href="#summary-release-highlights">摘要 -- 发布重点</a></li>
<li><a class="reference internal" href="#new-features">新的特性</a><ul>
<li><a class="reference internal" href="#parenthesized-context-managers">带圆括号的上下文管理器</a></li>
<li><a class="reference internal" href="#better-error-messages">更清楚的错误消息</a><ul>
<li><a class="reference internal" href="#syntaxerrors">SyntaxError</a></li>
<li><a class="reference internal" href="#indentationerrors">IndentationError</a></li>
<li><a class="reference internal" href="#attributeerrors">AttributeError</a></li>
<li><a class="reference internal" href="#nameerrors">NameError</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pep-626-precise-line-numbers-for-debugging-and-other-tools">PEP 626：在调试和其他工具中使用精确的行号</a></li>
<li><a class="reference internal" href="#pep-634-structural-pattern-matching">PEP 634：结构化模式匹配</a><ul>
<li><a class="reference internal" href="#syntax-and-operations">语法与操作</a></li>
<li><a class="reference internal" href="#declarative-approach">声明性方式</a></li>
<li><a class="reference internal" href="#simple-pattern-match-to-a-literal">简单模式：匹配一个字面值</a><ul>
<li><a class="reference internal" href="#behavior-without-the-wildcard">无通配符的行为</a></li>
</ul>
</li>
<li><a class="reference internal" href="#patterns-with-a-literal-and-variable">带有字面值和变量的模式</a></li>
<li><a class="reference internal" href="#patterns-and-classes">模式和类</a><ul>
<li><a class="reference internal" href="#patterns-with-positional-parameters">带有位置参数的模式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nested-patterns">嵌套模式</a></li>
<li><a class="reference internal" href="#complex-patterns-and-the-wildcard">复杂模式和通配符</a></li>
<li><a class="reference internal" href="#guard">约束项</a></li>
<li><a class="reference internal" href="#other-key-features">其他关键特性</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-encodingwarning-and-encoding-locale-option">可选的 <code class="docutils literal notranslate"><span class="pre">EncodingWarning</span></code> 和 <code class="docutils literal notranslate"><span class="pre">encoding=&quot;locale&quot;</span></code> 选项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-features-related-to-type-hints">有关类型提示的新增特性</a><ul>
<li><a class="reference internal" href="#pep-604-new-type-union-operator">PEP 604: 新的类型联合运算符</a></li>
<li><a class="reference internal" href="#pep-612-parameter-specification-variables">PEP 612: 形参规格变量</a></li>
<li><a class="reference internal" href="#pep-613-typealias">PEP 613: 类型别名</a></li>
<li><a class="reference internal" href="#pep-647-user-defined-type-guards">PEP 647: 用户自定义的类型保护器</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-language-changes">其他语言特性修改</a></li>
<li><a class="reference internal" href="#new-modules">新增模块</a></li>
<li><a class="reference internal" href="#improved-modules">改进的模块</a><ul>
<li><a class="reference internal" href="#asyncio">asyncio</a></li>
<li><a class="reference internal" href="#argparse">argparse</a></li>
<li><a class="reference internal" href="#array">array</a></li>
<li><a class="reference internal" href="#asynchat-asyncore-smtpd">asynchat、asyncore 和 smtpd</a></li>
<li><a class="reference internal" href="#base64">base64</a></li>
<li><a class="reference internal" href="#bdb">bdb</a></li>
<li><a class="reference internal" href="#bisect">bisect</a></li>
<li><a class="reference internal" href="#codecs">编码器</a></li>
<li><a class="reference internal" href="#collections-abc">collections.abc</a></li>
<li><a class="reference internal" href="#contextlib">contextlib</a></li>
<li><a class="reference internal" href="#curses">curses</a></li>
<li><a class="reference internal" href="#dataclasses">dataclasses</a><ul>
<li><a class="reference internal" href="#slots">__slots__</a></li>
<li><a class="reference internal" href="#keyword-only-fields">仅限关键字字段</a></li>
</ul>
</li>
<li><a class="reference internal" href="#distutils">distutils</a></li>
<li><a class="reference internal" href="#doctest">doctest</a></li>
<li><a class="reference internal" href="#encodings">encodings</a></li>
<li><a class="reference internal" href="#enum">enum</a></li>
<li><a class="reference internal" href="#fileinput">fileinput</a></li>
<li><a class="reference internal" href="#faulthandler">faulthandler</a></li>
<li><a class="reference internal" href="#gc">gc</a></li>
<li><a class="reference internal" href="#glob">glob</a></li>
<li><a class="reference internal" href="#hashlib">hashlib</a></li>
<li><a class="reference internal" href="#hmac">hmac</a></li>
<li><a class="reference internal" href="#idle-and-idlelib">IDLE 与 idlelib</a></li>
<li><a class="reference internal" href="#importlib-metadata">importlib.metadata</a></li>
<li><a class="reference internal" href="#inspect">inspect</a></li>
<li><a class="reference internal" href="#itertools">itertools</a></li>
<li><a class="reference internal" href="#linecache">linecache</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#os-path">os.path</a></li>
<li><a class="reference internal" href="#pathlib">pathlib</a></li>
<li><a class="reference internal" href="#platform">平台</a></li>
<li><a class="reference internal" href="#pprint">pprint</a></li>
<li><a class="reference internal" href="#py-compile">py_compile</a></li>
<li><a class="reference internal" href="#pyclbr">pyclbr</a></li>
<li><a class="reference internal" href="#shelve">shelve</a></li>
<li><a class="reference internal" href="#statistics">statistics</a></li>
<li><a class="reference internal" href="#site">site</a></li>
<li><a class="reference internal" href="#socket">socket</a></li>
<li><a class="reference internal" href="#ssl">ssl</a></li>
<li><a class="reference internal" href="#sqlite3">sqlite3</a></li>
<li><a class="reference internal" href="#sys">sys</a></li>
<li><a class="reference internal" href="#thread">_thread</a></li>
<li><a class="reference internal" href="#threading">threading</a></li>
<li><a class="reference internal" href="#traceback">traceback</a></li>
<li><a class="reference internal" href="#types">types</a></li>
<li><a class="reference internal" href="#typing">typing</a></li>
<li><a class="reference internal" href="#unittest">unittest</a></li>
<li><a class="reference internal" href="#urllib-parse">urllib.parse</a></li>
<li><a class="reference internal" href="#xml">xml</a></li>
<li><a class="reference internal" href="#zipimport">zipimport</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimizations">性能优化</a></li>
<li><a class="reference internal" href="#deprecated">弃用</a></li>
<li><a class="reference internal" href="#removed">移除</a></li>
<li><a class="reference internal" href="#porting-to-python-3-10">移植到 Python 3.10</a><ul>
<li><a class="reference internal" href="#changes-in-the-python-syntax">Python 语法中的变化</a></li>
<li><a class="reference internal" href="#changes-in-the-python-api">Python API 的变化</a></li>
<li><a class="reference internal" href="#changes-in-the-c-api">C API 的变化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cpython-bytecode-changes">CPython 字节码的改变</a></li>
<li><a class="reference internal" href="#build-changes">编译版的变化</a></li>
<li><a class="reference internal" href="#c-api-changes">C API 的变化</a><ul>
<li><a class="reference internal" href="#pep-652-maintaining-the-stable-abi">PEP 652：稳定版 ABI 的维护</a></li>
<li><a class="reference internal" href="#id1">新的特性</a></li>
<li><a class="reference internal" href="#id2">移植到 Python 3.10</a></li>
<li><a class="reference internal" href="#id3">弃用</a></li>
<li><a class="reference internal" href="#id4">移除</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="3.11.html"
                          title="上一章">What's New In Python 3.11</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="3.9.html"
                          title="下一章">Python 3.9 有什么新变化</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>当前页面</h3>
    <ul class="this-page-menu">
      <li><a href="../bugs.html">提交 Bug</a></li>
      <li>
        <a href="https://github.com/python/cpython/blob/main/Doc/whatsnew/3.10.rst"
            rel="nofollow">显示源码
        </a>
      </li>
    </ul>
  </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python 模块索引"
             >模块</a> |</li>
        <li class="right" >
          <a href="3.9.html" title="Python 3.9 有什么新变化"
             >下一页</a> |</li>
        <li class="right" >
          <a href="3.11.html" title="What&#39;s New In Python 3.11"
             >上一页</a> |</li>

          <li><img src="../_static/py.svg" alt="python logo" style="vertical-align: middle; margin-top: -1px"/></li>
          <li><a href="https://www.python.org/">Python</a> &#187;</li>
          <li class="switchers">
            <div class="language_switcher_placeholder"></div>
            <div class="version_switcher_placeholder"></div>
          </li>
          <li>
              
          </li>
    <li id="cpython-language-and-version">
      <a href="../index.html">3.11.0 Documentation</a> &#187;
    </li>

          <li class="nav-item nav-item-1"><a href="index.html" >Python的新变化</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Python 3.10 有什么新变化</a></li>
                <li class="right">
                    

    <div class="inline-search" role="search">
        <form class="inline-search" action="../search.html" method="get">
          <input placeholder="快速搜索" aria-label="快速搜索" type="text" name="q" />
          <input type="submit" value="转向" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
                     |
                </li>
            
      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="../copyright.html">版权所有</a> 2001-2022, Python Software Foundation.
    <br />
    This page is licensed under the Python Software Foundation License Version 2.
    <br />
    Examples, recipes, and other code in the documentation are additionally licensed under the Zero Clause BSD License.
    <br />
    See <a href="/license.html">History and License</a> for more information.<br />
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    最后更新于 11月 24, 2022.
    <a href="/bugs.html">Found a bug</a>?
    <br />

    由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0创建。
    </div>

  </body>
</html>